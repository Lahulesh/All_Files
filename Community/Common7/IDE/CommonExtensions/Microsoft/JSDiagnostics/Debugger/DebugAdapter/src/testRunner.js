"use strict";var fT=Object.create;var Fc=Object.defineProperty;var _b=Object.getOwnPropertyDescriptor;var hT=Object.getOwnPropertyNames;var bT=Object.getPrototypeOf,wT=Object.prototype.hasOwnProperty;var m=(i,e)=>()=>(i&&(e=i(i=0)),e);var yT=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),Lb=(i,e)=>{for(var t in e)Fc(i,t,{get:e[t],enumerable:!0})},Ab=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of hT(e))!wT.call(i,o)&&o!==t&&Fc(i,o,{get:()=>e[o],enumerable:!(r=_b(e,o))||r.enumerable});return i};var w=(i,e,t)=>(t=i!=null?fT(bT(i)):{},Ab(e||!i||!i.__esModule?Fc(t,"default",{value:i,enumerable:!0}):t,i)),vT=i=>Ab(Fc({},"__esModule",{value:!0}),i),h=(i,e,t,r)=>{for(var o=r>1?void 0:r?_b(e,t):e,n=i.length-1,s;n>=0;n--)(s=i[n])&&(o=(r?s(e,t,o):s(o))||o);return r&&o&&Fc(e,t,o),o},d=(i,e)=>(t,r)=>e(t,r,i);function Pl(i,e){let t={};for(let r of Object.keys(i)){let o=i[r];e(o,r)&&(t[r]=o)}return t}function ho(i,e){let t={};for(let r of Object.keys(i)){let o=i[r];t[r]=e(o,r)}return t}function Fb(i,e){let t={};for(let r of Object.keys(i))e(r,i[r])&&(t[r]=i[r]);return t}function Mb(...i){if(i.length===0)return{};let e={},t=Object.create(null);for(let r of i)if(r)for(let o of Object.keys(r)){let n=o.toLowerCase();t[n]?e[t[n]]=r[o]:(t[n]=o,e[o]=r[o])}return e}function Bb(i,e){if(i.hasOwnProperty(e))return i[e];let t=e.toLowerCase();for(let r of Object.keys(i))if(r.toLowerCase()===t)return i[r]}function N(i){let e=zm,t=(...r)=>(e===zm&&(t.value=e=i(...r)),e);return t.forget=()=>{e=zm,t.value=void 0},t.value=void 0,t}function bo(i){let e=new Map,t=r=>{if(e.has(r))return e.get(r);let o=i(r);return e.set(r,o),o};return t.clear=()=>e.clear(),t}function jb(i){let e,t=r=>((e==null?void 0:e.arg)===r||(e={arg:r,val:i(r)}),e.val);return t.clear=()=>e=void 0,t}function Ob(i,e){let t,r=()=>{t!==void 0&&clearTimeout(t),t=setTimeout(()=>{t=void 0,e()},i)};return r.clear=()=>{t&&(clearTimeout(t),t=void 0)},r}function Nb(i,e){let t,r=()=>{t===void 0&&(t=setTimeout(()=>{t=void 0,e()},i))};return r.queued=()=>!!t,r.clear=()=>{t&&(clearTimeout(t),t=void 0)},r}function Ub(i,e){let t=[],r=[];for(let o of i)e(o)?t.push(o):r.push(o);return[t,r]}function Yi(i){let e=[];for(let t of i)e=e.concat(t);return e}var Fe,ns,Eb,Qi,Il,zm,Wo,ST,Cl,M=m(()=>{"use strict";Fe=i=>!!i,ns=i=>Pl(i,e=>e!==null),Eb=i=>Pl(i,e=>e!==void 0),Qi=i=>e=>e instanceof i,Il=(i,e)=>{debugger;throw new Error(e.replace("{value}",JSON.stringify(i)))};zm=Symbol("unset");Wo=i=>i,ST=2**31-1,Cl=()=>{let i=0;return()=>i++&ST}});var Vb,Wb,$b,xl,wo,Ge,kl=m(()=>{"use strict";M();Vb="--remote-debugging-port",Wb="--remote-debugging-pipe",$b=i=>{let e={};for(let t of i){let r=t.indexOf("=");r===-1?e[t]=null:e[t.slice(0,r)]=t.slice(r+1)}return e},xl=i=>{let e=[];for(let t of Object.keys(i)){let r=i[t];r!==void 0&&e.push(r===null?t:`${t}=${r}`)}return e},wo=class{constructor(e=[]){this.args=e;this.argMap=N(()=>$b(this.args))}add(e,t=null){return new wo(xl({...this.argMap(),[e]:t}))}remove(e){return new wo(xl({...this.argMap(),[e]:void 0}))}merge(e){return new wo(xl({...this.argMap(),...e instanceof wo?e.argMap():$b(e)}))}setConnection(e){return new wo(xl({...this.argMap(),[Wb]:e==="pipe"?null:void 0,[Vb]:e!=="pipe"?String(e):void 0}))}getSuggestedConnection(){let e=this.argMap();if(e.hasOwnProperty(Wb))return"pipe";let t=e[Vb];if(t!==void 0)return t&&Number(t)||0}filter(e){let t=this.argMap(),r=[];for(let o of Object.keys(t)){let n=t[o];e(o,n)&&r.push(n===null?o:`${o}=${n}`)}return new wo(r)}toArray(){return this.args.slice()}},Ge=wo;Ge.default=new wo(["--disable-background-networking","--disable-background-timer-throttling","--disable-backgrounding-occluded-windows","--disable-breakpad","--disable-client-side-phishing-detection","--disable-default-apps","--disable-dev-shm-usage","--disable-renderer-backgrounding","--disable-sync","--metrics-recording-only","--no-first-run","--no-default-browser-check"])});var IT={};var Vr,qb=m(()=>{"use strict";kl();Vr=require("chai");describe("BrowserArgs",()=>{it("merge",()=>{let i=new Ge(["--a","--b=foo"]).merge(["--b=bar","--c"]);(0,Vr.expect)(i.toArray()).to.deep.equal(["--a","--b=bar","--c"])}),it("add",()=>{let i=new Ge(["--a","--b=foo"]).add("--a").add("--b","bar").add("--c");(0,Vr.expect)(i.toArray()).to.deep.equal(["--a","--b=bar","--c"])}),it("remove",()=>{let i=new Ge(["--a","--b=foo"]).remove("--b");(0,Vr.expect)(i.toArray()).to.deep.equal(["--a"])}),it("getSuggestedConnection",()=>{(0,Vr.expect)(new Ge(["--a","--b=foo"]).getSuggestedConnection()).to.be.undefined,(0,Vr.expect)(new Ge(["--a","--remote-debugging-port=42"]).getSuggestedConnection()).to.equal(42),(0,Vr.expect)(new Ge(["--a","--remote-debugging-pipe"]).getSuggestedConnection()).to.equal("pipe")}),it("setConnection",()=>{let i=new Ge(["--a","--remote-debugging-port=42","--remote-debugging-pipe"]);(0,Vr.expect)(i.setConnection("pipe").toArray()).to.deep.equal(["--a","--remote-debugging-pipe"]),(0,Vr.expect)(i.setConnection(1337).toArray()).to.deep.equal(["--a","--remote-debugging-port=1337"])}),it("filter",()=>{let i=new Ge(["--a","--b=42","--c=44"]).filter((e,t)=>e==="--b"||t==="44");(0,Vr.expect)(i.toArray()).to.deep.equal(["--b=42","--c=44"])})})});function Tt(i,e,t){let r=bo(s=>{if(s)return new Gm.URL(s);throw new Error(`A valid url wasn't supplied: <${s}>`)}),o={"url.hostname":()=>r(e).hostname,"url.port":()=>r(e).port,browserInspectUri:()=>encodeURIComponent(t),browserInspectUriPath:()=>new Gm.URL(t).pathname,wsProtocol:()=>r(e).protocol==="https:"?"wss":"ws"};return i.replace(/{([^\}]+)}/g,(s,a)=>o.hasOwnProperty(a)?o[a]():s)}var Gm,Tl=m(()=>{"use strict";Gm=require("url");M()});var ss,O,$e=m(()=>{"use strict";M();ss={dispose:()=>{}},O=class{constructor(e){this.disposed=!1;this.items=[];e&&(this.items=e.slice())}get isDisposed(){return this.disposed}callback(...e){for(let t of e)this.push({dispose:t})}push(...e){return this.disposed?(e.forEach(t=>t.dispose()),e[0]):(this.items.push(...e),e[0])}disposeObject(e){this.items=this.items.filter(t=>t!==e),e.dispose()}dispose(){let e=Promise.all(this.items.map(t=>t.dispose()));return this.items=[],this.disposed=!0,e}}});var Mc,Hb,Dl,PT,Rl,zb=m(()=>{"use strict";Mc=require("fs"),Hb=require("path"),Dl=require("zlib"),PT=(i,e)=>e instanceof Error?{message:e.message,stack:e.stack}:typeof e=="bigint"?e.toString():e,Rl=class{constructor(e,t){this.file=e;this.dap=t;try{(0,Mc.mkdirSync)((0,Hb.dirname)(e),{recursive:!0})}catch{}e.endsWith(".gz")?(this.stream=(0,Dl.createGzip)(),this.stream.pipe((0,Mc.createWriteStream)(e))):this.stream=(0,Mc.createWriteStream)(e)}async setup(){var e;(e=this.dap)==null||e.output({category:"console",output:`Verbose logs are written to:
${this.file}
`})}dispose(){this.stream&&(this.stream.end(),this.stream=void 0)}write(e){var t,r;this.stream&&(this.stream.write(JSON.stringify(e,PT)+`
`),(r=(t=this.stream).flush)==null||r.call(t,Dl.constants.Z_SYNC_FLUSH))}}});function Jm(i,e=(0,Jb.tmpdir)()){if(i===!1)return{stdio:!1,logFile:null};let t={stdio:!0,logFile:Kb.join(e,`vscode-debugadapter-${(0,Gb.randomBytes)(4).toString("hex")}.json.gz`)};return i===!0?t:{...t,...i}}function Qb(i,e){let t=Jm(e),r={sinks:[]};return t.logFile&&r.sinks.push(new Rl(t.logFile,i)),r}var Gb,Jb,Kb,CT,fL,T,L=m(()=>{"use strict";Gb=require("crypto"),Jb=require("os"),Kb=w(require("path"));zb();CT={["runtime"]:null,["runtime.sourcecreate"]:null,["runtime.assertion"]:null,["runtime.launch"]:null,["runtime.target"]:null,["runtime.welcome"]:null,["runtime.exception"]:null,["runtime.sourcemap"]:null,["runtime.breakpoints"]:null,["sourcemap.parsing"]:null,["perf.function"]:null,["cdp.send"]:null,["cdp.receive"]:null,["dap.send"]:null,["dap.receive"]:null,["internal"]:null,["proxyActivity"]:null},fL=Object.keys(CT),T=Symbol("ILogger")});var as,Vt,cs,ps=m(()=>{"use strict";as=class{constructor(e,t){this.lineNumber=e;this.columnNumber=t}get base0(){return this}get base1(){return new Vt(this.lineNumber+1,this.columnNumber+1)}get base01(){return new cs(this.lineNumber,this.columnNumber+1)}compare(e){return this.lineNumber-e.lineNumber||this.columnNumber-e.columnNumber||0}},Vt=class{constructor(e,t){this.lineNumber=e;this.columnNumber=t}get base0(){return new as(this.lineNumber-1,this.columnNumber-1)}get base1(){return this}get base01(){return new cs(this.lineNumber-1,this.columnNumber)}compare(e){return this.lineNumber-e.lineNumber||this.columnNumber-e.columnNumber||0}},cs=class{constructor(e,t){this.lineNumber=e;this.columnNumber=t}get base0(){return new as(this.lineNumber-1,this.columnNumber)}get base1(){return new Vt(this.lineNumber,this.columnNumber+1)}get base01(){return this}compare(e){return this.lineNumber-e.lineNumber||this.columnNumber-e.columnNumber||0}}});function Wr(i){return new Promise((e,t)=>{let r=i.length;for(let o of i)o.then(n=>{n?(e(n),r=-1):--r===0&&e(void 0)}).catch(t)})}function le(){let i=null,e=null,t=!1,r,o=new Promise((n,s)=>{i=a=>{t=!0,r=a,n(a)},e=a=>{t=!0,s(a)}});return{resolve:i,reject:e,promise:o,get settledValue(){return r},hasSettled:()=>t}}var k,Yb,U=m(()=>{"use strict";k=i=>isFinite(i)?new Promise(e=>setTimeout(e,i)):new Promise(()=>{}),Yb=(i,e)=>{let t=setTimeout(i,e);return{dispose:()=>clearTimeout(t)}}});var _l,dt,ls=m(()=>{"use strict";_l=class{constructor(e,t){this.key=e;this.value=t}toString(){return`${this.key}: ${this.value}`}},dt=class{constructor(e,t){this.projection=e;this.initialContents=t;let r=Array.from(t||[]).map(o=>[this.projection(o[0]),new _l(o[0],o[1])]);this.projectionToKeyAndValue=new Map(r)}clear(){this.projectionToKeyAndValue.clear()}delete(e){let t=this.projection(e);return this.projectionToKeyAndValue.delete(t)}forEach(e,t){this.projectionToKeyAndValue.forEach(r=>{e.call(t,r.value,r.key,this)},t)}get(e){let t=this.projection(e),r=this.projectionToKeyAndValue.get(t);return r?r.value:void 0}has(e){return this.projectionToKeyAndValue.has(this.projection(e))}set(e,t){return this.projectionToKeyAndValue.set(this.projection(e),new _l(e,t)),this}get size(){return this.projectionToKeyAndValue.size}*entries(){for(let e of this.projectionToKeyAndValue.values())yield[e.key,e.value]}*keys(){for(let e of this.projectionToKeyAndValue.values())yield e.key}*values(){for(let e of this.projectionToKeyAndValue.values())yield e.value}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return JSON.stringify(Array.from(this.entries()))}toString(){return`MapUsingProjection<${JSON.stringify([...this.entries()])}>`}}});var S,Bc,j=m(()=>{"use strict";M();S=class{constructor(){this._listeners=new Set;this.event=(e,t,r)=>{let o={listener:e,thisArg:t};this._listeners.add(o);let n={dispose:()=>{n.dispose=()=>{},this._listeners.delete(o)}};return r&&r.push(n),n}}get size(){return this._listeners.size}fire(e){let t=!this._deliveryQueue;this._deliveryQueue||(this._deliveryQueue=[]);for(let r of this._listeners)this._deliveryQueue.push({data:r,event:e});if(t){for(let r=0;r<this._deliveryQueue.length;r++){let{data:o,event:n}=this._deliveryQueue[r];o.listener.call(o.thisArg,n)}this._deliveryQueue=void 0}}dispose(){this._listeners.clear(),this._deliveryQueue&&(this._deliveryQueue=[])}},Bc=class{constructor(){this.map=new Map;this.listeners=this.map}listen(e,t){let r=this.map.get(e);r||(r=new S,this.map.set(e,r));let o=r.event(t);return{dispose:N(()=>{o.dispose(),(r==null?void 0:r.size)===0&&this.map.delete(e)})}}emit(e,t){var r;(r=this.listeners.get(e))==null||r.fire(t)}}});async function ET(i){switch(i.type){case 0:try{let e=await Km.promises.readFile(i.file);return{id:i.id,hash:i.mode===0?(0,Xi.hash)(e):(0,Xi.shaHash)(e)}}catch{return{id:i.id}}case 1:try{return{id:i.id,hash:(0,Xi.hash)(Zb(i.data))}}catch{return{id:i.id}}case 2:try{let e=await Km.promises.readFile(i.file);return{id:i.id,matches:Xb(e,i.expected,i.checkNode)}}catch{return{id:i.id,matches:!1}}case 3:try{return{id:i.id,matches:Xb(Zb(i.data),i.expected,i.checkNode)}}catch{return{id:i.id,matches:!1}}}}function FT(i){i.on("message",e=>{ET(e).then(t=>i.postMessage(t))})}var Xi,Km,Qm,xT,kT,TT,RT,DT,_T,LT,AT,Xb,Zb,ew=m(()=>{"use strict";Xi=require("@c4312/chromehash"),Km=require("fs"),Qm=require("worker_threads"),xT=Buffer.from("(function (exports, require, module, __filename, __dirname) { "),kT=Buffer.from(`
});`),TT=Buffer.from("(function (exports, require, module, __filename, __dirname, process, global, Buffer) { return function (exports, require, module, __filename, __dirname) { "),RT=Buffer.from(`
}.call(this, exports, require, module, __filename, __dirname); });`),DT=Buffer.from("#!"),_T=Buffer.from("\r")[0],LT=Buffer.from(`
`)[0],AT=(i,e)=>i.slice(0,e.length).equals(e),Xb=(i,e,t)=>{let r=e.length===64?Xi.shaHash:Xi.hash;if(r(i)===e)return!0;if(t){if(AT(i,DT)){let o=i.indexOf(LT);return i[o-1]===_T&&o--,r(i.slice(o))===e}if(r(Buffer.concat([xT,i,kT]))===e)return!0}return r(Buffer.concat([TT,i,RT]))===e},Zb=i=>i instanceof Buffer?i:Buffer.from(i,"utf-8");Qm.parentPort&&FT(Qm.parentPort)});var tw,rw,Ll,ow=m(()=>{"use strict";tw=require("path"),rw=require("worker_threads");M();U();ew();Ll=class{constructor(e=3,t=(0,tw.join)(__dirname,"hash.js")){this.maxFailures=e;this.hasherScriptPath=t;this.idCounter=0;this.failureCount=0;this.deferredMap=new Map;this.deferCleanup=Ob(3e4,()=>this.cleanup())}async hashBytes(e,t){return(await this.send({type:1,data:t,mode:e,id:this.idCounter++})).hash}async hashFile(e,t){return(await this.send({type:0,file:t,mode:e,id:this.idCounter++})).hash}async verifyBytes(e,t,r){return(await this.send({type:3,data:e,id:this.idCounter++,expected:t,checkNode:r})).matches}async verifyFile(e,t,r){return(await this.send({type:2,file:e,id:this.idCounter++,expected:t,checkNode:r})).matches}dispose(){this.cleanup(),this.deferCleanup.clear()}send(e){let t=this.getProcess();if(!t)throw new Error("hash.js process unexpectedly exited");this.deferCleanup();let r=le();return this.deferredMap.set(e.id,{deferred:r,request:e}),t.postMessage(e),r.promise}cleanup(){this.instance&&(this.instance.removeAllListeners("exit"),this.instance.terminate(),this.instance=void 0,this.failureCount=0)}getProcess(){if(this.instance)return this.instance;if(this.failureCount>this.maxFailures)return;let e=this.instance=new rw.Worker(this.hasherScriptPath);return e.setMaxListeners(1/0),e.on("message",t=>{let r=t,o=this.deferredMap.get(r.id);o&&(o.deferred.resolve(r),this.deferredMap.delete(r.id))}),e.on("exit",()=>{this.instance=void 0,this.failureCount++;let t=this.getProcess();if(t){this.deferCleanup();for(let{request:r}of this.deferredMap.values())t.postMessage(r)}else{for(let{deferred:r}of this.deferredMap.values())r.reject(new Error("hash.js process unexpectedly exited"));this.deferredMap.clear(),this.deferCleanup.clear()}}),e}}});async function us({access:i},e){if(!e)return!1;try{return await i(e),!0}catch{return!1}}async function Wt({stat:i},e){if(e)try{return await i(e)}catch{return}}async function nw({lstat:i},e){if(e)try{return await i(e)}catch{return}}async function sw({copyFile:i,rename:e,unlink:t},r,o){try{await e(r,o)}catch{await i(r,o),await t(r)}}function aw(i){return new Promise(e=>{$r.stat(i,(t,r)=>e(t?void 0:r))})}function nr(i){return new Promise(e=>{$r.readFile(i,"utf8",async(t,r)=>{e(t?"":r)})})}var $r,iw,EL,mt,se,Ym,Al,ae=m(()=>{"use strict";$r=w(require("fs")),iw=w(require("util"));EL=iw.promisify($r.writeFile),mt=Symbol("FsUtils"),se=class{constructor(e){this.fs=e}realPath(e){return this.fs.realpath(e)}async exists(e){try{return await this.fs.access(e,$r.constants.F_OK),!0}catch{return!1}}readFile(e){return this.fs.readFile(e)}},Ym=class{constructor(e){this.dap=e}async realPath(){throw new Error("not implemented")}async exists(e){try{let{doesExists:t}=await this.dap.remoteFileExistsRequest({localFilePath:e});return t}catch{return!1}}readFile(){throw new Error("not implemented")}},Al=class{constructor(e,t,r){this.remoteFilePrefix=e;this.localFsUtils=t;this.remoteFsUtils=r}static create(e,t,r){let o=new se(t);return e!==void 0?new this(e.toLowerCase(),o,new Ym(r)):o}async exists(e){return this.selectFs(e).exists(e)}async readFile(e){return this.selectFs(e).readFile(e)}async realPath(e){return this.selectFs(e).realPath(e)}selectFs(e){return e.toLowerCase().startsWith(this.remoteFilePrefix)?this.remoteFsUtils:this.localFsUtils}}});async function ds(i,e,t){let r;if(process.platform==="win32"){let o=t.WINDIR||"C:\\Windows";r=X.join(o,"System32","where.exe")}else r="/usr/bin/which";try{if(await Wt(i,r)){let n=(await(0,pw.default)(r,[e],{env:ns(t)})).stdout.split(/\r?\n/);if(process.platform==="win32"){let s=String(t.PATHEXT||".exe").toUpperCase().split(";");for(let a of n){let c=X.extname(a).toUpperCase();if(c&&s.includes(c))return a}}else if(n.length>0)return n[0];return}return e}catch{}}async function dw(i,e,t){if(e){if(process.platform==="win32"&&!X.extname(e)){let r=t.lookup("PATHEXT");if(r){let o=r.split(";");for(let n of o){let s=e+n;if(await Wt(i,s))return s}}}if(await Wt(i,e))return e}}function $o(...i){return X.posix.isAbsolute(i[0])?E(X.posix.join(...i)):X.win32.isAbsolute(i[0])?X.win32.join(...i):X.join(...i)}function $t(...i){return X.posix.isAbsolute(i[0])?X.posix.resolve(...i):X.win32.isAbsolute(i[0])?X.win32.resolve(...i):X.resolve(...i)}function Oc(i,e){return X.posix.isAbsolute(i)?X.posix.relative(i,e):X.win32.isAbsolute(i)?X.win32.relative(i,e):X.relative(i,e)}function be(i,e=!1){if(!i)return i;if(gw(i)){let t=jc.length;i=jc+i[t].toLowerCase()+i.substr(t+1)}else Ml(i)&&(i=(e?i[0].toUpperCase():i[0].toLowerCase())+i.substr(1));return i}function K(i,e=!1){if(!i)return i;if(i=be(i,e),gw(i)){let t=jc.length;i=i.substr(0,t+1)+i.substr(t+1).replace(/\//g,"\\")}else Ml(i)&&(i=i.replace(/\//g,"\\"));return i}function E(i){return i.replace(/\\\//g,"/").replace(/\\/g,"/")}var cw,pw,lw,X,MT,BT,uw,mw,jT,jc,gw,Xm,El,Fl,Zm,Ml,Z=m(()=>{"use strict";cw=require("crypto"),pw=w(require("execa")),lw=require("os"),X=w(require("path"));ae();M();MT=process.platform==="win32"?"\\\\.\\pipe\\":(0,lw.tmpdir)(),BT=0,uw=()=>X.join(MT,`node-cdp.${process.pid}-${(0,cw.randomBytes)(4).toString("hex")}-${BT++}.sock`);mw=i=>i.includes(`.asar${X.sep}`);jT=/\/|\\/,jc="file:///",gw=i=>i.startsWith(jc)&&i[jc.length+1]===":",Xm=i=>i.split(jT);El=(i,e)=>{let t=X.relative(i,e);return t.length&&!X.isAbsolute(t)&&!t.startsWith("..")},Fl=(i,e)=>{let t=X.relative(i,e);return!X.isAbsolute(t)&&!t.startsWith("..")},Zm=i=>i.startsWith("\\\\"),Ml=i=>/^[A-Za-z]:/.test(i)||Zm(i)});async function bw(i,e,t){return!i||mw(i)?void 0:e?(typeof t=="string"?await fw.verifyBytes(t,e,!0):await fw.verifyFile(i,e,!0))?i:void 0:await new se(hw.promises).exists(i)?i:void 0}var hw,fw,ww=m(()=>{"use strict";ow();ae();Z();hw=require("fs"),fw=new Ll});var Bl,Zi,Nc=m(()=>{"use strict";Bl=class extends Error{constructor(t,r,o){super(`Unexpected ${t} response from ${r}: ${o??"<empty body>"}`);this.statusCode=t;this.url=r;this.body=o}},Zi=Symbol("IResourceProvider")});var I,ce=m(()=>{"use strict";I=class extends Error{constructor(t){super("__errorMarker"in t?t.error.format:t.format);this._cause="__errorMarker"in t?t.error:t}get cause(){return this._cause}}});function yw(i,e){i.output({category:"console",output:e+`
`})}function ge(i,e=9222){return{__errorMarker:!0,error:{id:e,format:i,showUser:!1}}}function ue(i,e=9223){return{__errorMarker:!0,error:{id:e,format:i,showUser:!0}}}var ve,eg,vw,Sw,tg,Iw,Pw,Cw,rg,xw,kw,ms,Tw,Rw,jl,Dw,Uc,Ol,_w,qo,og,Nl,Lw,Aw,Ew,Fw,Mw,de=m(()=>{"use strict";ve=w(require("@vscode/l10n"));ce();eg=()=>ue(ve.t("Attribute 'runtimeVersion' requires Node.js version manager 'nvs' or 'nvm' to be installed."),9224),vw=()=>ue(ve.t("Attribute 'runtimeVersion' with a flavor/architecture requires 'nvs' to be installed."),9225),Sw=()=>ue(ve.t("Attribute 'runtimeVersion' requires Node.js version manager 'nvm-windows' or 'nvs'."),9226),tg=(i,e)=>ue(ve.t("Node.js version '{0}' not installed using version manager {1}.",i,e),9226),Iw=i=>ue(ve.t("Cannot launch debug target in terminal ({0}).",i),9227),Pw=i=>ue(ve.t("Can't load environment variables from file ({0}).",i),9228),Cw=i=>ue(ve.t("The configured `cwd` {0} does not exist.",i),9245),rg=(i,e)=>ue(ve.t(`Can't find Node.js binary "{0}": {1}. Make sure Node.js is installed and in your PATH, or set the "runtimeExecutable" in your launch.json`,i,e),9229),xw=(i,e)=>ue(ve.t('The Node version in "{0}" is outdated (version {1}), we require at least Node 8.x.',e,i),9230),kw=i=>ue(ve.t('Invalid hit condition "{0}". Expected an expression like "> 42" or "== 2".',i),9231),ms=()=>ue(ve.t("An error occurred taking a profile from the target."),9235),Tw=()=>ue(ve.t("Please stop the running profile before starting a new one."),9236),Rw=i=>ge(i,9238),jl=(i,e,t)=>ue(e==="*"&&!t.length?ve.t('Unable to find an installation of the browser on your system. Try installing it, or providing an absolute path to the browser in the "runtimeExecutable" in your launch.json.'):ve.t('Unable to find {0} version {1}. Available auto-discovered versions are: {2}. You can set the "runtimeExecutable" in your launch.json to one of these, or provide an absolute path to the browser executable.',i,e,JSON.stringify([...new Set(t)])),9233),Dw=i=>ue(ve.t('Unable to launch browser: "{0}"',i.message),9240),Uc=i=>ue(i??ve.t("Unable to attach to browser"),9242),Ol=()=>ue(ve.t('Target page not found. You may need to update your "urlFilter" to match the page you want to debug.'),9241),_w=()=>ge(ve.t("Variables not available in async stacks"),9234),qo=(i,e)=>ue(ve.t("Syntax error setting breakpoint with condition {0} on line {1}: {2}",JSON.stringify(i.condition),i.line,e),9237),og=()=>ge(ve.t("Thread not found"),9244),Nl=(i,e)=>ue(ve.t("Could not read source map for {0}: {1}",i,e)),Lw=()=>ue(ve.t("UWP webview debugging is not available on your platform.")),Aw=()=>ue(ve.t("Could not connect to any UWP Webview pipe. Make sure your webview is hosted in debug mode, and that the `pipeName` in your `launch.json` is correct.")),Ew=i=>typeof i=="object"&&!!i&&"__errorMarker"in i,Fw=(i,e)=>i instanceof I&&i.cause.id===e,Mw=i=>ue(ve.t("The browser process exited with code {0} before connecting to the debug server. Make sure the `runtimeExecutable` is configured correctly and that it can run without errors.",i))});var Bw,jw=m(()=>{"use strict";Bw=new WeakSet});var NT,UT,sr,fs,gs,qr=m(()=>{"use strict";L();U();de();jw();ce();NT="Request",UT=i=>i.endsWith("Request"),sr=Symbol("IDapApi"),fs=Symbol("IRootDapApi"),gs=class{constructor(e,t){this.transport=e;this.logger=t;this._pendingRequests=new Map;this._requestHandlers=new Map;this._eventListeners=new Map;this.disposables=[];this._initialized=le();this.closed=!1;this._sequence=1,this.disposables.push(this.transport.messageReceived(r=>this._onMessage(r.message,r.receivedTime))),this._dap=this._createApi()}get initializedBlocker(){return this._initialized.promise}attachTelemetry(e){this.telemetryReporter=e,e.attachDap(this._dap)}dap(){return this._dap}_createApi(){return new Proxy({},{get:(e,t)=>{if(t!=="then")return t==="on"?(r,o)=>(this._requestHandlers.set(r,o),()=>this._requestHandlers.delete(r)):t==="off"?r=>this._requestHandlers.delete(r):r=>{if(UT(t))return this.enqueueRequest(t.slice(0,-NT.length),r);this._send({seq:0,type:"event",event:t,body:r})}}})}createTestApi(){let e=(o,n)=>{let s=this._eventListeners.get(o);s||(s=new Set,this._eventListeners.set(o,s)),s.add(n)},t=(o,n)=>{let s=this._eventListeners.get(o);s&&s.delete(n)},r=(o,n)=>new Promise(s=>{let a=c=>{n&&!n(c)||(t(o,a),s(c))};e(o,a)});return new Proxy({},{get:(o,n)=>n==="on"?e:n==="off"?t:n==="once"?r:s=>this.enqueueRequest(n,s)})}enqueueRequest(e,t){return new Promise(r=>{let o={seq:0,type:"request",command:e,arguments:t||{}};this._send(o),this._pendingRequests.set(o.seq,r)})}stop(){this.closed=!0,this.transport.close()}_send(e,t){if(this.closed)this.logger.warn("dap.send","Not sending message because the connection has ended",e),t==null||t();else{e.seq=this._sequence++;let r=e.type!=="event"||!Bw.has(e.body);this.transport.send(e,r,t)}}async _onMessage(e,t){var r,o,n,s;if(e.type==="request"){let a={seq:0,type:"response",request_seq:e.seq,command:e.command,success:!0};try{let c=this._requestHandlers.get(e.command);if(!c)console.error(`Unknown request: ${e.command}`);else{let p=await c(e.arguments);if(Ew(p))this._send({...a,success:!1,message:p.error.format,body:{error:p.error}});else{let l={...a,body:p};a.command==="initialize"?(this._send(l),this._initialized.resolve(this)):a.command==="disconnect"?this._send({...a,body:p},()=>{this.stop()}):this._send(l)}}(r=this.telemetryReporter)==null||r.reportOperation("dapOperation",e.command,t.elapsed().ms)}catch(c){c instanceof I?this._send({...a,success:!1,body:{error:c.cause}}):(console.error(c),this._send({...a,success:!1,body:{error:{id:9221,format:`Error processing ${e.command}: ${c.stack||c.message}`,showUser:!1,sendTelemetry:!1}}})),(o=this.telemetryReporter)==null||o.reportOperation("dapOperation",e.command,t.elapsed().ms,c)}}if(e.type==="event"){let a=this._eventListeners.get(e.event)||new Set;for(let c of a)c(e.body)}if(e.type==="response"){let a=this._pendingRequests.get(e.request_seq);if(!this.logger.assert(a,`Expected callback for request sequence ID ${e.request_seq}`))return;if(this._pendingRequests.delete(e.request_seq),e.success)a(e.body);else{let c=(s=(n=e.body)==null?void 0:n.error)==null?void 0:s.format;a(c||e.message||"Unknown error")}}}}});var fe,Rt=m(()=>{"use strict";fe=Symbol("ISourcePathResolver")});function Uw(i,e,t){return e.length>1||e[0].type!=="FunctionDeclaration"?$w(i,e,!0,t):Vw(i,[{type:"ReturnStatement",argument:{type:"CallExpression",optional:!1,arguments:[{type:"ThisExpression"},...i.map(r=>({type:"Identifier",name:r}))],callee:{type:"MemberExpression",property:{type:"Identifier",name:"call"},computed:!1,optional:!1,object:{type:"FunctionExpression",params:e[0].params,body:e[0].body}}}}],!0,t)}function $w(i,e,t,r){let o=e[e.length-1];if(o.type!=="ReturnStatement"){let n=WT(o);n&&(e=[...e.slice(0,-1),{type:"ReturnStatement",argument:n}])}return Vw(i,e,t,r)}function WT(i){switch(i.type){case"ExpressionStatement":return i.expression;case"BlockStatement":return{type:"CallExpression",arguments:[],callee:{type:"ArrowFunctionExpression",params:[],expression:!1,body:i},optional:!1};case"ReturnStatement":return i.argument||void 0;default:return}}var Ow,Ul,ng,Ho,sg,Nw,zo,Vl,Vw,VT,Ww,hs=m(()=>{"use strict";Ow=require("acorn"),Ul=require("acorn-loose"),ng={ecmaVersion:"latest",locations:!0,allowAwaitOutsideFunction:!0,allowImportExportEverywhere:!0,allowReserved:!0,allowReturnOutsideFunction:!0},Ho=i=>i.start,sg=i=>i.end,Nw=(i,e)=>i.slice(Ho(e),sg(e)),zo=(i,e=!1)=>(e?Ow.parse:Ul.parse)(i,ng),Vl=i=>{let e=zo(i);for(let t of e.body)t.type==="FunctionDeclaration"&&t.id&&(0,Ul.isDummy)(t.id)&&(t.id=null);return e.body};Vw=(i,e,t,r)=>{let o={type:"Identifier",name:"e"},s=r?[{type:"TryStatement",block:{type:"BlockStatement",body:e},handler:{type:"CatchClause",param:o,body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"LogicalExpression",left:{type:"LogicalExpression",left:{type:"MemberExpression",object:o,property:{type:"Identifier",name:"stack"},computed:!1,optional:!1},operator:"||",right:{type:"MemberExpression",object:o,property:{type:"Identifier",name:"message"},computed:!1,optional:!1}},operator:"||",right:{type:"CallExpression",callee:{type:"Identifier",name:"String"},arguments:[o],optional:!1}}}]}}}]:e;return t?{type:"FunctionExpression",id:{type:"Identifier",name:"_generatedCode"},params:i.map(a=>({type:"Identifier",name:a})),body:{type:"BlockStatement",body:s}}:{type:"ArrowFunctionExpression",params:i.map(a=>({type:"Identifier",name:a})),expression:!1,body:{type:"BlockStatement",body:s}}},VT=(i,e)=>({type:"CallExpression",arguments:i.map(t=>({type:"Identifier",name:t})),callee:e,optional:!1}),Ww=(i,e,t)=>VT(i,$w(i,e,t,!0))});var ag,en,cg=m(()=>{"use strict";Z();B();ag=class{constructor(e,t,r,o,n){this.original=e;this.metadata=t;this.actualRoot=r;this.actualSources=o;this.hasNames=n;this.sourceActualToOriginal=new Map;this.sourceOriginalToActual=new Map;this.id=ag.idCounter++;if(o.length!==e.sources.length)throw new Error("Expected actualSources.length === original.source.length");for(let s=0;s<o.length;s++)this.sourceActualToOriginal.set(o[s],e.sources[s]),this.sourceOriginalToActual.set(e.sources[s],o[s])}get sources(){return this.actualSources.slice()}get sourceRoot(){return this.actualRoot}computedSourceUrl(e){return K(Wl(rt(this.metadata.sourceMapUrl)?this.metadata.compiledPath:this.metadata.sourceMapUrl,this.sourceRoot+e))}computeColumnSpans(){this.original.computeColumnSpans()}originalPositionFor(e){let t=this.original.originalPositionFor(e);return t.source&&(t.source=this.sourceOriginalToActual.get(t.source)??t.source),t}generatedPositionFor(e){return this.original.generatedPositionFor({...e,source:this.sourceActualToOriginal.get(e.source)??e.source})}allGeneratedPositionsFor(e){return this.original.allGeneratedPositionsFor({...e,source:this.sourceActualToOriginal.get(e.source)??e.source})}hasContentsOfAllSources(){return this.original.hasContentsOfAllSources()}sourceContentFor(e,t){return this.original.sourceContentFor(this.sourceActualToOriginal.get(e)??e,t)}eachMapping(e,t,r){return this.original.eachMapping(e,t,r)}destroy(){this.original.destroy()}},en=ag;en.idCounter=0});async function Hw(i,e,t,r){let o=$l.Parser.parse(e,{locations:!0,ecmaVersion:"latest"}),n=new Vc.SourceMapGenerator({file:i}),s=(0,pg.generate)(o,{sourceMap:{setSourceContent:(a,c)=>n.setSourceContent(a,c),applySourceMap:(a,c,p)=>n.applySourceMap(a,c,p),toJSON:()=>n.toJSON(),toString:()=>n.toString(),addMapping:a=>n.addMapping({generated:a.original,original:{column:a.generated.column,line:a.generated.line},source:i,name:a.name})}});return n.setSourceContent(i,s),new en(await Vc.SourceMapConsumer.fromSourceMap(n),{sourceMapUrl:r,compiledPath:t},"",[i],!1)}function zw(i){let e;try{e=zo(i,!0)}catch{return}let t=(c,p)=>({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:c,right:p}}),r=!1,o=!1,n=(0,bs.replace)(e,{enter(c,p){switch(c.type){case"ClassDeclaration":return t(c.id||{type:"Identifier",name:"_default"},{...c,type:"ClassExpression"});case"FunctionDeclaration":return this.skip(),t(c.id||{type:"Identifier",name:"_default"},{...c,type:"FunctionExpression"});case"FunctionExpression":case"ArrowFunctionExpression":case"MethodDefinition":return bs.VisitorOption.Skip;case"AwaitExpression":r=!0;return;case"ForOfStatement":c.await&&(r=!0);return;case"ReturnStatement":o=!0;return;case"VariableDeclaration":if(!p||!("body"in p)||!(p.body instanceof Array))return;let l=p.body,u=c.declarations.map(f=>({type:"ExpressionStatement",expression:{type:"UnaryExpression",operator:"void",prefix:!0,argument:{type:"AssignmentExpression",operator:"=",left:f.id,right:f.init||{type:"Identifier",name:"undefined"}}}}));l.splice(l.indexOf(c),1,...u)}}});if(!r||o)return;let s=n.body[n.body.length-1];s.type==="ExpressionStatement"&&(n.body[n.body.length-1]={type:"ReturnStatement",argument:s.expression});let a={type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"ArrowFunctionExpression",params:[],generator:!1,expression:!1,async:!0,body:{type:"BlockStatement",body:n.body}},arguments:[],optional:!1}};return(0,pg.generate)(a)}function Wc(i){try{let e=(0,$l.parseExpressionAt)(i,0,ng);return e.end<i.length||e.type!=="ObjectExpression"?i:`(${i})`}catch{return i}}function ws(i){if(!i)return;let e="sourceMappingURL",t=i.length,r=e.length,o=t,n=0;for(;;){if(o=i.lastIndexOf(e,o),o===-1||o<4)return;if(o-=4,i[o]==="/"&&i[o+1]==="/"&&!(i[o+2]!=="#"&&i[o+2]!=="@")&&!(i[o+3]!==" "&&i[o+3]!=="	")&&(n=o+4+r,!(n<t&&i[n]!=="=")))break}let s=i.substring(n+1),a=s.indexOf(`
`);return a!==-1&&(s=s.substring(0,a)),s.trim()}function ql(i,e,t){let r=t.generatedPositionFor({source:i,line:e.lineNumber,column:e.columnNumber-1,bias:Vc.SourceMapConsumer.GREATEST_LOWER_BOUND}),o=a=>{if(a.line===null||a.column===null)return 1e11;let c=t.originalPositionFor(a);return c.line!==null?Math.abs(e.lineNumber-c.line):1e11},n=o(r),s=t.allGeneratedPositionsFor({source:i,line:e.lineNumber,column:e.columnNumber-1}).filter(a=>a.line!==null&&a.column!==null).sort((a,c)=>a.line!==c.line?a.line-c.line:a.column-c.column).map(a=>[a,o(a)]);return s.push([r,n]),s.sort(([a,c],[p,l])=>c-l||a.line-p.line||a.column-p.column),s[0][0]}function Go(i){try{new Function(i)}catch(e){return e}}function $T(i,e){let t=zo(i),r,o;return(0,bs.traverse)(t,{enter:n=>{let s=n;e>=s.start&&e<s.end&&(n.type==="CallExpression"||n.type==="NewExpression"?o=n:r=n)}}),o||r}function Gw(i,e){try{let r=$T(i,e);if(r&&"callee"in r){let o=r.callee;return{text:`${i.slice(o.start,o.end)}(...)`,start:o.start,end:o.end}}else{let o=r;return{text:i.slice(o.start,o.end),start:o.start,end:o.end}}}catch{}qw.lastIndex=e-1;let t=qw.exec(i);if(t)return{text:t[0],start:e,end:e+t[0].length}}var $l,pg,bs,Vc,lg,qw,Dt=m(()=>{"use strict";$l=require("acorn"),pg=require("astring"),bs=require("estraverse"),Vc=require("source-map");hs();cg();lg=(i,e)=>!!e&&((e.type==="FunctionExpression"||e.type==="FunctionDeclaration"||e.type==="ArrowFunctionExpression")&&e.params.includes(i)||(e.type==="ForInStatement"||e.type==="ForOfStatement")&&e.left===i||e.type==="VariableDeclarator"&&e.id===i||e.type==="AssignmentPattern"&&e.left===i||e.type==="CatchClause"&&e.param===i||"kind"in e&&e.kind==="init"&&e.value===i||e.type==="RestElement"&&e.argument===i||e.type==="AssignmentPattern"&&e.left===i);qw=/^[^()]+/g});function tn(i){return qT(""+i)}function qT(i){let e=(0,Jw.parseExpressionAt)(i,0,{ecmaVersion:"latest",locations:!0});if(e.type!=="FunctionExpression")throw new Error(`Could not find function declaration for:

${i}`);let t=e.params.map(s=>{if(s.type!=="Identifier")throw new Error("Parameter must be identifier");return s.name}),{start:r,end:o}=e.body,n=s=>`
    ${s.map((a,c)=>`let ${t[c]} = ${a}`).join("; ")};
    ${i.slice(r+1,o-1)}
  `;return{expr:(...s)=>`(()=>{${n(s)}})();
${Re()}`,decl:(...s)=>`function(){${n(s)};
${Re()}}`}}function gt(i){let e=(""+i).replace("}",Re()+"}"),t=async({cdp:r,args:o,...n})=>{let s=await r.Runtime.callFunctionOn({functionDeclaration:e,arguments:o.map(a=>a instanceof $c?{objectId:a.objectId}:{value:a}),...n});if(!s)throw new ys({exceptionId:0,text:"No response from CDP",lineNumber:0,columnNumber:0});if(s.exceptionDetails)throw new ys(s.exceptionDetails);return s.result};return t.source=e,t}var Jw,Kw,Re,ys,$c,Je=m(()=>{"use strict";Jw=require("acorn"),Kw=require("crypto");Dt();Re=()=>`
//# sourceURL=eval-${(0,Kw.randomBytes)(4).toString("hex")}${".cdp"}
`;ys=class extends Error{constructor(t){super(t.text);this.details=t}},$c=class{constructor(e){this.objectId=e}}});var Qw,Yw=m(()=>{"use strict";Je();Qw=()=>"globalThis.__jsDebugIsReady = true; "+Re()});var Xw,qc,gg,mg,HT,Jo,Ko=m(()=>{"use strict";Xw=require("url");j();B();Yw();qc=new Set(["page","iframe","worker","service_worker"]),gg=new Set(["page","iframe"]),mg=new Set(["page","iframe"]),HT=mg,Jo=class{constructor(e,t,r,o,n,s,a,c,p){this._manager=e;this._targetInfo=t;this.launchConfig=s;this.sessionId=a;this.logger=c;this._attached=!1;this._onNameChangedEmitter=new S;this.onNameChanged=this._onNameChangedEmitter.event;this.entryBreakpoint=void 0;this._children=new Map;this.sourcePathResolver=this._manager._sourcePathResolver;this._cdp=r,r.pause(),this.parentTarget=o,this._waitingForDebugger=n,this._updateFromInfo(t),this._ondispose=p}get targetInfo(){return this._targetInfo}get targetId(){return this._targetInfo.targetId}get independentLifeycle(){return mg.has(this.type())}get supplementalConfig(){let e=this.type();return{__browserTargetType:e,__usePerformanceFromParent:e!=="page"}}targetOrigin(){return this._manager._targetOrigin}id(){return this.sessionId}cdp(){return this._cdp}name(){return this._computeName()}fileName(){return this._targetInfo.url}type(){return this._targetInfo.type}afterBind(){return this._cdp.resume(),Promise.resolve()}initialize(){return Promise.resolve()}async runIfWaitingForDebugger(){await Promise.all([this._cdp.Runtime.runIfWaitingForDebugger({}),this._cdp.Runtime.evaluate({expression:Qw()})])}parent(){return this.parentTarget&&!qc.has(this.parentTarget.type())?this.parentTarget.parentTarget:this.parentTarget}children(){let e=[];for(let t of this._children.values())qc.has(t.type())?e.push(t):e.push(...t.children());return e}canStop(){return HT.has(this.type())}stop(){if(this._manager.targetList().includes(this))if(this.type()==="service_worker"){if(this._manager.serviceWorkerModel.stopWorker(this.id()),!this.parentTarget)return;this._manager.serviceWorkerModel.stopWorker(this.parentTarget.id())}else this._cdp.Target.closeTarget({targetId:this._targetInfo.targetId})}canRestart(){return mg.has(this.type())}restart(){this._cdp.Page.reload({})}waitingForDebugger(){return this._waitingForDebugger}canAttach(){return!this._attached}async attach(){return this._waitingForDebugger=!1,this._attached=!0,Promise.resolve(this._cdp)}canDetach(){return this._attached}async detach(){this._attached=!1,this._manager._detachedFromTarget(this.sessionId)}executionContextName(e){let t=e.auxData,r=e.name;if(!t)return r;let o=t.frameId,n=o?this._manager.frameModel.frameForId(o):void 0;return n&&t.isDefault&&!n.parentFrame()?"top":n&&t.isDefault?n.displayName():n?`${r}`:r}supportsCustomBreakpoints(){return gg.has(this.type())}scriptUrlToUrl(e){return Cr(this._targetInfo.url,e)||e}_updateFromInfo(e){this._targetInfo={...e,type:this._targetInfo.type},this._onNameChangedEmitter.fire()}setComputeNameFn(e){this._customNameComputeFn=e,this._onNameChangedEmitter.fire()}_computeName(){var o;let e=(o=this._customNameComputeFn)==null?void 0:o.call(this,this);if(e)return e;if(this.type()==="service_worker"){let n=this._manager.serviceWorkerModel.version(this.id());if(n)return n.label()+" [Service Worker]"}let t=this._targetInfo.title;if(!(t&&this._manager.targetList().some(n=>n instanceof Jo&&n!==this&&n._targetInfo.title===this._targetInfo.title)))return t;try{let n=new Xw.URL(this._targetInfo.url);n.protocol==="data:"?t=" <data>":n?t+=` (${this._targetInfo.url.replace(/^[a-z]+:\/\/|\/$/gi,"")})`:t+=` (${this._targetInfo.url})`}catch{t+=` (${this._targetInfo.url})`}return t}async _detached(){await this._manager.serviceWorkerModel.detached(this._cdp),this._ondispose(this)}}});function Hr(i,e){return i.length<=e?i:i.substr(0,e-1)+"\u2026"}function vs(i,e){if(i.length<=e)return i;let t=e>>1,r=e-t-1,o=i.codePointAt(i.length-r-1);o&&o>=65536&&(--r,++t);let n=i.codePointAt(t-1);return t>0&&n&&n>=65536&&--t,i.substr(0,t)+"\u2026"+i.substr(i.length-r,r)}function ot(i,e){let t=Zw.split("").filter(o=>!e||e.indexOf(o)<0).join("").replace(/[\\\]]/g,"\\$&"),r=new RegExp(`[${t}]`,"g");return i.replace(r,"\\$&")}var Zw,ey,Qo,xr=m(()=>{"use strict";Zw="/\\.?*()^${}|[]+",ey=i=>Zw.includes(i);Qo=class{constructor(e){this.source=e;this.lines=[];this.lines.push(0);for(let t=e.indexOf(`
`);t!==-1;t=e.indexOf(`
`,t+1))this.lines.push(t+1)}getLineOffset(e){return e>=this.lines.length?this.source.length:this.lines[e]}convert(e){let t=e.base0;if(t.lineNumber>this.lines.length)return this.source.length;let r=this.lines[t.lineNumber],o=this.lines[t.lineNumber+1]??this.source.length+1;return r+Math.min(o-r-1,t.columnNumber)}}});function zl(){Ss=process.platform!=="win32"}function Gl(i){Ss=i}function Gc(){return Ss}function Jl(i){return Ss?i:i.toLowerCase()}function Kl(i,e){return Ss?i===e:i.toLowerCase()===e.toLowerCase()}function rn(){return Gc()?new Map:new dt(Jl)}function Cr(i,e){try{return new yo.URL(e,i).href}catch{}}function Wl(i,e){try{return new yo.URL(e),e}catch{}let t;try{t=new yo.URL(i||"")}catch{return e}let r=t.protocol+"//";return t.username&&(r+=t.username+":"+t.password+"@"),r+=t.host,r+=qt.dirname(t.pathname),r[r.length-1]!=="/"&&(r+="/"),r+=e,r}function Yl(i){try{return new yo.URL(i),!0}catch{return!1}}function sy(i){return i.replace(/\/$/,"").replace(/\\$/,"")}function Se(i){let e=KT.exec(i);if(e)i=`${e[1]}:///${e[2]}`;else if(i.startsWith("vscode-webview-resource://"))i=new yo.URL(i).pathname.replace(/%2F/gi,"/").replace(/^\/([a-z0-9\-]+)(\/{1,2})/i,(r,o,n)=>n.length===1?`${o}:///`:`${o}://`);else if(!kr(i))return;return i=i.replace("file:///",""),i=decodeURIComponent(i),i.startsWith("/")&&process.platform==="win32"&&i[1]!=="/"&&(i="/"+i),i[0]!=="/"&&!i.match(/^[A-Za-z]:/)&&(i="/"+i),K(i)}function ay(i){return kr(i)&&(i=i.replace("file:///","\\\\"),i=i.replace(/\//g,"\\"),i=decodeURIComponent(i)),i}function W(i){return wg==="win32"?"file:///"+Yo(i):"file://"+Yo(i)}function Cs(i){return i.startsWith("/")?"file://"+Yo(i):"file:///"+Yo(i)}function ft(i){return qt.posix.isAbsolute(i)||qt.win32.isAbsolute(i)}function rt(i){return!!i&&i.startsWith("data:")}function Me(i,[e,t]=[0,i.length]){if(t<=e)return i;let r=[],o=hg(i,0,e,!1),n=hg(i,t,i.length,!1),s=i.slice(e,t);for(let a of[decodeURIComponent(s),Se(s)]){if(!a)continue;let c=hg(a,0,a.length,!0);r.push(YT(`${o}${c}${n}`).concat("($|\\?)"))}return r.join("|")}function kr(i){return i.startsWith("file:///")}function Yo(i){return i=vt(i),wg==="win32"?(Zm(i)&&(i=i.slice(1)),i.split(/[\\//]/g).map((e,t)=>t>0?encodeURIComponent(e):e).join("/")):i.split("/").map(encodeURIComponent).join("/")}function vt(i){return i&&wg==="win32"&&i[1]===":"?i[0].toUpperCase()+i.substring(1):i}function XT(i){return!!i&&!qt.isAbsolute(i)&&!!(0,yo.parse)(i).protocol}var oy,qt,yo,Ss,ry,ty,Ql,bg,Is,GT,JT,Hl,iy,ny,Ps,KT,fg,QT,Hc,hg,YT,wg,Xo,xs,ZT,B=m(()=>{"use strict";oy=require("dns"),qt=w(require("path")),yo=require("url");Ko();ls();M();Z();xr();Ss=process.platform!=="win32";ty=process.platform==="win32"?(ry=process.env.PATHEXT)==null?void 0:ry.toLowerCase().split(";"):void 0,Ql=i=>{let e=Jl(qt.basename(i));if(ty){for(let t of ty)if(e.endsWith(t))return e.slice(0,-t.length)}return e},bg=async(i,e)=>{for(;;){if(await e(i))return i;let t=qt.dirname(i);if(t===i)return;i=t}},Is=(i,e,t)=>bg(e,r=>i.exists(qt.join(r,t))),GT=new Set(["localhost","127.0.0.1","::1"]),JT=new Set(["0.0.0.0","::","0000:0000:0000:0000:0000:0000:0000:0000"]),Hl=i=>GT.has(i.toLowerCase()),iy=i=>{try{return new yo.URL(i).hostname.replace(/^\[|\]$/g,"")}catch{return i}},ny=i=>JT.has(iy(i)),Ps=bo(async i=>{let e=iy(i);if(Hl(e))return!0;try{let t=await oy.promises.lookup(e);return Hl(t.address)}catch{return!1}});KT=/^https:\/\/([a-z0-9\-]+)\+\.vscode-resource\.vscode-(?:webview|cdn)\.net\/(.+)/i;fg=(i,e,t)=>{if(!t||i===":"){e.add(i);return}if(i==="/"){e.add(`\\${i}`);return}ey(i)?e.add(`\\${i}`):e.add(i);let r=encodeURIComponent(i);i!=="\\"&&r!==i&&e.add(r)},QT=i=>{switch(i.size){case 0:return"";case 1:return i.values().next().value;default:let e=[...i];return e.some(t=>t.length>1)?`(?:${e.join("|")})`:`[${e.join("")}]`}},Hc=new Set,hg=(i,e,t,r)=>{let o="";for(let n of i.slice(e,t))Ss?fg(n,Hc,r):(fg(n.toLowerCase(),Hc,r),fg(n.toUpperCase(),Hc,r)),o+=QT(Hc),Hc.clear();return o};YT=i=>i.replace(/^(file:\\\/\\\/\\\/)?([a-z]):/i,(e,t="",r)=>`${t}[${r.toUpperCase()}${r.toLowerCase()}]:`);wg=process.platform;Xo=(i,e=[])=>{let t=i.urlFilter||"file"in i&&i.file||i.url,r=t?ZT(t,...e):void 0;return o=>!o.url.startsWith("devtools://")&&(r==null?void 0:r(o.url))!==!1},xs=i=>e=>e.type==="page"&&i(e);ZT=(...i)=>{let e=o=>{o=o.toLowerCase();let n=Se(o);n?o=n:XT(o)&&o.includes("://")&&(o=o.substr(o.indexOf("://")+3)),o.endsWith("/")&&(o=o.substr(0,o.length-1));let s=o.indexOf("#");return s!==-1&&(o=o.slice(0,o[s-1]==="/"?s-1:s)),o},t=i.map(o=>ot(e(o),"/*").replace(/(\/\*$)|\*/g,".*")),r=new RegExp("^("+t.join("|")+")$","g");return o=>(r.lastIndex=0,r.test(e(o)))}});var Zo,cy,vo,Jc,ei,Kc=m(()=>{"use strict";Zo=require("inversify"),cy=require("source-map");Nc();qr();de();ls();L();M();Rt();B();cg();vo=Symbol("ISourceMapFactory"),Jc=class{constructor(e,t,r,o){this.pathResolve=e;this.resourceProvider=t;this.dap=r;this.logger=o;this.hasWarnedAboutMaps=new WeakSet}async load(e){var s,a;let t=await this.parseSourceMap(e.sourceMapUrl),r=t.sourceRoot;t.sourceRoot=void 0;let o=!1,n=[];if("sections"in t){n=[];let c=0;for(let p of t.sections)n.push(...p.map.sources),p.map.sources=p.map.sources.map(()=>`source${c++}.js`),o||=!!((s=p.map.names)!=null&&s.length)}else"sources"in t&&Array.isArray(t.sources)&&(n=t.sources,t.sources=t.sources.map((c,p)=>`source${p}.js`),o=!!((a=t.names)!=null&&a.length));return new en(await new cy.SourceMapConsumer(t),e,r??"",n,o)}async parseSourceMap(e){let t;try{t=await this.parseSourceMapDirect(e)}catch(r){if(t=await this.parsePathMappedSourceMap(e),!t)throw r}if("sections"in t){let r=await Promise.all(t.sections.map((o,n)=>"url"in o?this.parseSourceMap(o.url).then(s=>({offset:o.offset,map:s})).catch(s=>{this.logger.warn("sourcemap.parsing",`Error parsing nested map ${n}: ${s}`)}):o));t.sections=r.filter(Fe)}return t}async parsePathMappedSourceMap(e){if(rt(e))return;let t=await this.pathResolve.urlToAbsolutePath({url:e});if(t)try{return this.parseSourceMapDirect(t)}catch(r){this.logger.info("sourcemap.parsing","Parsing path mapped source map failed.",r)}}guardSourceMapFn(e,t,r){try{return t()}catch(o){if(!/error parsing/i.test(String(o.message)))throw o;if(!this.hasWarnedAboutMaps.has(e)){let n=Nl(e.metadata.compiledPath,o.message).error;this.dap.output({output:n.format+`
`,category:"stderr"}),this.hasWarnedAboutMaps.add(e)}return r()}}dispose(){}async parseSourceMapDirect(e){let t=Se(e);t&&(t=this.pathResolve.rebaseRemoteToLocal(t));let r=await this.resourceProvider.fetch(t||e);if(!r.ok)throw r.error;let o=r.body;return o.slice(0,3)===")]}"&&(o=o.substring(o.indexOf(`
`))),JSON.parse(o)}};Jc=h([(0,Zo.injectable)(),d(0,(0,Zo.inject)(fe)),d(1,(0,Zo.inject)(Zi)),d(2,(0,Zo.inject)(fs)),d(3,(0,Zo.inject)(T))],Jc);ei=class extends Jc{constructor(){super(...arguments);this.knownMaps=new dt(t=>t.toLowerCase());this.overwrittenSourceMaps=[]}load(t){let r=this.knownMaps.get(t.sourceMapUrl);if(!r)return this.loadNewSourceMap(t);let o=t.cacheKey,n=r.metadata.cacheKey;return r.reloadIfNoMtime?o&&n&&o===n?(r.reloadIfNoMtime=!1,r.prom):(this.overwrittenSourceMaps.push(r.prom),this.loadNewSourceMap(t)):n&&o&&o!==n?(this.overwrittenSourceMaps.push(r.prom),this.loadNewSourceMap(t)):r.prom}loadNewSourceMap(t){let r=super.load(t);return this.knownMaps.set(t.sourceMapUrl,{metadata:t,reloadIfNoMtime:!1,prom:r}),r}dispose(){for(let t of this.knownMaps.values())t.prom.then(r=>r.destroy(),()=>{});for(let t of this.overwrittenSourceMaps)t.then(r=>r.destroy(),()=>{});this.knownMaps.clear()}invalidateCache(){for(let t of this.knownMaps.values())t.reloadIfNoMtime=!0}};ei=h([(0,Zo.injectable)()],ei)});var yg,ks,eR,tR,UA,rR,ti,Ke,_t,ar,vg,Qc,F=m(()=>{"use strict";yg=new Map([["pwa-node","node"],["pwa-chrome","chrome"],["pwa-extensionHost","extensionHost"],["pwa-msedge","msedge"]]),ks=i=>yg.get(i)||i,eR={["pwa-extensionHost"]:null,["node-terminal"]:null,["pwa-node"]:null,["pwa-chrome"]:null,["pwa-msedge"]:null},tR={["extension.js-debug.addCustomBreakpoints"]:null,["extension.pwa-node-debug.attachNodeProcess"]:null,["extension.js-debug.clearAutoAttachVariables"]:null,["extension.js-debug.setAutoAttachVariables"]:null,["extension.js-debug.autoAttachToProcess"]:null,["extension.js-debug.createDebuggerTerminal"]:null,["extension.js-debug.createDiagnostics"]:null,["extension.js-debug.getDiagnosticLogs"]:null,["extension.js-debug.debugLink"]:null,["extension.js-debug.npmScript"]:null,["extension.js-debug.pickNodeProcess"]:null,["extension.js-debug.prettyPrint"]:null,["extension.js-debug.removeAllCustomBreakpoints"]:null,["extension.js-debug.removeCustomBreakpoint"]:null,["extension.js-debug.revealPage"]:null,["extension.js-debug.startProfile"]:null,["extension.js-debug.stopProfile"]:null,["extension.js-debug.toggleSkippingFile"]:null,["extension.node-debug.startWithStopOnEntry"]:null,["extension.js-debug.requestCDPProxy"]:null,["extension.js-debug.openEdgeDevTools"]:null,["extension.js-debug.callers.add"]:null,["extension.js-debug.callers.goToCaller"]:null,["extension.js-debug.callers.gotToTarget"]:null,["extension.js-debug.callers.remove"]:null,["extension.js-debug.callers.removeAll"]:null,["extension.js-debug.enableSourceMapStepping"]:null,["extension.js-debug.disableSourceMapStepping"]:null},UA=new Set(Object.keys(tR)),rR=new Set(Object.keys(eR)),ti=i=>rR.has(i),Ke=(i,e,t)=>i.registerCommand(e,t),_t=async(i,e,...t)=>await i.executeCommand(e,...t),ar=(i,e,t)=>i.getConfiguration(void 0,t).get(e),vg=(i,e,t,r)=>i.getConfiguration().update(e,t,r),Qc=async(i,e,t)=>await i.executeCommand("setContext",e,t)});function So(i){return{"webpack:///./~/*":`${i}/node_modules/*`,"webpack:////*":"/*","webpack://@?:*/?:*/*":`${i}/*`,"webpack://?:*/*":`${i}/*`,"webpack:///([a-z]):/(.+)":"$1:/$2","meteor://\u{1F4BB}app/*":`${i}/*`}}function Cg({...i}){return Zl(i),i.request==="attach"?{...ri,...i}:{...Xc,...i}}function iR(i,e){return i.request==="attach"?{...Zc,browserAttachLocation:e,...i}:{...Ts,browserLaunchLocation:e,...i}}function nR(i,e){return i.request==="attach"?{...Ig,browserAttachLocation:e,...i}:{...Pg,browserLaunchLocation:e,...i}}function sR(i){let e={...Sg,...i};return e.skipFiles=[...e.skipFiles,"**/node_modules.asar/**","**/bootstrap-fork.js"],e}function xg(i){return Zl(i),i.request==="launch"?{...py,...i}:{...oR,...i}}function Rs(i,e){let t,r=e==="remote"?"ui":"workspace";switch(i.type){case"pwa-node":t=Cg(i);break;case"pwa-msedge":t=nR(i,r);break;case"pwa-chrome":t=iR(i,r);break;case"pwa-extensionHost":t=sR(i);break;case"node-terminal":t=xg(i);break;default:throw Il(i,"Unknown config: {value}")}return Tg(t)}function kg(i){var r,o,n;let e="${workspaceFolder}",t={...i,rootPath:void 0,outFiles:i.outFiles.filter(s=>!s.includes(e)),sourceMapPathOverrides:Pl(i.sourceMapPathOverrides,s=>!s.includes("${workspaceFolder}"))};return"vueComponentPaths"in t&&(t.vueComponentPaths=t.vueComponentPaths.filter(s=>!s.includes(e))),"resolveSourceMapLocations"in t&&(t.resolveSourceMapLocations=((r=t.resolveSourceMapLocations)==null?void 0:r.filter(s=>!s.includes(e)))??null),"cwd"in t&&((o=t.cwd)!=null&&o.includes(e))&&(t.cwd=void 0),"webRoot"in t&&((n=t.webRoot)!=null&&n.includes(e))&&(t.webRoot="/"),t}function Tg(i){return i.__workspaceFolder||(i=kg(i)),i=zr(i,"workspaceFolder",i.__workspaceFolder),i=zr(i,"webRoot","webRoot"in i?i.webRoot:i.__workspaceFolder),i}function zr(i,e,t){let r;if(typeof i=="string")r=i.replace(new RegExp(`\\$\\{${e}\\}`,"g"),()=>{if(!t)throw new Error(`Unable to resolve \${${e}} in configuration (${JSON.stringify(e)})`);return t});else if(i instanceof Array)r=i.map(o=>zr(o,e,t));else if(typeof i=="object"&&i){let o={};for(let[n,s]of Object.entries(i))o[zr(n,e,t)]=zr(s,e,t);r=o}else r=i;return r}var ie,Xl,Yc,py,oR,Sg,Xc,Zc,Ig,Ts,Pg,ri,Zl,eu,tu,on,aR,ru,qA,H=m(()=>{"use strict";F();M();ie=Symbol("AnyLaunchConfiguration"),Xl={type:"",name:"",request:"",trace:!1,outputCapture:"console",timeout:1e4,timeouts:{},showAsyncStacks:!0,skipFiles:[],smartStep:!0,sourceMaps:!0,sourceMapRenames:!0,pauseForSourceMap:!0,resolveSourceMapLocations:null,rootPath:"${workspaceFolder}",outFiles:["${workspaceFolder}/**/*.js","!**/node_modules/**"],sourceMapPathOverrides:So("${workspaceFolder}"),enableContentValidation:!0,cascadeTerminateToConfigurations:[],__workspaceFolder:"",__remoteFilePrefix:void 0,__breakOnConditionalError:!1,customDescriptionGenerator:void 0,customPropertiesGenerator:void 0},Yc={...Xl,cwd:"${workspaceFolder}",env:{},envFile:null,pauseForSourceMap:!1,sourceMaps:!0,localRoot:null,remoteRoot:null,resolveSourceMapLocations:["**","!**/node_modules/**"],autoAttachChildProcesses:!0,runtimeSourcemapPausePatterns:[],skipFiles:["<node_internals>/**"]},py={...Yc,showAsyncStacks:{onceBreakpointResolved:16},type:"node-terminal",request:"launch",name:"JavaScript Debug Terminal"},oR={...Yc,type:"node-terminal",request:"attach",name:py.name,showAsyncStacks:{onceBreakpointResolved:16},delegateId:-1},Sg={...Yc,type:"pwa-extensionHost",name:"Debug Extension",request:"launch",args:["--extensionDevelopmentPath=${workspaceFolder}"],outFiles:["${workspaceFolder}/out/**/*.js"],resolveSourceMapLocations:["${workspaceFolder}/**","!**/node_modules/**"],rendererDebugOptions:{},runtimeExecutable:"${execPath}",autoAttachChildProcesses:!1,debugWebviews:!1,debugWebWorkerHost:!1,__sessionId:""},Xc={...Yc,type:"pwa-node",request:"launch",program:"",cwd:"${workspaceFolder}",stopOnEntry:!1,console:"internalConsole",restart:!1,args:[],runtimeExecutable:"node",runtimeVersion:"default",runtimeArgs:[],profileStartup:!1,attachSimplePort:null,killBehavior:"forceful"},Zc={...Xl,type:"pwa-chrome",request:"attach",address:"localhost",port:0,disableNetworkCache:!0,pathMapping:{},url:null,restart:!1,urlFilter:"",sourceMapPathOverrides:So("${webRoot}"),webRoot:"${workspaceFolder}",server:null,browserAttachLocation:"workspace",targetSelection:"automatic",vueComponentPaths:["${workspaceFolder}/**/*.vue","!**/node_modules/**"],perScriptSourcemaps:"auto"},Ig={...Zc,type:"pwa-msedge",useWebView:!1},Ts={...Zc,type:"pwa-chrome",request:"launch",cwd:null,file:null,env:{},urlFilter:"*",includeDefaultArgs:!0,includeLaunchArgs:!0,runtimeArgs:null,runtimeExecutable:"*",userDataDir:!0,browserLaunchLocation:"workspace",profileStartup:!1,cleanUp:"wholeBrowser"},Pg={...Ts,type:"pwa-msedge",useWebView:!1},ri={...Yc,type:"pwa-node",attachExistingChildren:!0,address:"localhost",port:9229,restart:!1,request:"attach",continueOnAttach:!1};Zl=i=>{!i.sourceMapPathOverrides&&i.cwd&&(i.sourceMapPathOverrides=So(i.cwd)),i.resolveSourceMapLocations===void 0&&!i.remoteRoot&&(i.resolveSourceMapLocations=i.outFiles)};eu=["javascript","typescript","typescriptreact","javascriptreact","fsharp","html"],tu="js-debug",on="1.78.0",aR="ms-vscode",ru=tu.includes("nightly"),qA=`${aR}.${tu}`});var Ds,Gr,Lt,cr,_s,De,Dg,ep,z,Io,nn,ou,Rg,Ce,iu,pr,G=m(()=>{"use strict";Ds=Symbol("IContainer"),Gr=Symbol("StoragePath"),Lt=Symbol("IInitializeParams"),cr=Symbol("VSCodeApi"),_s=Symbol("IsVSCode"),De=Symbol("ExtensionContext"),Dg=Symbol("ProcessEnv"),ep=Symbol("execa"),z=Symbol("FS"),Io="ExtensionLocation",nn=Symbol("IBrowserFinder"),ou=Symbol("SessionSubStates"),Rg=new WeakMap,Ce=(i,e)=>{if(!(typeof e=="object"&&e&&"dispose"in e))return e;let t=e,r=Rg.get(i.container);return r?r.push(t):Rg.set(i.container,[t]),e},iu=i=>{var e;(e=Rg.get(i))==null||e.forEach(t=>t.dispose())},pr=Symbol("IExtensionContribution")});var ly,nu,uy,dy=m(()=>{"use strict";ly=w(require("fs")),nu=w(require("path")),uy=i=>{let e={};f(e);function t(v,C){return i({category:"telemetry",output:v,data:C})}let r=v=>t("js-debug/dap/operation",{...e,...v}),o=v=>t("js-debug/cdp/operation",{...e,...v}),n=v=>t("js-debug/error",{...e,...v}),s=v=>{e.browser=(v.targetProject||v.targetProject)+"/"+v.targetVersion,t("js-debug/browserVersion",{...e,...v})},a=v=>t("js-debug/breakpointStats",{...e,...v}),c=v=>t("js-debug/statistics",{...e,...v}),p=v=>{e.nodeVersion=v.version,t("js-debug/nodeRuntime",{...e,...v})},l=v=>{t("js-debug/launch",{...e,...v,parameters:JSON.stringify(v.parameters)})},u=v=>{t("js-debug/diagnosticPrompt",{...e,...v})};function f(v){try{let C=nu.resolve(nu.dirname(__filename),"..","..",".gitcommit");v.jsDebugCommitId=ly.readFileSync(C,"utf8")}catch{}}return{breakpointStats:a,statistics:c,browserVersion:s,cdpOperation:o,dapOperation:r,error:n,launch:l,nodeRuntime:p,diagnosticPrompt:u,setGlobalMetric:(v,C)=>{e[v]=C}}}});var tp,my=m(()=>{"use strict";tp=class{constructor(e=!0){this.isVSCode=e;this.measurements=Object.create(null)}add(e,t,r){let o=this.measurements[e];o||(o=this.measurements[e]={times:[],errors:[]}),o.times.push(t),r&&o.errors.push(r)}flush(){let e={errors:[]};for(let t in this.measurements){let{times:r,errors:o}=this.measurements[t],n={operation:t,totalTime:0,max:0,avg:0,stddev:0,count:r.length,failed:o.length};for(let s of r)n.totalTime+=s,n.max=Math.max(n.max,s);n.avg=n.totalTime/n.count;for(let s of r)n.stddev+=(s-n.avg)**2;n.stddev=Math.sqrt(n.stddev/(r.length-1)),e[n.operation]=n,e[`!${n.operation}.errors`]=o,this.isVSCode||(e[`${n.operation}.errors`]=o)}return this.measurements=Object.create(null),e}}});function Lg(i){let e=String(i.message),t=String(i.name);gy.lastIndex=0;let r=typeof i.stack=="string"?i.stack.replace(gy,"$1"):void 0;return{error:{message:e,name:t,stack:r}}}var su,lr,_g,gy,au=m(()=>{"use strict";su=require("inversify");j();M();G();dy();my();lr=class{constructor(e=!0){this.isVsCode=e;this.target=[];this.flushEmitter=new S;this.loggers=uy(e=>this.pushOutput(e));this.batchFlushTimeout={};this.batchers={dapOperation:new tp(this.isVsCode),cdpOperation:new tp(this.isVsCode)};this.onFlush=this.flushEmitter.event;this.setGlobalMetric=this.loggers.setGlobalMetric}report(e,...t){let r=this.loggers[e];r(...t)}reportOperation(e,t,r,o){this.batchers[e].add(t,r,o),this.batchFlushTimeout[e]===void 0&&(this.batchFlushTimeout[e]=setTimeout(()=>{this.report(e,this.batchers[e].flush()),this.batchFlushTimeout[e]=void 0},lr.batchFlushInterval))}attachDap(e){this.target instanceof Array&&this.target.forEach(t=>e.output(t)),this.target=e}flush(){this.flushEmitter.fire();let e=Object.entries(this.batchFlushTimeout);for(let[t,r]of e){let o=this.batchers[t].flush();o.length&&this.report(t,o),this.batchFlushTimeout[t]=void 0,clearTimeout(r)}}dispose(){for(let e of Object.values(this.batchFlushTimeout))e&&clearTimeout(e)}pushOutput(e){e.data=_g(e.data),this.target instanceof Array?this.target.push(e):this.target.output(e)}};lr.batchFlushInterval=5e3,lr=h([(0,su.injectable)(),d(0,(0,su.inject)(_s))],lr);_g=i=>typeof i=="number"?Number(i.toFixed(1)):typeof i!="object"||!i?i:i instanceof Error?Lg(i):i instanceof Array?i.map(_g):ho(i,_g),gy=/(?:[A-z]:)?(?:[\\/][^:]*)+[\\/]([^:]*:)/g});var oi,rp=m(()=>{"use strict";oi=Symbol("IScriptSkipper")});function fy(i){return typeof i.lineNumber=="number"&&typeof i.columnNumber=="number"&&!!i.source}function ii(i,e){if(!e)return i;let{lineNumber:t,columnNumber:r}=i;return e&&(t+=e.lineOffset,t<=1&&(r+=e.columnOffset)),{...i,lineNumber:t,columnNumber:r}}function sn(i,e){if(!e)return i;let{lineNumber:t,columnNumber:r}=i;return e&&(t=Math.max(1,t-e.lineOffset),t<=1&&(r=Math.max(1,r-e.columnOffset))),{...i,lineNumber:t,columnNumber:r}}var yy,Tr,vy,Sy,Ag,Iy,hy,cR,pR,op,qe,St,by,wy,Qe,Py,ni,Ht=m(()=>{"use strict";yy=w(require("@vscode/l10n")),Tr=require("inversify"),vy=require("js-xxhash"),Sy=require("path"),Ag=require("source-map"),Iy=require("url");ls();j();ww();L();M();Z();U();Kc();Rt();Dt();Dt();B();H();qr();de();G();au();Nc();rp();hy=()=>({source:null,line:null,column:null,name:null,lastColumn:null,isSourceMapLoadFailure:!0}),cR=i=>i.endsWith(".hot-update.js"),pR={load:0,resolveLocation:2e3,sourceMapMinPause:1e3,output:1e3,sourceMapCumulativePause:1e4},op=class{constructor(e,t,r,o,n,s,a,c){this.url=t;this.inlineScriptOffset=s;this.runtimeScriptOffset=a;this.contentHash=c;this._scripts=[];this.sourceReference=e.getSourceReference(t),this._contentGetter=N(o),this._container=e,this.absolutePath=r||"",this._fqname=this._fullyQualifiedName(),this._name=this._humanName(),this.setSourceMapUrl(n),this._existingAbsolutePath=bw(this.absolutePath,s||a?void 0:c,e._fileContentOverridesForTest.get(this.absolutePath))}setSourceMapUrl(e){if(!e){this.sourceMap=void 0;return}this.sourceMap={url:e,sourceByUrl:new Map,metadata:{sourceMapUrl:e,compiledPath:this.absolutePath||this.url}}}addScript(e){this._scripts.push(e)}filterScripts(e){this._scripts=this._scripts.filter(e)}get scripts(){return this._scripts}get getSuggestedMimeType(){if(!/\.[^/]+$/.test(this.url))return"text/javascript"}async content(){var t;let e=await this._contentGetter();return(t=this.inlineScriptOffset)!=null&&t.lineOffset&&(e=`
`.repeat(this.inlineScriptOffset.lineOffset)+e),e}async prettyPrint(){var p,l;if(!this._container)return;if(St(this)&&this.sourceMap.url.endsWith("-pretty.map")){let u=(l=this._container._sourceMaps.get((p=this.sourceMap)==null?void 0:p.url))==null?void 0:l.map;return u&&{map:u,source:[...this.sourceMap.sourceByUrl.values()][0]}}let e=await this.content();if(!e)return;let t=this.url||`eval://${this.sourceReference}.js`,r=t+"-pretty.map",n=t.split(/[\/\\]/).pop()+"-pretty.js",s=await Hw(n,e,t,r);if(!s)return;this.setSourceMapUrl(r);let a=this,c={compiled:new Set([a]),map:s,loaded:Promise.resolve()};return this._container._sourceMaps.set(r,c),await this._container._addSourceMapSources(a,s),{map:s,source:[...a.sourceMap.sourceByUrl.values()][0]}}async toDap(){return this.toDapShallow()}async toDapShallow(){let e=await this._existingAbsolutePath,t={name:this._name,path:this._fqname,sourceReference:this.sourceReference,presentationHint:this.blackboxed()?"deemphasize":void 0,origin:this.blackboxed()?yy.t("Skipped by skipFiles"):void 0};return e&&(t.sourceReference=0,t.path=e),t}existingAbsolutePath(){return this._existingAbsolutePath}async prettyName(){let e=await this._existingAbsolutePath;return e||this._fqname}_humanName(){if(ft(this._fqname)){for(let e of this._container.rootPaths)if(El(e,this._fqname))return E((0,Sy.relative)(e,this._fqname))}return this._fqname}_fullyQualifiedName(){var r;if(!this.url)return"<eval>/VM"+this.sourceReference;if(this.url.endsWith(".repl"))return"repl";if(this.absolutePath.startsWith("<node_internals>"))return this.absolutePath;if(ft(this.url))return this.url;let e=Se(this.url);if(e)return e;let t=this.url;try{let o=[],n=new Iy.URL(this.url);if(n.protocol==="data:")return"<eval>/VM"+this.sourceReference;n.hostname&&o.push(n.hostname),n.port&&o.push("\uA789"+n.port),n.pathname&&o.push(/^\/[a-z]:/.test(n.pathname)?n.pathname.slice(1):n.pathname);let s=(r=n.searchParams)==null?void 0:r.toString();s&&o.push("?"+s),t=o.join("")}catch{}return t.endsWith("/")&&(t+="(index)"),this.inlineScriptOffset&&(t+=`\uA789${this.inlineScriptOffset.lineOffset+1}:${this.inlineScriptOffset.columnOffset+1}`),t}blackboxed(){return this._container.isSourceSkipped(this.url)}},qe=class extends op{constructor(){super(...arguments);this.compiledToSourceUrl=new Map}},St=i=>!!i&&i instanceof op&&!!i.sourceMap,by=(i,e)=>e instanceof qe&&e.compiledToSourceUrl.has(i),wy=2**31-1,Qe=class{constructor(e,t,r,o,n,s,a,c){this.sourceMapFactory=t;this.logger=r;this.launchConfig=o;this.initializeConfig=n;this.sourcePathResolver=s;this.scriptSkipper=a;this.resourceProvider=c;this.rootPaths=[];this.scriptsById=new Map;this.onSourceMappedSteppingChangeEmitter=new S;this.onScriptEmitter=new S;this._sourceByOriginalUrl=new dt(e=>e.toLowerCase());this._sourceByReference=new Map;this._sourceMapSourcesByUrl=new Map;this._sourceByAbsolutePath=rn();this._sourceMaps=new Map;this._sourceMapTimeouts=pR;this._fileContentOverridesForTest=new Map;this._temporarilyDisabledSourceMaps=new Set;this._permanentlyDisabledSourceMaps=new Set;this.onScript=this.onScriptEmitter.event;this._statistics={fallbackSourceMapCount:0};this._doSourceMappedStepping=this.launchConfig.sourceMaps;this.onSourceMappedSteppingChange=this.onSourceMappedSteppingChangeEmitter.event;this._dap=e;let p="webRoot"in o?o.webRoot:o.rootPath;p&&(this.rootPaths=[p,$t(p,"..","ClientApp")]),a.setSourceContainer(this),this.setSourceMapTimeouts({...this.sourceMapTimeouts(),...o.timeouts})}get sources(){return this._sourceByReference.values()}statistics(){return this._statistics}get doSourceMappedStepping(){return this._doSourceMappedStepping}set doSourceMappedStepping(e){e!==this._doSourceMappedStepping&&(this._doSourceMappedStepping=e,this.onSourceMappedSteppingChangeEmitter.fire(e))}setSourceMapTimeouts(e){this._sourceMapTimeouts=e}sourceMapTimeouts(){return this._sourceMapTimeouts}setFileContentOverrideForTest(e,t){t===void 0?this._fileContentOverridesForTest.delete(e):this._fileContentOverridesForTest.set(e,t)}async loadedSources(){let e=[];for(let t of this._sourceByReference.values())e.push(t.toDap());return await Promise.all(e)}source(e){if(e.sourceReference)return this._sourceByReference.get(e.sourceReference);if(e.path)return this._sourceByAbsolutePath.get(e.path)}isSourceSkipped(e){return this.scriptSkipper.isScriptSkipped(e)}addScriptById(e){this.scriptsById.set(e.scriptId,e),this.onScriptEmitter.fire(e)}getScriptById(e){return this.scriptsById.get(e)}getSourceByOriginalUrl(e){return this._sourceByOriginalUrl.get(e)}getSourceReference(e){let t=(0,vy.xxHash32)(e)&wy;for(let r=0;r<65535;r++){if(!this._sourceByReference.has(t))return t;t===wy&&(t=0),t++}return this.logger.assert(!1,"Max iterations exceeding for source reference assignment"),t}async preferredUiLocation(e){let t=!1,r=4;if(this._doSourceMappedStepping)for(;St(e.source);){let o=this._sourceMaps.get(e.source.sourceMap.url);if(!this.logger.assert(o,`Expected to have sourcemap for loaded source ${e.source.sourceMap.url}`))break;if(await Promise.race([o.loaded,k(this._sourceMapTimeouts.resolveLocation)]),!o.map)return{...e,isMapped:t,unmappedReason:r};let n=this._sourceMappedUiLocation(e,o.map);if(!fy(n)){r=t?void 0:n;break}e=n,t=!0,r=void 0}return{...e,isMapped:t,unmappedReason:r}}currentSiblingUiLocations(e,t){return this._uiLocations(e).filter(r=>!t||r.source===t)}clear(e){this.scriptsById.clear();for(let t of this._sourceByReference.values())this.removeSource(t,e);this._sourceByReference.clear(),this.sourceMapFactory instanceof ei&&this.sourceMapFactory.invalidateCache()}_uiLocations(e){return[...this.getSourceMapUiLocations(e),e,...this.getCompiledLocations(e)]}getSourceMapUiLocations(e){var n;if(!St(e.source)||!this._doSourceMappedStepping)return[];let t=(n=this._sourceMaps.get(e.source.sourceMap.url))==null?void 0:n.map;if(!t)return[];let r=this._sourceMappedUiLocation(e,t);if(!fy(r))return[];let o=this.getSourceMapUiLocations(r);return o.push(r),o}_sourceMappedUiLocation(e,t){let r=e.source;if(!St(r))return 1;if(this._temporarilyDisabledSourceMaps.has(r)||this._permanentlyDisabledSourceMaps.has(r))return 0;let o=this.getOptiminalOriginalPosition(t,sn(e,r.inlineScriptOffset));if("isSourceMapLoadFailure"in o)return 2;if(!o.source)return 3;let n=r.sourceMap.sourceByUrl.get(o.source);return n?{lineNumber:o.line||1,columnNumber:o.column?o.column+1:1,source:n}:3}getCompiledLocations(e){if(!(e.source instanceof qe))return[];let t=[];for(let[r,o]of e.source.compiledToSourceUrl){let n=this._sourceMaps.get(r.sourceMap.url);if(!n||!n.map)continue;let s=this.sourceMapFactory.guardSourceMapFn(n.map,()=>ql(o,e,n.map),hy);if(!s)continue;let{lineNumber:a,columnNumber:c}=ii({lineNumber:s.line||1,columnNumber:(s.column||0)+1},r.inlineScriptOffset),p={lineNumber:a,columnNumber:c,source:r};t=t.concat(p,this.getCompiledLocations(p))}return t}getOptiminalOriginalPosition(e,t){return this.sourceMapFactory.guardSourceMapFn(e,()=>{let r=e.originalPositionFor({line:t.lineNumber,column:t.columnNumber-1,bias:Ag.SourceMapConsumer.GREATEST_LOWER_BOUND});return r.line!==null?r:e.originalPositionFor({line:t.lineNumber,column:t.columnNumber-1,bias:Ag.SourceMapConsumer.LEAST_UPPER_BOUND})},hy)}async addSource(e,t,r,o,n,s){let a=await this.sourcePathResolver.urlToAbsolutePath({url:e});this.logger.verbose("runtime.sourcecreate","Creating source from url",{inputUrl:e,absolutePath:a});let c=new op(this,e,a,t,r&&this.sourcePathResolver.shouldResolveSourceMap({sourceMapUrl:r,compiledPath:a||e})?r:void 0,o,n,s);return this._addSource(c),c}async _addSource(e){let t=e.url&&this._sourceByOriginalUrl.get(e.url);t&&!by(t,e)&&this.removeSource(t,!0),this._sourceByOriginalUrl.set(e.url,e),this._sourceByReference.set(e.sourceReference,e),e instanceof qe&&this._sourceMapSourcesByUrl.set(e.url,e);let r=this._sourceByAbsolutePath.get(e.absolutePath);if((r===void 0||r.url.length>=e.url.length||by(r,e))&&this._sourceByAbsolutePath.set(e.absolutePath,e),this.scriptSkipper.initializeSkippingValueForSource(e),e.toDap().then(c=>this._dap.loadedSource({reason:"new",source:c})),!St(e))return;let o=this._sourceMaps.get(e.sourceMap.url);if(o){o.compiled.add(e),o.map&&await this._addSourceMapSources(e,o.map);return}let n=le(),s={compiled:new Set([e]),loaded:n.promise};this._sourceMaps.set(e.sourceMap.url,s);try{s.map=await this.sourceMapFactory.load(e.sourceMap.metadata)}catch(c){if(this.initializeConfig.clientID==="visualstudio"){let p=e.sourceMap.metadata.sourceMapUrl;try{let l=await this.sourcePathResolver.urlToAbsolutePath({url:p});l&&(e.sourceMap.metadata.sourceMapUrl=W(l)),s.map=await this.sourceMapFactory.load(e.sourceMap.metadata),this._statistics.fallbackSourceMapCount++,this.logger.info("sourcemap.parsing","Failed to process original source-map; falling back to storage source-map",{fallbackSourceMapUrl:e.sourceMap.metadata.sourceMapUrl,originalSourceMapUrl:p,originalSourceMapError:Lg(c)})}catch{}}if(!s.map)return this._dap.output({output:Nl(e.url,c.message).error.format+`
`,category:"stderr"}),n.resolve()}if(this._sourceMaps.get(e.sourceMap.url)!==s)return n.resolve();this.logger.verbose("sourcemap.parsing","Creating sources from source map",{sourceMapId:s.map.id,metadata:s.map.metadata});let a=[];for(let c of s.compiled)a.push(this._addSourceMapSources(c,s.map));await Promise.all(a),this.scriptSkipper.initializeSkippingValueForSource(e),n.resolve()}removeSource(e,t=!1){let r=this._sourceByReference.get(e.sourceReference);if(r===void 0)return;if(this.logger.assert(e===r,"Expected source to be the same as the existing reference"),this._sourceByReference.delete(e.sourceReference),this._sourceByOriginalUrl.get(e.url)===e&&this._sourceByOriginalUrl.delete(e.url),e instanceof qe){this._sourceMapSourcesByUrl.delete(e.url);for(let[n,s]of e.compiledToSourceUrl)n.sourceMap.sourceByUrl.delete(s)}if(this._sourceByAbsolutePath.delete(e.absolutePath),St(e)&&(this._permanentlyDisabledSourceMaps.delete(e),this._temporarilyDisabledSourceMaps.delete(e)),t||e.toDap().then(n=>this._dap.loadedSource({reason:"removed",source:n})),!St(e))return;let o=this._sourceMaps.get(e.sourceMap.url);this.logger.assert(o,`Source map missing for ${e.sourceMap.url} in removeSource()`)&&(this.logger.assert(o.compiled.has(e),`Source map ${e.sourceMap.url} does not contain source ${e.url}`),o.compiled.delete(e),o.compiled.size||(o.map&&o.map.destroy(),this._sourceMaps.delete(e.sourceMap.url)),o.map&&this._removeSourceMapSources(e,o.map,t))}async _addSourceMapSources(e,t){let r=[];for(let o of t.sources){let n=await this.sourcePathResolver.urlToAbsolutePath({url:o,map:t}),s=n?W(n):t.computedSourceUrl(o),a=this._sourceMapSourcesByUrl.get(s);if(e===a)continue;if(a)if(cR(e.url))this.removeSource(a);else{a.compiledToSourceUrl.set(e,o),e.sourceMap.sourceByUrl.set(o,a);continue}this.logger.verbose("runtime.sourcecreate","Creating source from source map",{inputUrl:o,sourceMapId:t.id,absolutePath:n,resolvedUrl:s});let c=n&&W(n),p=this.sourceMapFactory.guardSourceMapFn(t,()=>t.sourceContentFor(o,!0),()=>null),l;if(p){let f=ws(p);if(f&&(!rt(f)&&n?l=Cr(n?W(n):o,f):l=f),n&&l){let y={sourceMapUrl:l,compiledPath:n};this.sourcePathResolver.shouldResolveSourceMap(y)||(l=void 0)}}let u=new qe(this,s,n,p!==null?()=>Promise.resolve(p):c?()=>this.resourceProvider.fetch(c).then(f=>f.body):()=>e.content(),l,void 0,e.runtimeScriptOffset);u.compiledToSourceUrl.set(e,o),e.sourceMap.sourceByUrl.set(o,u),r.push(this._addSource(u))}await Promise.all(r)}_removeSourceMapSources(e,t,r){for(let o of t.sources){let n=e.sourceMap.sourceByUrl.get(o);n&&(e.sourceMap.sourceByUrl.delete(o),n.compiledToSourceUrl.delete(e),!n.compiledToSourceUrl.size&&this.removeSource(n,r))}}async waitForSourceMapSources(e){if(!St(e))return[];let t=this._sourceMaps.get(e.sourceMap.url);return this.logger.assert(t,"Unrecognized source map url in waitForSourceMapSources()")?(await t.loaded,[...e.sourceMap.sourceByUrl.values()]):[]}async revealUiLocation(e){this._dap.revealLocationRequested({source:await e.source.toDap(),line:e.lineNumber,column:e.columnNumber})}disableSourceMapForSource(e,t=!1){t?this._permanentlyDisabledSourceMaps.add(e):this._temporarilyDisabledSourceMaps.add(e)}clearDisabledSourceMaps(e){e?this._temporarilyDisabledSourceMaps.delete(e):this._temporarilyDisabledSourceMaps.clear()}};Qe=h([(0,Tr.injectable)(),d(0,(0,Tr.inject)(sr)),d(1,(0,Tr.inject)(vo)),d(2,(0,Tr.inject)(T)),d(3,(0,Tr.inject)(ie)),d(4,(0,Tr.inject)(Lt)),d(5,(0,Tr.inject)(fe)),d(6,(0,Tr.inject)(oi)),d(7,(0,Tr.inject)(Zi))],Qe);Py=i=>({lineNumber:i.lineNumber+1,columnNumber:i.columnNumber+1}),ni=i=>({lineNumber:i.lineNumber-1,columnNumber:i.columnNumber-1})});var ip,Cy,si,Ls,Eg,Rr,np=m(()=>{"use strict";ip=require("inversify");Ht();H();ps();xr();Kc();Cy=/[$a-z_][$0-9A-Z_$]*/iy,si=Symbol("IRenameProvider"),Ls=class{constructor(e,t){this.sourceMapFactory=e;this.launchConfig=t;this.renames=new Map}provideOnStackframe(e){if(!this.launchConfig.sourceMapRenames)return Rr.None;let t=e.uiLocation();return t===void 0?Rr.None:"then"in t?t.then(r=>this.provideForSource(r==null?void 0:r.source)):this.provideForSource(t==null?void 0:t.source)}provideForSource(e){if(!this.launchConfig.sourceMapRenames||!(e instanceof qe))return Rr.None;let t=e.compiledToSourceUrl.keys().next().value;if(!t)throw new Error("unreachable");let r=this.renames.get(t.url);if(r)return r;let o=this.sourceMapFactory.load(t.sourceMap.metadata).then(async n=>{if(!(n!=null&&n.hasNames))return Rr.None;let s=await t.content();return s?this.createFromSourceMap(n,s):Rr.None}).catch(()=>Rr.None);return this.renames.set(t.url,o),o}createFromSourceMap(e,t){let r=new Qo(t),o=[];return e.eachMapping(n=>{if(!n.name)return;let s=new cs(n.generatedLine,n.generatedColumn),a=r.convert(s);Cy.lastIndex=a;let c=Cy.exec(t);c&&o.push({compiled:c[0],original:n.name,position:s})}),o.sort((n,s)=>n.position.compare(s.position)),new Rr(o)}};Ls=h([(0,ip.injectable)(),d(0,(0,ip.inject)(vo)),d(1,(0,ip.inject)(ie))],Ls);Eg=class{constructor(e){this.renames=e}getOriginalName(e,t){var r;return(r=this.getClosestRename(t,o=>o.compiled===e))==null?void 0:r.original}getCompiledName(e,t){var r;return(r=this.getClosestRename(t,o=>o.original===e))==null?void 0:r.compiled}getClosestRename(e,t){let r=e.base01,o;for(let n of this.renames){if(!t(n))continue;if(!(n.position.compare(r)<0)&&o)return o;o=n}return o}},Rr=Eg;Rr.None=new Eg([])});var nt,As=m(()=>{"use strict";nt=Symbol("ITelemetryReporter")});var xy,ai,Es,sp=m(()=>{"use strict";xy=require("inversify");$e();ai=Symbol("IShutdownParticipants"),Es=class{constructor(){this.participants=[]}register(e,t){if(this.shutdownStage!==void 0&&this.shutdownStage>=e)return t(),ss;for(;this.participants.length<=e;)this.participants.push(new Set);return this.participants[e].add(t),{dispose:()=>this.participants[e].delete(t)}}async shutdown(){for(this.shutdownStage=0;this.shutdownStage<this.participants.length;this.shutdownStage++)await Promise.all([...this.participants[this.shutdownStage]].map(e=>e()))}};Es=h([(0,xy.injectable)()],Es)});var cu,pu,ky=m(()=>{"use strict";cu=class{constructor(e=!1,t=!1){this.verified=e;this.hit=t}},pu=class{constructor(){this._statisticsById=new Map}registerBreakpoints(e){e.forEach(t=>{t.id!==void 0&&!this._statisticsById.has(t.id)&&this._statisticsById.set(t.id,new cu(t.verified,!1))})}registerResolvedBreakpoint(e){this.getStatistics(e).verified=!0}registerBreakpointHit(e){this.getStatistics(e).hit=!0}getStatistics(e){let t=this._statisticsById.get(e);if(t!==void 0)return t;{let r=new cu;return this._statisticsById.set(e,r),r}}statistics(){let e=0,t=0,r=0;for(let o of this._statisticsById.values())e++,o.hit&&r++,o.verified&&t++;return{set:e,verified:t,hit:r}}}});var lu,Fg=m(()=>{"use strict";L();lu=async(i,e,t,r={})=>{let o=Date.now();try{return await t()}finally{i.verbose("perf.function","",{method:e,duration:Date.now()-o,...r})}}});var an,ap,zt,Jr,Po,Fs=m(()=>{"use strict";an=require("inversify"),ap=w(require("path"));H();Z();zt=class{get empty(){return this.patterns.length===0}constructor({rootPath:e,patterns:t}){!e||!t?(this.rootPath="",this.patterns=[]):(this.rootPath=e,this.patterns=t.map(r=>{let o=r.startsWith("!");return{negated:o,pattern:r.slice(o?1:0)}}))}*explode(){for(let e=0;e<this.patterns.length;e++){let{negated:t,pattern:r}=this.patterns[e];if(t)continue;let o=ap.resolve(this.rootPath,r).split(/[\\/]/g),n=o.findIndex(c=>c.includes("*"));if(n===-1){yield{cwd:o.slice(0,-1).join("/"),pattern:o[o.length-1],negations:[]};continue}let s=o.slice(0,n).join("/"),a=[];for(let c=e+1;c<this.patterns.length;c++){let{negated:p,pattern:l}=this.patterns[c];if(p)if(l.startsWith("**"))a.push(E(l));else{let u=ap.relative(s,ap.resolve(this.rootPath,l));u.startsWith("..")||a.push(E(u))}}yield{cwd:s,negations:a,pattern:o.slice(n).join("/")}}}};zt=h([(0,an.injectable)()],zt);Jr=class extends zt{constructor({rootPath:e,outFiles:t}){super({rootPath:e,patterns:t})}};Jr=h([(0,an.injectable)(),d(0,(0,an.inject)(ie))],Jr);Po=class extends zt{constructor(e){super({rootPath:e.rootPath,patterns:"vueComponentPaths"in e?e.vueComponentPaths:[]})}};Po=h([(0,an.injectable)(),d(0,(0,an.inject)(ie))],Po)});var Ty,Ms,YE,Ry,cp=m(()=>{"use strict";Ty=require("js-xxhash");ae();Dt();B();Ms=Symbol("ISearchStrategy"),YE=Symbol("ISearchStrategyFallback"),Ry=async(i,e)=>{typeof e>"u"&&(e=await nr(i));let t=ws(e);if(!t)return;let r=rt(t);if(r||(t=Cr(W(i),t)),!t||!t.startsWith("data:")&&!t.startsWith("file://"))return;let o;if(r)o=(0,Ty.xxHash32)(t);else{let n=await aw(Se(t)||i);if(!n)return;o=n.mtimeMs}return{compiledPath:i,sourceMapUrl:t,cacheKey:o}}});var pp,Ye,uu,Mg,Dy,cn,Kr,Bs,js,ln,pn,du=m(()=>{"use strict";pp=require("fs"),Ye=require("inversify"),uu=w(require("path"));j();Fs();L();Z();Kc();cp();Rt();Dt();B();H();Fg();Mg=Symbol("InlineSourceMapUrl"),Dy=10*1e3,cn=class{constructor(e){e.__workspaceCachePath&&(this.path=uu.join(e.__workspaceCachePath,"bp-predict.json"))}async load(){if(this.value||!this.path)return this.value;try{this.value=JSON.parse(await pp.promises.readFile(this.path,"utf-8"))}catch{}return this.value}async store(e){this.value=e,this.path&&(await pp.promises.mkdir(uu.dirname(this.path),{recursive:!0}),await pp.promises.writeFile(this.path,JSON.stringify(e)))}};cn=h([(0,Ye.injectable)(),d(0,(0,Ye.inject)(ie))],cn);Kr=class{constructor(e,t,r,o,n,s){this.outFiles=e;this.repo=t;this.logger=r;this.sourceMapFactory=o;this.sourcePathResolver=n;this.state=s}async createMapping(e){if(this.outFiles.empty)return new Map;let t=rn(),r=await this.state.load();try{let{state:o}=await this.repo.streamChildrenWithSourcemaps({files:this.outFiles,processMap:async n=>{let s=[],a=await this.sourceMapFactory.load(n);for(let c of a.sources){let p=this.sourcePathResolver?await this.sourcePathResolver.urlToAbsolutePath({url:c,map:a}):Se(c);p&&s.push({...n,sourceMapUrl:rt(n.sourceMapUrl)?{[Mg]:n.sourceMapUrl}:n.sourceMapUrl,resolvedPath:p,sourceUrl:c})}return{discovered:s,compiledPath:K(n.compiledPath)}},onProcessedMap:({discovered:n})=>{for(let s of n){let a=t.get(s.resolvedPath);a||(a=new Set,t.set(s.resolvedPath,a)),a.add(s)}},lastState:r,...e});o&&this.state.store(o).catch(n=>this.logger.warn("runtime.exception","Error saving sourcemap cache",{error:n}))}catch(o){this.logger.warn("runtime.exception","Error reading sourcemaps from disk",{error:o})}return t}};Kr=h([(0,Ye.injectable)(),d(0,(0,Ye.inject)(Jr)),d(1,(0,Ye.inject)(Ms)),d(2,(0,Ye.inject)(T)),d(3,(0,Ye.inject)(vo)),d(4,(0,Ye.inject)(fe)),d(5,(0,Ye.inject)(cn))],Kr);Bs=class extends Kr{async getMetadataForPaths(t){this.sourcePathToCompiled||(this.sourcePathToCompiled=this.createInitialMapping());let r=await this.sourcePathToCompiled;return t.map(o=>r.get(o))}async createInitialMapping(){return lu(this.logger,"BreakpointsPredictor.createInitialMapping",()=>this.createMapping())}};Bs=h([(0,Ye.injectable)()],Bs);js=class extends Kr{constructor(){super(...arguments);this.sourcePathToCompiled=new Map}async getMetadataForPaths(t){let r=t.map(s=>this.sourcePathToCompiled.get(s)),o=t.map((s,a)=>a).filter(s=>!r[s]);if(o.length){let s=new Set(o.map(c=>K(t[c]))),a=this.createMapping({filter:(c,p)=>!p||p.discovered.some(l=>s.has(l.resolvedPath))});for(let c of o)this.sourcePathToCompiled.set(t[c],a),r[c]=a}return await Promise.all(r.map(async(s,a)=>(await s).get(t[a])))}};js=h([(0,Ye.injectable)()],js);ln=Symbol("IBreakpointsPredictor"),pn=class{constructor(e,t,r,o){this.bpSearch=e;this.outFiles=t;this.logger=r;this.sourceMapFactory=o;this.predictedLocations=new Map;this.longParseEmitter=new S;this.targetedMode=!1;this.onLongParse=this.longParseEmitter.event}async predictBreakpoints(e){var o;if(!e.source.path||!((o=e.breakpoints)!=null&&o.length))return;let t=await this.getMetadataForPaths([e.source.path]).then(n=>n[0]);if(!t)return;let r=async(n,s,a)=>{let c=typeof a.sourceMapUrl=="string"?a.sourceMapUrl:a.sourceMapUrl.hasOwnProperty(Mg)?a.sourceMapUrl[Mg]:await pp.promises.readFile(a.compiledPath,"utf8").then(ws);if(!c)return[];let p=await this.sourceMapFactory.load({...a,sourceMapUrl:c}),l=this.sourceMapFactory.guardSourceMapFn(p,()=>ql(a.sourceUrl,{lineNumber:n,columnNumber:s||1},p),()=>null);if(!l||l.line===null)return[];let u=await this.getMetadataForPaths([a.compiledPath]).then(f=>f[0]);return u?(await Promise.all([...u].map(y=>r(l.line,l.column,y)))).flat():[{absolutePath:a.compiledPath,lineNumber:l.line||1,columnNumber:l.column?l.column+1:1}]};for(let n of e.breakpoints??[]){let s=`${e.source.path}:${n.line}:${n.column||1}`;if(this.predictedLocations.has(s))return;let a=[];this.predictedLocations.set(s,a);for(let c of t)a.push(...await r(n.line,n.column||0,c))}}async getPredictionForSource(e){return this.getMetadataForPaths([e]).then(t=>t[0])}async getMetadataForPaths(e){let t=setTimeout(()=>{this.longParseEmitter.fire(),this.logger.warn("runtime.sourcemap","Long breakpoint predictor runtime",{longPredictionWarning:Dy,patterns:[...this.outFiles.explode()].join(", ")})},Dy),r=await this.bpSearch.getMetadataForPaths(e);return clearTimeout(t),r}predictedResolvedLocations(e){let t=`${e.absolutePath}:${e.lineNumber}:${e.columnNumber||1}`;return this.predictedLocations.get(t)??[]}};pn=h([(0,Ye.injectable)(),d(0,(0,Ye.inject)(Kr)),d(1,(0,Ye.inject)(Jr)),d(2,(0,Ye.inject)(T)),d(3,(0,Ye.inject)(vo))],pn)});function dR(){if(parseInt(process.versions.node,10)>=11)return setImmediate;let i=!1,e=[],t=()=>{let r=e.shift();if(!r){i=!1;return}setImmediate(t),r()};return r=>{e.push(r),i||(i=!0,setImmediate(t))}}var lR,_e,un,Ue,uR,mu,He=m(()=>{"use strict";j();L();B();lR=0,_e=Symbol("ICdpApi"),un=class extends Error{constructor(t){super("<<message>>");this.method=t}setCause(t,r){var o;return this.cause={code:t,message:r},this.message=`CDP error ${t} calling method ${this.method}: ${r}`,this.stack=(o=this.stack)==null?void 0:o.replace("<<message>>",this.message),this}},Ue=class{constructor(e,t,r){this.logger=t;this.telemetryReporter=r;this._connectionId=lR++;this._lastId=1e3;this._disposedSessions=new Map;this._onDisconnectedEmitter=new S;this.waitWrapper=dR();this.onDisconnected=this._onDisconnectedEmitter.event;this._transport=e,this._transport.onMessage(([o,n])=>this._onMessage(o,n)),this._transport.onEnd(()=>this._onTransportClose()),this._sessions=new Map,this._closed=!1,this._rootSession=new mu(this,"",this.logger),this._sessions.set("",this._rootSession)}rootSession(){return this._rootSession.cdp()}_send(e,t={},r){let o=++this._lastId,n={id:o,method:e,params:t};r&&(n.sessionId=r);let s=JSON.stringify(n);return this.logger.verbose("cdp.send",void 0,{connectionId:this._connectionId,message:n}),this._transport.send(s),o}_onMessage(e,t){let r=JSON.parse(e),o=r;r.result&&r.result.scriptSource?o={...r,result:{...r.result,scriptSource:"<script source>"}}:r.method==="Debugger.scriptParsed"&&r.params&&rt(r.params.sourceMapURL)&&(o={...r,params:{...r.params,sourceMapURL:"<data source map url>"}}),this.logger.verbose("cdp.receive",void 0,{connectionId:this._connectionId,message:o});let n=this._sessions.get(r.sessionId||"");if(!n){let c=this._disposedSessions.get(r.sessionId);if(c){let p=(Date.now()-c.getTime())/1e3;this.logger.warn("internal",`Got message for a session disposed ${p} seconds ago`,{sessionId:r.sessionId,disposeOn:c});return}else throw new Error(`Unknown session id: ${r.sessionId} while processing: ${r.method}`)}let s=r.method,a;try{n._onMessage(r)}catch(c){a=c}s&&this.telemetryReporter.reportOperation("cdpOperation",s,t.elapsed().ms,a)}_onTransportClose(){if(!this._closed){this._closed=!0,this._transport.dispose(),this.logger.info("cdp.receive","Connection closed",{connectionId:this._connectionId});for(let e of this._sessions.values())e._onClose();this._sessions.clear(),this._onDisconnectedEmitter.fire()}}close(){this._onTransportClose()}isClosed(){return this._closed}createSession(e){let t=new mu(this,e,this.logger);return this._sessions.set(e,t),t.cdp()}disposeSession(e){let t=this._sessions.get(e);t&&(t._onClose(),this._disposedSessions.set(t.sessionId(),new Date),this._sessions.delete(t.sessionId()))}},uR=+process.version.substring(1).split(".")[0]<11,mu=class{constructor(e,t,r){this.logger=r;this._queue=[];this._prefixListeners=new Bc;this._directListeners=new Bc;this.paused=!1;this._callbacks=new Map,this._connection=e,this._sessionId=t,this._cdp=this._createApi()}pause(){this.paused=!0}resume(){if(!this.paused)return;this.paused=!1;let e=this._queue;this._queue=[],this.logger.verbose("cdp.receive","Dequeue messages",{message:e});for(let t of e)this._processResponse(t)}cdp(){return this._cdp}sessionId(){return this._sessionId}_createApi(){return new Proxy({},{get:(e,t)=>t==="pause"?()=>this.pause():t==="resume"?()=>this.resume():t==="session"?this:new Proxy({},{get:(r,o)=>{if(o!=="then")return o==="on"?(n,s)=>this.on(`${t}.${n}`,s):n=>this.send(`${t}.${o}`,n)}})})}on(e,t){return this._directListeners.listen(e,t)}onPrefix(e,t){return this._prefixListeners.listen(e,t)}send(e,t={}){return this.sendOrDie(e,t).catch(()=>{})}sendOrDie(e,t={}){if(!this._connection)return Promise.reject(new un(e).setCause(0,"Connection is closed"));let r=this._connection._send(e,t,this._sessionId);return new Promise((o,n)=>{this._callbacks.set(r,{resolve:o,reject:n,from:new un(e),method:e})})}_onMessage(e){if(this.paused&&e.id){this._processResponse(e);return}if(this._queue.length>0){this._queue.push(e);return}if(!uR&&!this.paused){this._processResponse(e);return}this._queue.push(e),this.paused||this._processQueue()}_processQueue(){var e;(e=this._connection)==null||e.waitWrapper(()=>{if(this.paused)return;let t=this._queue.shift();t&&(this._processResponse(t),this._queue.length&&this._processQueue())})}_processResponse(e){if(e.id===void 0){let r=e;this._directListeners.emit(r.method,r.params);for(let[o,n]of this._prefixListeners.listeners)r.method.startsWith(o)&&n.fire(r);return}let t=this._callbacks.get(e.id);t&&(this._callbacks.delete(e.id),"error"in e?t.reject(t.from.setCause(e.error.code,e.error.message)):"result"in e&&t.resolve(e.result))}async detach(){if(!this._connection)throw new Error("Session already detached. Most likely the target has been closed.");this._connection._send("Target.detachFromTarget",{},this._sessionId)}isClosed(){return!this._connection}_onClose(){for(let e of this._callbacks.values())e.reject(e.from.setCause(0,"Connection is closed"));this._callbacks.clear(),this._connection=void 0}}});var Ly,Ay,Ey,lp,Co,mR,_y,ur,Os,gR,dn=m(()=>{"use strict";Ly=require("astring"),Ay=require("crypto"),Ey=require("estraverse"),lp=require("inversify");He();hs();np();Dt();Je();Co="$returnValue",mR="__js_debug_hoisted_",_y=()=>mR+(0,Ay.randomBytes)(8).toString("hex"),ur=Symbol("IEvaluator"),Os=class{constructor(e,t){this.cdp=e;this.renameProvider=t}get hasReturnValue(){return!!this.returnValue}setReturnedValue(e){this.returnValue=e}prepare(e,{isInternalScript:t,hoist:r,renames:o}={}){t!==!1&&(e+=Re());let n=new Map;n.set(Co,_y());for(let c of r??[])n.set(c,_y());let{transformed:s,hoisted:a}=this.replaceVariableInExpression(e,n,o);return a.size?{canEvaluateDirectly:!1,invoke:(c,p={})=>Promise.all([...n].map(([l,u])=>this.hoistValue(l===Co?this.returnValue:p[l],u))).then(()=>this.cdp.Debugger.evaluateOnCallFrame({...c,expression:s}))}:{canEvaluateDirectly:!0,invoke:c=>this.cdp.Debugger.evaluateOnCallFrame({...c,expression:s})}}async evaluate(e,t){if(!("callFrameId"in e))return this.cdp.Runtime.evaluate(e);let r=t;if(t!=null&&t.stackFrame){let o=await this.renameProvider.provideOnStackframe(t.stackFrame);r={...r,renames:{mapping:o,position:t.stackFrame.rawPosition}}}return this.prepare(e.expression,r).invoke(e)}async hoistValue(e,t){let r=e==null?void 0:e.objectId,o=`setTimeout(() => { delete globalThis.${t} }, 0)`;r?await this.cdp.Runtime.callFunctionOn({objectId:r,functionDeclaration:`function() { globalThis.${t} = this; ${o}; ${Re()} }`}):await this.cdp.Runtime.evaluate({expression:`globalThis.${t} = ${JSON.stringify(e==null?void 0:e.value)};${o};`+Re()})}replaceVariableInExpression(e,t,r){let o=new Set,n=!1,s=(u,f)=>({type:"ConditionalExpression",test:{type:"BinaryExpression",left:{type:"UnaryExpression",operator:"typeof",prefix:!0,argument:{type:"Identifier",name:u}},operator:"!==",right:{type:"Literal",value:"undefined"}},consequent:{type:"Identifier",name:u},alternate:f}),a=[],c=zo(e),p=(0,Ey.replace)(c,{enter(u,f){let y=u;if(u.type!=="Identifier"||e[y.start-1]===".")return;let v=t.get(u.name);if(v)return o.add(u.name),n=!0,this.skip(),lg(u,f)?{type:"Identifier",name:v}:s(v,gR);let C=r==null?void 0:r.mapping.getCompiledName(u.name,r.position);if(C)return n=!0,this.skip(),lg(u,f)?{type:"Identifier",name:C}:s(C,u)},leave:()=>{a.pop()}});if(!n)return{hoisted:o,transformed:e};let l=c.body[c.body.length-1].end;return{hoisted:o,transformed:(0,Ly.generate)(p)+e.slice(l)}}};Os=h([(0,lp.injectable)(),d(0,(0,lp.inject)(_e)),d(1,(0,lp.inject)(si))],Os);gR={type:"Identifier",name:"undefined"}});var Ns,Bg,jg=m(()=>{"use strict";Dt();de();ce();Ns=class{static parse(e,t,r,o){r&&(t=Bg(t));let n=t&&Go(t);if(n)throw new I(qo(e,n.message));let{canEvaluateDirectly:s,invoke:a}=o.prepare(t);return new Ns(s?t:a)}constructor(e){typeof e=="function"?this.invoke=e:this.breakCondition=e}async shouldStayPaused(e){if(!this.invoke)return Promise.resolve(!0);let t=await this.invoke({callFrameId:e.callFrames[0].callFrameId,returnByValue:!0});return(t==null?void 0:t.result.value)===!0}},Bg=i=>`(()=>{try{return ${i};}catch(e){console.error(e);return true}})()`});var fR,ci,Og=m(()=>{"use strict";de();ce();fR=/^(>|>=|={1,3}|<|<=|%)?\s*([0-9]+)$/,ci=class{constructor(e){this.predicate=e;this.hits=0;this.breakCondition=void 0}shouldStayPaused(){return Promise.resolve(this.predicate(++this.hits))}static parse(e){let t=fR.exec(e);if(!t)throw new I(kw(e));let[,r="=",o]=t,n=r==="%"?`return (numHits % ${o}) === 0;`:r[0]==="="?`return numHits === ${o};`:`return numHits ${r} ${o};`;return new ci(new Function("numHits",n))}}});var gu,Fy=m(()=>{"use strict";gu=class{constructor(e){this.invoke=e;this.breakCondition=void 0}async shouldStayPaused(e){return await this.invoke({callFrameId:e.callFrames[0].callFrameId}),!1}}});var Us,Ng=m(()=>{"use strict";Dt();de();ce();Us=class{constructor(e,t){this.breakCondition=t;let r=t&&Go(t);if(r)throw new I(qo(e,r.message))}shouldStayPaused(){return Promise.resolve(!0)}}});var My,By,fu,pi,Ug=m(()=>{"use strict";My=require("astring"),By=require("crypto"),fu=require("inversify");hs();Dt();de();ce();dn();Fy();Ng();pi=class{constructor(e){this.evaluator=e}compile(e,t){let r=this.logMessageToExpression(t),o=Go(r);if(o)throw new I(qo(e,o.message));let{canEvaluateDirectly:n,invoke:s}=this.evaluator.prepare(r);return n?new Us(e,this.logMessageToExpression(t)):new gu(s)}serializeLogStatements(e){return Ww([],e,!1)}logMessageToExpression(e){let t=p=>p.replace(/%/g,"%%"),r=[],o=[],n=0;for(;;){let p=e.indexOf("{",n);if(p===-1){r.push(t(e.slice(n)));break}r.push(t(e.slice(n,p)));let[l]=Vl(e.slice(p));if(n=p+l.end,n-1===p+1||e[n-1]!=="}"){r.push(t(e.slice(p,n)));continue}if(l.type!=="BlockStatement")break;o.push((0,My.generate)(this.serializeLogStatements(l.body))),r.push("%O")}let a=`console.log(${[JSON.stringify(r.join("")),...o].join(", ")}), false`,c=(0,By.createHash)("sha1").update(a).digest("hex").slice(0,7);return a+`
//# sourceURL=logpoint-${c}.cdp`}};pi=h([(0,fu.injectable)(),d(0,(0,fu.inject)(ur))],pi)});var Ws,hR,hu,Vs,Vg=m(()=>{"use strict";Ws=require("inversify");H();dn();jg();Og();Ug();Ng();hR=new Us({line:0},void 0),hu=Symbol("IBreakpointConditionFactory"),Vs=class{constructor(e,t,r){this.logPointCompiler=e;this.evaluator=t;this.breakOnError=r.__breakOnConditionalError}getConditionFor(e){return e.condition?Ns.parse(e,e.condition,this.breakOnError,this.evaluator):e.logMessage?this.logPointCompiler.compile(e,e.logMessage):e.hitCondition?ci.parse(e.hitCondition):hR}};Vs=h([(0,Ws.injectable)(),d(0,(0,Ws.inject)(pi)),d(1,(0,Ws.inject)(ur)),d(2,(0,Ws.inject)(ie))],Vs)});var bu,wu,jy,Oy,$s,yu=m(()=>{"use strict";L();B();Ht();bu=(i,e)=>i.lineNumber===e.lineNumber&&i.columnNumber===e.columnNumber,wu=i=>!("location"in i),jy=i=>"location"in i,Oy=(i,e)=>i.url&&e===i.url||i.urlRegex&&new RegExp(i.urlRegex).test(e),$s=class{constructor(e,t,r){this._manager=e;this._source=t;this._originalPosition=r;this.isEnabled=!1;this.setInCdpScriptIds=new Set;this.cdpScriptIds=this.setInCdpScriptIds;this.cdpBreakpoints=[];this._cdpIds=new Set}get enabled(){return this.isEnabled}get cdpIds(){return this._cdpIds}get source(){return this._source}get originalPosition(){return this._originalPosition}async updateSourceLocation(e,t){this._source=e,this._originalPosition=t,this.updateCdpRefs(r=>r.map(o=>o.state===1?{...o,uiLocations:this._manager._sourceContainer.currentSiblingUiLocations(t)}:o))}async refreshUiLocations(e){await Promise.all(this.cdpBreakpoints.filter(t=>t.state===1).map(t=>this.updateUiLocations(e,t.cdpId,t.locations)))}async enable(e){if(this.isEnabled)return;this.isEnabled=!0;let t=[this._setPredicted(e)],r=this._manager._sourceContainer.source(this.source);if((!r||!(r instanceof qe))&&t.push(this._setByPath(e,ii(this.originalPosition,r==null?void 0:r.runtimeScriptOffset))),await Promise.all(t),r&&this.isEnabled){let o=this._manager._sourceContainer.currentSiblingUiLocations({lineNumber:this.originalPosition.lineNumber,columnNumber:this.originalPosition.columnNumber,source:r});await Promise.all(o.map(n=>this._setByUiLocation(e,ii(n,r.runtimeScriptOffset))))}}async updateUiLocations(e,t,r){this.updateExistingCdpRef(t,s=>({...s,locations:r}));let o=(await Promise.all(r.map(s=>e.rawLocationToUiLocation(e.rawLocation(s))))).find(s=>!!s);if(!o)return;let n=this._manager._sourceContainer.source(this.source);n&&this.updateExistingCdpRef(t,s=>{let a=this._manager._sourceContainer.currentSiblingUiLocations(o),c=a.filter(p=>p.source===n);return{...s,locations:r,uiLocations:c.length?c:a}})}compare(e){let t=this.originalPosition,r=e.originalPosition;return t.lineNumber!==r.lineNumber?t.lineNumber-r.lineNumber:t.columnNumber-r.columnNumber}async disable(){if(!this.isEnabled)return;this.isEnabled=!1;let e=this.cdpBreakpoints.map(t=>this.removeCdpBreakpoint(t));await Promise.all(e)}async updateForSourceMap(e,t){let r=this._manager._sourceContainer.source(this.source);if(!r)return[];let o=await t.source,n=this._manager._sourceContainer.currentSiblingUiLocations({lineNumber:this.originalPosition.lineNumber,columnNumber:this.originalPosition.columnNumber,source:r},o);if(!n.length)return[];let s=[];for(let a of n)s.push(this._setByScriptId(e,t,ii(a,r.runtimeScriptOffset)));for(let a of this.cdpBreakpoints){if(!wu(a.args)||!this.breakpointIsForSource(a.args,o))continue;let c=a.args;n.some(p=>p.columnNumber-1===c.columnNumber&&p.lineNumber-1===c.lineNumber)||(this._manager.logger.verbose("runtime.sourcemap","Adjusted breakpoint due to overlaid sourcemap",{url:r.url}),s.push(this.removeCdpBreakpoint(a)))}return await Promise.all(s),n}executionContextWasCleared(){this.updateCdpRefs(e=>e.filter(t=>wu(t.args)))}breakpointIsForSource(e,t){if(Oy(e,t.url))return!0;let r=this._manager._sourceContainer.sourcePathResolver.rebaseLocalToRemote(t.absolutePath);return!!Oy(e,r)}getBreakCondition(){}updateExistingCdpRef(e,t){this.updateCdpRefs(r=>r.map(o=>o.state!==1||o.cdpId!==e?o:t(o)))}updateCdpRefs(e){let t=this;t.cdpBreakpoints=e(this.cdpBreakpoints);let r=new Set;this.setInCdpScriptIds.clear();for(let o of this.cdpBreakpoints)if(o.state===1){r.add(o.cdpId);for(let n of o.locations)this.setInCdpScriptIds.add(n.scriptId)}this._cdpIds=r}async _setPredicted(e){if(!this.source.path||!this._manager._breakpointsPredictor)return;let t=this._manager._breakpointsPredictor.predictedResolvedLocations({absolutePath:this.source.path,lineNumber:this.originalPosition.lineNumber,columnNumber:this.originalPosition.columnNumber}),r=[];for(let o of t){let n=this._manager._sourceContainer.sourcePathResolver.absolutePathToUrlRegexp(o.absolutePath);n!==void 0&&(typeof n=="string"?r.push(this._setByUrlRegexp(e,n,o)):r.push(n.then(s=>s?this._setByUrlRegexp(e,s,o):void 0)))}await Promise.all(r)}async _setByUiLocation(e,t){await Promise.all(t.source.scripts.map(r=>this._setByScriptId(e,r,t)))}async _setByPath(e,t){let r=this._manager._sourceContainer.source({path:this.source.path});if(!(r instanceof qe&&[...r.compiledToSourceUrl.keys()].some(n=>n.absolutePath===this.source.path)))if(this.source.path){let o=await this._manager._sourceContainer.sourcePathResolver.absolutePathToUrlRegexp(this.source.path);if(!o)return;await this._setByUrlRegexp(e,o,t)}else{let o=this._manager._sourceContainer.source(this.source),n=o==null?void 0:o.url;if(!n)return;await this._setByUrl(e,n,t),this.source.path!==n&&this.source.path!==void 0&&await this._setByUrl(e,W(this.source.path),t)}}hasSetOnLocation(e,t){return this.cdpBreakpoints.find(r=>e.scriptId&&jy(r.args)&&r.args.location.scriptId===e.scriptId&&bu(r.args.location,t)||e.url&&wu(r.args)&&new RegExp(r.args.urlRegex??"").test(e.url)&&bu(r.args,t))}hasSetOnLocationByRegexp(e,t){return this.cdpBreakpoints.find(r=>{if(wu(r.args))return r.args.urlRegex===e&&bu(r.args,t);let o=this._manager._sourceContainer.getScriptById(r.args.location.scriptId);if(o)return bu(r.args.location,t)&&new RegExp(e).test(o.url)})}async _setByUrl(e,t,r){return this._setByUrlRegexp(e,Me(t),r)}async _setByUrlRegexp(e,t,r){r=ni(r);let o=this.hasSetOnLocationByRegexp(t,r);if(o){o.state===0&&await o.done;return}return this._setAny(e,{urlRegex:t,condition:this.getBreakCondition(),...r})}async _setByScriptId(e,t,r){r=ni(r);let o=this.hasSetOnLocation(t,r);if(o){o.state===0&&await o.done;return}return this._setAny(e,{condition:this.getBreakCondition(),location:{scriptId:t.scriptId,...r}})}async _setAny(e,t){if(!this.isEnabled)return;let r={state:0,args:t,deadletter:!1};r.done=(async()=>{let o=jy(t)?await e.cdp().Debugger.setBreakpoint(t):await e.cdp().Debugger.setBreakpointByUrl(t);if(!o)return;if(r.deadletter){await e.cdp().Debugger.removeBreakpoint({breakpointId:o.breakpointId});return}let n="actualLocation"in o?[o.actualLocation]:o.locations;this._manager._resolvedBreakpoints.set(o.breakpointId,this);let s={state:1,cdpId:o.breakpointId,args:t,locations:n,uiLocations:[]};return this.updateCdpRefs(a=>a.map(c=>c===r?s:c)),await this.updateUiLocations(e,o.breakpointId,n),s})(),this.updateCdpRefs(o=>[...o,r]),await r.done}async removeCdpBreakpoint(e){var t;this.updateCdpRefs(r=>r.filter(o=>o!==e)),e.state===0?(e.deadletter=!0,await e.done):(await((t=this._manager._thread)==null?void 0:t.cdp().Debugger.removeBreakpoint({breakpointId:e.cdpId})),this._manager._resolvedBreakpoints.delete(e.cdpId))}}});var vu,Dr,Wg=m(()=>{"use strict";vu=require("path");xr();li();yu();Dr=class extends $s{constructor(t,r,o){super(t,r,{lineNumber:1,columnNumber:1});this.mode=o}static getModeKeyForSource(t,r){return t===1?(0,vu.basename)(r,(0,vu.extname)(r)||void 0):r}_setPredicted(){return Promise.resolve()}_setByPath(t,r){if(!this.source.path)return Promise.resolve();let o=Dr.getModeKeyForSource(this.mode,this.source.path);return this.mode===1?super._setByUrlRegexp(t,ot(o),r):super._setByPath(t,r)}}});var Uy,dr,up=m(()=>{"use strict";Uy=w(require("@vscode/l10n"));U();yu();dr=class extends $s{constructor(t,r,o,n,s){super(t,o,{lineNumber:n.line,columnNumber:n.column||1});this.dapId=r;this.dapParams=n;this.condition=s;this.completedSet=le()}equivalentTo(t){return t.dapParams.column===this.dapParams.column&&t.dapParams.line===this.dapParams.line&&t.dapParams.hitCondition===this.dapParams.hitCondition&&t.dapParams.condition===this.dapParams.condition&&t.dapParams.logMessage===this.dapParams.logMessage}untilSetCompleted(){return this.completedSet.promise}markSetCompleted(){this.completedSet.resolve()}testHitCondition(t){return this.condition.shouldStayPaused(t)}async toDap(){let t=this.enabled&&this.getResolvedUiLocation();return t?{id:this.dapId,verified:!0,source:await t.source.toDap(),line:t.lineNumber,column:t.columnNumber}:{id:this.dapId,verified:!1,message:Uy.t("Unbound breakpoint")}}diagnosticDump(){return{source:this.source,params:this.dapParams,cdp:this.cdpBreakpoints}}getBreakCondition(){return this.condition.breakCondition}updateCdpRefs(t){let r=this.getResolvedUiLocation();super.updateCdpRefs(t),this.getResolvedUiLocation()!==r&&this.notifyResolved()}getResolvedUiLocation(){for(let t of this.cdpBreakpoints)if(t.state===1&&t.uiLocations.length)return t.uiLocations[0]}async notifyResolved(){await this._manager.notifyBreakpointChange(this,this.completedSet.hasSettled())}}});var Su,Vy=m(()=>{"use strict";up();Og();Su=class extends dr{constructor(e,t,r,o){super(e,t,r,o,new ci(()=>!1))}getResolvedUiLocation(){}}});var Wy,qs,$y=m(()=>{"use strict";Wy=require("micromatch");Z();li();Wg();qs=class extends Dr{constructor(t,r){super(t,{path:r},1);this.pattern=r}async enable(t){if(this.isEnabled)return;this.isEnabled=!0;let r=(0,Wy.makeRe)(E(this.pattern),{contains:!0,lookbehinds:!1});await this._setAny(t,{urlRegex:r.source.replace(/([a-z]):/i,(o,n)=>`[${n.toLowerCase()}${n.toUpperCase()}]:`),lineNumber:0,columnNumber:0})}}});var Hs,Iu=m(()=>{"use strict";Hs=Symbol("IExperimentationService")});var zs,wR,yR,qy,vR,Pe,dp=m(()=>{"use strict";zs=require("inversify");$e();j();U();qr();Iu();As();wR=/\/node_modules\/|^node\:/,yR=2,qy=5e3,vR=qy/2,Pe=class{constructor(e,t,r){this.telemetry=t;this.experimentation=r;this.disposable=new O;this.hadBreakpoint=!1;this.didVerifyBreakpoint=!1;this.hadNonModuleSourcemap=!1;this.startedAt=Date.now();this.disposable.push(Pe.didVerifyEmitter.event(()=>{this.didVerifyBreakpoint=!0})),Pe.consecutiveQualifyingSessions>=yR&&this.disposable.push(Yb(async()=>{this.currentlyQualifying&&await this.experimentation.getTreatment("diagnosticPrompt",!0)&&(t.report("diagnosticPrompt",{event:"suggested"}),Pe.didSuggest=!0,e.suggestDiagnosticTool({}))},qy))}get currentlyQualifying(){return this.hadBreakpoint&&!this.didVerifyBreakpoint&&this.hadNonModuleSourcemap}notifyHadBreakpoint(){this.hadBreakpoint=!0}notifyVerifiedBreakpoint(){this.didVerifyBreakpoint||(Pe.didVerifyEmitter.fire(),Pe.didSuggest&&(Pe.didSuggest=!1,this.telemetry.report("diagnosticPrompt",{event:"resolved"})))}attach(e){if(!this.hadNonModuleSourcemap){let t=this.disposable.push(e.Debugger.on("scriptParsed",r=>{r.sourceMapURL&&!wR.test(r.url)&&(this.hadNonModuleSourcemap=!0,this.disposable.disposeObject(t))}))}}dispose(){this.currentlyQualifying&&Date.now()-vR>this.startedAt?Pe.consecutiveQualifyingSessions++:Pe.consecutiveQualifyingSessions=0,this.disposable.dispose()}};Pe.consecutiveQualifyingSessions=0,Pe.didVerifyEmitter=new S,Pe.didSuggest=!1,Pe=h([(0,zs.injectable)(),d(0,(0,zs.inject)(fs)),d(1,(0,zs.inject)(nt)),d(2,(0,zs.inject)(Hs))],Pe)});var Qr,Hy,zy,Gy,mr,li=m(()=>{"use strict";Qr=require("inversify");L();M();U();B();H();qr();ce();ky();Fg();du();Vg();Wg();Vy();$y();up();dp();Ht();Hy=i=>i.originalPosition.columnNumber===1&&i.originalPosition.lineNumber===1,zy=500,Gy=Symbol("DontCompare"),mr=class{constructor(e,t,r,o,n,s,a){this.logger=r;this.launchConfig=o;this.conditionFactory=n;this.suggester=s;this._breakpointsPredictor=a;this._resolvedBreakpoints=new Map;this._totalBreakpointsCount=0;this._launchBlocker=new Set;this._predictorDisabledForTest=!1;this._breakpointsStatisticsCalculator=new pu;this.entryBreakpointMode=0;this._enabledFilter=()=>!0;this._byDapId=new Map;this._byPath=rn();this._byRef=new Map;this.moduleEntryBreakpoints=rn();this._dap=e,this._sourceContainer=t,a==null||a.onLongParse(()=>e.longPrediction({})),t.onSourceMappedSteppingChange(()=>{if(this._thread)for(let c of this._byDapId.values())c.refreshUiLocations(this._thread)}),this._scriptSourceMapHandler=async(c,p)=>{if(!r.assert(this._thread,"Expected thread to be set for the breakpoint source map handler"))return[];let l=[],u=[p];for(let f=0;f<u.length;f++)for(let y of u[f]){let v=y.absolutePath,C=v?this._byPath.get(v):void 0;for(let te of C||[])l.push(te.updateForSourceMap(this._thread,c));let Y=this._byRef.get(y.sourceReference);for(let te of Y||[])l.push(te.updateForSourceMap(this._thread,c));y.sourceMap&&u.push(y.sourceMap.sourceByUrl.values())}return Yi(await Promise.all(l))}}get appliedByPath(){return this._byPath}get appliedByRef(){return this._byRef}hasAtLocation(e){let t=this._byPath.get(e.source.absolutePath)||[],r=this._byRef.get(e.source.sourceReference)||[];return t.concat(r).some(o=>o.originalPosition.columnNumber===e.columnNumber&&o.originalPosition.lineNumber===e.lineNumber)}moveBreakpoints(e,t,r){let o=p=>Ub(p,l=>{let u=this._sourceContainer.getOptiminalOriginalPosition(t,l.originalPosition);return u.column===null||u.line===null||l.updateSourceLocation({path:r.absolutePath,sourceReference:r.sourceReference},{lineNumber:u.line,columnNumber:u.column+1,source:r}),!1}),n=e.absolutePath,s=r.absolutePath,a=n?this._byPath.get(n):void 0;if(a&&s){let[p,l]=o(a);this._byPath.set(n,p),this._byPath.set(s,l)}let c=this._byRef.get(e.sourceReference);if(c){let[p,l]=o(c);this._byRef.set(e.sourceReference,p),this._byRef.set(r.sourceReference,l)}}async updateEntryBreakpointMode(e,t){if(t===this.entryBreakpointMode)return;let r=[...this.moduleEntryBreakpoints.values()];this.moduleEntryBreakpoints.clear(),this.entryBreakpointMode=t,await Promise.all(r.map(o=>this.ensureModuleEntryBreakpoint(e,o.source)))}async applyEnabledFilter(e,t=Gy){if(t!==Gy&&this._enabledFilter!==t)return;this._enabledFilter=e||(()=>!0);let r=this._thread;r&&await Promise.all([...this._byDapId.values()].map(o=>this._enabledFilter(o)?o.enable(r):o.disable()))}async getBreakpointLocations(e,t,r,o){let n=r.base1,s=this._sourceContainer.currentSiblingUiLocations({source:t,lineNumber:n.lineNumber,columnNumber:n.columnNumber}),a=o.base1,c=this._sourceContainer.currentSiblingUiLocations({source:t,lineNumber:a.lineNumber,columnNumber:a.columnNumber});if(s.length!==c.length)return this.logger.warn("internal","Expected to have the same number of start and end locations"),[];let p=[],l=[];for(let u=0;u<s.length;u++){let f=s[u],y=c[u];if(f.source!==y.source){this.logger.warn("internal","Expected to have the same number of start and end scripts");continue}let v=f.source;if(!v.scripts.length)continue;let{scriptId:C}=v.scripts[v.scripts.length-1];p.push(e.cdp().Debugger.getPossibleBreakpoints({restrictToFunction:!1,start:{scriptId:C,...ii(ni(f),v.runtimeScriptOffset)},end:{scriptId:C,...ii(ni(y),v.runtimeScriptOffset)}}).then(Y=>{if(Y)for(let te of Y.locations){let{lineNumber:ze,columnNumber:ut=0}=te,Te=this._sourceContainer.currentSiblingUiLocations({source:v,...sn(Py({lineNumber:ze,columnNumber:ut}),v.runtimeScriptOffset)});l.push({breakLocation:te,uiLocations:Te})}}))}return await Promise.all(p),l}setThread(e){var t;this._thread=e,this._thread.cdp().Debugger.on("breakpointResolved",r=>{let o=this._resolvedBreakpoints.get(r.breakpointId);o&&o.updateUiLocations(e,r.breakpointId,[r.location])}),this._thread.setSourceMapDisabler(r=>{let o=[];for(let n of r){let s=this._resolvedBreakpoints.get(n);if(s){let a=this._sourceContainer.source(s.source);St(a)&&o.push(a)}}return o});for(let r of this._byPath.values())r.forEach(o=>this._setBreakpoint(o,e)),this.ensureModuleEntryBreakpoint(e,(t=r[0])==null?void 0:t.source);for(let r of this._byRef.values())r.forEach(o=>this._setBreakpoint(o,e));"runtimeSourcemapPausePatterns"in this.launchConfig&&this.launchConfig.runtimeSourcemapPausePatterns.length&&this.setRuntimeSourcemapPausePatterns(e,this.launchConfig.runtimeSourcemapPausePatterns),this._byDapId.size>0&&this._installSourceMapHandler(this._thread)}async launchBlocker(){lu(this.logger,"BreakpointManager.launchBlocker",async()=>{this._predictorDisabledForTest||await Promise.all([...this._launchBlocker])})}setRuntimeSourcemapPausePatterns(e,t){return Promise.all(t.map(r=>this._setBreakpoint(new qs(this,r),e)))}addLaunchBlocker(...e){for(let t of e)this._launchBlocker.add(t),t.finally(()=>this._launchBlocker.delete(t))}setPredictorDisabledForTest(e){this._predictorDisabledForTest=e}_installSourceMapHandler(e){return this.launchConfig.perScriptSourcemaps==="yes"?Promise.all([this.updateEntryBreakpointMode(e,1),e.setScriptSourceMapHandler(!1,this._scriptSourceMapHandler)]).then(()=>!0):this._breakpointsPredictor&&!this.launchConfig.pauseForSourceMap?e.setScriptSourceMapHandler(!1,this._scriptSourceMapHandler):e.setScriptSourceMapHandler(!0,this._scriptSourceMapHandler)}async _uninstallSourceMapHandler(e){e.setScriptSourceMapHandler(!1),this._sourceMapHandlerInstalled=void 0}_setBreakpoint(e,t){this._enabledFilter(e)&&this.addLaunchBlocker(Promise.race([k(zy),e.enable(t)]))}async setBreakpoints(e,t){var l,u;!this._sourceMapHandlerInstalled&&this._thread&&((l=e.breakpoints)!=null&&l.length)&&(this._sourceMapHandlerInstalled={entryBpSet:this._installSourceMapHandler(this._thread)});let r=await((u=this._sourceMapHandlerInstalled)==null?void 0:u.entryBpSet);e.source.path=vt(e.source.path);let o=this._sourceContainer.source(e.source);if(e.source.sourceReference&&e.source.path&&!o&&(e.source.sourceReference=void 0),!r&&this._breakpointsPredictor&&!o){let f=this._breakpointsPredictor.predictBreakpoints(e);this.addLaunchBlocker(f),await f}let n=this._thread;if((n==null?void 0:n.debuggerReady.hasSettled())===!1){let f=n.debuggerReady.promise;this.addLaunchBlocker(f),await f}let s=f=>{var v;let y={unbound:f.slice(),new:[],list:[]};if(!e.breakpoints)return y;for(let C=0;C<e.breakpoints.length;C++){let Y=e.breakpoints[C],te;try{te=new dr(this,t[C],e.source,Y,this.conditionFactory.getConditionFor(Y))}catch(Te){if(!(Te instanceof I))throw Te;this._dap.output({category:"stderr",output:Te.message}),te=new Su(this,t[C],e.source,Y)}let ze=y.unbound.findIndex(Te=>Te.equivalentTo(te)),ut=y.unbound[ze];(v=ut==null?void 0:ut.equivalentTo)!=null&&v.call(ut,te)?(y.list.push(ut),y.unbound.splice(ze,1)):(y.new.push(te),y.list.push(te),this._byDapId.set(te.dapId,te))}return y},a=()=>e.source.path?this._byPath.get(e.source.path):e.source.sourceReference?this._byRef.get(e.source.sourceReference):void 0,c=s(a()??[]);if(e.source.path)this._byPath.set(e.source.path,c.list);else if(e.source.sourceReference)this._byRef.set(e.source.sourceReference,c.list);else return{breakpoints:[]};if(this._totalBreakpointsCount-=c.unbound.length,await Promise.all(c.unbound.map(f=>(this._byDapId.delete(f.dapId),f.disable()))),this._totalBreakpointsCount+=c.new.length,this._thread&&this._totalBreakpointsCount===0&&this._sourceMapHandlerInstalled&&this._uninstallSourceMapHandler(this._thread),n&&c.new.length){this.ensureModuleEntryBreakpoint(n,e.source);let f=a(),y=Promise.all(c.new.filter(this._enabledFilter).filter(v=>f==null?void 0:f.includes(v)).map(v=>v.enable(n)));this.addLaunchBlocker(Promise.race([k(zy),y])),await y}let p=await Promise.all(c.list.map(f=>f.toDap()));return this._breakpointsStatisticsCalculator.registerBreakpoints(p),k(0).then(()=>c.new.forEach(f=>f.markSetCompleted())),{breakpoints:p}}async notifyBreakpointChange(e,t){if(!this._byDapId.has(e.dapId))return;let r=await e.toDap();r.verified&&(this._breakpointsStatisticsCalculator.registerResolvedBreakpoint(e.dapId),this.suggester.notifyVerifiedBreakpoint()),t&&this._dap.breakpoint({reason:"changed",breakpoint:r})}isEntrypointBreak(e,t){let r=[...this.moduleEntryBreakpoints.values()].filter(o=>o.enabled&&o.cdpScriptIds.has(t));if(r.length){for(let o of r)o instanceof qs||o.disable();return!0}return e.some(o=>{let n=this._resolvedBreakpoints.get(o);return n&&(n instanceof Dr||Hy(n))})}async shouldPauseAt(e,t,r,o=!1){if(!t.length)return e.reason!=="instrumentation";let n=0,s=o?1:0;return await Promise.all(t.map(async a=>{if((r==null?void 0:r.cdpId)===a){n++;return}let c=this._resolvedBreakpoints.get(a);if(c instanceof Dr){this.entryBreakpointMode===0&&!(c instanceof qs)&&c.disable(),s++;return}c instanceof dr&&(await c.testHitCondition(e)?n++:s++)})),n>0||s===0}registerBreakpointsHit(e){for(let t of e){let r=this._resolvedBreakpoints.get(t);r instanceof dr&&this._breakpointsStatisticsCalculator.registerBreakpointHit(r.dapId)}}statisticsForTelemetry(){return this._breakpointsStatisticsCalculator.statistics()}ensureModuleEntryBreakpoint(e,t){if(!t.path||(this._byPath.get(t.path)??[]).some(Hy))return;let o=Dr.getModeKeyForSource(this.entryBreakpointMode,t.path);if(!t.path||this.moduleEntryBreakpoints.has(o))return;let n=new Dr(this,t,this.entryBreakpointMode);this.moduleEntryBreakpoints.set(t.path,n),this._setBreakpoint(n,e)}executionContextWasCleared(){for(let e of this._byDapId.values())e.executionContextWasCleared()}async reapply(){let e=[...this._byDapId.values()];if(await Promise.all(e.map(t=>t.disable())),this._thread){let t=this._thread;await Promise.all(e.map(r=>r.enable(t)))}}};mr=h([(0,Qr.injectable)(),d(0,(0,Qr.inject)(sr)),d(1,(0,Qr.inject)(Qe)),d(2,(0,Qr.inject)(T)),d(3,(0,Qr.inject)(ie)),d(4,(0,Qr.inject)(hu)),d(5,(0,Qr.inject)(Pe)),d(6,(0,Qr.inject)(ln))],mr)});var mp,he,gp,Jy=m(()=>{"use strict";mp=class{constructor(e){this.element=e,this.next=mp.Undefined,this.prev=mp.Undefined}},he=mp;he.Undefined=new mp(void 0);gp=class{constructor(){this._first=he.Undefined;this._last=he.Undefined;this._size=0}get size(){return this._size}isEmpty(){return this._first===he.Undefined}clear(){let e=this._first;for(;e!==he.Undefined;){let t=e.next;e.prev=he.Undefined,e.next=he.Undefined,e=t}this._first=he.Undefined,this._last=he.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){let r=new he(e);if(this._first===he.Undefined)this._first=r,this._last=r;else if(t){let n=this._last;this._last=r,r.prev=n,n.next=r}else{let n=this._first;this._first=r,r.next=n,n.prev=r}this._size+=1;let o=!1;return()=>{o||(o=!0,this._remove(r))}}shift(){if(this._first!==he.Undefined){let e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==he.Undefined){let e=this._last.element;return this._remove(this._last),e}}applyFilter(e){let t=this._first;for(;t!==he.Undefined;){let r=t.next;e(t.element)||this._remove(t),t=r}}_remove(e){if(e.prev!==he.Undefined&&e.next!==he.Undefined){let t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===he.Undefined&&e.next===he.Undefined?(this._first=he.Undefined,this._last=he.Undefined):e.next===he.Undefined?(this._last=this._last.prev,this._last.next=he.Undefined):e.prev===he.Undefined&&(this._first=this._first.next,this._first.prev=he.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==he.Undefined;)yield e.element,e=e.next}}});function At(i,e,t){if(e.isCancellationRequested)return Promise.reject(new Gt(t||"Task cancelled"));let r=le(),o=e.onCancellationRequested(r.resolve);return Promise.race([r.promise.then(()=>{throw new Gt(t||"Task cancelled")}),i.then(n=>(o.dispose(),n)).catch(n=>{throw o.dispose(),n})])}function Qy(i,e){let t=new pe(e),r=i.map(async o=>{try{return await o(t.token)}finally{t.cancel()}});return Promise.race(r)}var Gt,Yy,Be,$g,pe,Gs,Ve=m(()=>{"use strict";de();ce();j();U();Gt=class extends I{constructor(e){super({id:9243,format:e,showUser:!0}),this._cause={id:9243,format:e,showUser:!0}}};Yy=Object.freeze(function(i,e){let t=setTimeout(i.bind(e),0);return{dispose(){clearTimeout(t)}}}),Be=Object.freeze({isCancellationRequested:!1,onCancellationRequested:()=>({dispose:()=>{}})}),$g=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Yy}),pe=class{constructor(e){this._token=void 0;this._parentListener=void 0;this._parentListener=e&&e.onCancellationRequested(this.cancel,this)}static withTimeout(e,t){let r=new pe(t),o=r._token=new Gs,n=setTimeout(()=>o.cancel(),e);return o.onCancellationRequested(()=>clearTimeout(n)),r}get token(){return this._token||(this._token=new Gs),this._token}cancel(){this._token?this._token instanceof Gs&&this._token.cancel():this._token=$g}dispose(e=!1){e&&this.cancel(),this._parentListener&&this._parentListener.dispose(),this._token?this._token instanceof Gs&&this._token.dispose():this._token=Be}},Gs=class{constructor(){this._isCancelled=!1;this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?Yy:(this._emitter||(this._emitter=new S),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}}});var Xy,Zy=m(()=>{"use strict";Xy=(i,e)=>i+Math.floor(Math.random()*(e-i))});async function je({min:i=53e3,max:e=54e3,attempts:t=1e3,tester:r=ov}={},o=Be){let n=Xy(i,e);for(let s=Math.min(t,e-i);;s--)try{return await r(n,o)}catch(a){if(s===0||a instanceof Gt)throw a;n=n===e-1?i:n+1}}async function rv(i,e){try{return await ov(i,e),!0}catch{return!1}}function ov(i,e=Be){let t;return new Promise((r,o)=>{let n=ev.createServer();n.listen(i,"127.0.0.1",()=>{let s=n.address();n.close(()=>r(s.port))}),n.on("error",o),t=e.onCancellationRequested(()=>{n.close(),o(new Gt("Port open lookup cancelled"))})}).finally(()=>t==null?void 0:t.dispose())}var ev,tv,iv,nv,ui=m(()=>{"use strict";ev=w(require("net")),tv=w(require("ws"));Ve();Zy();iv=i=>(e,t)=>nv(new tv.WebSocketServer({host:"127.0.0.1",...i,port:e}),t),nv=(i,e)=>{let t;return new Promise((r,o)=>{i.on("error",o),i.on("listening",()=>r(i)),t=e.onCancellationRequested(()=>{i.close(),o(new Gt("Port open lookup cancelled"))})}).finally(()=>t==null?void 0:t.dispose())}});var Pu,IR,Cu,ht,Js,xo=m(()=>{"use strict";Pu=require("inversify"),IR=w(require("net"));Ve();j();ui();U();G();Cu=async(i,e,t)=>{let r=await je({tester:iv(e)},t),o=i.register(r.address().port);return r.on("close",()=>o.dispose()),r.on("error",()=>o.dispose()),r},ht=Symbol("IPortLeaseTracker"),Js=class{constructor(e){this.usedPorts=new Set;this.onRegistered=new S;this.isMandated=e==="remote"}register(e){return this.usedPorts.add(e),this.onRegistered.fire(e),{dispose:()=>this.usedPorts.delete(e)}}isRegistered(e,t=2e3){return this.usedPorts.has(e)?Promise.resolve(!0):e<53e3||e>=54e3?Promise.resolve(!1):Qy([()=>k(t).then(()=>!1),r=>new Promise(o=>{let n=this.onRegistered.event(s=>{s===e&&o(!0)});r.onCancellationRequested(()=>n.dispose())})])}};Js=h([(0,Pu.injectable)(),d(0,(0,Pu.inject)(Io))],Js)});var cv,Qs,sv,av,qg,xu,Ks,PR,Hg,zg=m(()=>{"use strict";cv=require("crypto"),Qs=require("inversify");He();Jy();$e();L();xo();sv="JsDebug",av="*",qg=class{constructor(){this.replays=new Map}addReplay(e,t,r){let o=this.replays.get(e);return o||(o=new gp,this.replays.set(e,o)),o.push({event:`${e}.${t}`,params:r})}capture(e,t,r,o){let n=e[t];if(o===0)n.on(r,s=>this.addReplay(t,r,s));else if(o===2){let s;n.on(r,a=>{s==null||s(),s=this.addReplay(t,r,a)})}else{let s=new gp;n.on(r,a=>{var c;s.size===o.cap&&((c=s.shift())==null||c()),s.push(this.addReplay(t,r,a))})}}filter(e,t){let r=this.replays.get(e);r&&r.applyFilter(t)}clearEvent(e,t){let r=`${e}.${t}`;this.filter(e,o=>o.event!==r)}clearDomain(e){this.replays.delete(e)}read(e){return this.replays.get(e)??[]}},xu=Symbol("ICdpProxyProvider"),Ks=class{constructor(e,t,r){this.cdp=e;this.portTracker=t;this.logger=r;this.disposables=new O;this.replay=new qg;this.jsDebugApi={subscribe:(e,{events:t})=>{for(let r of t)r.endsWith(av)?e.pushDisposable(this.cdp.session.onPrefix(r.slice(0,-av.length),o=>e.send({method:o.method,params:o.params}))):e.pushDisposable(this.cdp.session.on(r,o=>e.send({method:r,params:o})));return{}}};this.replay.capture(e,"CSS","styleSheetAdded",0),this.replay.capture(e,"Debugger","paused",2),this.replay.capture(e,"Runtime","executionContextCreated",{cap:50,type:1}),this.replay.capture(e,"Runtime","consoleAPICalled",{cap:50,type:1}),e.Debugger.on("resumed",()=>{this.replay.clearEvent("Debugger","paused")}),e.CSS.on("fontsUpdated",o=>{o.font&&this.replay.addReplay("CSS","fontsUpdated",o)}),e.CSS.on("styleSheetRemoved",o=>this.replay.filter("CSS",n=>n.params.styleSheetId!==o.styleSheetId))}async proxy(){this.server||(this.server=this.createServer());let{server:e,path:t}=await this.server,r=e.address();return{host:r.address,port:r.port,path:t}}async createServer(){let e=`/${(0,cv.randomBytes)(20).toString("hex")}`,t=await Cu(this.portTracker,{perMessageDeflate:!0,path:e});return this.logger.info("proxyActivity","activated cdp proxy"),t.on("connection",r=>{let o=new Hg(r,this.logger);this.logger.info("proxyActivity","accepted proxy connection",{id:o.id}),r.on("close",()=>{this.logger.verbose("proxyActivity","closed proxy connection",{id:o.id}),this.disposables.disposeObject(o)}),r.on("message",async n=>{let s;try{s=JSON.parse(n.toString())}catch(f){return o.send({id:0,error:{code:-32700,message:f.message}})}this.logger.verbose("proxyActivity","received proxy message",s);let{method:a,params:c,id:p=0}=s,[l,u]=a.split(".");try{let f=l===sv?await this.invokeJsDebugDomainMethod(o,u,c):await this.invokeCdpMethod(o,l,u,c);o.send({id:p,result:f})}catch(f){let y=f instanceof un&&f.cause?f.cause:{code:0,message:f.message};o.send({id:p,error:y})}})}),{server:t,path:e}}dispose(){var e;this.disposables.dispose(),(e=this.server)==null||e.then(t=>t.server.close()),this.server=void 0}invokeCdpMethod(e,t,r,o){let n=this.cdp.session.sendOrDie(`${t}.${r}`,o);switch(r){case"enable":for(let s of this.replay.read(t))e.send({method:s.event,params:s.params});break;case"disable":this.replay.clearDomain(t);break;default:}return n}invokeJsDebugDomainMethod(e,t,r){if(!this.jsDebugApi.hasOwnProperty(t))throw new un(t).setCause(-32601,`${sv}.${t} not found`);return this.jsDebugApi[t](e,r)}};Ks=h([(0,Qs.injectable)(),d(0,(0,Qs.inject)(_e)),d(1,(0,Qs.inject)(ht)),d(2,(0,Qs.inject)(T))],Ks);PR=0,Hg=class{constructor(e,t){this.webSocket=e;this.logger=t;this.disposables=new O;this.id=PR++}pushDisposable(e){this.disposables.push(e)}dispose(){this.disposables.dispose(),this.webSocket.close()}send(e){this.logger.verbose("proxyActivity","send proxy message",e),this.webSocket.send(JSON.stringify(e))}}});var Gg,pv,lv=m(()=>{"use strict";ku();Je();Gg=gt(function(i,e,t){let r=t?"variable":"property",o=(l,u,f)=>{if(u!=="function")return r;if(l==="constructor")return"class";let y=String(f);return y.startsWith("class ")||y.includes("[native code]")&&/^[A-Z]/.test(l)?"class":t?"function":"method"},n=l=>{switch(typeof l){case"number":case"boolean":return`${l}`;case"object":return l===null?"null":l.constructor.name||"object";case"function":return`fn(${new Array(l.length).fill("?").join(", ")})`;default:return typeof l}},s=[],a=new Set,c="~",p=i===void 0?this:i;for(;p!=null;p=p.__proto__){c+="~";let l=Object.getOwnPropertyNames(p).filter(u=>u.startsWith(e)&&!u.match(/^\d+$/));for(let u of l){if(a.has(u))continue;a.add(u);let f=Object.getOwnPropertyDescriptor(p,u),y=r,v;try{let C=p[u];y=o(u,typeof(f==null?void 0:f.value),C),v=n(C)}catch{}s.push({label:u,sortText:c+u.replace(/^_+/,C=>"{".repeat(C.length)),type:y,detail:v})}t=!1}return{result:s,isArray:this instanceof Array}}),pv=tn(Gg.source)});function xR(i){let e=!1;return(0,Xs.traverse)(i,{enter(t){if(t.type==="CallExpression"||t.type==="NewExpression"||t.type==="UnaryExpression"&&t.operator==="delete"||t.type==="ClassBody")return e=!0,Xs.VisitorOption.Break}}),e}var uv,Xs,fp,CR,Tu,Ys,ku=m(()=>{"use strict";uv=require("acorn-loose"),Xs=require("estraverse"),fp=require("inversify");He();hs();xr();dn();lv();CR=i=>{var e,t,r;switch(i.type){case"ClassDeclaration":case"ClassExpression":return{type:"class",id:i.id};case"MethodDefinition":return{type:((e=i.key)==null?void 0:e.type)==="Identifier"&&i.key.name==="constructor"?"constructor":"method",id:i.key};case"VariableDeclarator":return{type:((t=i.init)==null?void 0:t.type)==="FunctionExpression"||((r=i.init)==null?void 0:r.type)==="ArrowFunctionExpression"?"function":"variable",id:i.id}}};Tu=Symbol("ICompletions"),Ys=class{constructor(e,t){this.evaluator=e;this.cdp=t}async completions(e){let t=zo(e.expression),r=new Qo(e.expression).convert(e.position),o=()=>Promise.resolve([]);return(0,Xs.traverse)(t,{enter:n=>{let s=n;s.start<r&&r<=s.end&&(n.type==="Identifier"?o=()=>this.identifierCompleter(e,t,n,r):n.type==="MemberExpression"&&(o=n.computed?()=>this.elementAccessCompleter(e,n,r):()=>this.propertyAccessCompleter(e,n,r)))}}),o().then(n=>n.sort((s,a)=>s.sortText>a.sortText?1:-1))}async elementAccessCompleter(e,t,r){if(t.property.type!=="Literal"||typeof t.property.value!="string")return[];let o=e.expression.slice(Ho(t.property)+1,r);return(await this.defaultCompletions(e,o)).filter(s=>s.sortText!=="~~[").map(s=>({...s,text:JSON.stringify(s.text??s.label)+"]",start:Ho(t.property),length:sg(t.property)-Ho(t.property)}))}async identifierCompleter(e,t,r,o){let n=[];(0,Xs.traverse)(t,{enter(c){var l;let p=CR(c);((l=p==null?void 0:p.id)==null?void 0:l.type)==="Identifier"&&n.push({label:p.id.name,type:p.type,sortText:p.id.name})}});let s=e.expression.slice(Ho(r),o),a=[...n,...await this.defaultCompletions(e,s)];return this.evaluator.hasReturnValue&&e.executionContextId!==void 0&&Co.startsWith(s)&&a.push({sortText:`~${Co}`,label:Co,type:"variable"}),a}async propertyAccessCompleter(e,t,r){let{result:o,isArray:n}=await this.completePropertyAccess({executionContextId:e.executionContextId,stackFrame:e.stackFrame,expression:Nw(e.expression,t.object),prefix:(0,uv.isDummy)(t.property)?"":e.expression.slice(Ho(t.property),r),throwOnSideEffect:xR(t)}),s=Ho(t.property)-1,a=/^[$a-z_][0-9a-z_$]*$/i;for(let c of o)a.test(c.label)||(c.text=`[${JSON.stringify(c.label)}]`,c.start=s,c.length=1);if(n){let c="index";o.unshift({label:`[${c}]`,text:`[${c}]`,type:"property",sortText:"~~[",start:s,selectionStart:1,selectionLength:c.length,length:1})}return o}async completePropertyAccess({executionContextId:e,stackFrame:t,expression:r,prefix:o,isInGlobalScope:n=!1,throwOnSideEffect:s=!1}){let a={expression:`(${r})`,objectGroup:"console",silent:!0,throwOnSideEffect:s},c=t&&t.callFrameId(),p=await this.evaluator.evaluate(c?{...a,callFrameId:c}:{...a,contextId:e},{stackFrame:t});if(!p||p.exceptionDetails)return{result:[],isArray:!1};if(!p.result.objectId){let l={...a,returnByValue:!0,throwOnSideEffect:!1,expression:pv.expr(`(${r})`,JSON.stringify(o),JSON.stringify(n))},u=await this.evaluator.evaluate(c?{...l,callFrameId:c}:{...l,contextId:e});return!u||u.exceptionDetails?{result:[],isArray:!1}:u.result.value}try{return(await Gg({cdp:this.cdp,args:[void 0,o,n],objectId:p.result.objectId,returnByValue:!0})).value}catch{return{result:[],isArray:!1}}finally{this.cdp.Runtime.releaseObject({objectId:p.result.objectId})}}async defaultCompletions(e,t=""){for(let r of["self","global","this"]){let{result:o}=await this.completePropertyAccess({executionContextId:e.executionContextId,stackFrame:e.stackFrame,expression:r,prefix:t,isInGlobalScope:!0});if(e.stackFrame){let n=t.toLowerCase(),s=new Set(o.map(a=>a.label));for(let a of await e.stackFrame.completions())s.has(a.label)||!a.label.toLowerCase().includes(n)||(s.add(a.label),o.push(a))}return o.push(...this.syntheticCompletions(e,t)),o}return this.syntheticCompletions(e,t)}syntheticCompletions(e,t){return this.evaluator.hasReturnValue&&Co.startsWith(t)?[{sortText:`~${Co}`,label:Co,type:"variable"}]:[]}};Ys=h([(0,fp.injectable)(),d(0,(0,fp.inject)(ur)),d(1,(0,fp.inject)(_e))],Ys)});var Yr,Jg=m(()=>{"use strict";Yr=class{constructor(e,t){this._tokens=[];this._separator=t||"",this._budget=e-1-this._separator.length}append(e){if(e.length>this.budget()){this.appendEllipsis();return}this._append(e)}_append(e){this._tokens.length&&(this._budget-=this._separator.length),this._tokens.push(e),this._budget-=e.length}appendEllipsis(){this._tokens[this._tokens.length-1]!=="\u2026"&&this._append("\u2026")}checkBudget(){return this._budget<=0&&this.appendEllipsis(),this._budget>0}budget(){return this._budget-(this._tokens.length?this._separator.length:0)}build(){return this._tokens.join(this._separator)}isEmpty(){return!this._tokens.length}}});function TR(i,e){if(!i.includes("%"))return[{type:"string",value:i}];let t=[];function r(c){if(!c)return;let p=t[t.length-1];(p==null?void 0:p.type)==="string"?p.value+=c:t.push({type:"string",value:c})}function o(c,p,l){t.push({type:"specifier",specifier:c,precision:p,substitutionIndex:l})}let n=0,s=0,a=new RegExp(`%%|%(?:(\\d+)\\$)?(?:\\.(\\d*))?([${e.join("")}])`,"g");for(let c=a.exec(i);c;c=a.exec(i)){let p=c.index;if(p>n&&r(i.substring(n,p)),c[0]==="%%")r("%");else{let[,l,u,f]=c;l&&Number(l)>0&&(s=Number(l)-1);let y=u?Number(u):void 0;o(f,y,s),++s}n=p+c[0].length}return r(i.substring(n)),t}function Kg(i,e,t){let r=TR(i,Array.from(t.keys())),o=new Set,n=t.get("");if(!n)throw new Error("Expected to hav a default formatter");let s=new Yr(kR),a=!1;for(let c=0;s.checkBudget()&&c<r.length;++c){let p=r[c];if(p.type==="string"){s.append(p.value);continue}let l=p.substitutionIndex;if(l>=e.length){s.append("%"+(p.precision||"")+p.specifier);continue}o.add(l),p.specifier==="c"&&(a=!0);let u=t.get(p.specifier)||n;s.append(u(e[l],{budget:s.budget(),quoted:!1}))}a&&s.append("\x1B[0m");for(let c=0;s.checkBudget()&&c<e.length;++c)o.has(c)||(o.add(c),(i||c)&&s.append(" "),s.append(n(e[c],{budget:s.budget(),quoted:!1})));return{result:s.build(),usedAllSubs:o.size===e.length}}function dv(i){try{return new mv.default(i).ansi256().object().ansi256}catch{}}function gv(i){let e=/\s*(.*?)\s*:\s*(.*?)\s*(?:;|$)/g,t="\x1B[0m",r=e.exec(i);for(;r!==null;){if(r.length===3)switch(r[1]){case"color":let o=dv(r[2]);o&&(t+=`\x1B[38;5;${o}m`);break;case"background":case"background-color":let n=dv(r[2]);n&&(t+=`\x1B[48;5;${n}m`);break;case"font-weight":r[2]==="bold"&&(t+="\x1B[1m");break;case"font-style":r[2]==="italic"&&(t+="\x1B[3m");break;case"text-decoration":r[2]==="underline"&&(t+="\x1B[4m");break;default:}r=e.exec(i)}return t}var mv,kR,Qg=m(()=>{"use strict";mv=w(require("color"));Jg();kR=1e4});var hv,DR,fv,_R,LR,AR,Ru,Du=m(()=>{"use strict";hv=i=>i.replace(/\\/gm,"\\\\").replace(/\n/gm,"\\n").replace(/\r/gm,"\\r").replace(/\t/gm,"\\t"),DR={budget:1e5,quoted:!0},fv={budget:1e3,quoted:!0,postProcess:hv},_R={budget:1/0,quoted:!1},LR={budget:1e3,quoted:!0,postProcess:hv},AR={budget:1e5,quoted:!0},Ru=i=>{switch(i){case"repl":return DR;case"hover":return fv;case"propertyValue":return fv;case"watch":return LR;case"copy":case"clipboard":return _R;default:return AR}}});function mn(i){return i.type==="function"||i.type==="object"&&!Xg.has(i.subtype)}function Zg(i){return i.subtype==="array"||i.subtype==="typedarray"}function gn(i,e,t){var n,s;let r=Ru(e),o=_u(i,r,t);return((n=i.preview)==null?void 0:n.subtype)==="regexp"?o:((s=r.postProcess)==null?void 0:s.call(r,o))??o}function _u(i,e,t){return i.type==="function"?i.description?Sv(i.description,e.budget):"<function>":i.type==="object"&&i.subtype==="node"?i.description:"preview"in i&&i.preview?Lu(i.preview,e.budget,t):vv(i,e.budget,e.quoted,t)}function Lu(i,e,t){return Zg(i)?jR(i,e):i.subtype==="internal#entry"?Hr(i.description||"",e):i.type==="function"?Sv(i.description,e):mn(i)?OR(i,e,t):UR(i,e,t)}function jR(i,e){let t=new Yr(e),r=i.description,o=r.match(/[^(]*\(([\d]+)\)/);if(!o)return r;let n=parseInt(o[1],10);r.startsWith("Array(")&&(r=r.substring(5)),t.append(Hr(r,t.budget())),t.append(" ");let s=new Yr(t.budget()-2,", "),a=-1;for(let c of i.properties){if(!s.checkBudget())break;if(isNaN(c.name))continue;let p=parseInt(c.name,10);p>a+1&&s.appendEllipsis(),a=p,s.append(hp(c,s.budget()))}n>a+1&&s.appendEllipsis();for(let c of i.properties){if(!s.checkBudget())break;isNaN(c.name)&&s.append(hp(c,s.budget(),c.name))}return i.overflow&&s.appendEllipsis(),t.append("["+s.build()+"]"),t.build()}function OR(i,e,t){let r=new Yr(e," ");i.description!=="Object"&&r.append(Hr(i.description,r.budget()));let o=new Map,n=i.properties||[];for(let f of n)o.set(f.name,f);let s=o.get("[[PrimitiveValue]]");if(s)return r.append(`(${hp(s,r.budget()-2)})`),r.build();let a=o.get("[[PromiseStatus]]"),c=o.get("[[PromiseValue]]");if(a&&c)return a.value==="pending"?r.append(`{<${a.value}>}`):r.append(`{${hp(c,r.budget()-2,`<${a.value}>`)}}`),r.build();let p=o.get("[[GeneratorStatus]]");if(p)return r.append(`{<${p.value}>}`),r.build();let l=new Yr(r.budget()-2,", ");for(let f of n){if(!l.checkBudget())break;l.append(hp(f,l.budget(),f.name))}for(let f of i.entries||[]){if(!l.checkBudget())break;if(f.key){let y=Lu(f.key,Math.min(Yg,l.budget()),t),v=Lu(f.value,Math.min(Yg,l.budget()-y.length-4),t);l.append(Zs(y," => ",v,l.budget()))}else l.append(Lu(f.value,Math.min(Yg,l.budget()),t))}i.overflow&&l.appendEllipsis();let u=l.build();return u?r.append("{"+u+"}"):r.isEmpty()&&r.append("{}"),r.build()}function wv(i,e){return i.length<=e?i:"\u2026"}function NR(i,e){return i.length>=e?i.slice(0,e-1)+"\u2026":i}function UR(i,e,t){if(i.type==="object"&&i.subtype==="null")return wv("null",e);if(i.type==="undefined")return wv("undefined",e);if(i.type==="string"){let r=i.description??i.value;return t!=null&&t.hex&&(r=Buffer.from(r,"utf8").toString("hex")),vs(r,e)}return i.type==="number"||i.type==="bigint"?bp(i,!1,e,t):NR(i.description||"",e)}function Zs(i,e,t,r){return i===void 0?vs(t,r):i.length+e.length>r?Hr(i,r):`${i}${e}${vs(t,r-i.length-e.length)}`}function hp(i,e,t){return e=Math.min(e,FR),i.type==="function"?Zs(t,": ","\u0192",e):i.type==="object"&&i.value==="Object"?Zs(t,": ","{\u2026}",e):typeof i.value>"u"?Zs(t,": ",`<${i.type}>`,e):i.type==="string"?Zs(t,": ",`'${i.value}'`,e):Zs(t,": ",i.value??"unknown",e)}function vv(i,e,t,r){if(i.type==="string"){let o=i.value||(i.description?i.description:"");r!=null&&r.hex&&(o=Buffer.from(o,"utf8").toString("hex"),t=!1);let n=vs(o,t?e-2:e);return t?`'${n}'`:n}return i.type==="undefined"?"undefined":i.subtype==="null"?"null":i.type==="bigint"||i.type==="number"?bp(i,!1,e,r):i.description?Hr(i.description,Math.max(e,1e5)):Hr(String("value"in i?i.value:i.description),e)}function Sv(i,e){let t=new Yr(e),r=i.replace(/^function [gs]et /,"function ").replace(/^function [gs]et\(/,"function(").replace(/^[gs]et /,""),o=r.match(/^(async\s+function)/),n=r.startsWith("function*"),s=r.startsWith("*"),a=!n&&r.startsWith("function"),c=r.startsWith("class ")||r.startsWith("class{"),p=r.indexOf("=>"),l=!o&&!n&&!a&&!c&&p>0,u;if(c){u=r.substring(5);let v=/^[^{\s]+/.exec(u.trim()),C="";v&&(C=v[0].trim()||""),y("class",u,C)}else if(o)u=r.substring(o[1].length),y("async \u0192",u,f(u));else if(n)u=r.substring(9),y("\u0192*",u,f(u));else if(s)u=r.substring(1),y("\u0192*",u,f(u));else if(a)u=r.substring(8),y("\u0192",u,f(u));else if(l){let v=r;r.length>ER&&(v=r.substring(0,p+2)+" {\u2026}"),y("",r,v)}else y("\u0192",r,f(r));return t.build();function f(v){let C=v.indexOf("("),Y=v.match(/\)\s*{/),te=Y&&Y.index||0;if(C!==-1&&Y&&te>C){let ze=v.substring(0,C).trim()||"",ut=v.substring(C,te+1);return ze+ut}return"()"}function y(v,C,Y){t.checkBudget()&&(v.length&&t.append(v+" "),C=C.trim(),C.endsWith(" { [native code] }")&&(C=C.substring(0,C.length-18)),t.budget()>=C.length?t.append(C):t.append(Y.replace(/\n/g," ")))}}function fn(i){let e=i;if(e.type!=="object"||e.subtype==="null")return{title:vv(e,MR,!1,void 0)};let t=e.description??e.className??"Error",r=/^\s+at\s/m.exec(t);if(!r){let o=t.lastIndexOf(`
`);return o===-1?{title:t}:{title:t.substring(0,o)}}return{title:t.substring(0,r.index-1),stackTrace:t.substring(r.index+2)}}function bp(i,e,t,r){if(i.type==="number"){if("unserializableValue"in i)return i.unserializableValue;let s=i.value||+i.description;return r!=null&&r.hex?s.toString(16):String(s)}if(i.type==="bigint"){let s=i.unserializableValue||i.description;return r!=null&&r.hex?BigInt(s.slice(0,-1)).toString(16):s}let o=i,n=typeof o.value=="number"?o.value:+String(o.description);return Hr(String(e?Math.floor(n):n),t)}function VR(i,e){return vs(String(typeof i.value<"u"?i.value:i.description),e)}function Iv(i){var l;let e=[],t=new Set([void 0]),r=new Map;for(let u of i.properties.filter(f=>f.valuePreview)){let f=new Map;f.set(void 0,u.name),r.set(void 0,Math.max(r.get(void 0)||0,u.name.length)),e.push(f),(l=u.valuePreview)==null||l.properties.map(y=>{y.value&&(t.add(y.name),f.set(y.name,y.value),r.set(y.name,Math.max(r.get(y.name)||0,y.value.length)))})}for(let u of t.values())u&&r.set(u,Math.max(r.get(u)||0,u.length));let o=Array.from(r.values()).reduce((u,f)=>u+f,0),n=bv-4-(t.size-1)*3;if(o>n){let u=n/o;for(let f of r.keys()){let y=Math.max(BR,r.get(f)*u|0);r.set(f,y)}}let s=[];for(let u of t.values())s.push("-".repeat(r.get(u)));let a="[-"+s.join("-|-")+"-]",c=[];c.push(a.replace("[","\u256D").replace(/\|/g,"\u252C").replace("]","\u256E").replace(/-/g,"\u2504"));let p=[];for(let u of t.values())p.push(yv(u||"",r.get(u)));c.push("\u250A "+p.join(" \u250A ")+" \u250A"),c.push(a.replace("[","\u251C").replace(/\|/g,"\u253C").replace("]","\u2524").replace(/-/g,"\u2504"));for(let u of e){let f=[];for(let y of t.values())f.push(yv(u.get(y)||"",r.get(y)));c.push("\u250A "+f.join(" \u250A ")+" \u250A")}return c.push(a.replace("[","\u2570").replace(/\|/g,"\u2534").replace("]","\u256F").replace(/-/g,"\u2504")),c.map(u=>Hr(u,bv)).join(`
`)}function yv(i,e){return i.length===e?i:i.length<e?i+" ".repeat(e-i.length):Hr(i,e)}var ER,FR,Yg,MR,BR,bv,Xg,ef,ea=m(()=>{"use strict";Jg();xr();Qg();Du();ER=30,FR=100,Yg=20,MR=1e4,BR=3,bv=120,Xg=new Set(["null","regexp","date"]);ef=new Map([["",(i,e)=>_u(i,e)],["s",(i,e)=>VR(i,e.budget)],["i",(i,e)=>bp(i,!0,e.budget,void 0)],["d",(i,e)=>bp(i,!0,e.budget,void 0)],["f",(i,e)=>bp(i,!1,e.budget,void 0)],["c",i=>gv(i.value)],["o",(i,e)=>_u(i,e)],["O",(i,e)=>_u(i,e)]])});var Cv,xv=m(()=>{"use strict";Je();Cv=gt(function(){return this})});var Au,Eu,kv=m(()=>{"use strict";Au=w(require("@vscode/l10n"));ea();xv();Eu=class{constructor(e,t){this.protoObj=e;this.cdp=t}async toDap(e){if(!this.protoObj.objectId)return{category:"stderr",output:Au.t("Only objects can be queried")};let t=await this.cdp.Runtime.queryObjects({prototypeObjectId:this.protoObj.objectId,objectGroup:"console"});if(await this.cdp.Runtime.releaseObject({objectId:this.protoObj.objectId}),!t)return{category:"stderr",output:Au.t("Could not query the provided object")};let r;try{r=await Cv({cdp:this.cdp,args:[],objectId:t.objects.objectId,objectGroup:"console",generatePreview:!0})}catch(s){return{category:"stderr",output:Au.t(s.message)}}let o="\x1B[32mobjects: "+gn(r,"repl")+"\x1B[0m";return{category:"stdout",output:"",variablesReference:e.replVariables.createVariableForOutput(o,[r]).id}}}});var Tv,Rv,di,tf,Fu=m(()=>{"use strict";ps();Tv=/^(\W*at .*\()(.*):(\d+):(\d+)(\))$/,Rv=/^(\W*at )(.*):(\d+):(\d+)$/,di=class{constructor(e){this.stack=e}static isStackLike(e){return Tv.test(e)||Rv.test(e)}*[Symbol.iterator](){for(let e of this.stack.split(`
`)){let t=Tv.exec(e)||Rv.exec(e);if(!t){yield e+`
`;continue}let[,r,o,n,s,a]=t;r&&(yield r),yield new tf(o,new Vt(Number(n),Number(s))),a&&(yield a),yield`
`}}},tf=class{constructor(e,t){this.path=e;this.position=t}toString(){return`${this.path}:${this.position.lineNumber}:${this.position.columnNumber}`}}});var It,ta=m(()=>{"use strict";It=class{constructor(e=process.hrtime()){this.value=e}get ms(){return this.s*1e3}get s(){return this.value[0]+this.value[1]/1e9}elapsed(){return new It().subtract(this)}subtract(e){let t=this.value[1]-e.value[1],r=this.value[0]-e.value[0];return t<0&&(t+=1e9,r--),new It([r,t])}}});var ra,rf=m(()=>{"use strict";j();B();ra=class{constructor(e,t,r,o,n,s){this.launchConfig=e;this.targetInfo=t;this.parentTarget=r;this.targetOriginValue=o;this.cdp=n;this.logger=s;this.onNameChanged=new S().event;this.attached=!1;this.isWaitingForDebugger=!0;n.pause()}id(){return this.targetInfo.targetId}name(){return this.targetInfo.title}fileName(){return this.targetInfo.url}type(){return"node"}parent(){return this.parentTarget}children(){return[]}canStop(){return!1}stop(){}canRestart(){return!1}restart(){}canAttach(){return!this.attached}async attach(){return await this.cdp.Runtime.enable({}),await this.cdp.Debugger.enable({}),this.attached=!0,this.cdp}canDetach(){return this.attached}async detach(){await this.cdp.Debugger.resume({}),await this.cdp.NodeWorker.detach({sessionId:this.targetInfo.targetId}),this.attached=!1}targetOrigin(){return this.targetOriginValue}afterBind(){return this.cdp.resume(),Promise.resolve()}async runIfWaitingForDebugger(){this.isWaitingForDebugger=!1,await this.cdp.Runtime.runIfWaitingForDebugger({})}initialize(){return Promise.resolve()}waitingForDebugger(){return this.isWaitingForDebugger}supportsCustomBreakpoints(){return!1}scriptUrlToUrl(e){return e[0]==="/"||process.platform==="win32"&&e[1]===":"&&e[2]==="\\"?W(e):e}executionContextName(){return this.targetInfo.title}}});function of(){if(Mu.size)return Mu;function i(n,s){for(let a of s)a.group=n,Mu.set(a.id,a)}function e(n,s){let a=s||n;return{id:"instrumentation:"+n,title:a,group:"",details:c=>{if(n==="webglErrorFired"){let p=c.webglErrorName;return p=p.replace(/^.*(0x[0-9a-f]+).*$/i,"$1"),{short:p,long:Oe.t('Paused on WebGL Error instrumentation breakpoint, error "{0}"',p)}}return n==="scriptBlockedByCSP"&&c.directiveText?{short:Oe.t('CSP violation "{0}"',c.directiveText),long:Oe.t('Paused on Content Security Policy violation instrumentation breakpoint, directive "{0}"',c.directiveText)}:{short:a,long:Oe.t('Paused on instrumentation breakpoint "{0}"',a)}},apply:async(c,p)=>p?!!await c.DOMDebugger.setInstrumentationBreakpoint({eventName:n}):!!await c.DOMDebugger.removeInstrumentationBreakpoint({eventName:n})}}function t(n,s,a){let c=s===void 0?"*":typeof s=="string"?[s]:s;return{id:"listener:"+n,title:a||n,group:"",details:p=>{let l=(p.targetName||"*").toLowerCase();return{short:l+"."+n,long:Oe.t('Paused on event listener breakpoint "{0}", triggered on "{1}"',n,l)}},apply:async(p,l)=>{let u=!0;for(let f of c)l?u=u&&!!await p.DOMDebugger.setEventListenerBreakpoint({eventName:n,targetName:f}):u=u&&!!await p.DOMDebugger.removeEventListenerBreakpoint({eventName:n,targetName:f});return u}}}i("Animation",[e("requestAnimationFrame",Oe.t("Request Animation Frame")),e("cancelAnimationFrame",Oe.t("Cancel Animation Frame")),e("requestAnimationFrame.callback",Oe.t("Animation Frame Fired"))]),i("Canvas",[e("canvasContextCreated",Oe.t("Create canvas context")),e("webglErrorFired",Oe.t("WebGL Error Fired")),e("webglWarningFired",Oe.t("WebGL Warning Fired"))]),i("Script",[e("scriptFirstStatement",Oe.t("Script First Statement")),e("scriptBlockedByCSP",Oe.t("Script Blocked by Content Security Policy"))]),i("Geolocation",[e("Geolocation.getCurrentPosition","getCurrentPosition"),e("Geolocation.watchPosition","watchPosition")]),i("Notification",[e("Notification.requestPermission","requestPermission")]),i("Parse",[e("Element.setInnerHTML",Oe.t("Set innerHTML")),e("Document.write","document.write")]),i("Timer",[e("setTimeout"),e("clearTimeout"),e("setInterval"),e("clearInterval"),e("setTimeout.callback",Oe.t("setTimeout fired")),e("setInterval.callback",Oe.t("setInterval fired"))]),i("Window",[e("DOMWindow.close","window.close")]),i("WebAudio",[e("audioContextCreated",Oe.t("Create AudioContext")),e("audioContextClosed",Oe.t("Close AudioContext")),e("audioContextResumed",Oe.t("Resume AudioContext")),e("audioContextSuspended",Oe.t("Suspend AudioContext"))]);let r=["audio","video"];i("Media",[t("play",r),t("pause",r),t("playing",r),t("canplay",r),t("canplaythrough",r),t("seeking",r),t("seeked",r),t("timeupdate",r),t("ended",r),t("ratechange",r),t("durationchange",r),t("volumechange",r),t("loadstart",r),t("progress",r),t("suspend",r),t("abort",r),t("error",r),t("emptied",r),t("stalled",r),t("loadedmetadata",r),t("loadeddata",r),t("waiting",r)]),i("Picture-in-Picture",[t("enterpictureinpicture","video"),t("leavepictureinpicture","video"),t("resize","PictureInPictureWindow")]),i("Clipboard",[t("copy"),t("cut"),t("paste"),t("beforecopy"),t("beforecut"),t("beforepaste")]),i("Control",[t("resize"),t("scroll"),t("zoom"),t("focus"),t("blur"),t("select"),t("change"),t("submit"),t("reset")]),i("Device",[t("deviceorientation"),t("devicemotion")]),i("DOM Mutation",[t("DOMActivate"),t("DOMFocusIn"),t("DOMFocusOut"),t("DOMAttrModified"),t("DOMCharacterDataModified"),t("DOMNodeInserted"),t("DOMNodeInsertedIntoDocument"),t("DOMNodeRemoved"),t("DOMNodeRemovedFromDocument"),t("DOMSubtreeModified"),t("DOMContentLoaded")]),i("Drag / drop",[t("drag"),t("dragstart"),t("dragend"),t("dragenter"),t("dragover"),t("dragleave"),t("drop")]),i("Keyboard",[t("keydown"),t("keyup"),t("keypress"),t("input")]),i("Load",[t("load"),t("beforeunload"),t("unload"),t("abort"),t("error"),t("hashchange"),t("popstate")]),i("Mouse",[t("auxclick"),t("click"),t("dblclick"),t("mousedown"),t("mouseup"),t("mouseover"),t("mousemove"),t("mouseout"),t("mouseenter"),t("mouseleave"),t("mousewheel"),t("wheel"),t("contextmenu")]),i("Pointer",[t("pointerover"),t("pointerout"),t("pointerenter"),t("pointerleave"),t("pointerdown"),t("pointerup"),t("pointermove"),t("pointercancel"),t("gotpointercapture"),t("lostpointercapture")]),i("Touch",[t("touchstart"),t("touchmove"),t("touchend"),t("touchcancel")]),i("Worker",[t("message"),t("messageerror")]);let o=["xmlhttprequest","xmlhttprequestupload"];return i("XHR",[t("readystatechange",o),t("load",o),t("loadstart",o),t("loadend",o),t("abort",o),t("error",o),t("progress",o),t("timeout",o)]),Mu}var Oe,Mu,Dv=m(()=>{"use strict";Oe=w(require("@vscode/l10n")),Mu=new Map});var nf,_v,Lv=m(()=>{"use strict";Je();nf=tn(function(i,e){let t=" ".repeat(e),r=`
`;function o(s){if(s instanceof Uint8Array)return Uint8Array;if(s instanceof Uint8ClampedArray)return Uint8ClampedArray;if(s instanceof Uint16Array)return Uint16Array;if(s instanceof Uint32Array)return Uint32Array;if(s instanceof BigUint64Array)return BigUint64Array;if(s instanceof Int8Array)return Int8Array;if(s instanceof Int32Array)return Int32Array;if(s instanceof BigInt64Array)return BigInt64Array;if(s instanceof Float32Array)return Float32Array;if(s instanceof Float64Array)return Float64Array}function n(s,a=0,c=[]){switch(typeof s){case"bigint":return`${s}n`;case"boolean":return s.toString();case"function":{let u=s.toString().replace(/^[^\s]+\(/,"function(").split(/\r?\n/g),f=/^$/;for(let y of u){let v=/^[ \t]+/.exec(y);if(v){f=new RegExp(`^[ \\t]{0,${v[0].length}}`);break}}return u.map((y,v)=>v===0?y:(y=y.replace(f,""),v===u.length-1?t.repeat(a)+y:t.repeat(a+1)+y)).join(r)}case"number":return`${s}`;case"object":if(s===null)return"null";if(c.includes(s))return"[Circular]";if(s instanceof Date)return`"${s.toISOString()}"`;if(typeof Node<"u"&&i instanceof Node)return i.outerHTML;let p=o(s);if(p)return`new ${p.name}([${s.join(", ")}])`;if(s instanceof ArrayBuffer)return`new Uint8Array([${new Uint8Array(s).join(", ")}]).buffer`;if(s instanceof Array)return["[",...s.map(u=>t.repeat(a+1)+n(u,a+1,[...c,s])+","),t.repeat(a)+"]"].join(r);let l=s;return["{",...Object.keys(l).map(u=>t.repeat(a+1)+(/^[$a-z_][0-9a-z_$]*$/i.test(u)?u:JSON.stringify(u))+": "+n(l[u],a+1,[...c,s])+","),t.repeat(a)+"}"].join(r);case"string":return JSON.stringify(s);case"symbol":return s.toString();case"undefined":return"undefined";default:return String(s)}}try{return n(i)}catch{return""+i}}),_v=gt(`
  function(spaces2) {
    const result = ${nf.expr("this","spaces2")};
    return result;
  }
`)});var Av,Ev=m(()=>{"use strict";Je();Av=gt(function(){let i={__proto__:this.__proto__},e=Object.getOwnPropertyNames(this);for(let t=0;t<e.length;++t){let r=e[t],o=r>>>0;if(String(o>>>0)===r&&o>>>0!==4294967295)continue;let n=Object.getOwnPropertyDescriptor(this,r);n&&Object.defineProperty(i,r,n)}return i})});var Fv,Mv=m(()=>{"use strict";Je();Fv=gt(function(i,e){let t={},r=i===-1?0:i,o=e===-1?this.length:i+e;for(let n=r;n<o&&n<this.length;++n){let s=Object.getOwnPropertyDescriptor(this,n);s&&Object.defineProperty(t,n,s)}return t})});var Bv,jv,Ov=m(()=>{"use strict";Je();Bv=tn(function(i,e){let t={},r="<<default preview>>";if(typeof this!="object"||!this)return t;for(let[o,n]of Object.entries(this)){if(e)try{let s=e.call(n,r);if(s!==r){t[o]=String(s);continue}}catch(s){t[o]=`<<indescribable>>${JSON.stringify([String(s),o])}`;continue}if(typeof n=="object"&&n&&!String(n.toString).includes("[native code]")){let s=String(n);if(!s.startsWith("[object ")){t[o]=s.length>=i?s.slice(0,i)+"\u2026":s;continue}}}return t}),jv=tn(function(i,e){if(e)try{let t="<<default preview>>",r=e.call(this,t);if(r!==t)return String(r)}catch(t){return`<<indescribable>>${JSON.stringify([String(t),"object"])}`}if(typeof this=="object"&&this&&!String(this.toString).includes("[native code]")){let t=String(this);if(!t.startsWith("[object "))return t.length>=i?t.slice(0,i)+"\u2026":t}})});var Nv,Uv=m(()=>{"use strict";Je();Nv=gt(function(i){return i.call(this)})});var Vv,Wv=m(()=>{"use strict";Je();Vv=gt(function(i,e){let{buffer:t,byteLength:r,byteOffset:o}=this instanceof ArrayBuffer?new DataView(this):this instanceof WebAssembly.Memory?new DataView(this.buffer):this,n=o+Math.min(i,r),s=Math.max(0,Math.min(e,r-i));return a(new Uint8Array(t,n,s));function a(c){let p="0123456789abcdef",l="";for(let u=0;u<c.length;u++){let f=c[u];l+=p[f>>>4]+p[f&15]}return l}})});var $v,qv=m(()=>{"use strict";Je();$v=gt(function(i,e){let t=c(e),{buffer:r,byteLength:o,byteOffset:n}=this instanceof ArrayBuffer?new DataView(this):this instanceof WebAssembly.Memory?new DataView(this.buffer):this,s=n+Math.min(i,o),a=Math.max(0,Math.min(t.length,o-i));return new Uint8Array(r,s,a).set(t.subarray(0,a)),a;function c(p){let l=new Uint8Array(p.length>>>1);for(let u=0;u<p.length;u+=2)l[u>>>1]=parseInt(p.slice(u,u+2),16);return l}})});function Yv(i){let e=i.exception&&fn(i.exception).title||i.text;return ue(e)}var gi,Jv,hn,hf,bf,$R,Kv,qR,HR,zR,Hv,zv,Qv,sf,oa,GR,Et,Bu,af,cf,pf,lf,ju,wp,Gv,uf,Ou,df,yp,mf,gf,bn,ff,mi,Xv=m(()=>{"use strict";gi=w(require("@vscode/l10n")),Jv=require("astring"),hn=require("inversify");He();M();hs();np();H();qr();de();ce();ea();Du();Je();Ev();Mv();Ov();Uv();Wv();qv();hf=(()=>{let i=0,e=2147483647-1;return()=>i++%e+1})(),bf=i=>{if(typeof i=="string")return{value:i};let e=i;return e.objectId?{objectId:e.objectId}:e.unserializableValue?{unserializableValue:e.unserializableValue}:{value:e.value}},$R=new Set(["typedarray","dataview","arraybuffer","webassemblymemory"]),Kv=1024,qR=/^[$a-z_][0-9a-z_$]*$/i,HR=/^#[0-9a-z_$]+$/i,zR=i=>i.hasOwnProperty("configurable"),Hv=(i,e,t)=>{let r=Uw(i,Vl(e),t);return(0,Jv.generate)(r)},zv="<<indescribable>>",Qv=i=>{if(!i.startsWith(zv))return i;let e,t;try{[e,t]=JSON.parse(i.slice(zv.length))}catch{return i}return gi.t("{0} (couldn't describe: {1})",e,t)},sf=i=>!!i&&typeof i=="object"&&"readMemory"in i&&"writeMemory"in i,oa=class{constructor(e,t,r,o,n,s,a){this.cdp=e;this.parent=t;this.vars=o;this.locationProvider=n;this.currentRef=s;this.settings=a;this.name=r.name,this.presentationHint=r.presentationHint,this.sortOrder=r.sortOrder||0}get customDescriptionGenerator(){return this.settings.customDescriptionGenerator}createVariable(e,t,...r){var n;let o=new e(new oa(this.cdp,(n=this.currentRef)==null?void 0:n.call(this),t,this.vars,this.locationProvider,()=>o,this.settings),...r);return o.id>0&&this.vars.add(o),o}createVariableByType(e,t,r){if(Zg(t))return this.createVariable(Ou,e,t);if(t.objectId){if(t.subtype==="map"||t.subtype==="set")return this.createVariable(uf,e,t,r);if(!Xg.has(t.subtype))return this.createVariable(wp,e,t,r)}return this.createVariable(Et,e,t)}async createObjectPropertyVars(e,t){var p;let r=[];if(this.settings.customPropertiesGenerator){let{result:l,errorDescription:u}=await this.evaluateCodeForObject(e,this.settings.customPropertiesGenerator,[]);l&&l.type!=="undefined"?e=l:r.push([this.createVariable(lf,{name:"",sortOrder:-1},l,(l==null?void 0:l.description)||u||gi.t("Unknown error"))])}if(!e.objectId)return[];t&&this.cdp.DotnetDebugger.setEvaluationOptions({options:t,type:"variable"});let[o,n,s]=await Promise.all([this.cdp.Runtime.getProperties({objectId:e.objectId,accessorPropertiesOnly:!0,ownProperties:!1,generatePreview:!0}),this.cdp.Runtime.getProperties({objectId:e.objectId,ownProperties:!0,generatePreview:!0}),this.cdp.Runtime.callFunctionOn({functionDeclaration:Bv.decl(`${Kv}`,this.settings.customDescriptionGenerator||"null"),objectId:e.objectId,throwOnSideEffect:!0,returnByValue:!0}).then(l=>(l==null?void 0:l.result.value)||{}).catch(()=>({}))]);if(!o||!n)return[];let a=new Map,c=[];for(let l of o.result){if(l.symbol){c.push(l);continue}l.name==="__proto__"&&((p=n.internalProperties)!=null&&p.some(u=>u.name==="[[Prototype]]"))||a.set(l.name,l)}for(let l of n.result)l.get||l.set||(l.symbol?c.push(l):a.set(l.name,l));for(let l of[a.values(),c.values()])for(let u of l)r.push(this.createPropertyVar(u,e,s!=null&&s.hasOwnProperty(u.name)?Qv(s[u.name]):void 0));for(let l of n.privateProperties??[])r.push(this.createPropertyVar(l,e,void 0,{presentationHint:{visibility:"private"},sortOrder:1}));for(let l of n.internalProperties||[]){if(l.name==="[[StableObjectId]]")continue;let u;l.name==="[[FunctionLocation]]"&&l.value&&l.value.subtype==="internal#location"?u=this.createVariable(pf,{name:l.name,presentationHint:{visibility:"internal",attributes:["readOnly"]},sortOrder:2},l.value):l.value!==void 0&&(u=this.createVariableByType({name:l.name,presentationHint:{visibility:"internal"},sortOrder:2},l.value)),u&&r.push([u])}return Yi(await Promise.all(r))}async createPropertyVar(e,t,r,o){let n=[],s=e.get&&e.get.type!=="undefined",a=e.set&&e.set.type!=="undefined",c={name:e.name,presentationHint:{},sortOrder:0,...o};return o||(zR(e)?(e.enumerable===!1&&!s&&(c.presentationHint.visibility="internal",c.sortOrder=1),(e.writable===!1||s&&!a)&&(c.presentationHint.attributes=["readOnly"])):(c.presentationHint.visibility="private",c.sortOrder=1)),"value"in e&&e.value&&n.push(this.createVariableByType(c,e.value,r)),s?n.push(this.createVariable(gf,c,e.get,t)):a&&n.push(this.createVariable(mf,c,e.set)),n}async evaluateCodeForObject(e,t,r){try{let o=await this.cdp.Runtime.callFunctionOn({objectId:e.objectId,functionDeclaration:t,arguments:r.map(bf)});if(o){if(o.exceptionDetails===void 0)return{result:o.result};if(o&&o.result.description)return{errorDescription:o.result.description}}return{errorDescription:gi.t("Unknown error")}}catch(o){return{errorDescription:o.stack||o.message||String(o)}}}},GR=i=>typeof i=="number"||/^[0-9]+$/.test(i),Et=class{constructor(e,t){this.context=e;this.remoteObject=t;this.id=hf()}get name(){return this.context.name}get sortOrder(){return this.context.sortOrder}get accessor(){let{parent:e,name:t}=this.context;if(!e||e instanceof bn)return this.context.name;if(e instanceof yp)return e.accessor;let r=e.context.parent;if(r instanceof Et){if(this.remoteObject.subtype==="internal#entry")return`[...${r.accessor}.entries()][${+t}]`;if(e.remoteObject.subtype==="internal#entry")return`${e.accessor}[${this.name==="key"?0:1}]`}return GR(t)?`${e.accessor}[${t}]`:qR.test(t)?`${e.accessor}.${t}`:e.accessor==="this"&&HR.test(t)?`${e.accessor}.${t}`:`${e.accessor}[${JSON.stringify(t)}]`}async toDap(e,t){let r=this.context.name;return this.context.parent instanceof bn&&(r=await this.context.parent.getRename(r)),Promise.resolve({name:r,value:gn(this.remoteObject,e,t),evaluateName:this.accessor,type:this.remoteObject.type,variablesReference:0,presentationHint:this.context.presentationHint})}async setProperty(e,t){let r=await this.context.cdp.Runtime.callFunctionOn({objectId:this.remoteObject.objectId,functionDeclaration:`function(a) { return this[a] = ${t}; ${Re()} }`,arguments:[bf(e)],silent:!0});if(!r)throw new I(ge(gi.t("Unable to set variable value")));if(r.exceptionDetails)throw new I(Yv(r.exceptionDetails));return this.context.createVariableByType({name:e},r.result)}async getChildren(e){return Promise.resolve([])}},Bu=class{constructor(e){this.child=e;this.id=hf()}getChildren(){return Promise.resolve([this.child])}},af=class extends Et{constructor(t,r,o,n){var s;super(t,{type:((s=o[0])==null?void 0:s.type)??"string"});this.value=r;this.args=o;this.stackTrace=n}toDap(){return Promise.resolve({name:this.context.name,value:this.value,variablesReference:this.stackTrace||this.args.some(mn)?this.id:0})}getChildren(t){let r=[],{args:o,stackTrace:n}=this;for(let s=0;s<o.length;++s)mn(o[s])&&r.push(this.context.createVariableByType({name:`arg${s}`,sortOrder:s},o[s]));return n&&r.push(this.context.createVariable(cf,{name:"",sortOrder:Number.MAX_SAFE_INTEGER},this.remoteObject,n)),Promise.resolve(r)}},cf=class extends Et{constructor(t,r,o){super(t,r);this.stacktrace=o}async toDap(){return{name:"",value:await this.stacktrace.format(),variablesReference:0}}},pf=class extends Et{constructor(t,r){super(t,r);this.location=r.value}async toDap(){return{name:this.context.name,value:await this.context.locationProvider.renderDebuggerLocation(this.location),variablesReference:0,presentationHint:{visibility:"internal"}}}},lf=class extends Et{constructor(t,r,o){super(t,r);this.message=o}get accessor(){if(!(this.context.parent instanceof Et))throw new Error("ErrorVariable must have a parent Variable");return this.context.parent.accessor}toDap(){return Promise.resolve({name:this.context.name,value:this.message,variablesReference:0})}},ju=Symbol("NoStringRepr"),wp=class extends Et{constructor(t,r,o){super(t,r);this.customStringRepr=o}async toDap(t,r){let[o,n]=await Promise.all([await super.toDap(t,r),await this.getValueRepresentation(t)]);return{...o,type:this.remoteObject.className||this.remoteObject.subtype||this.remoteObject.type,variablesReference:this.id,memoryReference:$R.has(this.remoteObject.subtype)?String(this.id):void 0,value:n}}async getValueRepresentation(t){if(typeof this.customStringRepr=="string")return this.customStringRepr;if(!this.context.parent&&this.customStringRepr!==ju)try{let r=await this.context.cdp.Runtime.callFunctionOn({functionDeclaration:jv.decl(`${Kv}`,this.context.customDescriptionGenerator||"null"),objectId:this.remoteObject.objectId,returnByValue:!0});if(r!=null&&r.result.value)return this.customStringRepr=Qv(r.result.value)}catch{this.customStringRepr=ju}return this.context.name==="__proto__"&&this.remoteObject.description||gn(this.remoteObject,t)}async readMemory(t,r){let o=await Vv({cdp:this.context.cdp,args:[t,r],objectId:this.remoteObject.objectId,returnByValue:!0});return Buffer.from(o.value,"hex")}async writeMemory(t,r){return(await $v({cdp:this.context.cdp,args:[t,r.toString("hex")],objectId:this.remoteObject.objectId,returnByValue:!0})).value}getChildren(t){return this.context.createObjectPropertyVars(this.remoteObject,t.evaluationOptions)}},Gv="[[Entries]]",uf=class extends wp{constructor(t,r){var n;super(t,r,ju);this.baseChildren=N(()=>super.getChildren({variablesReference:this.id}));let o=r.preview;this.isMap=o.subtype==="map",this.size=Number((n=o.properties.find(s=>s.name==="size"))==null?void 0:n.value)??void 0}async toDap(t){let r=await super.toDap(t);return this.size&&this.size>100&&(r.indexedVariables=this.size),r}async getChildren(t){var n;let r=await this.baseChildren();return[...(await((n=r.find(s=>s.name===Gv))==null?void 0:n.getChildren(t))||[]).filter(s=>s.sortOrder===0),...r.filter(s=>s.name!==Gv)]}},Ou=class extends wp{constructor(t,r){super(t,r,ju);this.length=0;let o=String(r.description).match(/\(([0-9]+)\)/);this.length=o?+o[1]:0}async toDap(t){return{...await super.toDap(t),indexedVariables:this.length>100?this.length:void 0,namedVariables:this.length>100?1:void 0}}async getChildren(t){switch(t==null?void 0:t.filter){case"indexed":return this.getArraySlots(t);case"named":return this.getArrayProperties();default:return Promise.all([this.getArrayProperties(),this.getArraySlots()]).then(Yi)}}async getArrayProperties(){try{let t=await Av({cdp:this.context.cdp,args:[],objectId:this.remoteObject.objectId,generatePreview:!0});return this.context.createObjectPropertyVars(t)}catch{return[]}}async getArraySlots(t){let r=t&&typeof t.start<"u"?t.start:-1,o=t&&typeof t.count<"u"?t.count:-1,n;try{n=await Fv({cdp:this.context.cdp,generatePreview:!1,args:[r,o],objectId:this.remoteObject.objectId})}catch{return[]}let s=await this.context.createObjectPropertyVars(n);return n.objectId&&await this.context.cdp.Runtime.releaseObject({objectId:n.objectId}),s}},df=class extends Ou{async toDap(e){return this.remoteObject.preview?{...await super.toDap(e),name:Iv(this.remoteObject.preview)}:super.toDap(e)}},yp=class extends Et{constructor(e,t){super(e,t)}getChildren(e){return this.context.createObjectPropertyVars(this.remoteObject)}},mf=class extends yp{async toDap(e,t){return{...await super.toDap(e,t),value:"write-only",variablesReference:this.id}}},gf=class extends yp{constructor(t,r,o){super(t,r);this.parentObject=o}async toDap(t,r){let o=await super.toDap(t,r);return o.variablesReference=this.id,o.presentationHint={...o.presentationHint,lazy:!0},o}async getChildren(t){try{let r=await Nv({cdp:this.context.cdp,objectId:this.parentObject.objectId,args:[new $c(this.remoteObject.objectId)]});return[this.context.createVariableByType({name:this.name,presentationHint:this.context.presentationHint},r)]}catch(r){if(!(r instanceof ys))throw r}return super.getChildren(t)}},bn=class{constructor(e,t,r,o,n){this.remoteObject=e;this.context=t;this.ref=r;this.extraProperties=o;this.renameProvider=n;this.id=hf()}async getChildren(e){let t=await this.context.createObjectPropertyVars(this.remoteObject),r=new Set(t.map(o=>o.name));for(let o of this.extraProperties)r.has(o.name)||t.push(this.context.createVariableByType({name:o.name},o.value));return t}async getRename(e){return(await this.renameProvider.provideOnStackframe(this.ref.stackFrame)).getOriginalName(e,this.ref.stackFrame.rawPosition)||e}async setProperty(e,t){let r=await this.context.cdp.Debugger.evaluateOnCallFrame({expression:`${t} ${Re()}`,callFrameId:this.ref.callFrameId});if(!r)throw new I(ue(gi.t("Invalid expression")));if(r.exceptionDetails)throw new I(Yv(r.exceptionDetails));return await this.context.cdp.Debugger.setVariableValue({callFrameId:this.ref.callFrameId,scopeNumber:this.ref.scopeNumber,variableName:e,newValue:bf(r.result)}),this.context.createVariableByType({name:e},r.result)}},ff=class{constructor(){this.value=new Map}get(e){return this.value.get(e)}add(e){this.value.set(e.id,e)}clear(){this.value.clear()}},mi=class{constructor(e,t,r,o,n){this.renameProvider=e;this.cdp=t;this.dap=r;this.launchConfig=o;this.locationProvider=n;this.vars=new ff;this.contextSettings={customDescriptionGenerator:o.customDescriptionGenerator&&Hv(["defaultValue"],o.customDescriptionGenerator,!1),customPropertiesGenerator:o.customPropertiesGenerator&&Hv([],o.customPropertiesGenerator,!1)}}createDetached(){return new mi(this.renameProvider,this.cdp,this.dap,this.launchConfig,this.locationProvider)}clear(){this.vars.clear()}createFloatingVariable(e,t){return this.createFloatingContext().createVariableByType({name:e},t)}createVariableForOutput(e,t,r,o){let n=this.createFloatingContext(),s=t.length===1&&o==="table"?n.createVariable(df,{name:""},t[0]):t.length===1&&mn(t[0])&&!r?n.createVariableByType({name:""},t[0]):n.createVariable(af,{name:""},e,t,r),a=new Bu(s);return this.vars.add(a),a}createScope(e,t,r){let o=new bn(e,new oa(this.cdp,void 0,{name:""},this.vars,this.locationProvider,()=>o,this.contextSettings),t,r,this.renameProvider);return this.vars.add(o),o}hasVariable(e){return!!this.vars.get(e)}hasMemory(e){return sf(this.vars.get(Number(e)))}async readMemory(e,t,r){let o=this.vars.get(Number(e));return sf(o)?o.readMemory(t,r):void 0}async writeMemory(e,t,r){let o=this.vars.get(Number(e)),n=sf(o)?await o.writeMemory(t,r):0;return n>0&&this.dap.invalidated({areas:["variables"]}),n}async getVariableNames(e){let t=this.vars.get(e.variablesReference);return t?(await t.getChildren(e)).filter(Qi(Et)).map(o=>o.name):[]}async getVariables(e){let t=this.vars.get(e.variablesReference);if(!t)return[];let r=await t.getChildren(e);return(await Promise.all(r.map(n=>n.toDap(t instanceof bn||t instanceof Bu?"repl":"propertyValue",e.format).then(s=>({v:n,dap:s}))))).sort((n,s)=>n.v.sortOrder-s.v.sortOrder||+n.dap.name-+s.dap.name||n.dap.name.localeCompare(s.dap.name)).map(n=>n.dap)}async setVariable(e){let t=this.vars.get(e.variablesReference);if(!e.value)throw new I(ue(gi.t("Cannot set an empty value")));if(t instanceof bn||t instanceof Et)return await(await t.setProperty(e.name,e.value)).toDap("propertyValue",e.format);throw new I(ge(gi.t("Variable not found")))}createFloatingContext(){return new oa(this.cdp,void 0,{name:"<unnamed>"},this.vars,this.locationProvider,void 0,this.contextSettings)}};mi=h([(0,hn.injectable)(),d(0,(0,hn.inject)(si)),d(1,(0,hn.inject)(_e)),d(2,(0,hn.inject)(sr)),d(3,(0,hn.inject)(ie))],mi)});var ee,eS,Nu,wf,KR,Zv,QR,yf,fi,hi,Uu=m(()=>{"use strict";ee=w(require("@vscode/l10n")),eS=require("crypto");F();j();ta();L();M();ps();U();Dt();Fu();xr();B();B();H();de();ce();rf();li();up();Vu();Dv();ea();Du();Ht();Sp();Lv();Xv();Nu=class{constructor(e){this.description=e;this.sourceMapLoads=new Map;this.scripts=[]}get isDefault(){return this.description.auxData&&this.description.auxData.isDefault}async remove(e){await Promise.all(this.scripts.map(async t=>{let r=await t.source;r.filterScripts(o=>o.executionContextId!==this.description.id),r.scripts.length||e.removeSource(r)}))}},wf=class{constructor(e){this._obj=e;this._dapDeferred=le()}resolve(){this._dapDeferred.resolve(this._obj)}with(e){return this._dapDeferred.hasSettled()?e(this._obj):this._dapDeferred.promise.then(t=>e(t))}},KR=50,Zv=(i,e)=>i.sourceReference===e.sourceReference&&Kl(i.path||"",e.path||""),QR=()=>`
//# sourceURL=eval-${(0,eS.randomBytes)(4).toString("hex")}${".repl"}
`,yf=class{enqueue(e,t){var r;if(!this.queue||this.queue.operation!==e){let o=((r=this.queue)==null?void 0:r.result.then(t,t))??t(),n=this.queue={operation:e,result:o.finally(()=>{this.queue===n&&(this.queue=void 0)})}}return this.queue.result}},fi=class{constructor(e,t,r,o,n,s,a,c,p,l,u,f,y,v){this.target=o;this.logger=s;this.evaluator=a;this.completer=c;this.launchConfig=p;this._breakpointManager=l;this.console=u;this.exceptionPause=f;this._smartStepper=y;this.shutdown=v;this._executionContexts=new Map;this._excludedCallers=[];this.stateQueue=new yf;this._onPausedEmitter=new S;this.disposed=!1;this.debuggerReady=le();this.onPaused=this._onPausedEmitter.event;this._dap=new wf(r),this._sourceContainer=e,this._cdp=t,this.id=fi._lastThreadId++,this.replVariables=new mi(n,this._cdp,r,p,this),e.onSourceMappedSteppingChange(()=>this.refreshStackTrace()),this._initialize()}setExcludedCallers(e){this._excludedCallers=e}cdp(){return this._cdp}name(){return this.target.name()}pausedDetails(){return this._pausedDetails}pausedVariables(){return this._pausedVariables}defaultExecutionContext(){for(let e of this._executionContexts.values())if(e.isDefault)return e}resume(){return this.stateQueue.enqueue("resume",async()=>(this._sourceContainer.clearDisabledSourceMaps(),!await this._cdp.Debugger.resume({})&&this._pausedDetails!==void 0?ge(ee.t("Unable to resume")):{allThreadsContinued:!1}))}pause(){return this.stateQueue.enqueue("pause",async()=>(this._expectedPauseReason={reason:"pause"},await this._cdp.Debugger.pause({})?{}:ge(ee.t("Unable to pause"))))}stepOver(){return this.stateQueue.enqueue("stepOver",async()=>(this._expectedPauseReason={reason:"step",direction:1},await this._cdp.Debugger.stepOver({})?{}:ge(ee.t("Unable to step next"))))}stepInto(e){return this.stateQueue.enqueue("stepInto",async()=>{var r,o;this._waitingForStepIn={lastDetails:this._pausedDetails},this._expectedPauseReason={reason:"step",direction:0};let t=(o=(r=this._pausedDetails)==null?void 0:r.stepInTargets)==null?void 0:o[e];if(t){let n=await this._cdp.Debugger.setBreakpoint({location:t.breakLocation});if(this._waitingForStepIn.intoTargetBreakpoint=n==null?void 0:n.breakpointId,await this._cdp.Debugger.resume({}))return{}}else if(await this._cdp.Debugger.stepInto({breakOnAsyncCall:!0}))return{};return ge(ee.t("Unable to step in"))})}stepOut(){return this.stateQueue.enqueue("stepOut",async()=>(this._expectedPauseReason={reason:"step",direction:2},await this._cdp.Debugger.stepOut({})?{}:ge(ee.t("Unable to step out"))))}_stackFrameNotFoundError(){return ge(ee.t("Stack frame not found"))}_evaluateOnAsyncFrameError(){return ge(ee.t("Unable to evaluate on async stack frame"))}async restartFrame(e){var n;let t=(n=this._pausedDetails)==null?void 0:n.stackTrace.frame(e.frameId);if(!t)return this._stackFrameNotFoundError();let r=t.callFrameId();return r?await this._cdp.Debugger.restartFrame({callFrameId:r,mode:"StepInto"})?(this._expectedPauseReason={reason:"frame_entry",description:ee.t("Paused on frame entry")},t.canExplicitlyBeRestarted||await this._cdp.Debugger.stepInto({}),{}):ue(ee.t("Frame could not be restarted")):ue(ee.t("Cannot restart asynchronous frame"))}async stackTrace(e){return this._pausedDetails?this._pausedDetails.stackTrace.toDap(e):ge(ee.t("Thread is not paused"))}async scopes(e){let t=this._pausedDetails?this._pausedDetails.stackTrace.frame(e.frameId):void 0;return t?t.scopes():this._stackFrameNotFoundError()}async exceptionInfo(){let e=this._pausedDetails&&this._pausedDetails.exception;if(!e)return ge(ee.t("Thread is not paused on exception"));let t=fn(e);return{exceptionId:t.title,breakMode:"all",details:{stackTrace:t.stackTrace,evaluateName:void 0}}}async revealPage(){return this._cdp.Page.bringToFront({}),{}}async completions(e){let t;if(e.frameId!==void 0){if(t=this._pausedDetails?this._pausedDetails.stackTrace.frame(e.frameId):void 0,!t)return this._stackFrameNotFoundError();if(!t.callFrameId())return this._evaluateOnAsyncFrameError()}if(e.line===1&&e.text.startsWith("cd "))return{targets:this.getExecutionContextCompletions(e)};let r=await this.completer.completions({executionContextId:this._selectedContext?this._selectedContext.description.id:void 0,stackFrame:t,expression:e.text,position:new Vt(e.line||1,e.column)});return{targets:[...this.getExecutionContextCompletions(e),...r]}}getExecutionContextCompletions(e){if(e.line&&e.line>1)return[];let t=e.text.slice(0,e.column).trim();return[...this._executionContexts.values()].map(r=>`cd ${this.target.executionContextName(r.description)}`).filter(r=>r.startsWith(t)).map(r=>({label:r,start:0,length:e.text.length}))}async evaluate(e){let t,r;if(e.frameId!==void 0){if(r=this._pausedDetails?this._pausedDetails.stackTrace.frame(e.frameId):void 0,!r)throw new I(this._stackFrameNotFoundError());if(t=r.callFrameId(),!t)throw new I(this._evaluateOnAsyncFrameError())}if(e.context==="repl"&&e.expression.startsWith("cd ")){let p=e.expression.substring(3).trim();for(let l of this._executionContexts.values())if(this.target.executionContextName(l.description)===p)return this._selectedContext=l,{result:`[${p}]`,variablesReference:0}}let o=e.context==="clipboard"?{expression:nf.expr(e.expression,"2"),includeCommandLineAPI:!0,returnByValue:!0,objectGroup:"console"}:{expression:e.expression,includeCommandLineAPI:!0,objectGroup:"console",generatePreview:!0,timeout:e.context==="hover"?this.getHoverEvalTimeout():void 0};if(e.context==="repl"){if(o.expression=Wc(o.expression),o.expression.indexOf("await")!==-1){let p=zw(o.expression);p&&(o.expression=p,o.awaitPromise=!0)}o.expression+=QR()}e.evaluationOptions&&this.cdp().DotnetDebugger.setEvaluationOptions({options:e.evaluationOptions,type:"evaluation"});let n=this.evaluator.evaluate(t?{...o,callFrameId:t}:{...o,contextId:this._selectedContext?this._selectedContext.description.id:void 0},{isInternalScript:!1,stackFrame:r});if(e.context==="repl")return await this._evaluateRepl(e,n,e.format);let s=await n;if(!s)throw new I(ge(ee.t("Unable to evaluate")));if(s.exceptionDetails){let p=s.exceptionDetails.exception?fn(s.exceptionDetails.exception).title:s.exceptionDetails.text;throw p.startsWith("Uncaught")||(p="Uncaught "+p),new I(ge(p))}let a=t?this._pausedVariables:this.replVariables;if(!a)throw new I(ge(ee.t("Unable to evaluate")));let c=await a.createFloatingVariable(o.expression,s.result).toDap(e.context,e.format);return{type:s.result.type,result:c.value,variablesReference:c.variablesReference,namedVariables:c.namedVariables,indexedVariables:c.indexedVariables,memoryReference:c.memoryReference}}getHoverEvalTimeout(){var t;let e=(t=this.launchConfig.timeouts)==null?void 0:t.hoverEvaluation;if(e===void 0)return 500;if(!(e<=0))return e}async _evaluateRepl(e,t,r){let o=await t;if(!o)return{result:"",variablesReference:0};if(o.exceptionDetails){let c=await new vp(o.exceptionDetails).toDap(this);throw new I(Rw(c.output))}let n=this._selectedContext&&this.defaultExecutionContext()!==this._selectedContext?`\x1B[33m[${this.target.executionContextName(this._selectedContext.description)}] `:"",s=await this.replVariables.createFloatingVariable(e.expression,o.result).toDap("repl",r),a=Ru("repl").budget;return s.variablesReference===0&&s.value.length===a&&setImmediate(()=>this.console.enqueue(this,{toDap:()=>({output:ee.t("Output has been truncated to the first {0} characters. Run `{1}` to copy the full output.",a,`copy(${e.expression.trim()}))`),category:"stdout"})})),{...s,result:`${n}${s.value}`}}_initialize(){this._cdp.Runtime.on("executionContextCreated",e=>{this._executionContextCreated(e.context)}),this._cdp.Runtime.on("executionContextDestroyed",e=>{this._executionContextDestroyed(e.executionContextId)}),this._cdp.Runtime.on("executionContextsCleared",()=>{this.launchConfig.noDebug||this._ensureDebuggerEnabledAndRefreshDebuggerId(),this.replVariables.clear(),this._executionContextsCleared()}),this._cdp.Inspector.on("targetReloadedAfterCrash",()=>{this._breakpointManager.reapply()}),this.launchConfig.outputCapture==="console"&&(this._cdp.Runtime.on("consoleAPICalled",e=>{this.console.dispatch(this,e)}),this._cdp.Runtime.on("exceptionThrown",e=>{this.console.enqueue(this,new vp(e.exceptionDetails))})),this._cdp.Runtime.on("inspectRequested",e=>{e.hints.copyToClipboard?this._copyObjectToClipboard(e.object):e.hints.queryObjects?this.console.enqueue(this,new Eu(e.object,this.cdp())):this._revealObject(e.object)}),this._cdp.Debugger.on("paused",async e=>this._onPaused(e)),this._cdp.Debugger.on("resumed",()=>this.onResumed()),this._cdp.Debugger.on("scriptParsed",e=>this._onScriptParsed(e)),this._cdp.Debugger.on("scriptFailedToParse",e=>this._onScriptParsed(e)),this._cdp.Runtime.enable({}),this._cdp.Profiler.enable({}),this.launchConfig.noDebug?this.logger.info("runtime.launch","Running with noDebug, so debug domains are disabled"):this._ensureDebuggerEnabledAndRefreshDebuggerId(),this.target.initialize(),this._dap.with(e=>e.thread({reason:"started",threadId:this.id}))}dapInitialized(){this._dap.resolve()}async getStepInTargets(e){var l,u;let t=this._pausedDetails;if(!t)return[];let r=t.stackTrace.frames.find(f=>f.frameId===e);if(!(r instanceof Ne))return[];let o=await r.uiLocation();if(!o)return[];let n=t.event.callFrames[0].location,[s,a]=await Promise.all([this._breakpointManager.getBreakpointLocations(this,o.source,new Vt(o.lineNumber,1),new Vt(o.lineNumber+1,1)).then(f=>f.filter(y=>y.breakLocation.lineNumber!==n.lineNumber||y.breakLocation.columnNumber!==n.columnNumber)),o.source.content()]),c=((l=t.stepInTargets)==null?void 0:l.length)||0;t.stepInTargets=((u=t.stepInTargets)==null?void 0:u.concat(s))||s;let p=a&&new Qo(a);return s.map((f,y)=>{let v=f.uiLocations.find(Y=>Y.source===o.source);if(!v)return;if(!p)return{id:c+y,label:`Column ${v}`,line:v.lineNumber,column:v.columnNumber};let C=Gw(a.slice(p.getLineOffset(v.lineNumber-1),p.getLineOffset(v.lineNumber)),v.columnNumber-1);if(C)return{id:c+y,label:C.text,line:v.lineNumber,column:C.start+1,endLine:v.lineNumber,endColumn:C.end+1}}).filter(Fe)}async refreshStackTrace(){this._pausedDetails&&(this._pausedDetails=this._createPausedDetails(this._pausedDetails.event),this._onThreadResumed(),await this._onThreadPaused(this._pausedDetails))}_executionContextCreated(e){let t=new Nu(e);this._executionContexts.set(e.id,t)}_executionContextDestroyed(e){let t=this._executionContexts.get(e);t&&(this._executionContexts.delete(e),t.remove(this._sourceContainer))}_executionContextsCleared(){this._removeAllScripts(),this._breakpointManager.executionContextWasCleared(),this._pausedDetails&&this.onResumed(),this._executionContexts.clear()}_ensureDebuggerEnabledAndRefreshDebuggerId(){this._cdp.Debugger.enable({}).then(e=>{this.debuggerReady.resolve(),e&&fi._allThreadsByDebuggerId.set(e.debuggerId,this)}),this.exceptionPause.apply(this._cdp)}async _onPaused(e){var l,u,f,y,v,C;let t=(e.hitBreakpoints??[]).filter(Y=>Y!==this._pauseOnSourceMapBreakpointId),r=e.reason==="Break on start"||e.reason==="debugCommand",o=(l=e.callFrames[0])==null?void 0:l.location,n=((u=e.data)==null?void 0:u.scriptId)||(o==null?void 0:o.scriptId),s=e.reason==="instrumentation"&&((f=e.data)==null?void 0:f.scriptId)||n&&this._breakpointManager.isEntrypointBreak(t,n);if(this.evaluator.setReturnedValue((y=e.callFrames[0])==null?void 0:y.returnValue),s){this.launchConfig.perScriptSourcemaps==="auto"&&this._shouldEnablePerScriptSms(e)&&await this._enablePerScriptSourcemaps(),e.data&&!r&&(e.data.__rewriteAs="breakpoint");let Y=this._expectedPauseReason;if(!(n&&await this._handleSourceMapPause(n,o))){if(!r){if(await this.isCrossThreadStep(e))e.data={...e.data,__rewriteAs:"step"};else if(!await this._breakpointManager.shouldPauseAt(e,t,this.target.entryBreakpoint,!0))if((Y==null?void 0:Y.reason)==="step"){if(Y.direction!==0)return this._cdp.Debugger.stepOut({})}else return this.resume()}}}else if(!(e.reason==="exception"||e.reason==="promiseRejection"?await this.exceptionPause.shouldPauseAt(e):await this._breakpointManager.shouldPauseAt(e,t,this.target.entryBreakpoint,!1)))return this.resume();let a=(v=this._waitingForStepIn)==null?void 0:v.intoTargetBreakpoint;if(a){(C=e.hitBreakpoints)!=null&&C.includes(a)?(this._waitingForStepIn.intoTargetBreakpoint=void 0,await this._cdp.Debugger.removeBreakpoint({breakpointId:a}),await this._cdp.Debugger.stepInto({breakOnAsyncCall:!1})):this.resume();return}if(r&&("continueOnAttach"in this.launchConfig&&this.launchConfig.continueOnAttach||this.launchConfig.type==="pwa-extensionHost"||this.target instanceof ra)){this.resume();return}let c=this._pausedDetails=this._createPausedDetails(e);if(this._excludedCallers.length&&await this._matchesExcludedCaller(this._pausedDetails.stackTrace)){this.logger.info("runtime","Skipping pause due to excluded caller"),this.resume();return}let p=await this._smartStepper.getSmartStepDirection(c,this._expectedPauseReason);if(this._pausedDetails===c){switch(p){case 0:return this.stepInto();case 2:return this.stepOut();case 1:return this.stepOver();default:}this._waitingForStepIn=void 0,this._pausedVariables=this.replVariables.createDetached(),await this._onThreadPaused(c)}}async _matchesExcludedCaller(e){if(!this._excludedCallers.length)return!1;let t=e.frames[0],r=t instanceof Ne&&await t.uiLocation();if(!r)return!1;let o,n,s=[];for(let{caller:a,target:c}of this._excludedCallers)if(!(c.line!==r.lineNumber||c.column!==r.columnNumber)&&(o??=await r.source.toDapShallow(),!!Zv(o,c.source))){n||(n=await e.loadFrames(KR).then(l=>Promise.all(l.slice(1).filter(Qi(Ne)).map(u=>u.uiLocation()))));for(let p=0;p<n.length;p++){let l=n[p];if(!l||l.lineNumber!==a.line||l.columnNumber!==a.column)continue;let u=s[p]??=await l.source.toDapShallow();if(Zv(u,a.source))return!0}}return!1}onResumed(){this._pausedDetails=void 0,this._pausedVariables=void 0,this.evaluator.setReturnedValue(void 0),this._onThreadResumed()}async dispose(){this.disposed=!0,await this.shutdown.shutdown();for(let[e,t]of fi._allThreadsByDebuggerId)t===this&&fi._allThreadsByDebuggerId.delete(e);this._removeAllScripts(!0),this._executionContextsCleared(),await this._dap.with(e=>e.thread({reason:"exited",threadId:this.id}))}rawLocation(e){if("location"in e){let t=e;return{lineNumber:Math.max(0,t.location.lineNumber)+1,columnNumber:Math.max(0,t.location.columnNumber||0)+1,scriptId:t.location.scriptId}}return{lineNumber:Math.max(0,e.lineNumber)+1,columnNumber:Math.max(0,e.columnNumber||0)+1,scriptId:e.scriptId}}rawLocationToUiLocation(e){if(!e.scriptId||this.disposed||this.launchConfig.noDebug)return;let t=this._sourceContainer.getScriptById(e.scriptId);return t?t.resolvedSource?this._sourceContainer.preferredUiLocation({...sn(e,t.resolvedSource.runtimeScriptOffset),source:t.resolvedSource}):t.source.then(r=>this._sourceContainer.preferredUiLocation({...sn(e,r.runtimeScriptOffset),source:r})):this.rawLocationToUiLocationWithWaiting(e)}async rawLocationToUiLocationWithWaiting(e){let t=e.scriptId?await this.getScriptByIdOrWait(e.scriptId):void 0;if(!t)return;let r=await t.source;return this._sourceContainer.preferredUiLocation({...sn(e,r.runtimeScriptOffset),source:r})}getScriptById(e){return this._sourceContainer.getScriptById(e)}getScriptByIdOrWait(e,t=500){return this._sourceContainer.getScriptById(e)||this.waitForScriptId(e,t)}waitForScriptId(e,t){return new Promise(r=>{let o=this._sourceContainer.onScript(s=>{s.scriptId===e&&(r(s),o.dispose(),clearTimeout(n))}),n=setTimeout(()=>{r(void 0),o.dispose()},t)})}async renderDebuggerLocation(e){let t=this.rawLocation(e),r=await this.rawLocationToUiLocation(t);return r?`@ ${await r.source.prettyName()}:${r.lineNumber}`:`@ VM${t.scriptId||"XX"}:${t.lineNumber}`}async updateCustomBreakpoint(e,t){if(!this.target.supportsCustomBreakpoints())return;let r=of().get(e);r&&await r.apply(this._cdp,t)}_createPausedDetails(e){var n,s;let t=e.reason==="assert"||e.reason==="exception"||e.reason==="promiseRejection"||e.reason==="other"||e.reason==="ambiguous";if((!!(e.hitBreakpoints&&e.hitBreakpoints.length)||!t)&&this._sourceContainer.clearDisabledSourceMaps(),e.hitBreakpoints&&this._sourceMapDisabler)for(let a of this._sourceMapDisabler(e.hitBreakpoints))this._sourceContainer.disableSourceMapForSource(a);let o=Jt.fromDebugger(this,e.callFrames,e.asyncStackTrace,e.asyncStackTraceId);if(((n=e.data)==null?void 0:n.__rewriteAs)==="breakpoint")return{thread:this,event:e,stackTrace:o,reason:"breakpoint",description:ee.t("Paused on breakpoint")};if(((s=e.data)==null?void 0:s.__rewriteAs)==="step")return{thread:this,event:e,stackTrace:o,reason:"step",description:ee.t("Paused")};switch(e.reason){case"assert":return{thread:this,event:e,stackTrace:o,reason:"exception",description:ee.t("Paused on assert")};case"debugCommand":return{thread:this,event:e,stackTrace:o,reason:"pause",description:ee.t("Paused on debug() call")};case"DOM":return{thread:this,event:e,stackTrace:o,reason:"data breakpoint",description:ee.t("Paused on DOM breakpoint")};case"EventListener":return this._resolveEventListenerBreakpointDetails(o,e);case"exception":return{thread:this,event:e,stackTrace:o,reason:"exception",description:ee.t("Paused on exception"),exception:e.data};case"promiseRejection":return{thread:this,event:e,stackTrace:o,reason:"exception",description:ee.t("Paused on {0}","promise rejection"),exception:e.data};case"instrumentation":return e.data&&e.data.scriptId?{thread:this,event:e,stackTrace:o,reason:"step",description:ee.t("Paused")}:{thread:this,event:e,stackTrace:o,reason:"function breakpoint",description:ee.t("Paused on instrumentation breakpoint")};case"XHR":return{thread:this,event:e,stackTrace:o,reason:"data breakpoint",description:ee.t("Paused on XMLHttpRequest or fetch")};case"OOM":return{thread:this,event:e,stackTrace:o,reason:"exception",description:ee.t("Paused before Out Of Memory exception")};default:if(e.hitBreakpoints&&e.hitBreakpoints.length){let a=!1,c=this.target.entryBreakpoint;if(c&&e.hitBreakpoints.includes(c.cdpId)){a=!0;let p=this._sourceContainer.source({path:Se(c.path)});p!==void 0&&(a=!this._sourceContainer.currentSiblingUiLocations({lineNumber:e.callFrames[0].location.lineNumber+1,columnNumber:(e.callFrames[0].location.columnNumber||0)+1,source:p}).some(u=>this._breakpointManager.hasAtLocation(u)))}return a||this._breakpointManager.registerBreakpointsHit(e.hitBreakpoints),{thread:this,event:e,stackTrace:o,hitBreakpoints:e.hitBreakpoints,reason:a?"entry":"breakpoint",description:ee.t("Paused on breakpoint")}}return this._expectedPauseReason?{thread:this,event:e,stackTrace:o,description:ee.t("Paused"),...this._expectedPauseReason}:{thread:this,event:e,stackTrace:o,reason:"pause",description:ee.t("Paused on debugger statement")}}}_resolveEventListenerBreakpointDetails(e,t){let r=t.data,o=r&&r.eventName||"",n=of().get(o);if(n){let s=n.details(r);return{thread:this,event:t,stackTrace:e,reason:"function breakpoint",description:s.short,text:s.long}}return{thread:this,event:t,stackTrace:e,reason:"function breakpoint",description:ee.t("Paused on event listener")}}_clearDebuggerConsole(){return{category:"console",output:"\x1B[2J"}}_removeAllScripts(e=!1){this._sourceContainer.clear(e)}_onScriptParsed(e){if(e.url.endsWith(".cdp")||(ft(e.url)&&(e.url=W(e.url)),this._sourceContainer.getScriptById(e.scriptId)))return;e.url&&(e.url=this.target.scriptUrlToUrl(e.url));let t=this._executionContexts.get(e.executionContextId);t||(this.logger.info("internal","Creating missing execution context id",e),t=new Nu({id:e.executionContextId,name:"<autofilled>",origin:"",uniqueId:String(e.executionContextId)}),this._executionContexts.set(e.executionContextId,t));let r=async()=>{let n=this._sourceContainer.getSourceByOriginalUrl(e.url);if(e.hash&&(n==null?void 0:n.contentHash)===e.hash)return n.addScript({scriptId:e.scriptId,url:e.url,executionContextId:e.executionContextId}),n;let s=async()=>{let u=await this._cdp.Debugger.getScriptSource({scriptId:e.scriptId});return u?u.scriptSource:void 0},a=e.startLine||e.startColumn?{lineOffset:e.startLine,columnOffset:e.startColumn}:void 0,c=e.url.endsWith("#vscode-extension")?{lineOffset:2,columnOffset:0}:void 0,p;e.sourceMapURL&&(p=rt(e.sourceMapURL)?e.sourceMapURL:e.url&&Cr(e.url,e.sourceMapURL)||e.url,p||this._dap.with(u=>yw(u,`Could not load source map from ${e.sourceMapURL}`)));let l=await this._sourceContainer.addSource(e.url,s,p,a,c,!e.hasSourceURL&&this.launchConfig.enableContentValidation?e.hash:void 0);return l.addScript({scriptId:e.scriptId,url:e.url,executionContextId:e.executionContextId}),l},o={url:e.url,scriptId:e.scriptId,executionContextId:e.executionContextId,source:r()};o.source.then(n=>o.resolvedSource=n),t.scripts.push(o),this._sourceContainer.addScriptById(o),e.sourceMapURL&&this._getOrStartLoadingSourceMaps(o)}async _handleSourceMapPause(e,t){this._pausedForSourceMapScriptId=e;let r=this._sourceContainer.sourceMapTimeouts().sourceMapMinPause,o=r+this._sourceContainer.sourceMapTimeouts().sourceMapCumulativePause,n=this._sourceContainer.getScriptById(e);if(!n)return this._pausedForSourceMapScriptId=void 0,!1;let s=new It,a=await Promise.race([this._getOrStartLoadingSourceMaps(n),k(o)]),c=s.elapsed().ms,p=this._sourceContainer.sourceMapTimeouts().sourceMapCumulativePause-Math.max(c-r,0);this._sourceContainer.setSourceMapTimeouts({...this._sourceContainer.sourceMapTimeouts(),sourceMapCumulativePause:p}),this.logger.verbose("internal","Blocked execution waiting for source-map",{timeSpentWallClockInMs:c,sourceMapCumulativePause:p}),a||this._dap.with(f=>f.output({category:"stderr",output:ee.t("WARNING: Processing source-maps of {0} took longer than {1} ms so we continued execution without waiting for all the breakpoints for the script to be set.",n.url||n.scriptId,o)})),console.assert(this._pausedForSourceMapScriptId===e),this._pausedForSourceMapScriptId=void 0;let l=(t==null?void 0:t.lineNumber)||0,u=t==null?void 0:t.columnNumber;return!!(a!=null&&a.map(ni).some(f=>f.lineNumber===l&&(u===void 0||u===f.columnNumber)))}_getOrStartLoadingSourceMaps(e){let t=this._executionContexts.get(e.executionContextId);if(!t)return Promise.resolve([]);let r=t.sourceMapLoads.get(e.scriptId);if(r)return r;let o=e.source.then(n=>this._sourceContainer.waitForSourceMapSources(n)).then(n=>n.length&&this._scriptWithSourceMapHandler?this._scriptWithSourceMapHandler(e,n):[]);return t.sourceMapLoads.set(e.scriptId,o),o}async _revealObject(e){if(e.type!=="function"||e.objectId===void 0)return;let t=await this._cdp.Runtime.getProperties({objectId:e.objectId,ownProperties:!0});if(t)for(let r of t.internalProperties||[]){if(r.name!=="[[FunctionLocation]]"||!r.value||r.value.subtype!=="internal#location")continue;let o=await this.rawLocationToUiLocation(this.rawLocation(r.value.value));o&&this._sourceContainer.revealUiLocation(o);break}}async _copyObjectToClipboard(e){if(!e.objectId){this._dap.with(t=>t.copyRequested({text:gn(e,"copy")}));return}try{let t=await _v({cdp:this.cdp(),objectId:e.objectId,args:[2],silent:!0,returnByValue:!0});this._dap.with(r=>r.copyRequested({text:t.value}))}catch{}finally{this.cdp().Runtime.releaseObject({objectId:e.objectId}).catch(()=>{})}}async _onThreadPaused(e){this._expectedPauseReason=void 0,this._onPausedEmitter.fire(e);let t;e.hitBreakpoints&&(t=await Promise.race([k(1e3).then(()=>{}),Promise.all(e.hitBreakpoints.map(r=>this._breakpointManager._resolvedBreakpoints.get(r)).filter(Qi(dr)).map(r=>r.untilSetCompleted().then(()=>r.dapId)))])),await k(0),this._dap.with(r=>r.stopped({reason:e.reason,description:e.description,threadId:this.id,text:e.text,hitBreakpointIds:t,allThreadsStopped:!1}))}_onThreadResumed(){this._dap.with(e=>e.continued({threadId:this.id,allThreadsContinued:!1}))}isCrossThreadStep(e){var o;if(!e.asyncStackTraceId||!e.asyncStackTraceId.debuggerId)return!1;let t=fi.threadForDebuggerId(e.asyncStackTraceId.debuggerId);if(!t||!((o=t._waitingForStepIn)!=null&&o.lastDetails))return!1;let r=t._waitingForStepIn.lastDetails.stackTrace;return t._cdp.Debugger.getStackTrace({stackTraceId:e.asyncStackTraceId}).then(n=>!n||!n.stackTrace.callFrames.length||!Ne.fromRuntime(t,n.stackTrace.callFrames[0],!1).equivalentTo(r.frames[0])?!1:(t._waitingForStepIn=void 0,!0))}async setScriptSourceMapHandler(e,t){this._scriptWithSourceMapHandler=t;let r=e&&this._sourceContainer.sourceMapTimeouts().sourceMapMinPause&&t;if(r&&!this._pauseOnSourceMapBreakpointId){let o=await this._cdp.Debugger.setInstrumentationBreakpoint({instrumentation:"beforeScriptWithSourceMapExecution"});this._pauseOnSourceMapBreakpointId=o?o.breakpointId:void 0}else if(!r&&this._pauseOnSourceMapBreakpointId){let o=this._pauseOnSourceMapBreakpointId;this._pauseOnSourceMapBreakpointId=void 0,await this._cdp.Debugger.removeBreakpoint({breakpointId:o})}return!!this._pauseOnSourceMapBreakpointId}async _enablePerScriptSourcemaps(){await this._breakpointManager.updateEntryBreakpointMode(this,1),await this.setScriptSourceMapHandler(!1,this._scriptWithSourceMapHandler)}_shouldEnablePerScriptSms(e){var t,r,o;return e.reason!=="instrumentation"||!rt((t=e.data)==null?void 0:t.sourceMapURL)?!1:((r=e.data.url)==null?void 0:r.startsWith("webpack"))||((o=e.data.url)==null?void 0:o.startsWith("ng:"))}setSourceMapDisabler(e){this._sourceMapDisabler=e}static threadForDebuggerId(e){return fi._allThreadsByDebuggerId.get(e)}async replacePathsInStackTrace(e){let t=[];for(let o of new di(e)){if(typeof o=="string"){t.push(o);continue}let n=this._sourceContainer.getSourceByOriginalUrl(W(o.path))||this._sourceContainer.getSourceByOriginalUrl(o.path);if(!n){t.push(o.toString());continue}t.push(this._sourceContainer.preferredUiLocation({columnNumber:o.position.base1.columnNumber,lineNumber:o.position.base1.lineNumber,source:n}).then(({source:s,lineNumber:a,columnNumber:c})=>`${s.absolutePath}:${a}:${c}`))}return(await Promise.all(t)).join("")}},hi=fi;hi._lastThreadId=0,hi._allThreadsByDebuggerId=new Map});async function vf(i){let e=await i.uiLocation();return e?e.source.blackboxed()?2:St(e.source)&&!e.isMapped&&e.unmappedReason===3?1:0:0}var Ip,YR,XR,bi,Wu=m(()=>{"use strict";Ip=require("inversify");L();M();H();Ht();Sp();Uu();YR=new Set(["breakpoint","exception","entry"]),XR=256,bi=class{constructor(e,t){this.launchConfig=e;this.logger=t;this._smartStepCount=0}resetSmartStepCount(){this._smartStepCount>0&&(this.logger.verbose("internal",`smartStep: skipped ${this._smartStepCount} steps`),this._smartStepCount=0)}async getSmartStepDirection(e,t){if(!this.launchConfig.smartStep||YR.has(e.reason))return;let r=(await e.stackTrace.loadFrames(1)).find(Qi(Ne));if((r&&await vf(r))===0){this.resetSmartStepCount();return}return this._smartStepCount++>XR?2:(t==null?void 0:t.reason)==="step"?t.direction:0}};bi=h([(0,Ip.injectable)(),d(0,(0,Ip.inject)(ie)),d(1,(0,Ip.inject)(T))],bi)});var Ft,Jt,tS,Sf,Ne,Sp=m(()=>{"use strict";Ft=w(require("@vscode/l10n"));M();ps();Dt();de();ce();Wu();Uu();Jt=class{constructor(e){this.frames=[];this._frameById=new Map;this._lastFrameThread=e}static fromRuntime(e,t){let r=new Jt(e);for(let o of t.callFrames)o.url.endsWith(".cdp")||r.frames.push(Ne.fromRuntime(e,o,!1));return t.parentId?(r._asyncStackTraceId=t.parentId,console.assert(!t.parent)):r._appendStackTrace(e,t.parent),r}static async fromRuntimeWithPredicate(e,t,r,o=1/0){let n=new Jt(e);for(let s=0;s<t.callFrames.length&&o>0;s++)if(!t.callFrames[s].url.endsWith(".cdp")){let a=Ne.fromRuntime(e,t.callFrames[s],!1);await r(a)&&(n.frames.push(),o--)}return t.parentId?(n._asyncStackTraceId=t.parentId,console.assert(!t.parent)):n._appendStackTrace(e,t.parent),n}static fromDebugger(e,t,r,o){let n=new Jt(e);for(let s of t)n._appendFrame(Ne.fromDebugger(e,s));return o?(n._asyncStackTraceId=o,console.assert(!r)):n._appendStackTrace(e,r),n}async loadFrames(e,t){for(;this.frames.length<e&&this._asyncStackTraceId;){if(this._asyncStackTraceId.debuggerId&&(this._lastFrameThread=hi.threadForDebuggerId(this._asyncStackTraceId.debuggerId)),!this._lastFrameThread){this._asyncStackTraceId=void 0;break}t&&this._lastFrameThread.cdp().DotnetDebugger.setEvaluationOptions({options:{noFuncEval:t},type:"stackFrame"});let r=await this._lastFrameThread.cdp().Debugger.getStackTrace({stackTraceId:this._asyncStackTraceId});this._asyncStackTraceId=void 0,r&&this._appendStackTrace(this._lastFrameThread,r.stackTrace)}return this.frames}frame(e){return this._frameById.get(e)}_appendStackTrace(e,t){for(console.assert(!t||!this._asyncStackTraceId);t;){if(t.description==="async function"&&t.callFrames.length&&t.callFrames.shift(),t.callFrames.length){this._appendFrame(new Sf(t.description||"async"));for(let r of t.callFrames)this._appendFrame(Ne.fromRuntime(e,r,!0))}t.parentId&&(this._asyncStackTraceId=t.parentId,console.assert(!t.parent)),t=t.parent}}_appendFrame(e){this.frames.push(e),e instanceof Ne&&this._frameById.set(e.frameId,e)}async formatAsNative(){return await this.formatWithMapper(e=>e.formatAsNative())}async format(){return await this.formatWithMapper(e=>e.format())}async formatWithMapper(e){let t=await this.loadFrames(50);for(let o=t.length-1;o>=0;o--){let n=t[o];if(n instanceof Ne&&n.isReplEval){t=t.slice(0,o+1);break}}let r=t.map(e);return(await Promise.all(r)).join(`
`)+`
`}async toDap(e){let t=e.startFrame||0,r=(e.levels||50)+t,o=await this.loadFrames(r,e.noFuncEval);r=Math.min(o.length,e.levels?r:o.length);let n=[];for(let s=t;s<r;s++)n.push(o[s].toDap(e.format));return{stackFrames:await Promise.all(n),totalFrames:this._asyncStackTraceId?1e6:o.length}}},tS=Cl(),Sf=class{constructor(e="async"){this.label=e;this.frameId=tS()}async toDap(){return{name:this.label,id:0,line:0,column:0,presentationHint:"label"}}async formatAsNative(){return`    --- ${this.label} ---`}async format(){return`\u25C0 ${this.label} \u25B6`}},Ne=class{constructor(e,t,r,o=!1){this.callFrame=t;this.isAsync=o;this.frameId=tS();this.completions=N(async()=>{if(!this._scope)return[];let e=this._thread.pausedVariables();if(!e)return[];let t=[];for(let o=0;o<this._scope.chain.length;o++){let n=this._scopeVariable(o,this._scope);n&&t.push(e.getVariableNames({variablesReference:n.id}).then(s=>s.map(a=>({label:a,type:"property"}))))}let r=await Promise.all(t);return[].concat(...r)});this._name=t.functionName||"<anonymous>",this._rawLocation=r,this.uiLocation=N(()=>e.rawLocationToUiLocation(r)),this._thread=e;let n=r.scriptId?e.getScriptById(r.scriptId):void 0;this.isReplEval=n?n.url.endsWith(".repl"):!1}get rawPosition(){return new as(this._rawLocation.lineNumber,this._rawLocation.columnNumber)}static fromRuntime(e,t,r){return new Ne(e,t,e.rawLocation(t),r)}static fromDebugger(e,t){let r=new Ne(e,t,e.rawLocation(t));return r._scope={chain:t.scopeChain,thisObject:t.this,returnValue:t.returnValue,variables:new Array(t.scopeChain.length).fill(void 0),callFrameId:t.callFrameId},r}get canExplicitlyBeRestarted(){return!!this.callFrame.canBeRestarted}equivalentTo(e){return e instanceof Ne&&e._rawLocation.columnNumber===this._rawLocation.columnNumber&&e._rawLocation.lineNumber===this._rawLocation.lineNumber&&e._rawLocation.scriptId===this._rawLocation.scriptId}callFrameId(){return this._scope?this._scope.callFrameId:void 0}async scopes(){let e=this._scope;if(!e)throw new I(_w());return{scopes:(await Promise.all(e.chain.map(async(r,o)=>{let n="",s;switch(r.type){case"global":n=Ft.t("Global");break;case"local":n=Ft.t("Local"),s="locals";break;case"with":n=Ft.t("With Block"),s="locals";break;case"closure":n=Ft.t("Closure"),s="arguments";break;case"catch":n=Ft.t("Catch Block"),s="locals";break;case"block":n=Ft.t("Block"),s="locals";break;case"script":n=Ft.t("Script");break;case"eval":n=Ft.t("Eval");break;case"module":n=Ft.t("Module");break;default:n=r.type.substr(0,1).toUpperCase()+r.type.substr(1);break}r.name&&r.type==="closure"?n=Ft.t("Closure ({0})",r.name):r.name&&(n=`${n}: ${r.name}`);let a=this._scopeVariable(o,e);if(!a)return;let c={name:n,presentationHint:s,expensive:r.type==="global",variablesReference:a.id};if(r.startLocation){let p=this._thread.rawLocation(r.startLocation),l=await this._thread.rawLocationToUiLocation(p);if(c.line=(l||p).lineNumber,c.column=(l||p).columnNumber,l&&(c.source=await l.source.toDap()),r.endLocation){let u=this._thread.rawLocation(r.endLocation),f=await this._thread.rawLocationToUiLocation(u);c.endLine=(f||u).lineNumber,c.endColumn=(f||u).columnNumber}}return c}))).filter(Fe)}}async toDap(e){let t=await this.uiLocation(),r=t?await t.source.toDap():void 0,o=await vf(this),n=o?"deemphasize":"normal";o&&r&&(r.origin=o===1?Ft.t("Skipped by smartStep"):Ft.t("Skipped by skipFiles"));let s=(t||this._rawLocation).lineNumber,a=(t||this._rawLocation).columnNumber,c=this._name;return r&&e&&(e.module&&(c+=` [${r.name}]`),e.line&&(c+=` Line ${s}`)),{id:this.frameId,name:c,line:s,column:a,source:r,presentationHint:n,canRestart:this.callFrame.canBeRestarted??!this.isAsync}}async formatAsNative(){let e=await this.uiLocation(),t=await(e==null?void 0:e.source.existingAbsolutePath())||await(e==null?void 0:e.source.prettyName())||this.callFrame.url,{lineNumber:r,columnNumber:o}=e||this._rawLocation;return`    at ${this._name} (${t}:${r}:${o})`}async format(){let e=await this.uiLocation(),t=await(e==null?void 0:e.source.prettyName())||"<unknown>",r=e||this._rawLocation,o=`${this._name} @ ${t}:${r.lineNumber}`;return r.columnNumber>1&&(o+=`:${r.columnNumber}`),o}_scopeVariable(e,t){let r=t.variables[e];if(r)return r;let o={stackFrame:this,callFrameId:t.callFrameId,scopeNumber:e},n=[];e===0&&(t.thisObject&&n.push({name:"this",value:t.thisObject}),t.returnValue&&n.push({name:Ft.t("Return value"),value:t.returnValue}));let s=this._thread.pausedVariables();if(!s)return;let a=s.createScope(t.chain[e].object,o,n);return t.variables[e]=a}}});var rS,wn,$u,yn,wi,qu,Hu,zu,Gu,Ju,If=m(()=>{"use strict";rS=w(require("@vscode/l10n"));M();Fu();Qg();ea();Sp();wn=class{constructor(e){this.event=e;this.stackTrace=N(e=>this.event.stackTrace?Jt.fromRuntime(e,this.event.stackTrace):void 0);this.getUiLocation=N(async e=>{let t=this.stackTrace(e);if(!t)return;let r;for(let o of t.frames){if(!(o instanceof Ne))continue;let n=await o.uiLocation();if(n&&(r||(r=n),!n.source.blackboxed()))return{source:await n.source.toDap(),line:n.lineNumber,column:n.columnNumber}}if(r)return{source:await r.source.toDap(),line:r.lineNumber,column:r.columnNumber}})}formatDefaultString(e,t,r=!1){let n=t.length>1&&t[0].type==="string"?Kg(t[0].value,t.slice(1),ef):Kg("",t,ef),s=n.result+`
`;return n.usedAllSubs&&!t.some(mn)?{output:s}:this.formatComplexStringOutput(e,s,t,r)}async formatComplexStringOutput(e,t,r,o){(r.some(s=>s.subtype==="error")||di.isStackLike(t))&&(await this.getUiLocation(e),t=await e.replacePathsInStackTrace(t),o=!0);let n=e.replVariables.createVariableForOutput(t,r,o?this.stackTrace(e):void 0);return{output:t,variablesReference:n.id}}},$u=class extends wn{async toDap(e){var t;return((t=this.event.args[0])==null?void 0:t.value)==="console.assert"&&(this.event.args[0].value=rS.t("Assertion failed")),{category:"stderr",...await this.formatDefaultString(e,this.event.args,!0),...await this.getUiLocation(e)}}},yn=class extends wn{constructor(t,r,o){super(t);this.includeStack=r;this.category=o}async toDap(t){return{category:this.category,...await this.formatDefaultString(t,this.event.args,this.includeStack),...await this.getUiLocation(t)}}},wi=class extends yn{constructor(e){super(e,!1,"stdout")}},qu=class extends yn{constructor(e){super(e,!0,"stdout")}},Hu=class extends yn{constructor(e){super(e,!0,"stderr")}},zu=class extends yn{constructor(e){super(e,!0,"stderr")}},Gu=class extends wn{async toDap(e){return{category:"stdout",group:this.event.type==="startGroupCollapsed"?"startCollapsed":"start",...await this.formatDefaultString(e,this.event.args),...await this.getUiLocation(e)}}},Ju=class extends yn{constructor(e){super(e,!1,"stdout")}async toDap(e){var t;return(t=this.event.args[0])!=null&&t.preview?{category:"stdout",output:"",variablesReference:e.replVariables.createVariableForOutput("",this.event.args,void 0,this.event.type).id,...await this.getUiLocation(e)}:super.toDap(e)}}});var vp,oS=m(()=>{"use strict";M();Fu();ea();Sp();If();vp=class extends wn{constructor(){super(...arguments);this.stackTrace=N(t=>{if(this.event.stackTrace)return Jt.fromRuntime(t,this.event.stackTrace);if(this.event.scriptId)return Jt.fromRuntime(t,{callFrames:[{functionName:"(program)",lineNumber:this.event.lineNumber,columnNumber:this.event.columnNumber,scriptId:this.event.scriptId,url:this.event.url||""}]})})}async toDap(t){var a;let r=this.event.exception?fn(this.event.exception):{title:""},o=r.title;o.startsWith("Uncaught")||(o=`Uncaught ${((a=this.event.exception)==null?void 0:a.className)??"Error"} `+o);let n=this.stackTrace(t),s=this.event.exception&&!r.stackTrace?[this.event.exception]:[];return di.isStackLike(o)?o=await t.replacePathsInStackTrace(o):n&&(o+=`
`+await n.formatAsNative()),{category:"stderr",output:o,variablesReference:n||s.length?t.replVariables.createVariableForOutput(o,s,n).id:void 0,...await this.getUiLocation(t)}}}});var Ku,Vu=m(()=>{"use strict";kv();oS();Ku=Symbol("IConsole")});var Pf,iS,nS,sS=m(()=>{"use strict";Pf=require("path"),iS=(0,Pf.join)(__dirname,"diagnosticTool.js"),nS=(0,Pf.join)(__dirname,"diagnosticTool.css")});var yi,st,vn=m(()=>{"use strict";yi=Symbol("ITarget"),st=Symbol("ILauncher")});var Sn,aS,cS,vi,Cf=m(()=>{"use strict";Sn=require("inversify"),aS=require("os"),cS=require("path");M();sS();G();vn();li();yu();Ht();vi=class{constructor(e,t,r,o){this.fs=e;this.sources=t;this.breakpoints=r;this.target=o}async generateObject(){let[e]=await Promise.all([this.dumpSources()]);return{breakpoints:this.dumpBreakpoints(),sources:e,config:this.target.launchConfig}}async generateHtml(e=(0,cS.join)((0,aS.tmpdir)(),"js-debug-diagnostics.html")){return await this.fs.writeFile(e,`<!DOCTYPE html>
      <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <style>${await this.fs.readFile(nS,"utf-8")}<</style>
      </head>
      <body>
        <script>window.DUMP=${JSON.stringify(await this.generateObject())}</script>
        <script>${await this.fs.readFile(iS,"utf-8")}</script>
      </body>
      </html>`),e}dumpBreakpoints(){let e=[];for(let t of[this.breakpoints.appliedByPath,this.breakpoints.appliedByRef])for(let r of t.values())for(let o of r){let n=o.diagnosticDump();e.push({source:n.source,params:n.params,cdp:n.cdp.map(s=>s.state===1?{...s,uiLocations:s.uiLocations.map(a=>this.dumpUiLocation(a))}:{...s,done:void 0})})}return e}dumpSources(){let e=[],t=0;for(let r of this.sources.sources)e.push((async()=>({uniqueId:t++,url:r.url,sourceReference:r.sourceReference,absolutePath:r.absolutePath,actualAbsolutePath:await r.existingAbsolutePath(),scriptIds:r.scripts.map(o=>o.scriptId),prettyName:await r.prettyName(),compiledSourceRefToUrl:r instanceof qe?[...r.compiledToSourceUrl.entries()].map(([o,n])=>[o.sourceReference,n]):void 0,sourceMap:r.sourceMap&&{url:r.sourceMap.url,metadata:r.sourceMap.metadata,sources:ho(Object.fromEntries(r.sourceMap.sourceByUrl),o=>o.sourceReference)}}))());return Promise.all(e)}dumpUiLocation(e){return{lineNumber:e.lineNumber,columnNumber:e.columnNumber,sourceReference:e.source.sourceReference}}};vi=h([(0,Sn.injectable)(),d(0,(0,Sn.inject)(z)),d(1,(0,Sn.inject)(Qe)),d(2,(0,Sn.inject)(mr)),d(3,(0,Sn.inject)(yi))],vi)});var Si,na,ia,xf=m(()=>{"use strict";Si=require("inversify");M();U();Dt();H();qr();de();ce();jg();dn();rp();Ht();na=Symbol("IExceptionPauseService"),ia=class{constructor(e,t,r,o,n){this.evaluator=e;this.scriptSkipper=t;this.dap=r;this.sourceContainer=n;this.state={cdp:"none"};this.blocker=le();this.noDebug=!!o.noDebug,this.breakOnError=o.__breakOnConditionalError,this.blocker.resolve()}get launchBlocker(){return this.blocker.promise}async setBreakpoints(e){if(!this.noDebug){try{this.state=this.parseBreakpointRequest(e)}catch(t){if(!(t instanceof I))throw t;this.dap.output({category:"stderr",output:t.message});return}this.cdp?await this.sendToCdp(this.cdp):this.state.cdp!=="none"&&this.blocker.hasSettled()&&(this.blocker=le())}}async shouldPauseAt(e){var r;if(e.reason!=="exception"&&e.reason!=="promiseRejection"||this.state.cdp==="none"||this.shouldScriptSkip(e))return!1;let t=this.state.condition;if((r=e.data)!=null&&r.uncaught){if(t.uncaught&&!await this.evalCondition(e,t.uncaught))return!1}else if(t.caught&&!await this.evalCondition(e,t.caught))return!1;return!0}async apply(e){this.cdp=e,this.state.cdp!=="none"&&await this.sendToCdp(e)}async sendToCdp(e){await e.Debugger.setPauseOnExceptions({state:this.state.cdp}),this.blocker.resolve()}async evalCondition(e,t){let r=await t({callFrameId:e.callFrames[0].callFrameId},{error:e.data});return!!(r!=null&&r.result.value)}shouldScriptSkip(e){var r;if((r=e.data)!=null&&r.uncaught||!e.callFrames.length)return!1;let t=this.sourceContainer.getScriptById(e.callFrames[0].location.scriptId);return!!t&&this.scriptSkipper.isScriptSkipped(t.url)}parseBreakpointRequest(e){let t=(e.filterOptions??[]).concat(e.filters.map(a=>({filterId:a}))),r="none",o=[],n=[];for(let{filterId:a,condition:c}of t)a==="all"?(r="all",c&&o.push(a)):a==="uncaught"&&(r==="none"&&(r="uncaught"),c&&n.push(a));let s=a=>{if(a.length===0)return;let c="!!("+t.map(u=>u.condition).filter(Fe).join(") || !!(")+")",p=Go(c);if(p)throw new I(qo({line:0,condition:c},p.message));let l=this.breakOnError?Bg(c):c;return this.evaluator.prepare(l,{hoist:["error"]}).invoke};return r==="none"?{cdp:r}:{cdp:r,condition:{caught:s(o),uncaught:s(n)}}}};ia=h([(0,Si.injectable)(),d(0,(0,Si.inject)(ur)),d(1,(0,Si.inject)(oi)),d(2,(0,Si.inject)(sr)),d(3,(0,Si.inject)(ie)),d(4,(0,Si.inject)(Qe))],ia)});var Qu,pS=m(()=>{"use strict";Qu=class{constructor(){this.didEnable=new WeakSet}async retrieve(e){this.didEnable.has(e)||(this.didEnable.add(e),await e.Performance.enable({}));let t=await e.Performance.getMetrics({});if(!t)return{error:"Error in CDP"};let r={};for(let o of t.metrics)r[o.name]=o.value;return{metrics:r}}}});var Yu,lS=m(()=>{"use strict";Je();Yu=class{async retrieve(e){let t=await e.Runtime.evaluate({expression:`({
        memory: process.memoryUsage(),
        cpu: process.cpuUsage(),
        timestamp: Date.now(),
        resourceUsage: process.resourceUsage && process.resourceUsage(),
      })${Re()}`,returnByValue:!0});return t?t.exceptionDetails?{error:t.exceptionDetails.text}:{metrics:t.result.value}:{error:"No response from CDP"}}}});var Xu,Zu,In,kf=m(()=>{"use strict";Xu=require("inversify");vn();pS();lS();Zu=Symbol("IPerformanceProvider"),In=class{constructor(e){this.target=e}create(){return this.target.type()==="node"?new Yu:new Qu}};In=h([(0,Xu.injectable)(),d(0,(0,Xu.inject)(yi))],In)});var sa,Tf=m(()=>{"use strict";sa=class{constructor(e){this.sources=e;this.locationIdCounter=0;this.locationsByRef=new Map}getLocationIdFor(e){let t=[e.functionName,e.url,e.scriptId,e.lineNumber,e.columnNumber].join(":"),r=this.locationsByRef.get(t);if(r)return r.id;let o=this.locationIdCounter++;return this.locationsByRef.set(t,{id:o,callFrame:e,locations:(async()=>{var s;let n=await((s=this.sources.getScriptById(e.scriptId))==null?void 0:s.source);return n?Promise.all(this.sources.currentSiblingUiLocations({lineNumber:e.lineNumber+1,columnNumber:e.columnNumber+1,source:n}).map(async a=>({...a,source:await a.source.toDapShallow()}))):[]})()}),o}getLocations(){return Promise.all([...this.locationsByRef.values()].sort((e,t)=>e.id-t.id).map(async e=>({callFrame:e.callFrame,locations:await e.locations})))}}});async function uS(i,e,t){let r=new sa(e),o=i.nodes.map(n=>{var s;return{...n,locationId:r.getLocationIdFor(n.callFrame),positionTicks:(s=n.positionTicks)==null?void 0:s.map(a=>({...a,startLocationId:r.getLocationIdFor({...n.callFrame,lineNumber:a.line-1,columnNumber:0}),endLocationId:r.getLocationIdFor({...n.callFrame,lineNumber:a.line,columnNumber:0})}))}});return{...i,nodes:o,$vscode:{rootPath:t,locations:await r.getLocations()}}}var Rf,Pn,ed,Xe,Df,Pp=m(()=>{"use strict";Rf=w(require("@vscode/l10n")),Pn=require("inversify"),ed=require("path");He();j();H();de();ce();G();Ht();Tf();Xe=class{constructor(e,t,r,o){this.cdp=e;this.fs=t;this.sources=r;this.launchConfig=o}static canApplyTo(){return!0}async start(e,t){if(!await this.cdp.Profiler.start({}))throw new I(ms());return new Df(this.cdp,this.fs,this.sources,this.launchConfig.__workspaceFolder,t)}async save(e,t){let r=await uS(e,this.sources,this.launchConfig.__workspaceFolder);(0,ed.isAbsolute)(t)||(t=(0,ed.join)(this.launchConfig.__workspaceFolder,t)),await this.fs.writeFile(t,JSON.stringify(r))}};Xe.type="cpu",Xe.extension=".cpuprofile",Xe.label=Rf.t("CPU Profile"),Xe.description=Rf.t("Generates a .cpuprofile file you can open in the Chrome devtools"),Xe.editable=!0,Xe=h([(0,Pn.injectable)(),d(0,(0,Pn.inject)(_e)),d(1,(0,Pn.inject)(z)),d(2,(0,Pn.inject)(Qe)),d(3,(0,Pn.inject)(ie))],Xe);Df=class{constructor(e,t,r,o,n){this.cdp=e;this.fs=t;this.sources=r;this.workspaceFolder=o;this.file=n;this.stopEmitter=new S;this.disposed=!1;this.onUpdate=new S().event;this.onStop=this.stopEmitter.event}async dispose(){this.disposed||(this.disposed=!0,this.stopEmitter.fire())}async stop(){let e=await this.cdp.Profiler.stop({});if(!e)throw new I(ms());await this.dispose();let t=await uS(e.profile,this.sources,this.workspaceFolder);await this.fs.writeFile(this.file,JSON.stringify(t))}}});var _f,Cn,Kt,Lf,Af=m(()=>{"use strict";_f=w(require("@vscode/l10n")),Cn=require("inversify");He();j();H();de();ce();G();Ht();Tf();Kt=class{constructor(e,t,r,o){this.cdp=e;this.fs=t;this.sources=r;this.launchConfig=o}static canApplyTo(){return!0}async start(e,t){if(await this.cdp.HeapProfiler.enable({}),!await this.cdp.HeapProfiler.startSampling({}))throw new I(ms());return new Lf(this.cdp,this.fs,this.sources,this.launchConfig.__workspaceFolder,t)}};Kt.type="heap",Kt.extension=".heapprofile",Kt.label=_f.t("Heap Profile"),Kt.description=_f.t("Generates a .heapprofile file you can open in the Chrome devtools"),Kt.editable=!0,Kt=h([(0,Cn.injectable)(),d(0,(0,Cn.inject)(_e)),d(1,(0,Cn.inject)(z)),d(2,(0,Cn.inject)(Qe)),d(3,(0,Cn.inject)(ie))],Kt);Lf=class{constructor(e,t,r,o,n){this.cdp=e;this.fs=t;this.sources=r;this.workspaceFolder=o;this.file=n;this.stopEmitter=new S;this.disposed=!1;this.onUpdate=new S().event;this.onStop=this.stopEmitter.event}async dispose(){this.disposed||(this.disposed=!0,await this.cdp.HeapProfiler.disable({}),this.stopEmitter.fire())}async stop(){let e=await this.cdp.HeapProfiler.stopSampling({});if(!e)throw new I(ms());await this.dispose();let t=await this.annotateSources(e.profile);await this.fs.writeFile(this.file,JSON.stringify(t))}async annotateSources(e){let t=new sa(this.sources),r=(n,s)=>{s.locationId=t.getLocationIdFor(n.callFrame);for(let a of n.children){let c={...a,children:[]};s.children.push(c),r(a,c)}},o={...e.head,children:[]};return r(e.head,o),{...e,head:o,$vscode:{rootPath:this.workspaceFolder,locations:await t.getLocations()}}}}});var Ef,dS,td,Qt,Ff=m(()=>{"use strict";Ef=w(require("@vscode/l10n")),dS=require("fs"),td=require("inversify");He();j();Qt=class{constructor(e){this.cdp=e;this.cdp.HeapProfiler.on("addHeapSnapshotChunk",({chunk:t})=>{var r;return(r=this.currentWriter)==null?void 0:r.stream.write(t)})}static canApplyTo(){return!0}async start(e,t){return{onStop:new S().event,onUpdate:new S().event,dispose:()=>{},stop:async()=>{await this.cdp.HeapProfiler.enable({}),await this.dumpToFile(t),await this.cdp.HeapProfiler.disable({})}}}async dumpToFile(e){let{stream:t,promise:r}=this.currentWriter={stream:(0,dS.createWriteStream)(e),promise:this.cdp.HeapProfiler.takeHeapSnapshot({})};await r,t.end(),this.currentWriter=void 0}};Qt.type="memory",Qt.extension=".heapsnapshot",Qt.label=Ef.t("Heap Snapshot"),Qt.description=Ef.t("Generates a .heapsnapshot file you can open in the Chrome devtools"),Qt.instant=!0,Qt=h([(0,td.injectable)(),d(0,(0,td.inject)(_e))],Qt)});var rd,od,id,Mt,nd=m(()=>{"use strict";rd=require("inversify");G();Pp();Af();Ff();od=Symbol("IProfilerFactory"),id=()=>{let i=new Date;return["vscode-profile",i.getFullYear(),i.getMonth()+1,i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds()].map(e=>String(e).padStart(2,"0")).join("-")},Mt=class{constructor(e){this.container=e}get(e){let t=Mt.ctors.find(r=>r.type===e);if(!t)throw new Error(`Invalid profilter type ${e}`);return this.container.get(t)}};Mt.ctors=[Xe,Kt,Qt],Mt=h([(0,rd.injectable)(),d(0,(0,rd.inject)(Ds))],Mt)});var Mf,mS,Ii,gS,fS,sd,aa,Bf=m(()=>{"use strict";Mf=w(require("@vscode/l10n")),mS=require("crypto"),Ii=require("inversify"),gS=require("os"),fS=require("path");He();de();ce();sp();li();up();nd();Pp();sd=Symbol("IProfileController"),aa=class{constructor(e,t,r,o,n){this.cdp=e;this.factory=t;this.basicCpuProfiler=r;this.breakpoints=o;this.shutdown=n;this.seenConsoleProfileNames=Object.create(null)}connect(e,t){e.on("startProfile",async r=>(await this.start(e,t,r),{})),e.on("stopProfile",()=>this.stopProfiling(e)),this.cdp.Profiler.on("consoleProfileStarted",()=>{e.output({output:Mf.t("Console profile started")+`
`,category:"console"})}),this.cdp.Profiler.on("consoleProfileFinished",async r=>{let o=this.saveConsoleProfile(e,r),n=this.shutdown.register(0,()=>o);await o,n.dispose()}),t.onPaused(()=>this.stopProfiling(e))}async start(e,t,r){if(this.profile)throw new I(Tw());this.profile=this.startProfileInner(e,t,r).catch(o=>{throw this.profile=void 0,o}),await this.profile}async saveConsoleProfile(e,t){var o;let r;if(t.title){r=(o=t.title)==null?void 0:o.replace(/[\/\\]/g,"-");let n=this.seenConsoleProfileNames[t.title]||0;this.seenConsoleProfileNames[t.title]=n+1,n>0&&(r+=`-${n}`)}else r=id();r+=Xe.extension,await this.basicCpuProfiler.save(t.profile,r),e.output({output:Mf.t('CPU profile saved as "{0}" in your workspace folder',r)+`
`,category:"console"})}async startProfileInner(e,t,r){var l;let o=!1,n;if((l=r.stopAtBreakpoint)!=null&&l.length){let u=new Set(r.stopAtBreakpoint);o=!0,n=f=>!(f instanceof dr)||u.has(f.dapId)}else n=()=>!1;await this.breakpoints.applyEnabledFilter(n);let s=(0,fS.join)((0,gS.tmpdir)(),`vscode-js-profile-${(0,mS.randomBytes)(4).toString("hex")}`),a=await this.factory.get(r.type).start(r,s),c={file:s,profile:a,enableFilter:n,keptDebuggerOn:o};a.onUpdate(u=>e.profilerStateUpdate({label:u,running:!0})),a.onStop(()=>this.disposeProfile(c));let p=!!t.pausedDetails();return o?await t.resume():p&&(await this.cdp.Debugger.disable({}),p&&t.onResumed()),e.profileStarted({file:c.file,type:r.type}),c}async stopProfiling(e){var r;let t=await((r=this.profile)==null?void 0:r.catch(()=>{}));return!t||!this.profile?{}:(this.profile=void 0,await(t==null?void 0:t.profile.stop()),e.profilerStateUpdate({label:"",running:!1}),{})}async disposeProfile({profile:e,enableFilter:t,keptDebuggerOn:r}){r||await this.cdp.Debugger.enable({}),await this.breakpoints.applyEnabledFilter(void 0,t),e.dispose()}};aa=h([(0,Ii.injectable)(),d(0,(0,Ii.inject)(_e)),d(1,(0,Ii.inject)(od)),d(2,(0,Ii.inject)(Xe)),d(3,(0,Ii.inject)(mr)),d(4,(0,Ii.inject)(ai))],aa)});var gr,ko,jf=m(()=>{"use strict";gr=w(require("@vscode/l10n"));$e();L();M();ps();U();np();Dt();B();de();ce();G();As();sp();li();zg();ku();Vu();Cf();dp();dn();xf();kf();Bf();Pp();rp();Wu();Ht();Uu();ko=class{constructor(e,t,r,o){this.asyncStackPolicy=t;this.launchConfig=r;this._services=o;this._disposables=new O;this._customBreakpoints=new Set;this._threadDeferred=le();this.breakpointIdCounter=Cl();this._cdpProxyProvider=this._services.get(xu);this._configurationDoneDeferred=le(),this.sourceContainer=o.get(Qe),this.breakpointManager=o.get(mr);let n=o.get(Zu),s=o.get(nt);s.onFlush(()=>{s.report("breakpointStats",this.breakpointManager.statisticsForTelemetry()),s.report("statistics",this.sourceContainer.statistics())}),this.dap=e,this.dap.on("initialize",a=>this.onInitialize(a)),this.dap.on("setBreakpoints",a=>this._onSetBreakpoints(a)),this.dap.on("setExceptionBreakpoints",a=>this.setExceptionBreakpoints(a)),this.dap.on("configurationDone",()=>this.configurationDone()),this.dap.on("loadedSources",()=>this._onLoadedSources()),this.dap.on("disableSourcemap",a=>this._onDisableSourcemap(a)),this.dap.on("source",a=>this._onSource(a)),this.dap.on("threads",()=>this._onThreads()),this.dap.on("stackTrace",a=>this._withThread(c=>c.stackTrace(a))),this.dap.on("variables",a=>this._onVariables(a)),this.dap.on("readMemory",a=>this._onReadMemory(a)),this.dap.on("writeMemory",a=>this._onWriteMemory(a)),this.dap.on("setVariable",a=>this._onSetVariable(a)),this.dap.on("setExpression",a=>this._onSetExpression(a)),this.dap.on("continue",()=>this._withThread(a=>a.resume())),this.dap.on("pause",()=>this._withThread(a=>a.pause())),this.dap.on("next",()=>this._withThread(a=>a.stepOver())),this.dap.on("stepIn",a=>this._withThread(c=>c.stepInto(a.targetId))),this.dap.on("stepOut",()=>this._withThread(a=>a.stepOut())),this.dap.on("restartFrame",a=>this._withThread(c=>c.restartFrame(a))),this.dap.on("scopes",a=>this._withThread(c=>c.scopes(a))),this.dap.on("evaluate",a=>this.onEvaluate(a)),this.dap.on("completions",a=>this._withThread(c=>c.completions(a))),this.dap.on("exceptionInfo",()=>this._withThread(a=>a.exceptionInfo())),this.dap.on("enableCustomBreakpoints",a=>this.enableCustomBreakpoints(a)),this.dap.on("toggleSkipFileStatus",a=>this._toggleSkipFileStatus(a)),this.dap.on("disableCustomBreakpoints",a=>this._disableCustomBreakpoints(a)),this.dap.on("prettyPrintSource",a=>this._prettyPrintSource(a)),this.dap.on("revealPage",()=>this._withThread(a=>a.revealPage())),this.dap.on("getPerformance",()=>this._withThread(a=>n.retrieve(a.cdp()))),this.dap.on("breakpointLocations",a=>this._breakpointLocations(a)),this.dap.on("createDiagnostics",a=>this._dumpDiagnostics(a)),this.dap.on("requestCDPProxy",()=>this._requestCDPProxy()),this.dap.on("setExcludedCallers",a=>this._onSetExcludedCallers(a)),this.dap.on("saveDiagnosticLogs",({toFile:a})=>this._saveDiagnosticLogs(a)),this.dap.on("setSourceMapStepping",a=>this._setSourceMapStepping(a)),this.dap.on("stepInTargets",a=>this._stepInTargets(a)),this.dap.on("setDebuggerProperty",a=>this._setDebuggerProperty(a)),this.dap.on("setSymbolOptions",a=>this._setSymbolOptions(a))}_setDebuggerProperty(e){var t;return(t=this._thread)==null||t.cdp().DotnetDebugger.setDebuggerProperty(e),Promise.resolve({})}_setSymbolOptions(e){var t;return(t=this._thread)==null||t.cdp().DotnetDebugger.setSymbolOptions(e),Promise.resolve({})}_breakpointLocations(e){return this._withThread(async t=>{let r=this.sourceContainer.source(e.source);return r?{breakpoints:(await this.breakpointManager.getBreakpointLocations(t,r,new Vt(e.line,e.column||1),new Vt(e.endLine||e.line+1,e.endColumn||e.column||1))).map(n=>n.uiLocations.find(s=>s.source===r)).filter(Fe).map(n=>({line:n.lineNumber,column:n.columnNumber}))}:{breakpoints:[]}})}_stepInTargets(e){return this._withThread(async t=>({targets:await t.getStepInTargets(e.frameId)}))}_setSourceMapStepping({enabled:e}){return this.sourceContainer.doSourceMappedStepping=e,Promise.resolve({})}async _saveDiagnosticLogs(e){let t=this._services.get(T).getRecentLogs();return await this._services.get(z).writeFile(e,t.map(r=>JSON.stringify(r)).join(`
`)),{}}async launchBlocker(){await this._configurationDoneDeferred.promise,await this._services.get(na).launchBlocker,await this.breakpointManager.launchBlocker()}async _onSetExcludedCallers({callers:e}){return(await this._threadDeferred.promise).setExcludedCallers(e),{}}async onInitialize(e){console.assert(e.linesStartAt1),console.assert(e.columnsStartAt1);let t=ko.capabilities(!0);return setTimeout(()=>this.dap.initialized({}),0),setTimeout(()=>{var r;return(r=this._thread)==null?void 0:r.dapInitialized()},0),t}static capabilities(e=!1){return{supportsConfigurationDoneRequest:!0,supportsFunctionBreakpoints:!1,supportsConditionalBreakpoints:!0,supportsHitConditionalBreakpoints:!0,supportsEvaluateForHovers:!0,supportsReadMemoryRequest:!0,supportsWriteMemoryRequest:!0,exceptionBreakpointFilters:[{filter:"all",label:gr.t("Caught Exceptions"),default:!1,supportsCondition:!0,description:gr.t("Breaks on all throw errors, even if they're caught later."),conditionDescription:'error.name == "MyError"'},{filter:"uncaught",label:gr.t("Uncaught Exceptions"),default:!1,supportsCondition:!0,description:gr.t("Breaks only on errors or promise rejections that are not handled."),conditionDescription:'error.name == "MyError"'}],supportsStepBack:!1,supportsSetVariable:!0,supportsRestartFrame:!0,supportsGotoTargetsRequest:!1,supportsStepInTargetsRequest:!0,supportsCompletionsRequest:!0,supportsModulesRequest:!1,additionalModuleColumns:[],supportedChecksumAlgorithms:[],supportsRestartRequest:!0,supportsExceptionOptions:!1,supportsValueFormattingOptions:!0,supportsExceptionInfoRequest:!0,supportTerminateDebuggee:!1,supportsDelayedStackTraceLoading:!0,supportsLoadedSourcesRequest:!0,supportsLogPoints:!0,supportsTerminateThreadsRequest:!1,supportsSetExpression:!0,supportsTerminateRequest:!1,completionTriggerCharacters:[".","[",'"',"'"],supportsBreakpointLocationsRequest:!0,supportsClipboardContext:!0,supportsExceptionFilterOptions:!0,supportsEvaluationOptions:!!e,supportsDebuggerProperties:!!e,supportsSetSymbolOptions:!!e}}async _onSetBreakpoints(e){var t;return this.breakpointManager.setBreakpoints(e,((t=e.breakpoints)==null?void 0:t.map(()=>this.breakpointIdCounter()))??[])}async setExceptionBreakpoints(e){return await this._services.get(na).setBreakpoints(e),{}}async configurationDone(){return this._configurationDoneDeferred.resolve(),{}}async _onLoadedSources(){return{sources:await this.sourceContainer.loadedSources()}}async _onDisableSourcemap(e){var r;let t=this.sourceContainer.source(e.source);if(!t)return ge(gr.t("Source not found"));if(!(t instanceof qe))return ge(gr.t("Source not a source map"));for(let o of t.compiledToSourceUrl.keys())this.sourceContainer.disableSourceMapForSource(o,!0);return await((r=this._thread)==null?void 0:r.refreshStackTrace()),{}}async _onSource(e){e.source||(e.source={sourceReference:e.sourceReference}),e.source.path=vt(e.source.path);let t=this.sourceContainer.source(e.source);if(!t)return ge(gr.t("Source not found"));let r=await t.content();return r===void 0?(t instanceof qe&&this.dap.suggestDisableSourcemap({source:e.source}),ge(gr.t("Unable to retrieve source content"))):{content:r,mimeType:t.getSuggestedMimeType}}async _onThreads(){let e=[];return this._thread&&e.push({id:this._thread.id,name:this._thread.name()}),{threads:e}}findVariableStore(e){if(!this._thread)return;let t=this._thread.pausedVariables();if(t&&e(t))return t;if(e(this._thread.replVariables))return this._thread.replVariables}async _onVariables(e){let t=this.findVariableStore(r=>r.hasVariable(e.variablesReference));return{variables:await(t==null?void 0:t.getVariables(e))??[]}}async _onReadMemory(e){var o;let t=e.memoryReference,r=await((o=this.findVariableStore(n=>n.hasMemory(t)))==null?void 0:o.readMemory(t,e.offset??0,e.count));return r?{address:"0",data:r.toString("base64"),unreadableBytes:e.count-r.length}:{address:"0",unreadableBytes:e.count}}async _onWriteMemory(e){var o;let t=e.memoryReference;return{bytesWritten:await((o=this.findVariableStore(n=>n.hasMemory(t)))==null?void 0:o.writeMemory(t,e.offset??0,Buffer.from(e.data,"base64")))}}async _onSetExpression(e){if(!this._thread)throw new I(og());let t=await this._thread.evaluate({expression:`${e.expression} = ${Wc(e.value)}`,context:"repl",frameId:e.frameId});return{value:t.result,variablesReference:t.variablesReference,indexedVariables:t.indexedVariables,namedVariables:t.namedVariables,presentationHint:t.presentationHint,type:t.type}}async _onSetVariable(e){let t=this.findVariableStore(r=>r.hasVariable(e.variablesReference));return t?(e.value=Wc(e.value.trim()),t.setVariable(e)):ge(gr.t("Variable not found"))}_withThread(e){if(!this._thread)throw new I(og());return e(this._thread)}async _refreshStackTrace(){if(!this._thread)return;this._thread.pausedDetails()&&await this._thread.refreshStackTrace()}createThread(e,t){this._thread=new hi(this.sourceContainer,e,this.dap,t,this._services.get(si),this._services.get(T),this._services.get(ur),this._services.get(Tu),this.launchConfig,this.breakpointManager,this._services.get(Ku),this._services.get(na),this._services.get(bi),this._services.get(ai));let r=this._services.get(sd);r.connect(this.dap,this._thread),"profileStartup"in this.launchConfig&&this.launchConfig.profileStartup&&r.start(this.dap,this._thread,{type:Xe.type});for(let o of this._customBreakpoints)this._thread.updateCustomBreakpoint(o,!0);return this.asyncStackPolicy.connect(e).then(o=>this._disposables.push(o)).catch(o=>this._services.get(T).error("internal","Error enabling async stacks",o)),this.breakpointManager.setThread(this._thread),this._services.get(Pe).attach(e),this._threadDeferred.resolve(this._thread),this._thread}async enableCustomBreakpoints(e){let t=[];for(let r of e.ids)this._customBreakpoints.add(r),this._thread&&t.push(this._thread.updateCustomBreakpoint(r,!0));return await Promise.all(t),{}}async _disableCustomBreakpoints(e){let t=[];for(let r of e.ids)this._customBreakpoints.delete(r),this._thread&&t.push(this._thread.updateCustomBreakpoint(r,!1));return await Promise.all(t),{}}async _toggleSkipFileStatus(e){return await this._services.get(oi).toggleSkippingFile(e),await this._refreshStackTrace(),{}}async _prettyPrintSource(e){if(!e.source)return{canPrettyPrint:!1};e.source.path=vt(e.source.path);let t=this.sourceContainer.source(e.source);if(!t)return ge(gr.t("Source not found"));let r=await t.prettyPrint();if(!r)return ge(gr.t("Unable to pretty print"));let{map:o,source:n}=r;return this.breakpointManager.moveBreakpoints(t,o,n),this.sourceContainer.clearDisabledSourceMaps(t),await this._refreshStackTrace(),{}}onEvaluate(e){return e.expression===".scripts"?this._dumpDiagnostics({fromSuggestion:!1}).then(this.dap.openDiagnosticTool).then(()=>({result:"Opening diagnostic tool...",variablesReference:0})):this._withThread(t=>t.evaluate(e))}async _dumpDiagnostics(e){let t={file:await this._services.get(vi).generateHtml()};return e.fromSuggestion&&this._services.get(nt).report("diagnosticPrompt",{event:"opened"}),t}async _requestCDPProxy(){return await this._cdpProxyProvider.proxy()}dispose(){this._disposables.dispose(),iu(this._services)}}});var eD,bS,tD,hS,wS,yS=m(()=>{"use strict";$e();j();eD={connect:async()=>ss},bS=i=>({async connect(e){return await e.Debugger.setAsyncCallStackDepth({maxDepth:i}),ss}}),tD=i=>{let e=new S,t=!1,r=()=>{t||(t=!0,e.fire())};return{async connect(o){if(t)return await o.Debugger.setAsyncCallStackDepth({maxDepth:i}),ss;let n=new O;return n.push(e.event(()=>{n.dispose(),o.Debugger.setAsyncCallStackDepth({maxDepth:i})}),o.Debugger.on("breakpointResolved",r),o.Debugger.on("paused",s=>{s.reason!=="instrumentation"&&r()})),n}}},hS=bS(32),wS=i=>i===!1?eD:i===!0?hS:"onAttach"in i?bS(i.onAttach):"onceBreakpointResolved"in i?tD(i.onceBreakpointResolved):hS});var vS,SS,ad,IS=m(()=>{"use strict";vS=require("inspector"),SS=require("fs"),ad=class{constructor(e){this.file=e;this.session=new vS.Session;this.session.connect()}async start(){try{await this.post("Profiler.enable")}catch{}await this.post("Profiler.start")}async stop(){let{profile:e}=await this.post("Profiler.stop");await SS.promises.writeFile(this.file,JSON.stringify(e))}dispose(){this.session.disconnect()}post(e,t){return new Promise((r,o)=>this.session.post(e,t,(n,s)=>{n?o(n):r(s)}))}}});var Cp,PS,Of=m(()=>{"use strict";j();Cp=Symbol("MutableLaunchConfig"),PS=i=>{let e=new S;return new Proxy({},{ownKeys(){return Object.keys(i)},get(t,r){switch(r){case"update":return o=>{i=o,e.fire()};case"onChange":return e.event;default:return i[r]}}})}});var xp,cd,CS=m(()=>{"use strict";xp=class{toDap(){return{category:"console",output:"\x1B[2J"}}},cd=class{toDap(){return{category:"stdout",output:"",group:"end"}}}});var pd,xS,kS,TS,Nf,RS=m(()=>{"use strict";j();pd=class{constructor(e){this.sink=e;this.q=[];this.disposed=!1;this.onDrainedEmitter=new S;this.onDrained=this.onDrainedEmitter.event}get length(){return this.q.length}enqueue(e){this.disposed||(this.q.push(new Nf(e)),this.q.length===1&&this.process())}dispose(){this.disposed=!0,this.q=[]}async process(){let e=this.q.findIndex(t=>t.value===kS);e===0?await this.q[0].wait:e===-1?(this.sink(xS(this.q)),this.q=[]):(this.sink(xS(this.q.slice(0,e))),this.q=this.q.slice(e)),this.q.length?this.process():this.onDrainedEmitter.fire()}},xS=i=>i.map(e=>e.value).filter(e=>e!==TS),kS=Symbol("unsettled"),TS=Symbol("unsettled"),Nf=class{constructor(e){this.value=kS;e instanceof Promise?this.wait=e.then(t=>{this.value=t},()=>{this.value=TS}):(this.value=e,this.wait=Promise.resolve())}}});var kp,rD,ca,DS=m(()=>{"use strict";kp=require("inversify");M();qr();sp();CS();RS();If();rD=new Set(["group","assert","count"]),ca=class{constructor(e,t){this.dap=e;this.isDirty=!1;this.queue=new pd(e=>{for(let t of e)this.dap.output(t)});this.onDrained=this.queue.onDrained;t.register(0,async()=>{this.length&&await new Promise(r=>this.onDrained(r)),this.dispose()})}get length(){return this.queue.length}dispose(){this.queue.dispose()}dispatch(e,t){let r=this.parse(t);r&&this.enqueue(e,r)}enqueue(e,t){if(!(t instanceof xp))this.isDirty=!0;else if(this.isDirty)this.isDirty=!1;else return;this.queue.enqueue(t.toDap(e))}parse(e){var t;if(e.type==="log"){let r=(t=e.stackTrace)==null?void 0:t.callFrames[0];if(r&&r.url==="internal/console/constructor.js"&&rD.has(r.functionName))return}switch(e.type){case"clear":return new xp;case"endGroup":return new cd;case"assert":return new $u(e);case"table":return new Ju(e);case"startGroup":case"startGroupCollapsed":return new Gu(e);case"debug":case"log":case"info":return new wi(e);case"trace":return new qu(e);case"error":return new zu(e);case"warning":return new Hu(e);case"dir":case"dirxml":return new wi(e);case"count":return new wi(e);case"profile":case"profileEnd":return new wi(e);case"timeEnd":return new wi(e);default:try{Il(e.type,"unknown console message type")}catch{}}}};ca=h([(0,kp.injectable)(),d(0,(0,kp.inject)(sr)),d(1,(0,kp.inject)(ai))],ca)});var _S,LS,Uf=m(()=>{"use strict";_S=(i,e,t)=>{e=e.toLowerCase();let r=i==null?void 0:i[e];return{...i,[e]:r?r instanceof Array?r.concat(t):[r,t]:t}},LS=(i,e)=>{let t=i;for(let[r,o]of Object.entries(e))typeof o=="object"&&o?t[r]=Object.assign(t[r]||{},o):t[r]=o}});var AS,Pi,Vf=m(()=>{"use strict";AS=require("inversify");Uf();Pi=class{constructor(){this.cdp=[]}attach(e){return this.cdp.push({cdp:e,enabledNetwork:!1}),{dispose:()=>{this.cdp=this.cdp.filter(t=>t.cdp!==e)}}}async apply(e,t){let r=this.cdp[0];return r&&(t=await this.applyCookies(r,e,t)),t}async applyCookies(e,t,r){var n;e.enabledNetwork||(e.enabledNetwork=!0,await e.cdp.Network.enable({}));let o=await e.cdp.Network.getCookies({urls:[t]});return(n=o==null?void 0:o.cookies)!=null&&n.length?_S(r,"Cookie",o.cookies.sort((s,a)=>s.path.length-a.path.length).map(s=>`${s.name}=${s.value}`).join("; ")):r}};Pi=h([(0,AS.injectable)()],Pi)});var pa,ld=m(()=>{"use strict";pa=Symbol("IRequestOptionsProvider")});var ES,FS,ud,xn,Bt,dd=m(()=>{"use strict";ES=w(require("data-uri-to-buffer")),FS=require("dns"),ud=w(require("got")),xn=require("inversify");Nc();Ve();$e();B();G();ld();Bt=class{constructor(e,t){this.fs=e;this.options=t;this.autoLocalhostPortFallbacks={}}async fetch(e,t=Be,r){try{let n=(0,ES.default)(e);return{ok:!0,url:e,body:n.toString("utf-8"),statusCode:200}}catch{}let o=ft(e)?e:Se(e);if(o)try{return{ok:!0,url:e,body:await this.fs.readFile(o,"utf-8"),statusCode:200}}catch(n){return{ok:!1,url:e,error:n,statusCode:200}}return this.fetchHttp(e,t,r)}async fetchJson(e,t,r){let o=await this.fetch(e,t,{Accept:"application/json",...r});if(!o.ok)return o;try{return{...o,body:JSON.parse(o.body)}}catch(n){return{...o,ok:!1,url:e,error:n}}}async fetchHttp(e,t,r){var u;let o=new URL(e),n=o.protocol!=="http:",s=Number(o.port)??(n?443:80),a={headers:r,followRedirect:!0};n&&await Ps(e)&&(a.rejectUnauthorized=!1),(u=this.options)==null||u.provideOptions(a,e);let c=o.hostname==="localhost";if(c&&this.autoLocalhostPortFallbacks[s]){let f=await this.requestHttp(o.toString(),a,t);return f.statusCode!==503?f:(delete this.autoLocalhostPortFallbacks[s],this.requestHttp(e,a,t))}let l=await this.requestHttp(e,a,t);if(l.statusCode===503&&c){let f;try{f=await FS.promises.lookup(o.hostname)}catch{return l}o.hostname=f.family===6?"127.0.0.1":"[::1]",l=await this.requestHttp(o.toString(),a,t),l.statusCode!==503&&(this.autoLocalhostPortFallbacks[s]=o.hostname)}return l}async requestHttp(e,t,r){var n,s,a;(n=this.options)==null||n.provideOptions(t,e);let o=new O;try{let c=(0,ud.default)(e,t);o.push(r.onCancellationRequested(()=>c.cancel()));let p=await c;return{ok:!0,url:e,body:p.body,statusCode:p.statusCode}}catch(c){if(!(c instanceof ud.RequestError))throw c;let p=c.response?String((s=c.response)==null?void 0:s.body):c.message,l=((a=c.response)==null?void 0:a.statusCode)??503;return{ok:!1,body:p,statusCode:l,url:e,error:new Bl(l,e,p)}}finally{o.dispose()}}};Bt=h([(0,xn.injectable)(),d(0,(0,xn.inject)(z)),d(1,(0,xn.optional)()),d(1,(0,xn.inject)(pa))],Bt)});var Xr,kn,MS=m(()=>{"use strict";Xr=require("inversify");He();$e();G();dd();ld();Vf();kn=class extends Bt{constructor(t,r,o,n){super(t,n);this.state=r;this.disposables=new O;o&&this.disposables.push(this.state.attach(o))}dispose(){this.disposables.dispose()}async fetchHttp(t,r,o={}){let n=await super.fetchHttp(t,r,o);if(!n.ok){let s=await this.state.apply(t,o);if(s!==o)return await super.fetchHttp(t,r,s)}return n}};kn=h([(0,Xr.injectable)(),d(0,(0,Xr.inject)(z)),d(1,(0,Xr.inject)(Pi)),d(2,(0,Xr.optional)()),d(2,(0,Xr.inject)(_e)),d(3,(0,Xr.optional)()),d(3,(0,Xr.inject)(pa))],kn)});var Ci,Wf=m(()=>{"use strict";Ci="node:"});function jS(i){let e=[];for(let t=0;t<i.length;t++){let r=i[t];if(r.startsWith("!")){let o=BS(r.slice(1));for(let n=0;n<e.length;n++)e[n]=`^(?!${o.slice(1)})${e[n].slice(1)}`}else e.push(BS(r))}return e.map(t=>new RegExp(t,"i"))}function BS(i){let e=i.split("/"),t=[];for(let r=0;r<e.length;r++){let o=e[r];if(o==="**")r===0?t.push("(.+/)?"):r===e.length-1||t.push(".*/");else{if(o.includes("*")){let n=o.split("*");t.push(n.map(s=>ot(s)).join("[^\\/]*"))}else t.push(ot(o));t.push(r<e.length-1?"\\/":"$")}}return`^${t.join("")}`}var OS=m(()=>{"use strict";xr()});function oD(i){let e=/^<node_internals>[\/\\](.*)$/,t=i.map(r=>{r=r.trim();let o=e.exec(r);return o?o[1]:null}).filter(Fe);return t.length>0?t:void 0}function iD(i,e){return e.filter(r=>!r.includes("<node_internals>")).map(r=>ft(r)?Cs(i.rebaseLocalToRemote(r)):E(r)).map(Jl)}function US(i){let e=i.parent();return e?US(e):i}var xi,NS,Zr,VS=m(()=>{"use strict";xi=require("inversify"),NS=w(require("micromatch"));He();ls();j();L();Wf();M();Z();U();Rt();xr();B();H();vn();Ht();Je();OS();Zr=class{constructor({skipFiles:e},t,r,o,n){this.logger=r;this.cdp=o;this._regexForAuthored=jb(jS);this._scriptsWithSkipping=new Set;this._targetId=n.id(),this._rootTargetId=US(n).id(),this._isUrlFromSourceMapSkipped=new dt(s=>this._normalizeUrl(s)),this._authoredGlobs=iD(t,e),this._nodeInternalsGlobs=oD(e),this._initNodeInternals(n),this._updateSkippedDebounce=Nb(500,()=>this._updateGeneratedSkippedSources()),e.length&&this._updateGeneratedSkippedSources(),Zr.sharedSkipsEmitter.event(s=>{s.rootTargetId===this._rootTargetId&&s.targetId!==this._targetId&&this._toggleSkippingFile(s.params)})}setSourceContainer(e){this._sourceContainer=e}_testSkipNodeInternal(e){return this._nodeInternalsGlobs?(e.startsWith(Ci)&&(e=e.slice(Ci.length)),(0,NS.default)([e],this._nodeInternalsGlobs).length>0):!1}_testSkipAuthored(e){return this._regexForAuthored(this._authoredGlobs).some(t=>t.test(e))}_isNodeInternal(e,t){return e.startsWith(Ci)?!0:(t==null?void 0:t.has(e))||/^internal\/.+\.js$/.test(e)}async _updateGeneratedSkippedSources(){var r;let e=this._regexForAuthored(this._authoredGlobs).map(o=>o.source),t=(r=this._allNodeInternals)==null?void 0:r.settledValue;if(t){e.push(`^(${Ci})?internal\\/`);for(let o of t)this._testSkipNodeInternal(o)&&e.push(`^(${Ci})?${ot(o)}$`)}await this.cdp.Debugger.setBlackboxPatterns({patterns:e})}_normalizeUrl(e){return E(e.toLowerCase())}isScriptSkipped(e){var t;return this._isNodeInternal(e,(t=this._allNodeInternals)==null?void 0:t.settledValue)?this._testSkipNodeInternal(e):(e=this._normalizeUrl(e),this._isUrlFromSourceMapSkipped.get(e)===!0?!0:this._testSkipAuthored(e))}async _updateSourceWithSkippedSourceMappedSources(e,t){let r=this.isScriptSkipped(e.url),o=[],n=r;Array.from(e.sourceMap.sourceByUrl.values()).forEach(a=>{let c=this.isScriptSkipped(a.url);if(typeof c>"u"&&(c=r),c!==n){let p=this._sourceContainer.currentSiblingUiLocations({source:a,lineNumber:1,columnNumber:1},e);p[0]?(o.push({lineNumber:p[0].lineNumber-1,columnNumber:p[0].columnNumber-1}),n=!n):this.logger.error("internal","Could not map script beginning for "+a.sourceReference)}});let s=t;o.length||(s=s.filter(a=>this._scriptsWithSkipping.has(a.scriptId)),s.forEach(a=>this._scriptsWithSkipping.delete(a.scriptId))),await Promise.all(s.map(({scriptId:a})=>this.cdp.Debugger.setBlackboxedRanges({scriptId:a,positions:o})))}initializeSkippingValueForSource(e){this._initializeSkippingValueForSource(e)}_initializeSkippingValueForSource(e,t=e.scripts){let r=e.url,o=this.isScriptSkipped(r);if(!o&&e.absolutePath&&this._testSkipAuthored(W(e.absolutePath))&&(this.setIsUrlBlackboxSkipped(r,!0),o=!0,this._updateSkippedDebounce()),St(e)){if(o)for(let n of e.sourceMap.sourceByUrl.values())this._isUrlFromSourceMapSkipped.set(n.url,!0);for(let n of e.sourceMap.sourceByUrl.values())this._initializeSkippingValueForSource(n,t);this._updateSourceWithSkippedSourceMappedSources(e,t)}}async _initNodeInternals(e){if(e.type()!=="node"||!this._nodeInternalsGlobs||this._allNodeInternals)return;let t=this._allNodeInternals=le(),r=await this.cdp.Runtime.evaluate({expression:"require('module').builtinModules"+Re(),returnByValue:!0,includeCommandLineAPI:!0});r&&!r.exceptionDetails?t.resolve(new Set(r.result.value.map(o=>o+".js"))):t.resolve(new Set),await this._updateGeneratedSkippedSources()}async _toggleSkippingFile(e){let t;e.resource&&ft(e.resource)&&(t=e.resource);let r={path:t,sourceReference:e.sourceReference},o=this._sourceContainer.source(r);if(!o)return{};let n=!this.isScriptSkipped(o.url);if(o instanceof qe){this._isUrlFromSourceMapSkipped.set(o.url,n);let s=Array.from(o.compiledToSourceUrl.keys());await Promise.all(s.map(a=>this._updateSourceWithSkippedSourceMappedSources(a,a.scripts)))}else{if(St(o))for(let s of o.sourceMap.sourceByUrl.values())this._isUrlFromSourceMapSkipped.set(s.url,n);this.setIsUrlBlackboxSkipped(o.url,n),await this._updateGeneratedSkippedSources()}return{}}setIsUrlBlackboxSkipped(e,t){let r=e,o=`!${r}`,n=this._authoredGlobs.filter(s=>s!==r&&s!==o);this._regexForAuthored(n).some(s=>s.test(e))!==t&&(n.push(t?r:o),this._regexForAuthored.clear()),this._authoredGlobs=n}async toggleSkippingFile(e){let t=await this._toggleSkippingFile(e);return Zr.sharedSkipsEmitter.fire({params:e,rootTargetId:this._rootTargetId,targetId:this._targetId}),t}};Zr.sharedSkipsEmitter=new S,Zr=h([(0,xi.injectable)(),d(0,(0,xi.inject)(ie)),d(1,(0,xi.inject)(fe)),d(2,(0,xi.inject)(T)),d(3,(0,xi.inject)(_e)),d(4,(0,xi.inject)(yi))],Zr)});var Tp,$S,WS,nD,la,ki,Rp=m(()=>{"use strict";Tp=require("inversify");cp();Fs();M();$S=require("path"),WS=/^webpack:\/{3}([^/]+?\.vue)(\?[0-9a-z]*)?$/i,nD=/^webpack:\/{3}\.\/.+\.vue\?[0-9a-z]+$/i,la=Symbol("IVueFileMapper"),ki=class{constructor(e,t){this.files=e;this.search=t;this.getMapping=N(async()=>{let e=new Map;return await this.search.streamAllChildren(this.files,t=>e.set((0,$S.basename)(t),t)),e})}async lookup(e){let t=WS.exec(e);return t?(await this.getMapping()).get(t[1]):void 0}getVueHandling(e){return this.files.empty?0:WS.test(e)?1:nD.test(e)?2:0}};ki=h([(0,Tp.injectable)(),d(0,(0,Tp.inject)(Po)),d(1,(0,Tp.inject)(Ms))],ki)});var eo,Dp=m(()=>{"use strict";j();eo=class{constructor(){this.changeEmitter=new S;this.addEmitter=new S;this.removeEmitter=new S;this.targetMap=new Map;this.onChanged=this.changeEmitter.event;this.onAdd=this.addEmitter.event;this.onRemove=this.removeEmitter.event}get size(){return this.targetMap.size}add(e,t){this.targetMap.set(e,t),this.addEmitter.fire([e,t]),this.changeEmitter.fire()}get(e){return this.targetMap.get(e)}remove(e){let t=this.targetMap.get(e);return t===void 0?!1:(this.targetMap.delete(e),this.removeEmitter.fire([e,t]),this.changeEmitter.fire(),!0)}value(){return this.targetMap.values()}}});function md(i,e,t){return new Promise((r,o)=>{let n=(0,qS.spawn)(i,e,{...t,stdio:"pipe"}),s=[],a=[];n.stderr.on("data",p=>s.push(p)),n.stdout.on("data",p=>a.push(p));let c=(p,l)=>o(new To(i,Buffer.concat(s).toString(),Buffer.concat(a).toString(),p,l));n.on("error",p=>c(void 0,p)),n.on("close",p=>p?c(p):r({stdout:Buffer.concat(a).toString(),stderr:Buffer.concat(s).toString()}))})}var qS,To,gd=m(()=>{"use strict";qS=require("child_process"),To=class extends Error{constructor(t,r,o,n,s){super(`${t} exited with code ${n||-1}: ${r}`);this.command=t;this.stderr=r;this.stdout=o;this.code=n;this.innerError=s}static fromExeca(t){return new To(t.command,t.stderr.toString(),t.stdout.toString(),t.exitCode)}}});var zS,fd,sD,HS,ua,Ti,_p=m(()=>{"use strict";zS=w(require("default-browser")),fd=require("inversify");G();gd();M();sD=new Map([["chrome",0],["safari",1],["firefox",2],["msedge",3],["microsoft edge",3],["appxq0fevzme2pys62n3e0fbqa7peapykr8v",4],["ie.http",5]]),HS=i=>{i=i.toLowerCase();for(let[e,t]of sD.entries())if(i.includes(e))return t},ua=Symbol("IDefaultBrowserProvider"),Ti=class{constructor(e,t=process.platform){this.execa=e;this.platform=t;this.lookup=N(()=>this.platform==="win32"?this.lookupWindows():this.lookupUnix())}async lookupUnix(){let{name:e}=await(0,zS.default)();return HS(e)}async lookupWindows(){let e=await this.execa("reg",["QUERY"," HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice","/v","ProgId"]);if(e.failed)throw To.fromExeca(e);let t=/ProgId\s*REG_SZ\s*(\S+)/.exec(e.stdout);if(t)return HS(t[1])}};Ti=h([(0,fd.injectable)(),d(0,(0,fd.inject)(ep))],Ti)});var hd,GS=m(()=>{"use strict";L();hd=class{async setup(){}dispose(){}write(e){if(e.level>2)throw new Error(e.message);console.log(JSON.stringify(e))}}});var JS,bd,qf,A,aD,_r=m(()=>{"use strict";JS=require("inversify"),bd=w(require("os"));L();H();GS();qf=class{constructor(e=512){this.size=e;this.items=[];this.i=0}write(e){this.items[this.i]=e,this.i=(this.i+1)%this.size}read(){return this.items.slice(this.i).concat(this.items.slice(0,this.i))}},A=class{constructor(){this.logTarget={queue:[]};this.logBuffer=new qf}static async test(){let e=new A;return e.setup({sinks:[new hd],showWelcome:!1}),e}info(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:1})}verbose(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:0})}warn(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:2})}error(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:3})}fatal(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:4})}assert(e,t){if(e===!1||e===void 0||e===null){if(this.error("runtime.assertion",t,{error:new Error("Assertion failed")}),process.env.JS_DEBUG_THROW_ASSERTIONS)throw new Error(t);debugger;return!1}return!0}log(e){if(this.logBuffer.write(e),"queue"in this.logTarget){this.logTarget.queue.push(e);return}for(let t of this.logTarget.sinks)t.write(e)}getRecentLogs(){return this.logBuffer.read()}dispose(){if("sinks"in this.logTarget){for(let e of this.logTarget.sinks)e.dispose();this.logTarget={queue:[]}}}forTarget(){return this}async setup(e){if(await Promise.all(e.sinks.map(r=>r.setup())),e.showWelcome!==!1){let r=aD();for(let o of e.sinks)o.write(r)}let t=this.logTarget;this.logTarget={sinks:e.sinks.slice()},"sinks"in t?t.sinks.forEach(r=>r.dispose()):t.queue.forEach(r=>this.log(r))}};A.null=(()=>{let e=new A;return e.setup({sinks:[]}),e})(),A=h([(0,JS.injectable)()],A);aD=()=>({timestamp:Date.now(),tag:"runtime.welcome",level:1,message:`${tu} v${on} started`,metadata:{os:`${bd.platform()} ${bd.arch()}`,nodeVersion:process.version,adapterVersion:on}})});var da,Ri,Hf=m(()=>{"use strict";da=Symbol("touched");(c=>{function i(){return{children:{},[da]:1}}c.root=i;function e(p,l){return a(p,s(l),0)}c.getPath=e;function t(p){p[da]=1}c.touch=t;function r(p){p[da]=2}c.touchAll=r;function o(p,l){let u=p.children[l]??={children:{}};return u[da]=1,u}c.getOrMakeChild=o;function n(p){if(p[da]){for(let[l,u]of Object.entries(p.children))switch(u[da]){case 1:n(u);break;case 2:break;default:delete p.children[l]}return p}}c.prune=n;function s(p){let l=p.split(/\/|\\/);return l[0]===""&&l.unshift(),l}function a(p,l,u){let f=o(p,l[u]);return u===l.length-1?f:a(f,l,u+1)}})(Ri||={})});var zf,Gf,Tn,KS,cD,wd,QS=m(()=>{"use strict";zf=require("fs"),Gf=w(require("micromatch")),Tn=require("path"),KS=w(require("to-absolute-glob"));j();M();Z();Hf();cD=/\//g,wd=class{constructor(e){this.stat=bo(e=>zf.promises.lstat(e));this.readdir=bo(e=>zf.promises.readdir(e,{withFileTypes:!0}));this.alreadyProcessedFiles=new Set;this.fileEmitter=new S;this.onFile=this.fileEmitter.event;this.errorEmitter=new S;this.onError=this.errorEmitter.event;this.processor=e.fileProcessor,this.filter=e.filter,this.ignore=e.ignore.map(o=>Gf.default.matcher((0,KS.default)(E(o),{cwd:e.cwd})));let t=(0,Tn.isAbsolute)(e.pattern)?(0,Tn.relative)(e.cwd,e.pattern):e.pattern,r=Gf.default.parse(E(t),{ignore:e.ignore,cwd:e.cwd,expand:!0});this.done=Promise.all(r.map(o=>{let n=[];for(let p=1;p<o.tokens.length;){let l=p+1;for(;l<o.tokens.length&&o.tokens[l].type!=="slash";)l++;let u=o.tokens[p];u.type==="globstar"?n.push("**"):l===p+1&&u.type==="text"?n.push(u.value):n.push(new RegExp("^"+o.tokens.slice(p,l).map(f=>f.output||f.value).join("")+"$")),p=l+1}let s=n[0]==="**"?[0,1]:[0],a=Ri.getPath(e.cache,e.cwd),c={elements:n,seen:new Set};return Promise.all(s.map(p=>this.readSomething(c,p,e.cwd,a)))})).then(()=>{})}async readSomething(e,t,r,o){if(this.alreadyProcessedFiles.has(o))return;let n=`${t}:${r}`;if(e.seen.has(n))return;e.seen.add(n);let s;try{s=await this.stat(r)}catch(c){this.errorEmitter.fire({path:r,error:c});return}if(this.alreadyProcessedFiles.has(o))return;let a=o.data;if(a&&s.mtimeMs===a.mtime){if(a.type===0){let c=[];for(let[p,l]of Object.entries(o.children))c.push(l.data!==void 0?this.handleDirectoryEntry(e,t,r,{name:p,type:l.data.type},o):this.stat(r).then(u=>this.handleDirectoryEntry(e,t,r,{name:p,type:u.isFile()?1:0},o),()=>{}));await Promise.all(c)}else a.type===1&&(this.alreadyProcessedFiles.add(o),this.fileEmitter.fire(a.extracted));return}s.isDirectory()?await this.handleDir(e,t,s.mtimeMs,r,o):(this.alreadyProcessedFiles.add(o),await this.handleFile(s.mtimeMs,r,o))}applyFilterToFile(e,t,r){var s;let o=r.children[e];if(this.alreadyProcessedFiles.has(o))return!1;if(!this.filter)return!0;let n=((s=o.data)==null?void 0:s.type)===1?o.data.extracted:void 0;return Ri.touch(o),this.filter(t,n)}handleDirectoryEntry(e,t,r,o,n){let s=r+"/"+o.name,a=this.getDirectoryReadDescends(e,t,r,o);if(a===void 0)return;let c=Ri.getOrMakeChild(n,o.name);if(!(o.type===1&&!this.applyFilterToFile(o.name,s,n)))return typeof a=="number"?this.readSomething(e,t+a,s,c):Promise.all(a.map(p=>this.readSomething(e,t+p,s,c)))}getDirectoryReadDescends(e,t,r,o){let n=r+"/"+o.name;if(this.ignore.some(c=>c(n)))return;let s=t===e.elements.length-1,a=e.elements[t];if(a==="**")return o.type===1?s?0:this.getDirectoryReadDescends(e,t+1,r,o):s?0:[0,1];if((a instanceof RegExp&&a.test(o.name)||a===o.name)&&(o.type===0?!s:s))return 1}async handleFile(e,t,r){let o=Tn.sep==="/"?t:t.replace(cD,Tn.sep),n;try{n=await this.processor(o)}catch(s){this.errorEmitter.fire({path:o,error:s});return}r.data={type:1,mtime:e,extracted:n},this.fileEmitter.fire(n)}async handleDir(e,t,r,o,n){let s;try{s=await this.readdir(o)}catch(c){this.errorEmitter.fire({path:o,error:c});return}let a=[];for(let c of s){if(c.name.startsWith("."))continue;let p;if(c.isDirectory())p=0;else if(c.isFile())p=1;else continue;a.push(this.handleDirectoryEntry(e,t,o,{name:c.name,type:p},n))}await Promise.all(a),n.data={type:0,mtime:r}}}});var YS,yd,Di,Jf=m(()=>{"use strict";YS=w(require("glob-stream")),yd=require("inversify");L();M();Z();Hf();cp();QS();Di=class{constructor(e){this.logger=e}async streamAllChildren(e,t){let r=[];return await this.globForFiles(e,n=>r.push(t(K(n.path)))),(await Promise.all(r)).filter(n=>n!==void 0)}async streamChildrenWithSourcemaps(e){let t=[],r=e.lastState||{},o={};return await Promise.all([...e.files.explode()].map(async s=>{let a=JSON.stringify(s),c=r[a]||Ri.root();await this._streamChildrenWithSourcemaps(c,e,t,s);let p=Ri.prune(c);p&&(o[a]=p)})),this.logger.info("sourcemap.parsing",`turboGlobStream search found ${t.length} files`),{values:(await Promise.all(t)).filter(Fe),state:o}}async _streamChildrenWithSourcemaps(e,t,r,o){let n=new wd({pattern:o.pattern,ignore:o.negations,cwd:o.cwd,cache:e,filter:t.filter,fileProcessor:s=>Ry(s).then(a=>a&&t.processMap(a))});n.onError(({path:s,error:a})=>{this.logger.warn("sourcemap.parsing","Error parsing source map",{error:a,path:s})}),n.onFile(s=>s&&r.push(t.onProcessedMap(s))),await n.done}async globForFiles(e,t){await Promise.all([...e.explode()].map(r=>new Promise((o,n)=>(0,YS.default)([r.pattern,"!**/*.asar/**"],{ignore:r.negations,matchBase:!0,cwd:r.cwd}).on("data",t).on("finish",o).on("error",n))))}};Di=h([(0,yd.injectable)(),d(0,(0,yd.inject)(T))],Di)});function Kf(i,e){return i.length<=e?i:i.substr(0,e-1)+"\u2026"}function pD(i){let e;try{e=new XS.URL(i)}catch{return Kf(i,20)}if(e.protocol==="data")return Kf(i,20);if(e.protocol==="blob"||i==="about:blank")return i;let t=ZS.basename(e.pathname);return t||(t=(e.host||"")+"/"),t==="/"&&(t=Kf(i,20)),t}var XS,ZS,vd,Qf,eI=m(()=>{"use strict";XS=require("url"),ZS=w(require("path"));j();vd=class{constructor(){this._onFrameAddedEmitter=new S;this._onFrameRemovedEmitter=new S;this._onFrameNavigatedEmitter=new S;this.onFrameAdded=this._onFrameAddedEmitter.event;this.onFrameRemoved=this._onFrameRemovedEmitter.event;this.onFrameNavigated=this._onFrameNavigatedEmitter.event;this._frames=new Map}attached(e,t){e.Page.enable({}),e.Page.getResourceTree({}).then(r=>{this._processCachedResources(e,r?r.frameTree:void 0,t)})}mainFrame(){return this._mainFrame}_processCachedResources(e,t,r){t&&this._addFramesRecursively(e,t,t.frame.parentId,r),e.Page.on("frameAttached",o=>{this._frameAttached(e,r,o.frameId,o.parentFrameId)}),e.Page.on("frameNavigated",o=>{this._frameNavigated(e,r,o.frame)}),e.Page.on("frameDetached",o=>{this._frameDetached(e,r,o.frameId)})}_addFrame(e,t,r){let o=new Qf(this,e,t,r);return this._frames.set(o.id,o),o.isMainFrame()&&(this._mainFrame=o),this._onFrameAddedEmitter.fire(o),o}_frameAttached(e,t,r,o){let n=this._frames.get(r);return n||(n=this._addFrame(e,r,o)),n._ref(t),n}_frameNavigated(e,t,r){let o=this._frames.get(r.id);o||(o=this._frameAttached(e,t,r.id,r.parentId)),o._navigate(r,t),this._onFrameNavigatedEmitter.fire(o)}_frameDetached(e,t,r){let o=this._frames.get(r);o&&o._unref(t)}frameForId(e){return this._frames.get(e)}frames(){return Array.from(this._frames.values())}_addFramesRecursively(e,t,r,o){let n=t.frame,s=this._frames.get(n.id);s?(s._navigate(n,o),this._onFrameNavigatedEmitter.fire(s)):(s=this._addFrame(e,n.id,r),s._navigate(n,o));for(let a=0;t.childFrames&&a<t.childFrames.length;++a)this._addFramesRecursively(e,t.childFrames[a],s.id,o)}},Qf=class{constructor(e,t,r,o){this._targets=new Set;this.cdp=t,this.model=e,this._parentFrameId=o,this.id=r,this._url=""}_ref(e){this._targets.add(e)}_navigate(e,t){this._name=e.name,this._url=e.url,this._securityOrigin=e.securityOrigin,this._unreachableUrl=e.unreachableUrl||"",this._ref(t),this._unrefChildFrames(t)}name(){return this._name||""}url(){return this._url}securityOrigin(){return this._securityOrigin}unreachableUrl(){return this._unreachableUrl}isMainFrame(){return!this._parentFrameId}parentFrame(){return this._parentFrameId?this.model.frameForId(this._parentFrameId):void 0}childFrames(){return this.model.frames().filter(e=>e._parentFrameId===this.id)}_unrefChildFrames(e){for(let t of this.childFrames())t._unref(e)}_unref(e){this._targets.delete(e),!this._targets.size&&(this._unrefChildFrames(e),this.model._frames.delete(this.id),this.model._onFrameRemovedEmitter.fire(this))}displayName(){return this._name?this._name:pD(this._url)||`<iframe ${this.id}>`}}});var tI,Yf,Xf,_i,Lp,rI=m(()=>{"use strict";j();tI=require("url"),Yf=class{constructor(e){this.versions=new Map;this.id=e.registrationId,this.scopeURL=e.scopeURL}},Xf=class{constructor(e,t){this.revisions=[];this.registration=e,this.id=t.versionId,this.scriptURL=t.scriptURL,this._targetId=t.targetId,this._status=t.status,this._runningStatus=t.runningStatus}addRevision(e){this._targetId&&e.targetId&&this._targetId!==e.targetId&&console.error(`${this._targetId} !== ${e.targetId}`),e.targetId&&(this._targetId=e.targetId),this._status=e.status,this._runningStatus=e.runningStatus,this.revisions.unshift(e)}status(){return this._status}runningStatus(){return this._runningStatus}targetId(){return this._targetId}label(){let e=new tI.URL(this.registration.scopeURL),t=e.pathname.substr(1);t.endsWith("/")&&(t=t.substring(0,t.length-1));let r=t||`${e.host}`,o=this._status==="activated"?"":` ${this._status}`,n=this._runningStatus==="running"?"":` ${this._runningStatus}`;return`${r} #${this.id}${o}${n}`}},_i=class{constructor(e){this._registrations=new Map;this._versions=new Map;this._onDidChangeUpdater=new S;this.onDidChange=this._onDidChangeUpdater.event;this._targets=new Set;this._frameModel=e,_i._instances.add(this)}dispose(){_i._instances.delete(this)}attached(e){this._targets.add(e),!this._cdp&&(this._cdp=e,e.ServiceWorker.enable({}),e.ServiceWorker.on("workerRegistrationUpdated",t=>this._workerRegistrationsUpdated(t.registrations)),e.ServiceWorker.on("workerVersionUpdated",t=>this._workerVersionsUpdated(t.versions)),_i._mode!=="normal"&&this.setMode(_i._mode))}async detached(e){this._targets.delete(e)}version(e){return this._versions.get(e)}registrations(){let e=[],t=this._frameModel.frames().map(r=>r.url());for(let r of this._registrations.values())for(let o of t)if(o.startsWith(r.scopeURL)){e.push(r);break}return e}registration(e){return this._registrations.get(e)}_workerVersionsUpdated(e){for(let t of e){let r=this._registrations.get(t.registrationId);if(!r)continue;let o=r.versions.get(t.versionId);o||(o=new Xf(r,t),r.versions.set(t.versionId,o)),t.targetId&&this._versions.set(t.targetId,o),o.addRevision(t),o.status()==="redundant"&&o.runningStatus()==="stopped"&&(t.targetId&&this._versions.delete(t.targetId),r.versions.delete(o.id))}this._onDidChangeUpdater.fire()}_workerRegistrationsUpdated(e){for(let t of e)if(t.isDeleted){if(!this._registrations.has(t.registrationId))debugger;this._registrations.delete(t.registrationId)}else{if(this._registrations.has(t.registrationId))return;this._registrations.set(t.registrationId,new Yf(t))}this._onDidChangeUpdater.fire()}static setModeForAll(e){_i._mode=e;for(let t of _i._instances)t.setMode(e)}setMode(e){if(this._cdp){this._cdp.ServiceWorker.setForceUpdateOnPageLoad({forceUpdateOnPageLoad:e==="force"});for(let t of this._targets.values())e==="bypass"?(t.Network.enable({}),t.Network.setBypassServiceWorker({bypass:!0})):t.Network.disable({})}}async stopWorker(e){if(!this._cdp)return;let t=this.version(e);t&&await this._cdp.ServiceWorker.stopWorker({versionId:t.id})}},Lp=_i;Lp._instances=new Set});var Li,Sd=m(()=>{"use strict";j();L();Ko();eI();rI();Li=class{constructor(e,t,r,o,n,s,a,c){this.process=t;this.logger=n;this.telemetry=s;this.launchParams=a;this._targets=new Map;this._detachedTargets=new Set;this.frameModel=new vd;this.serviceWorkerModel=new Lp(this.frameModel);this._lifecycleQueue=Promise.resolve();this._onTargetAddedEmitter=new S;this._onTargetRemovedEmitter=new S;this.onTargetAdded=this._onTargetAddedEmitter.event;this.onTargetRemoved=this._onTargetRemovedEmitter.event;this._connection=e,this._sourcePathResolver=o,this._browser=r,this._targetOrigin=c,this.serviceWorkerModel.onDidChange(()=>{for(let p of this._targets.values())p.type()==="service_worker"&&p._onNameChangedEmitter.fire()})}static async connect(e,t,r,o,n,s,a){let p=await e.rootSession().Target.attachToBrowserTarget({});if(!p)return;let l=e.createSession(p.sessionId);return new this(e,t,l,r,n,s,o,a)}dispose(){this.serviceWorkerModel.dispose()}targetList(){return Array.from(this._targets.values()).filter(e=>qc.has(e.type()))}async getCandiateInfo(e){let t=await this._browser.Target.getTargets({});return t?e?t.targetInfos.filter(e):t.targetInfos:[]}async closeBrowser(){var e;if(this.launchParams.request==="launch"){if(this.launchParams.cleanUp==="wholeBrowser")await this._browser.Browser.close({}),(e=this.process)==null||e.kill();else for(let t of this._targets.values())await this._browser.Target.closeTarget({targetId:t.targetId}),this._connection.close();this.process=void 0}}waitForMainTarget(e){let t,r=new Promise(n=>t=n),o=async n=>{if([...this._targets.values()].some(c=>c.targetId===n.targetId)||this._detachedTargets.has(n.targetId)||e&&!e(n))return;let s=this._browser.Target.on("targetInfoChanged",c=>{c.targetInfo.targetId===n.targetId&&(n=c.targetInfo)}),a;try{a=await this._browser.Target.attachToTarget({targetId:n.targetId,flatten:!0})}finally{s.dispose()}if(!a){t(void 0);return}t(this.attachedToTarget(n,a.sessionId,!0))};return this._browser.Target.setDiscoverTargets({discover:!0}),this._browser.Target.on("targetCreated",this.enqueueLifecycleFn(n=>o(n.targetInfo))),this._browser.Target.on("targetInfoChanged",n=>this._targetInfoChanged(n.targetInfo,this.enqueueLifecycleFn(o))),this._browser.Target.on("detachedFromTarget",this.enqueueLifecycleFn(async n=>{n.targetId&&await this._detachedFromTarget(n.sessionId,!1)})),r}enqueueLifecycleFn(e){return t=>this._lifecycleQueue=this._lifecycleQueue.then(()=>e(t))}attachedToTarget(e,t,r,o,n=!0){let s=this._targets.get(t);if(s)return s;let a=this._connection.createSession(t),c=new Jo(this,e,a,o,r,this.launchParams,t,this.logger,()=>{this._connection.disposeSession(t),this._detachedFromTarget(t)});this._targets.set(t,c),o&&o._children.set(e.targetId,c),a.Target.on("attachedToTarget",async l=>{this.attachedToTarget(l.targetInfo,l.sessionId,l.waitingForDebugger,c)}),a.Target.on("detachedFromTarget",async l=>{l.targetId&&this._detachedFromTarget(l.sessionId,!1)}),a.Target.setAutoAttach({autoAttach:!0,waitForDebuggerOnStart:n,flatten:!0}),a.Network.setCacheDisabled({cacheDisabled:this.launchParams.disableNetworkCache}).catch(l=>this.logger.info("runtime.target","Error setting network cache state",l)),o||this.retrieveBrowserTelemetry(a);let p=e.type;return gg.has(p)&&this.frameModel.attached(a,e.targetId),this.serviceWorkerModel.attached(a),this._onTargetAddedEmitter.fire(c),!qc.has(p)||p==="service_worker"?c.runIfWaitingForDebugger():p==="page"&&n&&a.Page.waitForDebugger({}),c}async retrieveBrowserTelemetry(e){try{let t=await e.Browser.getVersion({});if(!t)throw new Error("Undefined return from getVersion()");let r={targetCRDPVersion:t.protocolVersion,targetRevision:t.revision,targetUserAgent:t.userAgent,targetV8:t.jsVersion,targetVersion:"",targetProject:"",targetProduct:""};this.logger.verbose("runtime.target","Retrieved browser information",t);let o=(t.product||"").split("/");o.length===2?(r.targetProject=o[0],r.targetVersion=o[1]):r.targetProduct=t.product,this.telemetry.report("browserVersion",r)}catch(t){this.logger.warn("runtime.target","Error getting browser telemetry",t)}}async _detachedFromTarget(e,t=!0){var o;let r=this._targets.get(e);if(r){this._targets.delete(e),(o=r.parentTarget)==null||o._children.delete(e);try{await r._detached()}catch{}if(this._onTargetRemovedEmitter.fire(r),t&&(this._detachedTargets.add(r.targetId),await this._browser.Target.detachFromTarget({sessionId:e})),!this._targets.size&&this.launchParams.request==="launch")try{this.launchParams.cleanUp==="wholeBrowser"?await this._browser.Browser.close({}):(await this._browser.Target.closeTarget({targetId:r.id()}),this._connection.close())}catch{}}}async _targetInfoChanged(e,t){let r=[...this._targets.values()].filter(o=>o.targetId===e.targetId);if(!e.attached||!r.length)return r.length&&await Promise.all(r.map(o=>this._detachedFromTarget(o.sessionId,!1))),t(e);for(let o of r)o._updateFromInfo(e);for(let o of this._targets.values())o.targetId!==e.targetId&&o._onNameChangedEmitter.fire()}}});var oI,lD,Ze,Rn=m(()=>{"use strict";oI=w(require("ws"));Ve();j();ta();U();B();lD=50,Ze=class{constructor(e){this.messageEmitter=new S;this.endEmitter=new S;this.onMessage=this.messageEmitter.event;this.onEnd=this.endEmitter.event;this._ws=e,this._ws.addEventListener("message",t=>{this.messageEmitter.fire([t.data.toString("utf-8"),new It])}),this._ws.addEventListener("close",()=>{this.endEmitter.fire(),this._ws=void 0}),this._ws.addEventListener("error",()=>{})}static async create(e,t,r){let o=!e.startsWith("ws://"),n=await Ps(e);for(;;){let s=Date.now()+lD;try{let a={headers:{host:r??"localhost"},perMessageDeflate:!1,maxPayload:268435456,rejectUnauthorized:!(o&&n),followRedirects:!0},c=new oI.default(e,[],a);return await At(new Promise((p,l)=>{c.addEventListener("open",()=>p(new Ze(c))),c.addEventListener("error",u=>{let f=e===c.url?e:c.url.replace(/^http(s?):/,"ws$1:");if(f===e){l(u.error);return}this.create(f,t,r).then(p,l)})}),pe.withTimeout(2e3,t).token,`Could not open ${e}`).catch(p=>{throw c.close(),p})}catch(a){if(t.isCancellationRequested)throw a;let c=s-Date.now();c>0&&await k(c)}}}send(e){var t;(t=this._ws)==null||t.send(e)}dispose(){return new Promise(e=>{if(!this._ws)return e();this._ws.addEventListener("close",()=>e()),this._ws.close()})}}});function uD(i){let e=[/^APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL$/i,/^ELECTRON_.+$/i,/^GOOGLE_API_KEY$/i,/^VSCODE_.+$/i,/^SNAP(|_.*)$/i,/^GDK_PIXBUF_.+$/i];return new oe(i).map((t,r)=>e.some(o=>o.test(t))?void 0:r)}var Id,fr,oe,to=m(()=>{"use strict";Id=w(require("path"));M();fr=class{constructor(e){this.defined=N(()=>ns(this.value));this.value=e?Eb(e):{}}lookup(e){return fr.platform==="win32"?Bb(this.value,e):this.value[e]}addToPath(e,t="append",r=!1){let o=fr.platform==="win32"?"Path":"PATH",n=fr.platform==="win32"?Id.win32.delimiter:Id.posix.delimiter,s=this.lookup(o);return r&&!s&&(s=`\${env:${o}}`),s?t==="append"?s=s+n+e:s=e+n+s:s=e,this.update(o,s)}addNodeOption(e){let t=this.lookup("NODE_OPTIONS");return this.update("NODE_OPTIONS",t?`${t} ${e}`:e)}update(e,t){return fr.merge(this,{[e]:t})}merge(...e){return fr.merge(this,...e)}map(e){return new fr(ho(this.value,(t,r)=>e(r,t)))}static merge(...e){let t=e.map(o=>o instanceof fr?o.value:o),r=fr.platform==="win32"?Mb(...t):Object.assign({},...t);return new fr(r)}},oe=fr;oe.platform=process.platform,oe.empty=new fr({}),oe.processEnv=N(()=>uD(process.env))});var iI,Pt,Dn=m(()=>{"use strict";iI=w(require("split2"));j();ta();L();M();Pt=class{constructor(e,t,r){this.logger=e;this.pipeWrite=t;this.pipeRead=r;this.messageEmitter=new S;this.endEmitter=new S;this.onMessage=this.messageEmitter.event;this.onEnd=this.endEmitter.event;this.onceEnded=N(()=>{var e;this.streams&&(this.beforeClose(),this.streams.read.removeAllListeners(),(e=this.pipeRead)==null||e.destroy(),this.streams.write.removeListener("end",this.onceEnded),this.streams.write.removeListener("error",this.onWriteError),this.streams.write.on("error",()=>{}),this.streams.write.end(),this.streams=void 0,this.endEmitter.fire())});this.onWriteError=e=>{this.logger.error("internal","pipeWrite error",{error:e})};let o=r||t;this.streams={read:o.on("error",n=>this.logger.error("internal","pipeRead error",{error:n})).pipe((0,iI.default)("\0")).on("data",n=>this.messageEmitter.fire([n,new It])).on("end",this.onceEnded),write:t.on("end",this.onceEnded).on("error",this.onWriteError)}}send(e){var t;(t=this.streams)==null||t.write.write(e+"\0")}dispose(){this.onceEnded()}beforeClose(){}}});function Lr(i,e,t="forceful"){if(t==="none")return!0;if(process.platform==="win32"){let r=process.env.WINDIR||"C:\\Windows",o=(0,Zf.join)(r,"System32","taskkill.exe");try{return(0,Pd.execSync)(`${o} ${t==="forceful"?"/F":""} /T /PID ${i}`,{stdio:"pipe"}),!0}catch(n){return e.error("runtime.exception","Error running taskkill.exe",n),!1}}else try{let r=(0,Zf.join)(__dirname,"./targets/node/terminateProcess.sh"),o=(0,Pd.spawnSync)("sh",[r,i.toString(),t==="forceful"?"9":"15"]);return o.stderr&&o.status?(e.error("runtime.exception","Error running terminateProcess",o),!1):!0}catch(r){return e.error("runtime.exception","Error running terminateProcess",r),!1}}var Pd,Zf,Ap=m(()=>{"use strict";Pd=require("child_process"),Zf=require("path");L();H()});async function eh(i,e,t,r){let o=new Bt(aI.promises),[n,s]=await Promise.all([nI(o,new URL("/json/version",i),e),r?nI(o,new URL("/json/list",i),e):Promise.resolve(void 0)]);if(!n.ok)t.verbose("runtime.launch","Error looking up /json/version",n);else if(n.body.webSocketDebuggerUrl){let a=sI(n.url,n.body.webSocketDebuggerUrl);return t.verbose("runtime.launch","Discovered target URL from /json/version",{url:n.body.webSocketDebuggerUrl,fixed:a}),a}if(s)if(!s.ok)t.verbose("runtime.launch","Error looking up /json/list",s);else{let a=sI(s.url,s.body[0].webSocketDebuggerUrl);return t.verbose("runtime.launch","Discovered target URL from /json/list",{url:s.body[0].webSocketDebuggerUrl,fixed:a}),a}throw new Error("Could not find any debuggable target")}async function nI(i,e,t){if(e.hostname!=="localhost")return i.fetchJson(e.toString(),t,{host:"localhost"});let r=e.toString();e.hostname="127.0.0.1";let o=e.toString(),n=new pe(t);try{let s;return await Wr([r,o].map(async c=>(s=await i.fetchJson(c,n.token),s.ok&&s)))||s}finally{n.cancel()}}function sI(i,e){let t=new URL(i),r=new URL(e);return r.host=t.host,r.toString()}var aI,cI,ma,Cd,_n=m(()=>{"use strict";aI=require("fs");dd();Ve();L();U();cI=i=>async(e,t,r)=>{for(;;)try{return await eh(e,t,r,i)}catch(o){if(t.isCancellationRequested)throw new Error(`Could not connect to debug target at ${e}: ${o.message}`);await k(200)}},ma=cI(!0),Cd=cI(!1)});function mD(i,e){if(!i.stderr)throw new Error("Cannot wait for a websocket for a target that lacks stderr");return new Promise((t,r)=>{let o=pI.createInterface({input:i.stderr}),n="",s=()=>p();o.on("line",l),o.on("close",s);let a=new O([i.onExit(()=>p()),i.onError(p)]),c=e.onCancellationRequested(()=>{u(),r(new Gt(`Timed out after ${c} ms while trying to connect to the browser!`))});function p(f){u(),r(new Error(["Failed to launch browser!"+(f?" "+f.message:""),n,"","TROUBLESHOOTING: https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md",""].join(`
`)))}function l(f){n+=f+`
`;let y=f.match(/^DevTools listening on (ws:\/\/.*)$/);y&&(u(),t(y[1]))}function u(){c.dispose(),o.removeListener("line",l),o.removeListener("close",s),a.dispose()}})}var pI,lI,xd,kd,uI=m(()=>{"use strict";pI=w(require("readline"));Dn();Rn();Ve();$e();j();U();Ap();Tl();_n();lI=async(i,e,t,r)=>{let o=t.connection===0?await mD(e,r):await Cd(`http://localhost:${t.connection}`,r,i),n=t.inspectUri?Tt(t.inspectUri,t.url,o):o;for(;;)try{return await Ze.create(n,r)}catch(s){if(r.isCancellationRequested)throw s;await k(200)}},xd=class{constructor(e){this.logger=e;this.pid=void 0;this.onExit=new S().event;this.onError=new S().event}async transport(e,t){return lI(this.logger,this,e,t)}kill(){}},kd=class{constructor(e,t){this.cp=e;this.logger=t;this.pid=void 0;this.exitEmitter=new S;this.onExit=this.exitEmitter.event;this.errorEmitter=new S;this.onError=this.errorEmitter.event;e.on("exit",r=>this.exitEmitter.fire(r||0)),e.on("error",r=>this.errorEmitter.fire(r))}get stderr(){return this.cp.stderr}get stdio(){return this.cp.stdio}async transport(e,t){return e.connection==="pipe"?new Pt(this.logger,this.cp.stdio[3],this.cp.stdio[4]):lI(this.logger,this,e,t)}kill(){Lr(this.cp.pid,this.logger)}}});async function dI(i,e,t,r){let o=i.launchUnelevatedRequest({process:e,args:t});await At(o,r,"Could not launch browser unelevated")}var mI=m(()=>{"use strict";Ve()});async function bI(i,e,t,r,o,n,s={}){var xb,kb,Tb,Rb;let{onStderr:a=gI,onStdout:c=gI,args:p=[],dumpio:l=!1,cwd:u=process.cwd(),env:f=oe.empty,connection:y="pipe",cleanUp:v="wholeBrowser",url:C,inspectUri:Y}=s,te=new Ge(p),ze=te.getSuggestedConnection();s.includeLaunchArgs!==!1?(te=th(te,s),ze===void 0&&(te=te.setConnection(y),ze=y)):ze===void 0&&(ze="pipe");let ut=["pipe","pipe","pipe"];ze==="pipe"&&(l?ut=["ignore","pipe","pipe","pipe","pipe"]:ut=["ignore","ignore","ignore","pipe","pipe"]);let Te;if(!!(o.supportsLaunchUnelevatedProcessRequest&&s.launchUnelevated)&&typeof ze=="number"&&ze!==0)await dI(i,e,te.toArray(),n),Te=new xd(t);else{t.info("runtime.launch",`Launching Chrome from ${e}`);let Pr=fI.spawn(e,te.toArray(),{detached:!0,env:f.defined(),cwd:await us(hI.promises,u)?u:process.cwd(),stdio:ut});if(Pr.pid===void 0)throw await Promise.race([k(1e3).then(()=>new Error("Unable to launch the executable (undefined pid)")),new Promise(Ec=>Pr.once("error",Ec))]);Te=new kd(Pr,t)}l?((xb=Te.stderr)==null||xb.on("data",Pr=>a(Pr.toString())),(kb=Te.stdout)==null||kb.on("data",Pr=>c(Pr.toString()))):((Tb=Te.stderr)==null||Tb.resume(),(Rb=Te.stdout)==null||Rb.resume());let Vo=()=>{v==="wholeBrowser"&&Te.kill()};process.on("exit",Vo),Te.onExit(()=>process.removeListener("exit",Vo));try{if(s.promisedPort){let Db;ze=await Promise.race([s.promisedPort,new Promise((rL,mT)=>{Db=Te.onExit(gT=>{mT(new I(Mw(gT)))})})]).finally(()=>Db.dispose())}let Pr=await Te.transport({connection:ze,inspectUri:Y||void 0,url:C||void 0},n),Ec=new Ue(Pr,t,r);return Vo=async()=>{v==="wholeBrowser"?(await Ec.rootSession().Browser.close({}),Te.kill()):Ec.close()},{cdp:Ec,process:Te}}catch(Pr){throw Vo(),Pr}}function th(i,e={}){let{userDataDir:t=null,ignoreDefaultArgs:r=!1}=e,o=r===!0?new Ge:Ge.default;return r instanceof Array&&(o=o.filter(n=>!r.includes(n))),t&&(o=o.add("--user-data-dir",t)),o=o.merge(i),i.toArray().every(n=>n.startsWith("-"))&&e.hasUserNavigation&&(o=o.add("about:blank")),o}async function wI(i,e,t,r){let{browserWSEndpoint:o,browserURL:n}=i;if(o){let s=await Ze.create(o,e);return new Ue(s,t,r)}else if(n){let s=await Cd(n,e,t),a=i.inspectUri?Tt(i.inspectUri,i.pageURL,s):s,c=await Ze.create(a,e);return new Ue(c,t,r)}throw new Error("Either browserURL or browserWSEndpoint needs to be specified")}var fI,hI,gI,Td=m(()=>{"use strict";fI=w(require("child_process")),hI=require("fs");He();Rn();to();ae();L();U();de();ce();kl();Tl();uI();_n();mI();gI=()=>{}});var Rd,Ai,hr,Ep=m(()=>{"use strict";Rd=w(require("@vscode/l10n")),Ai=require("inversify");Ve();F();j();L();U();Rt();B();de();ce();G();Sd();Ko();Td();hr=class{constructor(e,t,r){this.logger=e;this.pathResolver=t;this.vscode=r;this._disposables=[];this._onTerminatedEmitter=new S;this.onTerminated=this._onTerminatedEmitter.event;this._onTargetListChangedEmitter=new S;this.onTargetListChanged=this._onTargetListChangedEmitter.event}dispose(){for(let e of this._disposables)e.dispose();this._disposables=[],this._attemptTimer&&clearTimeout(this._attemptTimer),this._targetManager&&this._targetManager.dispose()}resolveParams(e){return e.request==="attach"&&(e.type==="pwa-chrome"||e.type==="pwa-msedge"&&typeof e.useWebView!="object")&&e.browserAttachLocation==="workspace"}async launch(e,t){return this.resolveParams(e)?(this._lastLaunchParams={...e,timeout:1/0},await this.attemptToAttach(this._lastLaunchParams,t),{blockSessionTermination:!0}):{blockSessionTermination:!1}}_scheduleAttach(e,t){this._attemptTimer=setTimeout(()=>{this._attemptTimer=void 0,this.attemptToAttach(e,{...t,cancellationToken:Be})},1e3)}createTargetManager(e,t,r){return Li.connect(e,void 0,this.pathResolver,t,this.logger,r.telemetryReporter,r.targetOrigin)}async attemptToAttach(e,t){let r=await this.acquireConnectionForBrowser(t,e);this._connection=r,r.onDisconnected(()=>{this._connection=void 0,this._targetManager&&(this._targetManager.dispose(),this._targetManager=void 0,this._onTargetListChangedEmitter.fire()),this._lastLaunchParams===e&&e.restart?this._scheduleAttach(e,t):this._onTerminatedEmitter.fire({killed:!0,code:0})},void 0,this._disposables);let o=this._targetManager=await this.createTargetManager(r,e,t);if(!o)return;o.serviceWorkerModel.onDidChange(()=>this._onTargetListChangedEmitter.fire()),o.frameModel.onFrameNavigated(()=>this._onTargetListChangedEmitter.fire()),o.onTargetAdded(()=>{this._onTargetListChangedEmitter.fire()}),o.onTargetRemoved(()=>{this._onTargetListChangedEmitter.fire(),o.targetList().length||this._onTerminatedEmitter.fire({killed:!0,code:0})});let n=await Promise.race([o.waitForMainTarget(await this.getTargetFilter(o,e)),k(e.timeout).then(()=>{throw new I(Ol())})]);return typeof n=="string"?n:void 0}async getTargetFilter(e,t){let r=Xo(t),o=xs(r);if(t.targetSelection!=="pick")return o;let n=await e.getCandiateInfo(o);if(n.length===0)return o;if(n.length===1||!this.vscode)return c=>c.targetId===n[0].targetId;let s=Rd.t("Select a tab"),a=await this.vscode.window.showQuickPick(n.map(c=>({label:c.title,detail:c.url,targetId:c.targetId})),{matchOnDescription:!0,matchOnDetail:!0,placeHolder:s});return a?c=>c.targetId===a.targetId:o}async acquireConnectionForBrowser({telemetryReporter:e,cancellationToken:t},r){for(;this._lastLaunchParams===r;)try{return await this.acquireConnectionInner(e,r,t)}catch(o){if(t.isCancellationRequested)throw new I(Uc(Rd.t("Cannot connect to the target at {0}: {1}",`${r.address}:${r.port}`,o.message)));await k(1e3)}throw new I(Uc(Rd.t("Cannot connect to the target at {0}: {1}",`${r.address}:${r.port}`,"Cancelled")))}async acquireConnectionInner(e,t,r){let o=`http://${t.address}:${t.port}`;return await wI({browserURL:o,inspectUri:t.inspectUri,pageURL:t.url},r,this.logger,e)}async terminate(){var e;this._lastLaunchParams=void 0,(e=this._connection)==null||e.close()}async restart(){if(this._targetManager)for(let e of this._targetManager.targetList())e.type()==="page"&&!e.name().startsWith("devtools://")&&e.restart()}targetList(){let e=this._targetManager;return e?e.targetList():[]}};hr=h([(0,Ai.injectable)(),d(0,(0,Ai.inject)(T)),d(1,(0,Ai.inject)(fe)),d(2,(0,Ai.optional)()),d(2,(0,Ai.inject)(cr))],hr)});var vI,Fp,Ei,ga,ro,Dd=m(()=>{"use strict";vI=require("@vscode/js-debug-browsers"),Fp=w(require("fs")),Ei=require("inversify"),ga=w(require("path"));Ve();$e();to();j();ae();L();Rt();B();de();ce();G();Sd();Ko();Td();ro=class{constructor(e,t,r,o,n){this.storagePath=e;this.logger=t;this.pathResolver=r;this.initializeParams=o;this.fs=n;this._disposables=new O;this._terminated=!1;this._onTerminatedEmitter=new S;this.onTerminated=this._onTerminatedEmitter.event;this._onTargetListChangedEmitter=new S;this.onTargetListChanged=this._onTargetListChangedEmitter.event}dispose(){this._disposables.dispose()}async launchBrowser({runtimeExecutable:e,trace:t,includeDefaultArgs:r,includeLaunchArgs:o,runtimeArgs:n,userDataDir:s,env:a,cwd:c,port:p,url:l,file:u,inspectUri:f,webRoot:y,cleanUp:v,launchUnelevated:C},Y,te,ze,ut){let Te=await this.findBrowserPath(e||"stable"),Uo;return typeof s=="string"?Uo=ga.resolve(s):s&&(Uo=ga.resolve(ga.join(this.storagePath,n!=null&&n.includes("--headless")?".headless-profile":".profile"))),Fp.mkdirSync(this.storagePath,{recursive:!0}),Uo&&(Fp.mkdirSync(Uo,{recursive:!0}),Uo=Fp.realpathSync(Uo)),await bI(Y,Te,this.logger,ze,this.initializeParams,te,{onStdout:Vo=>Y.output({category:"stdout",output:Vo}),onStderr:Vo=>Y.output({category:"stderr",output:Vo}),dumpio:typeof t=="boolean"?t:t.stdio,cleanUp:v,hasUserNavigation:!!(l||u),cwd:c||y||void 0,env:oe.merge(oe.processEnv(),a),args:n||[],userDataDir:Uo,connection:p||(f?0:"pipe"),launchUnelevated:C,ignoreDefaultArgs:!r,includeLaunchArgs:o,url:l,inspectUri:f,promisedPort:ut})}getFilterForTarget(e){return xs(Xo(e,["about:blank"]))}async prepareLaunch(e,{dap:t,targetOrigin:r,cancellationToken:o,telemetryReporter:n}){let s;try{s=await this.launchBrowser(e,t,o,n)}catch(p){throw new I(Dw(p))}if(this._disposables.push(s.cdp.onDisconnected(()=>this.fireTerminatedEvent())),this._connectionForTest=s.cdp,this._launchParams=e,this._targetManager=await Li.connect(s.cdp,s.process,this.pathResolver,this._launchParams,this.logger,n,r),!this._targetManager)throw s.process.kill(),new I(Uc());this._targetManager.serviceWorkerModel.onDidChange(()=>this._onTargetListChangedEmitter.fire()),this._targetManager.frameModel.onFrameNavigated(()=>this._onTargetListChangedEmitter.fire()),this._disposables.push(this._targetManager),this._targetManager.onTargetAdded(()=>{this._onTargetListChangedEmitter.fire()}),this._targetManager.onTargetRemoved(()=>{this._onTargetListChangedEmitter.fire()});let a=this.getFilterForTarget(e),c=await At(this._targetManager.waitForMainTarget(a),o,"Could not attach to main target");if(!c)throw s.process.kill(),new I(Ol());return c}async finishLaunch(e,t){if("skipNavigateForTest"in t)return;let r;if(t.file){let o=ga.resolve(t.webRoot||t.rootPath||"",t.file),n=Math.min(o.includes("#")?o.indexOf("#"):1/0,o.includes("?")?o.indexOf("?"):1/0);isFinite(n)&&!await Wt(this.fs,o)?r=W(o.slice(0,n))+o.slice(n):r=W(o)}else r=t.url;r&&await e.cdp().Page.navigate({url:r})}async launch(e,t){let r=this.resolveParams(e);if(!r)return{blockSessionTermination:!1};let o=await this.prepareLaunch(r,t);return await this.finishLaunch(o,r),{blockSessionTermination:!0}}async terminate(){var e;await((e=this._targetManager)==null?void 0:e.closeBrowser())}async restart(){for(let e of this.targetList())e.type()==="page"&&e.restart()}async findBrowserByExe(e,t){var r;if(t==="*"){let o=await e.findWhere(n=>n.quality==="stable")||(await e.findAll())[0];return o==null?void 0:o.path}else return(0,vI.isQuality)(t)?(r=await e.findWhere(o=>o.quality===t))==null?void 0:r.path:t}targetList(){let e=this._targetManager;return e?e.targetList():[]}connectionForTest(){return this._connectionForTest}fireTerminatedEvent(){this._terminated||(this._terminated=!0,this._onTerminatedEmitter.fire({code:0,killed:!0}))}};ro=h([(0,Ei.injectable)(),d(0,(0,Ei.inject)(Gr)),d(1,(0,Ei.inject)(T)),d(2,(0,Ei.inject)(fe)),d(3,(0,Ei.inject)(Lt)),d(4,(0,Ei.inject)(z))],ro)});var Ar,Ln,SI=m(()=>{"use strict";Ar=require("inversify");F();ae();L();Rt();de();ce();G();Dd();Ln=class extends ro{constructor(t,r,o,n,s,a){super(t,r,s,a,n);this.browserFinder=o}resolveParams(t){return t.type==="pwa-chrome"&&t.request==="launch"&&t.browserLaunchLocation==="workspace"?t:void 0}async findBrowserPath(t){let r=await this.findBrowserByExe(this.browserFinder,t);if(!r||!await us(this.fs,r))throw new I(jl("Chrome",t,(await this.browserFinder.findAll()).map(o=>o.quality)));return r}};Ln=h([(0,Ar.injectable)(),d(0,(0,Ar.inject)(Gr)),d(1,(0,Ar.inject)(T)),d(2,(0,Ar.inject)(nn)),d(2,(0,Ar.tagged)("browser","chrome")),d(3,(0,Ar.inject)(z)),d(4,(0,Ar.inject)(fe)),d(5,(0,Ar.inject)(Lt))],Ln)});var II,Er,PI,CI,xI,gD,fa,kI=m(()=>{"use strict";II=require("crypto"),Er=require("inversify"),PI=require("net"),CI=require("os"),xI=require("path");He();Rn();Ve();F();ae();L();U();Rt();B();de();ce();G();Dd();gD=["--do-not-de-elevate"],fa=class extends ro{constructor(t,r,o,n,s,a){super(t,r,s,a,n);this.browserFinder=o}resolveParams(t){return t.type==="pwa-msedge"&&t.request==="launch"&&t.browserLaunchLocation==="workspace"?t:void 0}launchBrowser(t,r,o,n){return super.launchBrowser({...t,runtimeArgs:t.runtimeArgs??gD},r,o,n,t.useWebView?this.getWebviewPort(t,n):void 0)}getFilterForTarget(t){return t.useWebView&&t.urlFilter?xs(Xo(t)):super.getFilterForTarget(t)}async getWebviewPort(t,r){let o=le();if(!t.runtimeExecutable)return o.resolve(t.port),o.promise;let n=t.runtimeExecutable.split(/\\|\//).pop(),s=`VSCode_${(0,II.randomBytes)(12).toString("base64")}`,a=`\\\\.\\pipe\\WebView2\\Debugger\\${n}\\${s}`,c=(0,PI.createServer)(p=>{p.on("data",async l=>{let u=JSON.parse(l.toString()),f=u.devtoolsActivePort||"",y=parseInt(f.split(`
`).shift()||""),v=t.port||y;o.resolve(v);let C=`ws://${t.address}:${v}/devtools/${u.type}/${u.id}`,Y=await Ze.create(C,Be),te=new Ue(Y,this.logger,r);await te.rootSession().Runtime.runIfWaitingForDebugger({}),te.close()})});return c.on("error",o.reject),c.on("close",()=>o.resolve(t.port)),c.listen(a),t.userDataDir=t.userDataDir||(0,xI.join)((0,CI.tmpdir)(),`vscode-js-debug-userdatadir_${t.port}`),t.env=t.env||{},t.env.WEBVIEW2_USER_DATA_FOLDER=t.userDataDir.toString(),t.env.WEBVIEW2_ADDITIONAL_BROWSER_ARGUMENTS=`--remote-debugging-port=${t.port}`,t.env.WEBVIEW2_WAIT_FOR_SCRIPT_DEBUGGER="true",t.env.WEBVIEW2_PIPE_FOR_SCRIPT_DEBUGGER=s,o.promise}async findBrowserPath(t){let r=await this.findBrowserByExe(this.browserFinder,t);if(!r||!await us(this.fs,r))throw new I(jl("Edge",t,(await this.browserFinder.findAll()).map(o=>o.quality)));return r}};fa=h([(0,Er.injectable)(),d(0,(0,Er.inject)(Gr)),d(1,(0,Er.inject)(T)),d(2,(0,Er.inject)(nn)),d(2,(0,Er.tagged)("browser","edge")),d(3,(0,Er.inject)(z)),d(4,(0,Er.inject)(fe)),d(5,(0,Er.inject)(Lt))],fa)});var TI,_d,fD,oo,Ld=m(()=>{"use strict";TI=require("crypto"),_d=require("inversify");xo();Rn();Ve();fD=0,oo=class{constructor(e){this.portLeaseTracker=e;this.teardown=new WeakMap}async launch(e,t,r){this.server&&this.server.close();let o=`/${(0,TI.randomBytes)(20).toString("hex")}`,n=this.server=await Cu(this.portLeaseTracker,{perMessageDeflate:!0,host:"127.0.0.1",path:o}),s=++fD;e.launchBrowserInCompanion({...r,serverPort:n.address().port,path:o,launchId:s});let a=await At(new Promise((p,l)=>{n.once("connection",p),n.once("error",l)}),t,"Timed out waiting for browser connection"),c=new Ze(a);return this.teardown.set(c,()=>e.killCompanionBrowser({launchId:s})),c}close(e){var t;(t=this.teardown.get(e))==null||t()}dispose(){var e;(e=this.server)==null||e.close(),this.server=void 0}};oo=h([(0,_d.injectable)(),d(0,(0,_d.inject)(ht))],oo)});var Ro,ha,RI=m(()=>{"use strict";Ro=require("inversify");He();F();L();Rt();G();Ep();Ld();ha=class extends hr{constructor(t,r,o,n){super(r,o,n);this.helper=t}resolveParams(t){return t.request==="attach"&&(t.type==="pwa-chrome"||t.type==="pwa-msedge")&&t.browserAttachLocation==="ui"}async acquireConnectionForBrowser(t,r){let o=await this.helper.launch(t.dap,t.cancellationToken,{type:r.type==="pwa-chrome"?"chrome":"edge",params:r,attach:{host:r.address,port:r.port}});return new Ue(o,this.logger,t.telemetryReporter)}};ha=h([(0,Ro.injectable)(),d(0,(0,Ro.inject)(oo)),d(1,(0,Ro.inject)(T)),d(2,(0,Ro.inject)(fe)),d(3,(0,Ro.optional)()),d(3,(0,Ro.inject)(cr))],ha)});var Do,ba,DI=m(()=>{"use strict";Do=require("inversify");He();F();j();L();Rt();G();kl();Dd();Td();Ld();ba=class extends ro{constructor(t,r,o,n,s,a){super(t,r,o,n,s);this.helper=a}resolveParams(t){return(t.type==="pwa-chrome"||t.type==="pwa-msedge")&&t.request==="launch"&&t.browserLaunchLocation==="ui"?t:void 0}async launchBrowser(t,r,o,n){let s=await this.helper.launch(r,o,{type:t.type==="pwa-chrome"?"chrome":"edge",browserArgs:th(new Ge(t.runtimeArgs||[]),{hasUserNavigation:!!t.url,ignoreDefaultArgs:!t.includeDefaultArgs}).setConnection(t.port||"pipe").toArray(),params:t});return{cdp:new Ue(s,this.logger,n),process:{onExit:new S().event,onError:new S().event,transport:()=>Promise.resolve(s),kill:()=>this.helper.close(s)}}}async findBrowserPath(){throw new Error("not implemented")}};ba=h([(0,Do.injectable)(),d(0,(0,Do.inject)(Gr)),d(1,(0,Do.inject)(T)),d(2,(0,Do.inject)(fe)),d(3,(0,Do.inject)(Lt)),d(4,(0,Do.inject)(z)),d(5,(0,Do.inject)(oo))],ba)});var Fi,_I,wa,LI=m(()=>{"use strict";Fi=require("inversify"),_I=require("net");He();Dn();Ve();F();L();U();Rt();de();ce();G();Ep();wa=class extends hr{constructor(e,t,r){super(e,t,r)}resolveParams(e){return e.request==="attach"&&e.type==="pwa-msedge"&&typeof e.useWebView=="object"}async acquireConnectionForBrowser(e,t){let{getAppContainerProcessTokens:r}=await import("@vscode/win32-app-container-tokens"),o=r(t.useWebView.pipeName);if(!o)throw new I(Lw());let n=o.map(c=>(0,_I.connect)(c)),s;try{s=await At(Wr(n.map(c=>new Promise(p=>c.on("error",()=>p(void 0)).on("connect",()=>p(c))))),e.cancellationToken)}finally{for(let c of n)c!==s&&c.destroy()}if(!s)throw new I(Aw());let a=new Pt(this.logger,s);return new Ue(a,this.logger,e.telemetryReporter)}};wa=h([(0,Fi.injectable)(),d(0,(0,Fi.inject)(T)),d(1,(0,Fi.inject)(fe)),d(2,(0,Fi.optional)()),d(2,(0,Fi.inject)(cr))],wa)});var Mp,rh=m(()=>{"use strict";Mp=Symbol("ILinkedBreakpointLocation")});function Ad(i,e){return i?(i.endsWith("/")||(i+="/"),i+e):e}async function Ct(i,e,t,r,o){e=Se(e)||e;let n;if(i){if(kr(i))n=Se(i);else if(ft(i))n=await r(i,t,o)||i;else if(_o.isAbsolute(e))n=wD(e,i);else{let s=new oh.URL(e).pathname,a=await r(s,t,o),c=_o.dirname(a);n=$o(c,i)}o.verbose("sourcemap.parsing","resolved sourceRoot",{sourceRoot:i,absSourceRoot:n})}else if(_o.isAbsolute(e))n=_o.dirname(e),o.verbose("sourcemap.parsing","no sourceRoot specified, using script dirname",{absSourceRoot:n});else{let s=new oh.URL(e).pathname||"/placeholder.js",a=await r(s,t,o);n=a?_o.dirname(a):"",o.verbose("sourcemap.parsing","no sourceRoot specified, using webRoot + script path dirname",{absSourceRoot:n})}return n=sy(n),n=K(n),n}function hD(i,e){return i===e?!0:(i.endsWith("/")||(i+="/"),e.startsWith(i))}function bD(i,e,t){let r=decodeURIComponent(t.substring(i.length));return r?$o(e,r):e}function wD(i,e){return $t(_o.dirname(i),e)}var AI,_o,oh,bt,EI,Ed=m(()=>{"use strict";AI=require("fs"),_o=w(require("path")),oh=require("url");B();L();M();Z();bt=async(i,e,t)=>{if(!i||!i.startsWith("/"))return"";let r=Object.keys(e).sort((o,n)=>n.length-o.length);for(let o of r){if(!o)continue;let n=e[o];if(o[0]!=="/"&&(t.verbose("sourcemap.parsing",`Keys should be absolute: ${o}`),o="/"+o),hD(o,i))return bD(o,n,i)}return""},EI=(i,e)=>async(t,r,o)=>{if(process.platform==="win32"&&/^[a-z]:/i.test(t))return t;let n=await Is(i,_o.dirname(e),"package.json");if(!n)return bt(t,r,o);let s=await bt(t,Fb(r,a=>a.length>=n.length),o);if(process.platform!=="win32"&&t!=="/"&&!s){let a=await AI.promises.stat(t).catch(()=>{});if(a!=null&&a.isDirectory())return t}return s||n}});var Bd,FI,Fd,yD,ih,MI,Md,BI=m(()=>{"use strict";L();Z();xr();Bd="*",FI=new RegExp(ot(Bd),"g"),Fd="?:"+Bd,yD=new RegExp(ot(Fd),"g"),ih=(i,e)=>{let t=e.match(i);return i.lastIndex=0,t?t.length:0},MI=new RegExp(`${ot(Fd)}|${ot(Bd)}`,"g"),Md=class{constructor(e,t){this.logger=t;this.replacers=[];let r=Object.keys(e).sort((o,n)=>n.replace(Fd,"*").length-o.replace(Fd,"*").length);for(let o of r){let n=e[o];if(!n.includes("*")&&/\$[0-9'`&]/.test(n)){this.replacers.push([new RegExp(`^${o}$`,"i"),n]);continue}let s=E(o),a=`"${s}": "${n}"`,c=ih(FI,s)-ih(yD,s);if(c>1){t.warn("runtime.sourcemap",`Warning: only one asterisk allowed in a sourceMapPathOverrides entry - ${a}`);continue}if(ih(FI,n)>c){t.warn("runtime.sourcemap",`The right side of a sourceMapPathOverrides entry must have 0 or 1 asterisks - ${a}}`);continue}let p="^",l=0;for(MI.lastIndex=0;;){let u=MI.exec(s);if(p+=ot(s.slice(l,u==null?void 0:u.index),"/"),!u)break;u[0]===Bd?p+="(.*?)":p+=".*?",l=u.index+u[0].length}c===0&&(p+="([\\/\\\\].*)?",n+="*"),this.replacers.push([new RegExp(p+"$","i"),n.replace(/\$/g,"$$$$").replace(/\*/,"$1")])}}apply(e){let t=E(e);for(let[r,o]of this.replacers){let n=t.replace(r,o);if(n!==t)return this.logger.verbose("runtime.sourcemap",`SourceMap: mapping ${e} => ${n}, via sourceMapPathOverrides entry - ${r.toString()}`),$o(n)}return e}}});var OI,va,vD,jI,ya,nh=m(()=>{"use strict";OI=w(require("micromatch")),va=w(require("path"));L();Wf();Z();B();BI();vD=/\x00/,ya=class{constructor(e,t){this.options=e;this.logger=t;this.sourceMapOverrides=new Md(this.options.sourceMapOverrides,this.logger);this.resolvePatterns=(jI=this.options.resolveSourceMapLocations)==null?void 0:jI.map(e=>{let t=e.startsWith("!")?"!":"",r=e.slice(t.length).replace(/\.[a-z0-9]+$/,".*");if(!ft(r))return E(e);r=E($t(r));let o=Xm(this.options.workspaceFolder),n=Xm(r),s=0;for(let a=0;a<o.length&&a<n.length&&n[a].toLowerCase()===o[a].toLowerCase();a++)s+=o[a].length+1;return r=r.slice(0,s).replace(/[\[\]\(\)\{\}\!\*]/g,"\\$&")+r.slice(s),t+r})}shouldResolveSourceMap({sourceMapUrl:e,compiledPath:t}){if(t.startsWith(Ci))return!1;if(!this.resolvePatterns||this.resolvePatterns.length===0)return!0;let r=Se(e)||rt(e)&&t||e;if(r.startsWith("webpack-internal:///"))return!0;let o=Ml(e)?!1:Gc(),n=this.rebaseRemoteToLocal(r);return(0,OI.default)((n!==r?[r,n]:[r]).map(E),this.resolvePatterns,{dot:!0,nocase:!o}).length>0}rebaseRemoteToLocal(e){if(!this.options.remoteRoot||!this.options.localRoot||!this.canMapPath(e))return va.resolve(e);let t=Oc(this.options.remoteRoot,e);if(t.startsWith(".."))return"";let r=$o(this.options.localRoot,t);return r=be(r),this.logger.verbose("runtime.sourcemap",`Mapped remoteToLocal: ${e} -> ${r}`),$t(r)}rebaseLocalToRemote(e){if(!this.options.remoteRoot||!this.options.localRoot||!this.canMapPath(e))return e;let t=Oc(this.options.localRoot,e),r=$o(this.options.remoteRoot,t);return r=K(r,!0),this.logger.verbose("runtime.sourcemap",`Mapped localToRemote: ${e} -> ${r}`),r}normalizeSourceMapUrl(e){e=e.replace(vD,"");let t=e.lastIndexOf("?");return t!==-1&&e.slice(t-4,t)!==".vue"&&(e=e.slice(0,t)),e}canMapPath(e){return va.posix.isAbsolute(e)||va.win32.isAbsolute(e)||kr(e)}}});var Bp,Mi,NI,sh,br,jd=m(()=>{"use strict";Bp=require("inversify"),Mi=w(require("path")),NI=require("url");Rp();ae();Z();Ed();B();B();nh();sh="https?:\\/\\/[^\\/]+\\/",br=class extends ya{constructor(t,r,o,n){super(o,n);this.vueMapper=t;this.fsUtils=r}absolutePathToUrlPath(t){t=Mi.normalize(t);let{baseUrl:r,pathMapping:o}=this.options,n=["/",o["/"]],s=Object.entries(o).sort(([p,l],[u,f])=>f.length-l.length||u.length-p.length).find(([,p])=>Fl(p,t))||n;if(!s)return{url:W(t),needsWildcard:!1};let a=Yo(Mi.relative(s[1],t)),c=s[0].replace(/\/$|^\//g,"");return c&&(a=c+"/"+a),!r&&!Yl(a)?{url:a,needsWildcard:!0}:{url:Wl(r,a),needsWildcard:!1}}async urlToAbsolutePath({url:t,map:r}){let o=t.indexOf("?");return o!==-1&&t.slice(o-4,o)!==".vue"&&(t=t.slice(0,o)),r?this.sourceMapSourceToAbsolute(t,r):this.simpleUrlToAbsolute(t)}async simpleUrlToAbsolute(t){if(!t)return;if(kr(t)){let s=Se(t);if(await this.fsUtils.exists(s))return s;let a=ay(t);if(await this.fsUtils.exists(a))return a}let r;try{let s=new NI.URL(t);if(!s.pathname||s.pathname==="/"?r="index.html":r=s.pathname,s.protocol==="webpack-internal:")return}catch{r=t}let o=Mi.extname(r),n=r.replace(/^\//,"").split(/[\/\\]/);for(;n.length>0;){let s="/"+n.join("/"),a=await bt(s,this.options.pathMapping,this.logger);if(a){if(!o&&await this.fsUtils.exists(a+".html"))return a+".html";if(await this.fsUtils.exists(a))return a}n.shift()}}async sourceMapSourceToAbsolute(t,r){if(!this.shouldResolveSourceMap(r.metadata))return;switch(this.vueMapper.getVueHandling(t)){case 2:return;case 1:let a=await this.vueMapper.lookup(t);if(a)return K(a);break;default:}t=this.normalizeSourceMapUrl(t);let{pathMapping:o}=this.options,n=Ad(r.sourceRoot,t),s=this.sourceMapOverrides.apply(n);if(s!==n){s=K(s);let a=$t(o["/"],"..","ClientApp",Oc(o["/"],s));return this.options.clientID==="visualstudio"&&n.startsWith("webpack:///")&&!await this.fsUtils.exists(s)&&await this.fsUtils.exists(a)?a:s}return kr(t)?Se(t):Mi.isAbsolute(t)?K(t):$t(await Ct(r.sourceRoot,r.metadata.compiledPath,o,bt,this.logger),t)}absolutePathToUrlRegexp(t){let r=this.absolutePathToUrlPath(t),o=r.url,n=o.length;o.endsWith("index.html")?(n=o.length-10-1,o=o.slice(0,n)+"\\/?($|index(\\.html)?)"):o.endsWith(".html")&&(n=o.length-5,o=o.slice(0,n)+"(\\.html)?");let s=0;r.needsWildcard&&(o=sh+o,s=sh.length,n+=sh.length);let a=Me(o,[s,n]);return r.needsWildcard?`${Me(W(t))}|${a}`:a}};br=h([(0,Bp.injectable)(),d(0,(0,Bp.inject)(la)),d(1,(0,Bp.inject)(mt))],br)});var UI,Sa,ah=m(()=>{"use strict";UI=w(require("path"));L();B();jd();Sa=class extends br{constructor(t,r,o,n){super(t,r,o,n);this.blazorInCodespacesRegexpSubstitution="$1:\\$2";if(this.options.remoteFilePrefix){let s=`\\${UI.default.sep}`,a=this.options.remoteFilePrefix.replace(new RegExp(s,"g"),s);this.blazorInCodespacesRegexp=new RegExp(`^${a}${s}([A-z])\\$${s}(.*)$`)}else this.blazorInCodespacesRegexp=new RegExp("")}absolutePathToUrlRegexp(t){if(this.options.remoteFilePrefix){let r=t.replace(this.blazorInCodespacesRegexp,this.blazorInCodespacesRegexpSubstitution),n=Yo(r).replace(/^(\w):(.*)$/,"$1$2"),s=Me(n);if(s){let a=`dotnet://.*\\.dll/${s}`;return this.logger.verbose("runtime.breakpoints","absolutePathToUrlRegexp.blazor.remoteFs",{absolutePath:t,dotnetUrlRegexp:a}),a}}else{let r=W(t),o=Me(r),n=super.absolutePathToUrlRegexp(t);return o.includes(n)?o:`${o}|${n}`}return super.absolutePathToUrlRegexp(t)}}});function WI(i){if("file"in i&&i.file)return Cs(i.file);if(i.url)try{let e=new VI.URL(i.url);return e.pathname="/",e.search="",e.hash="",e.protocol==="data:"?void 0:e.href}catch{}}var VI,$I=m(()=>{"use strict";VI=require("url");B()});var An,HI,qI,Le,ch=m(()=>{"use strict";An=w(require("path")),HI=require("url");Z();Ed();B();nh();qI="node:",Le=class extends ya{constructor(t,r,o,n){super(o,n);this.fsUtils=t;this.linkedBp=r;this.options=o;this.logger=n}static shouldWarnAboutSymlinks(t){var r;return"runtimeArgs"in t&&!((r=t.runtimeArgs)!=null&&r.includes("--preserve-symlinks"))}static getOptions(t){return{workspaceFolder:t.__workspaceFolder,resolveSourceMapLocations:t.resolveSourceMapLocations,basePath:t.cwd,sourceMapOverrides:t.sourceMapPathOverrides,remoteRoot:t.remoteRoot,localRoot:t.localRoot}}derive(t){return new Le(this.fsUtils,this.linkedBp,{...this.options,...t},this.logger)}get resolutionOptions(){return this.options}async urlToAbsolutePath({url:t,map:r}){if(t=this.normalizeSourceMapUrl(t),t.startsWith(qI)&&this.options.basePath)return t=An.join(this.options.basePath,"lib",t.slice(qI.length)),t.endsWith(".js")||(t+=".js"),t;if(r)return this.sourceMapSourceToAbsolute(t,r);let o=Se(t);if(o)return this.rebaseRemoteToLocal(o);if(Yl(t)){let s=this.sourceMapOverrides.apply(t);t=s===t?new HI.URL(t).pathname.slice(1):s}else if(An.isAbsolute(t))t=this.sourceMapOverrides.apply(t);else return`<node_internals>/${t}`;let n=$t(this.options.basePath??"",t);return this.rebaseRemoteToLocal(n)}absolutePathToUrl(t){return W(this.rebaseLocalToRemote(An.normalize(t)))}async absolutePathToUrlRegexp(t){var o;let r=t;try{r=await this.fsUtils.realPath(t)}catch{}return Kl(r,t)?Me(this.absolutePathToUrl(t)):((o=this.linkedBp)==null||o.warn(),Me(this.absolutePathToUrl(t))+"|"+Me(this.absolutePathToUrl(r)))}async sourceMapSourceToAbsolute(t,r){if(!this.shouldResolveSourceMap(r.metadata))return;let o=Ad(r.sourceRoot,t),n=this.sourceMapOverrides.apply(o);return n!==o?K(n):kr(t)?Se(t):!An.isAbsolute(t)&&this.options.basePath?$t(await Ct(this.options.remoteRoot&&ft(r.sourceRoot)&&this.rebaseRemoteToLocal(r.sourceRoot)||r.sourceRoot,r.metadata.compiledPath,{"/":this.options.basePath},EI(this.fsUtils,r.metadata.compiledPath),this.logger),t):this.rebaseRemoteToLocal(t)||t}}});var Yt,Xt,Ia,Pa,En=m(()=>{"use strict";Yt=require("inversify");Rp();F();ae();G();rh();ah();$I();jd();ch();Xt=Symbol("ISourcePathResolverFactory"),Ia=class{constructor(e,t){this.fsUtils=e;this.linkedBp=t}create(e,t){if(e.type==="pwa-node"||e.type==="node-terminal"||e.type==="pwa-extensionHost")return new Le(this.fsUtils,Le.shouldWarnAboutSymlinks(e)?this.linkedBp:void 0,Le.getOptions(e),t);throw new Error(`Not usable for type ${e.type}`)}};Ia=h([(0,Yt.injectable)(),d(0,(0,Yt.inject)(mt)),d(1,(0,Yt.optional)()),d(1,(0,Yt.inject)(Mp))],Ia);Pa=class{constructor(e,t,r,o){this.initializeParams=e;this.vueMapper=t;this.fsUtils=r;this.linkedBp=o}create(e,t){if(e.type==="pwa-node"||e.type==="node-terminal"||e.type==="pwa-extensionHost")return new Le(this.fsUtils,Le.shouldWarnAboutSymlinks(e)?this.linkedBp:void 0,Le.getOptions(e),t);{let r=!!e.inspectUri;return new(r?Sa:br)(this.vueMapper,this.fsUtils,{workspaceFolder:e.__workspaceFolder,resolveSourceMapLocations:e.resolveSourceMapLocations,baseUrl:WI(e),localRoot:null,remoteRoot:null,pathMapping:{"/":e.webRoot,...e.pathMapping},sourceMapOverrides:e.sourceMapPathOverrides,clientID:this.initializeParams.clientID,remoteFilePrefix:e.__remoteFilePrefix},t)}}};Pa=h([(0,Yt.injectable)(),d(0,(0,Yt.inject)(Lt)),d(1,(0,Yt.inject)(la)),d(2,(0,Yt.inject)(mt)),d(3,(0,Yt.optional)()),d(3,(0,Yt.inject)(Mp))],Pa)});var zI,Od,ID,GI=m(()=>{"use strict";zI=require("url");B();Sd();Ko();Od=class extends Li{constructor(){super(...arguments);this.baseFilter=Xo(this.launchParams);this.filter=t=>{let{debugWebWorkerExtHost:r,debugWebviews:o}=this.launchParams;return!!(r&&(t.type==="worker"&&t.title==="DebugWorkerExtensionHost"||t.type==="page"&&t.title.includes("[Extension Development Host]"))||o&&t.type==="iframe"&&this.baseFilter(t))}}static async connectRenderer(t,r,o,n,s,a){let p=await t.rootSession().Target.attachToBrowserTarget({});if(!p)return;let l=t.createSession(p.sessionId);return new this(t,void 0,l,r,n,s,o,a)}waitForMainTarget(t){let r=this.launchParams;return r.debugWebWorkerExtHost&&this._browser.Target.on("targetCreated",this.enqueueLifecycleFn(async({targetInfo:o})=>{if(!o.url.includes(r.__sessionId))return;let n=await this._browser.Target.attachToTarget({targetId:o.targetId,flatten:!0});n&&this.attachedToTarget(o,n.sessionId,!1)})),super.waitForMainTarget(t)}attachedToTarget(t,r,o,n){let s=super.attachedToTarget(t,r,o||this.filter(t),n,!1);return t.type==="iframe"&&s.setComputeNameFn(ID),s}},ID=i=>{let e;try{e=new zI.URL(i.targetInfo.url)}catch{return}switch(e.searchParams.get("purpose")){case"customEditor":return`${e.searchParams.get("extensionId")} editor: ${e.host}`;case"notebookRenderer":return`Notebook Renderer: ${e.host}`;default:let t=e.searchParams.get("extensionId");return`Webview: ${t?t+" ":""} ${e.host}`}}});var Ca,JI,Fr,ph=m(()=>{"use strict";Ca=require("inversify"),JI=require("net");He();Dn();F();$e();L();Rt();H();En();Ep();GI();Fr=class extends hr{constructor(t,r,o){super(t,r);this.pathResolverFactory=o}async launch(t,r){if(t.type!=="pwa-extensionHost"||t.request!=="attach")return{blockSessionTermination:!1};let o=Fr.debugIdToRendererDebugPort.get(t.__sessionId);if(!o)return{blockSessionTermination:!1};let n=Rs({name:"Webview",type:"pwa-chrome",request:"attach",port:o,__workspaceFolder:t.__workspaceFolder,urlFilter:"",...t.rendererDebugOptions});return n.__sessionId=t.__sessionId,n.debugWebWorkerExtHost=t.debugWebWorkerHost,n.debugWebviews=t.debugWebviews,super.launch(n,r).catch(s=>this.logger.error("runtime.exception","Error in webview attach",{err:s})),{blockSessionTermination:!1}}async acquireConnectionInner(t,r,o){let n=new O,s=await new Promise((a,c)=>{let p=(0,JI.createConnection)({port:r.port},()=>a(p));p.on("error",c),n.push(o.onCancellationRequested(()=>{p.destroy(),c(new Error("connection timed out"))}))}).finally(()=>n.dispose());return new Ue(new Pt(this.logger,s),this.logger,t)}async getTargetFilter(t){return t.filter}async createTargetManager(t,r,o){return new Od(t,void 0,t.rootSession(),this.pathResolverFactory.create(r,this.logger),this.logger,o.telemetryReporter,r,o.targetOrigin)}};Fr.debugIdToRendererDebugPort=new Map,Fr=h([(0,Ca.injectable)(),d(0,(0,Ca.inject)(T)),d(1,(0,Ca.inject)(fe)),d(2,(0,Ca.inject)(Xt))],Fr)});var xa,KI=m(()=>{"use strict";L();xa=class{constructor(){this.target={queue:[]}}connectTo(e){this.target={logger:e}}info(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:1})}verbose(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:0})}warn(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:2})}error(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:3})}fatal(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:4})}log(e){this.target&&("queue"in this.target?this.target.queue.push(e):this.target.logger.log(e))}getRecentLogs(){return this.target?"queue"in this.target?this.target.queue:this.target.logger.getRecentLogs():[]}assert(e,t){if(e===!1||e===void 0||e===null){if(this.error("runtime.assertion",t,{error:new Error("Assertion failed")}),process.env.JS_DEBUG_THROW_ASSERTIONS)throw new Error(t);debugger;return!1}return!0}setup(){throw new Error("A ProxyLogger cannot be setup()")}dispose(){this.target=void 0}forTarget(){return new xa}}});var QI,Nd,Ud,Vd=m(()=>{"use strict";QI=Symbol("ITargetOrigin"),Nd=class{constructor(e){this.id=e}},Ud=class{constructor(e){this.id=e}}});var Wd,YI=m(()=>{"use strict";F();Dp();j();KI();Vd();Wd=class{constructor(e,t){this.parentList=e;this.logger=t;this.targets=new eo;this.onTerminatedEmitter=new S;this.onTerminated=this.onTerminatedEmitter.event;this.onTargetListChanged=this.targets.onChanged;e.onAdd(([,r])=>{r.parent&&this.targets.get(r.parent.id)&&this.targets.add(r.id,r.target)}),e.onRemove(([r])=>{this.targets.remove(r)&&!this.targets.size&&this.onTerminatedEmitter.fire({killed:!0,code:0})})}async launch(e,t){if(e.type!=="node-terminal"||e.request!=="attach")return{blockSessionTermination:!1};let r=this.parentList.get(e.delegateId);if(r===void 0)return setTimeout(()=>this.onTerminatedEmitter.fire({killed:!0,code:0}),1),{blockSessionTermination:!0};let o=r.target.targetOrigin();if(!(o instanceof Ud))throw new Error("Expected delegate session to have a mutable target origin");let n=r.target.logger;if(!(n instanceof xa))throw new Error("Expected delegate session to have a proxy logger");return o.id=t.targetOrigin.id,n.connectTo(this.logger),setTimeout(()=>{this.targets.add(e.delegateId,r.target),r.dap.connect(t.dap)},0),{blockSessionTermination:!0}}terminate(){for(let e of this.targets.value())e.stop();return Promise.resolve()}restart(){for(let e of this.targets.value())e.restart();return Promise.resolve()}targetList(){return[...this.targets.value()]}dispose(){this.terminate()}}});var XI,PD,Fn,ZI=m(()=>{"use strict";Dp();YI();XI=require("inversify"),PD=0,Fn=class{constructor(){this.delegateSessions=new eo;this.refsByTarget=new WeakMap}createLauncher(e){return new Wd(this.delegateSessions,e)}addDelegate(e,t,r){let o={id:PD++,target:e,dap:t,parent:r&&this.refsByTarget.get(r)};return this.refsByTarget.set(e,o),this.delegateSessions.add(o.id,o),o.id}removeDelegate(e){let t=this.refsByTarget.get(e);t&&this.delegateSessions.remove(t.id)}};Fn=h([(0,XI.injectable)()],Fn)});var ne,lh=m(()=>{"use strict";ne=class{constructor(e,t,r){this.major=e;this.minor=t;this.patch=r}static parse(e){let t=e.split(".").map(Number);if(t.length!==3||t.some(isNaN))throw new SyntaxError(`Input string '${e}' is not a semver`);return new ne(t[0],t[1],t[2])}static min(e,t){return e.lt(t)?e:t}compare(e){return this.major-e.major||this.minor-e.minor||this.patch-e.patch}gt(e){return this.compare(e)>0}gte(e){return this.compare(e)>=0}lt(e){return this.compare(e)<0}lte(e){return this.compare(e)<=0}toString(){return`${this.major}.${this.minor}.${this.patch}`}}});var $d,eP=m(()=>{"use strict";$e();j();ta();$d=class{constructor(e,t){this.sessionId=e;this.sink=t;this.onMessageEmitter=new S;this.onEndEmitter=new S;this.disposables=new O;this.onMessage=this.onMessageEmitter.event;this.onEnd=this.onEndEmitter.event;this.disposables.push(t.NodeWorker.on("detachedFromWorker",r=>{r.sessionId===e&&(this.onEndEmitter.fire(),this.dispose())}),t.NodeWorker.on("receivedMessageFromWorker",r=>{r.sessionId===e&&this.onMessageEmitter.fire([r.message,new It])}))}send(e){this.sink.NodeWorker.sendMessageToWorker({message:e,sessionId:this.sessionId})}dispose(){this.disposables.isDisposed||(this.disposables.dispose(),this.onEndEmitter.fire())}}});var uh,d3,tP,rP=m(()=>{"use strict";uh=require("path"),d3=(0,uh.join)(__dirname,"watchdog.js"),tP=(0,uh.join)(__dirname,"bootloader.js")});var jp,oP,Mn,ka,qd=m(()=>{"use strict";jp=require("inversify"),oP=require("path");F();ae();M();B();H();Mn=Symbol("IPackageJsonProvider"),ka=class{constructor(e,t){this.fs=e;this.config=t;this.getPath=N(async()=>{if(this.config.type!=="pwa-node"||this.config.request!=="launch")return;let e=await Is(this.fs,this.config.cwd,"package.json");return e?(0,oP.join)(e,"package.json"):void 0});this.getContents=N(async()=>{let e=await this.getPath();if(e)try{let t=await this.fs.readFile(e);return JSON.parse(t.toString())}catch{return}})}};ka=h([(0,jp.injectable)(),d(0,(0,jp.inject)(mt)),d(1,(0,jp.inject)(ie))],ka)});function Hd(i,e){return i.has(1)?e.addNodeOption("--inspect-publish-uid=http"):e}var Up,wr,io,no,CD,iP,nP,dh,xD,kD,Zt,Np,TD,RD,Op,Ta,Bn=m(()=>{"use strict";Up=w(require("@vscode/l10n")),wr=require("inversify"),io=require("path");to();ae();L();Z();gd();lh();B();de();ce();G();qd();no=Symbol("INodeBinaryProvider");CD=new Set(["npm","yarn","pnpm","tnpm","cnpm"]),iP=i=>CD.has((0,io.basename)(i,(0,io.extname)(i))),nP=(i,e)=>{if(!(!i||!iP(i)))return e.find(t=>!t.startsWith("-")&&t!=="run"&&t!=="run-script")},dh=new ne(12,0,0),xD=new ne(8,0,0),kD=[{inclusiveMin:new ne(16,0,0),inclusiveMax:new ne(16,3,99),message:Up.t("Some breakpoints might not work in your version of Node.js. We recommend upgrading for the latest bug, performance, and security fixes. Details: https://aka.ms/AAcsvqm")},{inclusiveMin:new ne(7,0,0),inclusiveMax:new ne(8,99,99),message:Up.t("You're running an outdated version of Node.js. We recommend upgrading for the latest bug, performance, and security fixes.")}],Zt=class{constructor(e,t){this.path=e;this.version=t;this.capabilities=new Set;t===void 0&&(t=dh),t.gte(new ne(12,0,0))&&this.capabilities.add(0),t.gte(new ne(12,6,0))&&this.capabilities.add(1)}get isPreciselyKnown(){return this.version!==void 0}get warning(){if(this.version){for(let e of kD)if(e.inclusiveMax.gte(this.version)&&e.inclusiveMin.lte(this.version))return e}}has(e,t){return!this.isPreciselyKnown&&t!==void 0?t:this.capabilities.has(e)}},Np=class extends I{constructor(t,r){super(xw(t.toString(),r));this.version=t;this.location=r}},TD=["node","node64","electron"],RD=new Map([[11,new ne(12,0,0)],[10,new ne(12,0,0)],[9,new ne(12,0,0)],[8,new ne(12,0,0)],[7,new ne(12,0,0)],[6,new ne(12,0,0)],[5,new ne(10,0,0)],[4,new ne(10,0,0)],[3,new ne(10,0,0)],[2,new ne(8,0,0)],[1,new ne(8,0,0)]]),Op=class{constructor(e,t,r){this.logger=e;this.fs=t;this.packageJson=r;this.knownGoodMappings=new Map}async resolveAndValidate(e,t="node",r,o){try{return await this.resolveAndValidateInner(e,t,r,o)}catch(n){if(!(n instanceof Np))throw n;if(await this.shouldTryDebuggingAnyway(n))return new Zt(n.location,n.version instanceof ne?n.version:void 0);throw n}}shouldTryDebuggingAnyway(e){return Promise.resolve(!1)}async resolveAndValidateInner(e,t,r,o){let n=await this.resolveBinaryLocation(t,e);if(this.logger.info("runtime.launch","Using binary at",{location:n,executable:t}),!n)throw new I(rg(t,Up.t("path does not exist")));if(r)return new Zt(n,new ne(r,0,0));let s=Ql(n);if(!TD.includes(s)){if(iP(n)){let C=await this.packageJson.getPath();C&&(e=e.addToPath((0,io.resolve)((0,io.dirname)(C),"node_modules/.bin"),"prepend"))}try{let C=await this.resolveAndValidateInner(e,"node",void 0,o);return new Zt(n,C.version)}catch(C){if(Fw(C,9230))throw C;return new Zt(n,void 0)}}if(n.startsWith("/snap/"))return new Zt(n,void 0);let a=this.knownGoodMappings.get(n);if(a)return a;let c=await this.getVersionText(n,o);if(!c)return new Zt(n,void 0);this.logger.info("runtime.launch","Discovered version",{version:c});let p=/v([0-9]+)\.([0-9]+)\.([0-9]+)/.exec(c);if(!p)throw new Np(c,n);let[,l,u,f]=p.map(Number),y=new ne(l,u,f);if(s==="electron"){let C=await this.resolveAndValidate(e);y=ne.min(RD.get(y.major)??dh,C.version??dh)}if(y.lt(xD))throw new Np(y,n);let v=new Zt(n,y);return this.knownGoodMappings.set(n,v),v}async resolveBinaryLocation(e,t){return e&&(0,io.isAbsolute)(e)?await dw(this.fs,e,t):await ds(this.fs,e,t.value)}async getVersionText(e,t){var r;try{let{stdout:o}=await md(e,["--version"],{env:oe.processEnv().defined(),cwd:t});return o.trim()}catch(o){throw t&&!((r=await Wt(this.fs,t))!=null&&r.isDirectory())?new I(Cw(t)):new I(rg(e,o.message))}}};Op=h([(0,wr.injectable)(),d(0,(0,wr.inject)(T)),d(1,(0,wr.inject)(z)),d(2,(0,wr.inject)(Mn))],Op);Ta=class extends Op{constructor(t,r,o,n){super(t,r,o);this.vscode=n}async shouldTryDebuggingAnyway({message:t}){if(!this.vscode)return!1;let r=Up.t("Yes");return await this.vscode.window.showErrorMessage(t,r)===r}};Ta=h([d(0,(0,wr.inject)(T)),d(1,(0,wr.inject)(z)),d(2,(0,wr.inject)(Mn)),d(3,(0,wr.optional)()),d(3,(0,wr.inject)(cr))],Ta)});var sP,zd,aP=m(()=>{"use strict";sP=require("path");j();L();B();zd=class{constructor(e,t,r,o,n,s,a={},c){this.launchConfig=e;this.targetOriginValue=t;this.connection=r;this.targetInfo=n;this.logger=s;this.lifecycle=a;this._parent=c;this._serialize=Promise.resolve(void 0);this._attached=!1;this._onNameChangedEmitter=new S;this._onDisconnectEmitter=new S;this.entryBreakpoint=void 0;this.onDisconnect=this._onDisconnectEmitter.event;this.onNameChanged=this._onNameChangedEmitter.event;this.connection=r,this._cdp=o,o.pause(),this._waitingForDebugger=n.type==="waitingForDebugger",n.title?this._targetName=`${(0,sP.basename)(n.title)} [${n.processId}]`:this._targetName=`[${n.processId}]`,o.Target.on("targetDestroyed",()=>this.connection.close()),r.onDisconnected(()=>this._disconnected())}id(){return this.targetInfo.targetId}processId(){return this.targetInfo.processId}name(){return this._targetName}fileName(){return this.targetInfo.title}type(){return"node"}targetOrigin(){return this.targetOriginValue}parent(){return this._parent}async initialize(){this.lifecycle.initialized&&(this.entryBreakpoint=await this.lifecycle.initialized(this)||void 0)}waitingForDebugger(){return this._waitingForDebugger}scriptUrlToUrl(e){return e[0]==="/"||process.platform==="win32"&&e[1]===":"&&e[2]==="\\"?W(e):e}supportsCustomBreakpoints(){return!1}executionContextName(){return this._targetName}hasParent(){return!!this._parent}async runIfWaitingForDebugger(){await this._cdp.Runtime.runIfWaitingForDebugger({})}async _disconnected(){this._onDisconnectEmitter.fire()}canAttach(){return!this._attached}async attach(){return this._serialize=this._serialize.then(async()=>{if(!this._attached)return this._doAttach()}),this._serialize}async _doAttach(){this._waitingForDebugger=!1,this._attached=!0;let e=await this._cdp.Target.attachToTarget({targetId:this.targetInfo.targetId});if(!e){this.logger.info("runtime.launch","Failed to attach to target",{targetId:this.targetInfo.targetId});return}this._cdp.NodeWorker.enable({waitForDebuggerOnStart:!0}),e&&"__dynamicAttach"in e&&(await this._cdp.Runtime.enable({}),await this._cdp.Debugger.enable({}));let t;return this._cdp.Runtime.on("executionContextCreated",r=>{r.context.auxData&&r.context.auxData.isDefault&&(t=r.context.id)}),this._cdp.Runtime.on("executionContextDestroyed",r=>{r.executionContextId===t&&this.connection.close()}),this._cdp}async afterBind(){this._cdp.resume()}canDetach(){return this._attached}async detach(){this._serialize=this._serialize.then(async()=>{if(this._waitingForDebugger){let e=await this._doAttach();await(e==null?void 0:e.Runtime.runIfWaitingForDebugger({}))}this._attached&&this._doDetach()})}async _doDetach(){await Promise.all([this._cdp.Target.detachFromTarget({targetId:this.targetInfo.targetId}),this._cdp.NodeWorker.disable({})]),this.connection.close(),this._attached=!1}canRestart(){return!1}restart(){}canStop(){return!0}stop(){try{this.lifecycle.close&&this.lifecycle.close(this)}finally{this.connection.close()}}}});function DD(i){if(!so.existsSync(i))return{};let e=_D(so.readFileSync(i,"utf8"));return cP.parse(Buffer.from(e))}function _D(i){return i&&i[0]==="\uFEFF"&&(i=i.substr(1)),i}var cP,so,jn,pP,mh,gh,yr,Vp=m(()=>{"use strict";cP=w(require("dotenv")),so=w(require("fs")),jn=require("inversify"),pP=w(require("net")),mh=w(require("os")),gh=w(require("path"));xo();Je();He();Dn();eP();Ve();F();Dp();$e();to();j();L();M();Z();U();de();ce();En();rP();Bn();aP();rf();yr=class{constructor(e,t,r,o){this.pathProvider=e;this.logger=t;this.portLeaseTracker=r;this.pathResolverFactory=o;this.serverConnections=new Set;this.targets=new eo;this.onTerminatedEmitter=new S;this.onTerminated=this.onTerminatedEmitter.event;this.onTargetListChanged=this.targets.onChanged;this.bootloaderFile=N(this.getBootloaderFile.bind(this))}async launch(e,t){let r=this.resolveParams(e);if(!r)return{blockSessionTermination:!1};this._stopServer();let{server:o,pipe:n}=await this._startServer(t.telemetryReporter),s=this.logger.forTarget(),a=this.run={server:o,serverAddress:n,params:r,context:t,logger:s,pathResolver:this.pathResolverFactory.create(r,this.logger)};return await this.launchProgram(a),{blockSessionTermination:!0}}async terminate(){this.program?await this.program.stop():this.onProgramTerminated({code:0,killed:!0})}async restart(e){if(!this.run)return;let t=this.program;t&&(this.program=void 0,await t.stop(),await Promise.race([k(2e3).then(()=>!1),Promise.all([...this.serverConnections].map(o=>new Promise(n=>o.onDisconnected(n))))])||(this.logger.warn("runtime.launch","Timeout waiting for server connections to close"),this.closeAllConnections())),await this.launchProgram({...this.run,params:e?this.resolveParams(e)??this.run.params:this.run.params,context:{...this.run.context,cancellationToken:this.run.params.timeout>0?pe.withTimeout(this.run.params.timeout).token:Be}})}targetList(){return[...this.targets.value()]}dispose(){this._stopServer()}onProgramTerminated(e){this.onTerminatedEmitter.fire(e),this._stopServer(),this.program=void 0}resolveNodePath(e,t="node"){return this.pathProvider.resolveAndValidate(oe.merge(oe.processEnv(),this.getConfiguredEnvironment(e)),t,e.nodeVersionHint,e.cwd)}getConfiguredEnvironment(e){let t=oe.empty;if(e.envFile)try{t=t.merge(DD(e.envFile))}catch(r){throw new I(Pw(r.message))}return t.merge(e.env)}async resolveEnvironment({params:e,serverAddress:t},r,o){let n=this.getConfiguredEnvironment(e),s=await this.bootloaderFile(e.cwd,r),a={inspectorIpc:t,deferredMode:!1,waitForDebugger:"",execPath:await ds(so.promises,"node",process.env),onlyEntrypoint:!e.autoAttachChildProcesses,verbose:e.trace===!0||typeof e.trace=="object"&&e.trace.stdio?!0:void 0,autoAttachMode:"always",mandatePortTracking:this.portLeaseTracker.isMandated?!0:void 0,...o},c={NODE_OPTIONS:`--require ${s.interpolatedPath}`,VSCODE_INSPECTOR_OPTIONS:JSON.stringify(a),ELECTRON_RUN_AS_NODE:null},p=n.lookup("NODE_OPTIONS");p&&(c.NODE_OPTIONS+=` ${p}`);let l=oe.processEnv().lookup("NODE_OPTIONS");return l&&(c.NODE_OPTIONS+=` ${l}`),n.merge({...c})}createLifecycle(e,t,r){return{}}async _startServer(e){let t=uw(),r=await new Promise((o,n)=>{let s=pP.createServer(a=>this._startSession(a,e)).on("error",n).listen(t,()=>o(s))});return{pipe:t,server:r}}_stopServer(){var e,t;(e=this.run)==null||e.server.close(),this.run=void 0,(t=this.bootloaderFile.value)==null||t.then(r=>r.dispose()),this.bootloaderFile.forget(),this.closeAllConnections()}closeAllConnections(){this.serverConnections.forEach(e=>e.close()),this.serverConnections.clear()}async _startSession(e,t){if(!this.run)return;let{connection:r,cdp:o,targetInfo:n}=await this.acquireTarget(e,t,this.run.logger);if(!this.run){e.destroy();return}n.processId===void 0&&(n.processId=Number(n.targetId));let s=new zd(this.run.params,this.run.context.targetOrigin,r,o,n,this.run.logger,this.createLifecycle(o,this.run,n),n.openerId?this.targets.get(n.openerId):void 0);this.listenToWorkerDomain(o,t,s),this.targets.add(n.targetId,s),s.onDisconnect(()=>this.targets.remove(n.targetId))}async listenToWorkerDomain(e,t,r){e.NodeWorker.on("attachedToWorker",o=>{let n=new $d(o.sessionId,e),s=new ra(r.launchConfig,{attached:!0,canAccessOpener:!1,type:"node-worker",targetId:`${r.id()}-${o.sessionId}`,title:o.workerInfo.title,url:o.workerInfo.url,openerId:r.id()},r,r.targetOrigin(),new Ue(n,r.logger,t).rootSession(),r.logger),a=new O;a.push(n),a.push(r.onDisconnect(()=>a.dispose())),a.push(n.onEnd(()=>a.dispose())),a.callback(()=>this.targets.remove(s.id())),this.targets.add(s.id(),s)})}async acquireTarget(e,t,r){let o=new Ue(new Pt(r,e),r,t);this.serverConnections.add(o),o.onDisconnected(()=>this.serverConnections.delete(o));let n=o.rootSession(),{targetInfo:s}=await new Promise(p=>n.Target.on("targetCreated",p)),a=s,c=this.portLeaseTracker.register(a.processInspectorPort);return o.onDisconnected(()=>c.dispose()),{targetInfo:a,cdp:n,connection:o,logger:r}}async getBootloaderFile(e,t){let r=E(tP);if(!r.includes(" "))return{interpolatedPath:r,dispose:()=>{}};if(t.has(0))return{interpolatedPath:`"${r}"`,dispose:()=>{}};let o=`require(${JSON.stringify(r)})`;if(!mh.tmpdir().includes(" ")||!e){let a=gh.join(mh.tmpdir(),"vscode-js-debug-bootloader.js");return await so.promises.writeFile(a,o),{interpolatedPath:a,dispose:()=>{}}}let n=".vscode-js-debug-bootloader.js",s=gh.join(e,n);return await so.promises.writeFile(s,o),{interpolatedPath:`./${n}`,dispose:()=>so.unlinkSync(s)}}async gatherTelemetryFromCdp(e,t){for(let r=0;r<8;r++){let o=await e.Runtime.evaluate({contextId:1,returnByValue:!0,expression:"typeof process === 'undefined' || process.pid === undefined ? 'process not defined' : ({ processId: process.pid, nodeVersion: process.version, architecture: process.arch })"+Re()});if(!this.program)return;if(!o||!o.result.value){this.logger.error("runtime.target","Undefined result getting telemetry");return}if(typeof o.result.value!="object"){this.logger.info("runtime.target","Process not yet defined, will retry"),await k(50*2**r);continue}let n=o.result.value;return t.context.telemetryReporter.report("nodeRuntime",{version:n.nodeVersion,arch:n.architecture}),this.program.gotTelemetery(n),n}}};yr=h([(0,jn.injectable)(),d(0,(0,jn.inject)(no)),d(1,(0,jn.inject)(T)),d(2,(0,jn.inject)(ht)),d(3,(0,jn.inject)(Xt))],yr)});var lP,Bi,fh=m(()=>{"use strict";lP=require("inversify");Vp();Bi=class extends yr{};Bi=h([(0,lP.injectable)()],Bi)});function LD(i){try{return process.kill(i,0),!0}catch{return!1}}var Gd,Jd,On,Oi,Wp,ji,Nn=m(()=>{"use strict";Ap();Gd=class{constructor(e,t){this.a=e;this.b=t;this.stopped=Promise.race([this.a.stopped.then(async e=>await this.b.stop()&&e),this.b.stopped.then(async e=>await this.a.stop()&&e)])}gotTelemetery(e){this.a.gotTelemetery(e),this.b.gotTelemetery(e)}async stop(){return(await Promise.all([this.a.stop(),this.b.stop()]))[0]}},Jd=class{constructor(e,t,r){this.child=e;this.logger=t;this.killBehavior=r;this.killed=!1;this.stopped=new Promise((o,n)=>{e.once("exit",s=>o({killed:this.killed,code:s||0})),e.once("error",s=>n({killed:this.killed,code:1,error:s}))})}gotTelemetery(){}stop(){return this.killed=!0,Lr(this.child.pid,this.logger,this.killBehavior),this.stopped}},On=class{constructor(){this.stopped=new Promise(e=>this.stopDefer=e)}gotTelemetery(e){this.telemetry=e}stop(){return this.stopDefer({code:0,killed:!0}),this.stopped}},Oi=class extends On{constructor(t){super();this.wd=t;t.onEnd(r=>{this.stopDefer(r),this.wd.dispose()})}stop(){return this.wd.dispose(),this.stopped}},Wp=class{constructor(e,t,r){this.terminalResult=e;this.logger=t;this.killBehavior=r;this.didStop=!1;this.stopped=new Promise(e=>this.onStopped=t=>{this.didStop=!0,e({code:0,killed:t})});e.processId&&this.startPollLoop(e.processId)}gotTelemetery({processId:e}){if(this.didStop){Lr(e,this.logger,this.killBehavior);return}this.loop||this.startPollLoop(e)}stop(){return this.didStop?this.stopped:(this.didStop=!0,this.loop?(Lr(this.loop.processId,this.logger,this.killBehavior),this.startPollLoop(this.loop.processId,Wp.killConfirmInterval)):this.terminalResult.shellProcessId?(Lr(this.terminalResult.shellProcessId,this.logger,this.killBehavior),this.startPollLoop(this.terminalResult.shellProcessId,Wp.killConfirmInterval)):this.onStopped(!0),this.stopped)}startPollLoop(e,t=Wp.terminationPollInterval){this.loop&&clearInterval(this.loop.timer);let r={processId:e,timer:setInterval(()=>{LD(e)||(clearInterval(r.timer),this.onStopped(!0))},t)};this.loop=r}},ji=Wp;ji.terminationPollInterval=1e3,ji.killConfirmInterval=200});var uP,dP,mP=m(()=>{"use strict";uP=require("crypto"),dP=()=>(0,uP.randomBytes)(12).toString("hex")});var gP,vr,$p=m(()=>{"use strict";gP=w(require("net"));Dn();Rn();Ve();j();_r();mP();vr=class{constructor(e,t){this.info=e;this.server=t;this.onEndEmitter=new S;this.cts=new pe;this.gracefulExit=!1;this.targetAlive=!1;this.targetInfo={targetId:this.info.ownId??dP(),processId:Number(this.info.pid)||0,type:this.info.waitForDebugger?"waitingForDebugger":"",title:this.info.scriptName,url:"file://"+this.info.scriptName,openerId:this.info.openerId,attached:!0,canAccessOpener:!1,processInspectorPort:Number(new URL(this.info.inspectorURL).port)};this.onEnd=this.onEndEmitter.event;this.listenToServer()}get isTargetAlive(){return this.targetAlive}static async attach(e){let t=await new Promise((o,n)=>{let s=gP.createConnection(e.ipcAddress,()=>o(s));s.on("error",n)}),r=new Pt(A.null,t);return new vr(e,r)}listenToServer(){let{server:e,targetInfo:t}=this;e.send(JSON.stringify({method:"Target.targetCreated",params:{targetInfo:t}})),e.onMessage(async([r])=>{if(this.target&&!r.includes("Target.attachToTarget")&&!r.includes("Target.detachFromTarget")){this.target.send(r);return}let o=await this.execute(r);o&&e.send(JSON.stringify(o))}),e.onEnd(()=>{this.disposeTarget(),this.onEndEmitter.fire({killed:this.gracefulExit,code:this.gracefulExit?0:1})})}dispose(){this.gracefulExit=!0,this.cts.dispose(!0),this.disposeTarget(),this.server.dispose()}async execute(e){var r;let t=JSON.parse(e);switch(t.method){case"Target.attachToTarget":return this.target&&this.disposeTarget(),this.target=await this.createTarget(),{id:t.id,result:{sessionId:this.targetInfo.targetId,__dynamicAttach:this.info.dynamicAttach?!0:void 0}};case"Target.detachFromTarget":return this.gracefulExit=!0,this.disposeTarget(),{id:t.id,result:{}};default:(r=this.target)==null||r.send(t);return}}async createTarget(){this.gracefulExit=!1;let e=await Ze.create(this.info.inspectorURL,this.cts.token,this.info.remoteHostHeader);return e.onMessage(([t])=>this.server.send(t)),e.onEnd(()=>{e&&this.server.send(JSON.stringify({method:"Target.targetDestroyed",params:{targetId:this.targetInfo.targetId,sessionId:this.targetInfo.targetId}})),this.targetAlive=!1,this.server.dispose()}),e}disposeTarget(){this.target&&(this.target.dispose(),this.target=void 0)}}});var fP,hh,Ra,hP=m(()=>{"use strict";fP=require("inversify");Je();F();L();U();lh();H();_n();Ap();fh();Bn();Nn();$p();hh=class extends Oi{constructor(t,r){super(t);this.logger=r;this.stopped.then(()=>{this.telemetry&&Lr(this.telemetry.processId,this.logger,"polite")})}},Ra=class extends Bi{constructor(){super(...arguments);this.restarting=!1}async restart(){var t;this.restarting=!0,this.onProgramTerminated({code:0,killed:!0,restart:!0}),(t=this.program)==null||t.stop()}resolveParams(t){return t.type==="pwa-extensionHost"&&t.request==="attach"?t:void 0}async launchProgram(t){let r=await ma(`http://localhost:${t.params.port}`,t.context.cancellationToken,this.logger),o=await vr.attach({ipcAddress:t.serverAddress,scriptName:"Extension Host",inspectorURL:r,waitForDebugger:!0,dynamicAttach:!0}),n=this.program=new hh(o,this.logger);this.program.stopped.then(s=>{n===this.program&&this.onProgramTerminated(s)})}createLifecycle(t,r,o){return o.openerId?{}:{initialized:()=>this.onFirstInitialize(t,r,o)}}async onFirstInitialize(t,r,o){this.setEnvironmentVariables(t,r,o.targetId);let n=await this.gatherTelemetryFromCdp(t,r),s=this.program;if(n&&s){let a=new ji({processId:n.processId},this.logger,"forceful");a.stopped.then(()=>s.stop()),s.stopped.then(()=>{this.restarting||a.stop()})}}async setEnvironmentVariables(t,r,o){if(!r.params.autoAttachChildProcesses)return;let n=await this.resolveEnvironment(r,new Zt("node",ne.parse(process.versions.node)),{openerId:o});for(let s=0;s<200;s++){let a=await t.Runtime.evaluate({contextId:1,returnByValue:!0,expression:`Object.assign(process.env, ${JSON.stringify(n.defined())})`+Re()});if(!a)this.logger.error("runtime.target","Undefined result setting child environment vars");else if(a.exceptionDetails)this.logger.error("runtime.target","Error setting child environment vars",a.exceptionDetails);else return;await k(50)}}};Ra=h([(0,fP.injectable)()],Ra)});var qp,bP,Da,AD,wP=m(()=>{"use strict";qp=require("fs"),bP=require("inversify");F();ui();ph();Vp();Nn();Da=class extends yr{resolveParams(e){return e.type==="pwa-extensionHost"&&e.request==="launch"?e:void 0}async launchProgram(e){let t=e.params.port||await je(),r=await e.context.dap.launchVSCodeRequest({args:AD(e.params,t),env:this.getConfiguredEnvironment(e.params).defined(),debugRenderer:e.params.debugWebviews||e.params.debugWebWorkerHost});r.rendererDebugPort&&Fr.debugIdToRendererDebugPort.set(e.params.__sessionId,r.rendererDebugPort),this.program=new On,this.program.stop()}};Da=h([(0,bP.injectable)()],Da);AD=(i,e)=>{let t=i.args.map(r=>{if(r.startsWith("-")){let o=r.split("=",2);return o.length===2&&((0,qp.existsSync)(o[1])||(0,qp.existsSync)(o[1]+".js"))?{prefix:o[0]+"=",path:o[1]}:{prefix:r}}else{try{let o=(0,qp.lstatSync)(r);if(o.isDirectory())return{prefix:"--folder-uri=",path:r};if(o.isFile())return{prefix:"--file-uri=",path:r}}catch{}return{path:r}}});return i.noDebug||t.unshift({prefix:`--inspect-brk-extensions=${e}`}),t.unshift({prefix:`--debugId=${i.__sessionId}`}),t}});var yP,Hp,vP,SP,Kd,jt,bh=m(()=>{"use strict";yP=require("crypto"),Hp=require("fs"),vP=require("os"),SP=w(require("path")),Kd=class{constructor(){this.disposed=!1;this.path=SP.join((0,vP.tmpdir)(),`node-debug-callback-${(0,yP.randomBytes)(8).toString("hex")}`);this.file=Hp.promises.open(this.path,"w")}static isValid(e){try{let t=(0,Hp.readFileSync)(e);return t.length?t.readDoubleBE()>Date.now()-Kd.recencyDeadline:!1}catch{return!1}}async startTouchLoop(){await this.touch(),this.disposed||(this.updateInterval=setInterval(()=>this.touch(),Kd.updateInterval))}async touch(e=()=>Date.now()){let t=await this.file,r=Buffer.alloc(8);r.writeDoubleBE(e()),await t.write(r,0,r.length,0)}async dispose(){if(!this.disposed){this.disposed=!0,this.updateInterval&&clearInterval(this.updateInterval);try{await(await this.file).close(),await Hp.promises.unlink(this.path)}catch{}}}},jt=Kd;jt.updateInterval=1e3,jt.recencyDeadline=2e3});var IP,PP,_a,wh=m(()=>{"use strict";IP=require("child_process"),PP=w(require("split2")),_a=class{constructor(e=IP.spawn){this.spawn=e}lookup(e,t){return new Promise((r,o)=>{let n=this.createProcess(),s=this.createParser();n.on("error",o),n.stderr.on("error",a=>o(`Error finding processes: ${a.toString()}`)),n.stdout.pipe((0,PP.default)(/\r?\n/)).on("data",a=>{let c=s(a);c&&(t=e(c,t))}),n.on("close",(a,c)=>{a===0?r(t):c?o(new Error(`process terminated with signal: ${c}`)):a&&o(new Error(`process terminated with exit code: ${a}`))})})}}});var CP,Ni,Qd=m(()=>{"use strict";CP=require("path");gd();wh();Ni=class extends _a{constructor(t){super();this.fsUtils=t}async getWorkingDirectory(t){try{let{stdout:r}=await md("lsof",["-a","-dcwd","-Fn",`-p${t}`]),o=r.trim().split(`
`).pop().slice(1);return o&&(0,CP.isAbsolute)(o)&&await this.fsUtils.exists(o)?o:void 0}catch(r){if(r instanceof To)return;throw r}}createProcess(){return this.spawn("/bin/ps",["-xo",`pid=PID,ppid=PPID,comm=${"a".repeat(256)},command=COMMAND`])}createParser(){let t;return r=>{if(!t){t=r.indexOf("COMMAND");return}let o=/^\W*([0-9]+)\W*([0-9]+)\W*/.exec(r);if(o)return{pid:Number(o[1]),ppid:Number(o[2]),command:r.slice(o[0].length,t).trim(),args:r.slice(t).trim()}}}}});var La,yh=m(()=>{"use strict";Qd();La=class extends Ni{createProcess(){return this.spawn("/bin/ps",["-axo","pid=PID,ppid=PPID,comm:30,command=COMMAND"])}createParser(){let e=super.createParser();return t=>{let r=e(t);if(!r)return;let o=r.args.indexOf(r.command);if(o===-1)return r;for(o=o+r.command.length;o<r.args.length&&r.args[o]!==" ";)o++;return r.command=r.args.substr(0,o),r.args=r.args.substr(o+1),r}}}});var xP,Aa,vh=m(()=>{"use strict";xP=require("path");wh();Aa=class extends _a{async getWorkingDirectory(){}createProcess(){let e=(0,xP.join)(process.env.WINDIR||"C:\\Windows","System32","wbem","WMIC.exe");return this.spawn(e,["process","get","CommandLine,CreationDate,ParentProcessId,ProcessId"])}createParser(){let e=/^(.*)\s+([0-9]+)\.[0-9]+[+-][0-9]+\s+([0-9]+)\s+([0-9]+)$/;return t=>{let r=e.exec(t.trim());if(!r||r.length!==5)return;let o=Number(r[4]),n=Number(r[3]),s=Number(r[2]),a=r[1].trim();if(!isNaN(o)&&!isNaN(n)&&a){let c=a;if(a[0]==='"'){let p=a.indexOf('"',1);p>0&&(c=a.substr(1,p-1),a=a.substr(p+2))}else{let p=a.indexOf(" ");p>0?(c=a.substr(0,p),a=a.substr(p+1)):a=""}return{pid:o,ppid:n,command:c,args:a,date:s}}}}}});function Sh(i){let e=/--inspect(-brk)?(=((\[[0-9a-fA-F:]*\]|[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+|[a-zA-Z0-9\.]*):)?(\d+))?/,t=/--inspect-port=(\d+)/,r,o,n=e.exec(i);return n&&n.length>=1&&(n.length>=5&&n[4]&&(r=n[4]),n.length>=6&&n[5]&&(o=parseInt(n[5]))),n=t.exec(i),n&&n.length===2&&(o=parseInt(n[1])),{address:r,port:o}}var TP,kP,Un,Yd=m(()=>{"use strict";TP=require("fs");ae();Qd();yh();vh();kP=new se(TP.promises),Un=process.platform==="win32"?new Aa:process.platform==="darwin"?new Ni(kP):new La(kP)});async function RP(i,e,t,r=Be){let o=await ED(i.pid,t);if(!o)return[];let n=[],s=o.children.slice();for(;s.length;){let a=s.pop();s=s.concat(a.children);let{port:c}=Sh(a.args);c&&n.push(eh(`http://${i.hostname}:${c}`,r,t,!0).then(p=>vr.attach({ipcAddress:i.ipcAddress,scriptName:"Child Process",inspectorURL:p,waitForDebugger:!0,dynamicAttach:!0,pid:String(a.pid),openerId:e})).catch(p=>t.info("internal","Could not spawn WD for child process",{err:p,port:c,child:a})))}return(await Promise.all(n)).filter(a=>!!a)}async function ED(i,e){let t=new Map;t.set(0,{children:[],pid:0,ppid:0,command:"",args:""});try{await Un.lookup(({pid:o,ppid:n,command:s,args:a})=>(o!==n&&t.set(o,{pid:o,ppid:n,command:s,args:a,children:[]}),t),null)}catch(o){e.warn("internal","Error getting child process tree",o);return}let r=t.values();for(let o of r){let n=t.get(o.ppid);n&&n!==o&&n.children.push(o)}return!isNaN(i)&&i>0?t.get(i):t.get(0)}var DP=m(()=>{"use strict";L();$p();Ve();Yd();_n()});var _P,ao,Vn,Ih,Xd=m(()=>{"use strict";_P=require("inversify"),ao=class{create(e){return e===!1?new Ih:e===!0?new Vn({maxAttempts:1/0,delay:1e3}):new Vn({maxAttempts:e.maxAttempts??1/0,delay:e.delay??1e3})}};ao=h([(0,_P.injectable)()],ao);Vn=class{constructor(e,t=0){this.options=e;this.attempt=t}get delay(){return this.options.delay}next(){return this.attempt===this.options.maxAttempts?void 0:new Vn(this.options,this.attempt+1)}reset(){return this.attempt?new Vn(this.options):this}},Ih=class{constructor(){this.delay=-1}next(){}reset(){return this}}});var LP,Wn,Ea,AP=m(()=>{"use strict";LP=w(require("@vscode/l10n")),Wn=require("inversify");xo();Je();Ve();F();L();U();B();_n();En();bh();fh();DP();Bn();Nn();Xd();$p();Ea=class extends Bi{constructor(t,r,o,n,s=new ao){super(t,r,n,o);this.restarters=s}resolveParams(t){return t.type==="pwa-node"&&t.request==="attach"?t:void 0}async launchProgram(t){let r=async(n,s)=>{let a=this.program,c;try{t.params.websocketAddress?c=t.params.websocketAddress:c=await ma(`http://${t.params.address}:${t.params.port}`,s&&t.params.timeout>0?pe.withTimeout(t.params.timeout).token:t.context.cancellationToken,this.logger)}catch(u){if(a&&a===s)return o(n,a,{killed:!1,code:1});throw u}let p=await vr.attach({ipcAddress:t.serverAddress,scriptName:"Remote Process",inspectorURL:c,remoteHostHeader:t.params.remoteHostHeader,waitForDebugger:!0,dynamicAttach:!0}),l=this.program=new Oi(p);l.stopped.then(u=>o(n.reset(),l,u))},o=async(n,s,a)=>{if(this.program!==s)return;if(a.killed){this.onProgramTerminated(a);return}let c=n.next();if(!c){this.onProgramTerminated(a);return}t.context.dap.output({output:LP.t(`Lost connection to debugee, reconnecting in {0}ms\r
`,c.delay)});let p=new On;this.program=p;let l=await Promise.race([k(c.delay),p.stopped]);this.program===p&&(l?this.onProgramTerminated(a):r(c,p))};return r(this.restarters.create(t.params.restart))}createLifecycle(t,r,o){if(o.openerId)return{};let n;return{initialized:async()=>{n=this.onFirstInitialize(t,r,o),await n},close:()=>{var s;this.targetList().length&&((s=this.program)==null||s.stop()),n==null||n.then(a=>a.dispose())}}}async onFirstInitialize(t,r,o){let n=new jt;await n.startTouchLoop();let s=await this.resolveNodePath(r.params),[a]=await Promise.all([this.gatherTelemetryFromCdp(t,r),this.setEnvironmentVariables(t,r,n.path,o.targetId,s)]);return a&&r.params.attachExistingChildren&&RP({pid:a.processId,nodePath:s.path,hostname:r.params.address,ipcAddress:r.serverAddress},o.targetId,this.logger).catch(c=>this.logger.warn("internal","Error watching child processes",{err:c})),n}async setEnvironmentVariables(t,r,o,n,s){if(!r.params.autoAttachChildProcesses)return;if(!await Ps(r.params.address)){this.logger.warn("runtime.target","Cannot attach to children of remote process");return}let a=await this.resolveEnvironment(r,s,{requireLease:o,openerId:n});for(let c=0;c<5;c++){let p=await t.Runtime.evaluate({contextId:1,returnByValue:!0,expression:`typeof process === 'undefined' || process.pid === undefined ? 'process not defined' : Object.assign(process.env, ${JSON.stringify(a.defined())})`+Re()});if(!p){this.logger.error("runtime.target","Undefined result setting child environment vars");return}if(!p.exceptionDetails&&p.result.value!=="process not defined")return;this.logger.error("runtime.target","Error setting child environment vars",p),await k(50)}}};Ea=h([(0,Wn.injectable)(),d(0,(0,Wn.inject)(no)),d(1,(0,Wn.inject)(T)),d(2,(0,Wn.inject)(Xt)),d(3,(0,Wn.inject)(ht))],Ea)});function zp(i){return i instanceof Array?i:[i]}var Ph=m(()=>{"use strict"});function Zd(i){if(!i.runtimeArgs||i.attachSimplePort)return;let e=[];for(let t of i.runtimeArgs)/^--inspect-brk(=|$)/.test(t)?i.stopOnEntry=i.stopOnEntry||!0:e.push(t);i.runtimeArgs=e}var Ch=m(()=>{"use strict"});var EP,FP,MP,Fa,xh,Gp,BP=m(()=>{"use strict";EP=require("os"),FP=w(require("path")),MP=require("crypto"),Fa=require("fs"),xh=class{constructor(){this.path=FP.join((0,EP.tmpdir)(),`node-debug-callback-${(0,MP.randomBytes)(8).toString("hex")}`);this.disposed=!1}read(e=xh.pollInterval){return this.readPromise?this.readPromise:(this.readPromise=new Promise((t,r)=>{let o=setInterval(()=>{if(this.disposed){clearInterval(o),t(void 0);return}if((0,Fa.existsSync)(this.path)){try{t(JSON.parse((0,Fa.readFileSync)(this.path,"utf-8")))}catch(n){r(n)}finally{this.dispose()}clearInterval(o)}},e)}),this.readPromise)}dispose(){if(!this.disposed){this.disposed=!0;try{(0,Fa.unlinkSync)(this.path)}catch{}}}},Gp=xh;Gp.pollInterval=200});var $n,Jp,em,Kp=m(()=>{"use strict";$n=w(require("path"));Ph();Jp=Symbol("IProgramLauncher"),em=i=>{let e=i.program;if(e&&$n.isAbsolute(e)){let t=$n.relative(i.cwd,e);e=$n.isAbsolute(t)?t:`.${$n.sep}${t}`}return e?[...i.runtimeArgs,e,...zp(i.args)]:[...i.runtimeArgs,...zp(i.args)]}});var er,Ba,FD,Ma,jP=m(()=>{"use strict";er=require("inversify"),Ba=require("path");du();xo();Ph();F();ae();L();Z();U();B();Ch();_n();En();BP();Bn();Vp();qd();Kp();Nn();Xd();$p();FD=async(i,e)=>{if(typeof e.stopOnEntry=="string")return(0,Ba.resolve)(e.cwd,e.stopOnEntry);if(e.program)return(0,Ba.resolve)(e.cwd,e.program);for(let t of zp(e.args)){if(t.startsWith("-"))continue;let r=(0,Ba.resolve)(e.cwd,t);if(await i.exists(r))return r}},Ma=class extends yr{constructor(t,r,o,n,s,a,c,p,l){super(t,r,l,p);this.bpPredictor=o;this.launchers=n;this.restarters=s;this.fsUtils=a;this.packageJson=c}resolveParams(t){let r;if(t.type==="pwa-node"&&t.request==="launch"?r={...t}:"server"in t&&t.server&&"program"in t.server&&(r={...t.server}),!!r)return Zd(r),r}async launchProgram(t){t.params.program&&(t.params.program=await this.tryGetCompiledFile(t.params.program)),this.attachSimplePort=await this.getSimpleAttachPortIfAny(t.params);let r=async o=>{this.program&&this.program.stop();let n=await this.resolveNodePath(t.params,t.params.runtimeExecutable||void 0),s=n.warning;s&&t.context.dap.output({category:"stderr",output:s.message});let a=new Gp,c=await this.resolveEnvironment(t,n,{fileCallback:a.path});this.attachSimplePort?(t.params.attachSimplePort||t.context.dap.output({category:"stderr",output:"Using legacy attach mode for --inspect-brk in npm scripts. We recommend removing --inspect-brk, and using `stopOnEntry` in your launch.json if you need it."}),c=c.merge({NODE_OPTIONS:null})):c=Hd(n,c);let p={...t.params,env:c.value},l=this.launchers.find(f=>f.canLaunch(p));if(!l)throw new Error("Cannot find an appropriate launcher for the given set of options");let u=await l.launchProgram(n.path,p,t.context);if(this.attachSimplePort){let f=await vr.attach({ipcAddress:t.serverAddress,scriptName:"Remote Process",inspectorURL:await ma(`http://127.0.0.1:${this.attachSimplePort}`,t.context.cancellationToken,this.logger),waitForDebugger:!0,dynamicAttach:!0});u=new Gd(u,new Oi(f))}else a.read().then(f=>{f&&u.gotTelemetery(f)});this.program=u,u.stopped.then(async f=>{if(a.dispose(),this.program!==u)return;if(f.killed||f.code===0){this.onProgramTerminated(f);return}let y=o.next();if(!y){this.onProgramTerminated(f);return}await k(y.delay),this.program===u&&r(y)})};return r(this.restarters.create(t.params.restart))}async getSimpleAttachPortIfAny(t){var n,s;if(t.attachSimplePort)return t.attachSimplePort;let r=nP(t.runtimeExecutable,t.runtimeArgs);if(!r)return;let o=await this.packageJson.getContents();if((s=(n=o==null?void 0:o.scripts)==null?void 0:n[r])!=null&&s.includes("--inspect-brk"))return t.port??9229}createLifecycle(t,r,{targetId:o}){return{initialized:async()=>{if(this.attachSimplePort&&await this.gatherTelemetryFromCdp(t,r),!r.params.stopOnEntry)return;let n=await FD(this.fsUtils,r.params);if(!n){this.logger.warn("runtime","Could not resolve program entrypointfrom args");return}let s="(?:entryBreakpoint){0}",a=W(n),c=Me(a)+s,p=await t.Debugger.setBreakpointByUrl({urlRegex:c,lineNumber:0,columnNumber:0});return p!=null&&p.breakpointId?{cdpId:p==null?void 0:p.breakpointId,path:a}:void 0},close:()=>{let n=Number(o);if(n>0)try{process.kill(n)}catch{}}}}async tryGetCompiledFile(t){t=K(t);let r=(0,Ba.extname)(t);if(!r||r===".js")return t;let o=await this.bpPredictor.getPredictionForSource(t);if(!o||o.size===0)return t;let n=o.values().next().value;return n?(this.logger.info("runtime.launch","Updating entrypoint to compiled file",{from:t,to:n.compiledPath,candidates:o.size}),n.compiledPath):t}};Ma=h([(0,er.injectable)(),d(0,(0,er.inject)(no)),d(1,(0,er.inject)(T)),d(2,(0,er.inject)(ln)),d(3,(0,er.multiInject)(Jp)),d(4,(0,er.inject)(ao)),d(5,(0,er.inject)(mt)),d(6,(0,er.inject)(Mn)),d(7,(0,er.inject)(Xt)),d(8,(0,er.inject)(ht))],Ma)});function BD(i){switch(i){case"32":case"x86":case"ia32":return"x86";case"64":case"x64":case"amd64":return"x64";case"arm":let e=process.config.variables.arm_version;return e?"armv"+e+"l":"arm";default:return i}}var ja,OP,tm,NP,xt,rm,Ot,MD,om=m(()=>{"use strict";ja=w(require("fs")),OP=require("fs"),tm=require("inversify"),NP=w(require("os")),xt=w(require("path"));ae();U();de();ce();rm=Symbol("INvmResolver"),Ot=class{constructor(e=new se(OP.promises),t=process.env,r=process.arch,o=process.platform,n=NP.homedir()){this.fsUtils=e;this.env=t;this.arch=r;this.platform=o;this.homedir=n}async resolveNvmVersionPath(e){let t=this.env["NVS_HOME"];if(!t){let s=this.platform==="win32"?xt.join(this.env.LOCALAPPDATA||"","nvs"):xt.join(this.env.HOME||"",".nvs");ja.existsSync(s)&&(t=s)}let r,o=[],n=this.parseVersionString(e);if(n.nvsFormat||t){if(r=await this.resolveNvs(t,n),!r&&n.nvsFormat)throw new I(tg(e,"nvs"));o.push("nvs")}if(!r)if(this.platform==="win32")this.env["NVM_HOME"]&&(r=await this.resolveWindowsNvm(e),o.push("nvm-windows"));else{let s=this.env["NVM_DIR"]||xt.join(this.homedir,".nvm");await this.fsUtils.exists(s)&&(r=await this.resolveUnixNvm(e),o.push("nvm"))}if(!o.length)throw new I(eg());if(!r||!await this.fsUtils.exists(r))throw new I(tg(e,o.join("/")));return{directory:r,binary:await this.getBinaryInFolder(r)}}async getBinaryInFolder(e){return await Wr(["node64.exe","node64"].map(t=>this.fsUtils.exists(xt.join(e,t))))?"node64":"node"}async resolveNvs(e,{remoteName:t,semanticVersion:r,arch:o}){if(!e)throw new I(vw());let n=this.findBinFolderForVersion(xt.join(e,t),r,s=>ja.existsSync(xt.join(s,o)));if(n)return this.platform!=="win32"?xt.join(n,o,"bin"):xt.join(n,o)}async resolveUnixNvm(e){let t=this.env["NVM_DIR"];if(!t){let o=xt.join(this.env.HOME||"",".nvm");await this.fsUtils.exists(o)&&(t=o)}if(!t)throw new I(eg());let r=this.findBinFolderForVersion(xt.join(t,"versions","node"),`v${e}`);return r?xt.join(r,"bin"):void 0}async resolveWindowsNvm(e){let t=this.env["NVM_HOME"];if(!t)throw new I(Sw());return this.findBinFolderForVersion(t,`v${e}`)}findBinFolderForVersion(e,t,r){if(!ja.existsSync(e))return;let o=ja.readdirSync(e);if(o.includes(t))return xt.join(e,t);let n=o.filter(s=>s.startsWith(`${t}.`)).sort(MD).filter(s=>r?r(xt.join(e,s)):!0).pop();return n?xt.join(e,n):void 0}parseVersionString(e){let r=/^(([\w-]+)\/)?(v?(\d+(\.\d+(\.\d+)?)?))(\/((x86)|(32)|((x)?64)|(arm\w*)|(ppc\w*)))?$/i.exec(e);if(!r)throw new Error("Invalid version string: "+e);let o=!!(r[2]||r[8]),n=r[2]||"node",s=r[4]||"",a=BD(r[8]||this.arch);return{nvsFormat:o,remoteName:n,semanticVersion:s,arch:a}}};Ot=h([(0,tm.injectable)(),d(0,(0,tm.inject)(mt))],Ot);MD=(i,e)=>{let t=/([0-9]+)\.([0-9]+)\.([0-9]+)/.exec(i),r=/([0-9]+)\.([0-9]+)\.([0-9]+)/.exec(e);if(!t||!r)return(r?-1:0)+(t?1:0);let[,o,n,s]=t,[,a,c,p]=r;return Number(o)-Number(a)||Number(n)-Number(c)||Number(s)-Number(p)}});var UP,im,VP,Oa,jD,Na,WP=m(()=>{"use strict";UP=require("child_process"),im=require("inversify"),VP=w(require("split2"));to();L();B();H();Kp();Nn();Oa=class{constructor(e){this.logger=e}canLaunch(e){return e.console==="internalConsole"}async launchProgram(e,t,r){let{executable:o,args:n,shell:s,cwd:a}=jD(e,em(t),t.cwd);r.dap.output({category:"console",output:[o,...n].join(" ")+`
`});let c=(0,UP.spawn)(o,n,{shell:s,cwd:a,env:oe.merge(oe.processEnv(),t.env).defined()});return t.outputCapture==="console"?this.discardStdio(r.dap,c):this.captureStdio(r.dap,c),new Jd(c,this.logger,t.killBehavior)}captureStdio(e,t){t.stdout.pipe(Na.stream()).on("data",r=>e.output({category:"stdout",output:r})).resume(),t.stderr.pipe(Na.stream()).on("data",r=>e.output({category:"stderr",output:r})).resume()}discardStdio(e,t){let r=[],o=()=>{r&&e.output({category:"stderr",output:Buffer.concat(r).toString()})},n=Buffer.from("Debugger attached."),s=a=>{a.includes(n)?(r=void 0,t.stderr.removeListener("data",s)):r&&r.push(a)};t.stderr.on("data",s),t.on("error",a=>{o(),e.output({category:"stderr",output:a.stack||a.message})}),t.on("exit",a=>{a!==null&&a>0&&(o(),e.output({category:"stderr",output:`Process exited with code ${a}\r
`}))}),t.stdout.resume(),t.stderr.resume()}};Oa=h([(0,im.injectable)(),d(0,(0,im.inject)(T))],Oa);jD=(i,e,t)=>{if(process.platform==="win32"&&(i=vt(i),t=vt(t),i.endsWith(".ps1")&&(e=["-File",i,...e],i="powershell.exe")),process.platform!=="win32"||!i.includes(" "))return{executable:i,args:e,shell:!1,cwd:t};let r=!1,o=[];for(let n of e)n.includes(" ")?(o.push(`"${n}"`),r=!0):o.push(n);return r?{executable:`"${i}"`,args:o,shell:!0,cwd:t}:{executable:i,args:e,shell:!1,cwd:t}},Na=class{constructor(){this.etxSpotted=!1}static stream(){return(0,VP.default)(new Na,void 0,void 0)}[Symbol.split](e){this.etxSpotted||=e.includes("");let t=e.split(this.etxSpotted?"":`
`);return t.length>1?t.map((r,o)=>o<t.length-1?`${r}
`:r):t}}});var nm,Ui,kh=m(()=>{"use strict";nm=require("inversify");L();M();de();ce();Kp();Nn();Ui=class{constructor(e){this.logger=e}canLaunch(e){return e.internalConsoleOptions,e.console!=="internalConsole"}async launchProgram(e,t,r){let o={kind:t.console==="integratedTerminal"?"integrated":"external",title:t.name,cwd:t.cwd,args:[e,...em(t)],env:ns(t.env),argsCanBeInterpretedByShell:!Array.isArray(t.args)},n;try{n=await this.sendLaunchRequest(o,r)}catch(s){throw new I(Iw(s.message))}return new ji(n,this.logger,t.killBehavior)}sendLaunchRequest(e,t){return t.dap.runInTerminalRequest(e)}};Ui=h([(0,nm.injectable)(),d(0,(0,nm.inject)(T))],Ui)});var $P,Ua,qP=m(()=>{"use strict";$P=require("inversify"),Ua=class{getTreatment(e,t){return Promise.resolve(t)}};Ua=h([(0,$P.injectable)()],Ua)});var HP,qn,zP=m(()=>{"use strict";j();HP=require("inversify"),qn=class{constructor(){this.flushEmitter=new S;this.onFlush=this.flushEmitter.event}report(){}reportOperation(){}attachDap(){}flush(){this.flushEmitter.fire()}dispose(){}};qn=h([(0,HP.injectable)()],qn)});var GP,Vi,JP,KP,Qp,Th,Va,QP=m(()=>{"use strict";GP=require("crypto"),Vi=require("inversify"),JP=require("os"),KP=w(require("path")),Qp=w(require("vscode"));xo();F();j();L();U();de();ce();G();En();Bn();Vp();Th=class{constructor(e){this.terminal=e;this.stopped=new Promise(t=>{let r=Qp.window.onDidCloseTerminal(o=>{o===e&&(t({code:0,killed:!0}),r.dispose())})})}gotTelemetery(){}stop(){return this.terminal.sendText(""),setTimeout(()=>this.terminal.dispose(),1),this.stopped}},Va=class extends yr{constructor(t,r,o,n,s){super(t,r,s,n);this.fs=o;this.terminalCreatedEmitter=new S;this.callbackFile=KP.join((0,JP.tmpdir)(),`node-debug-callback-${(0,GP.randomBytes)(8).toString("hex")}`);this.onTerminalCreated=this.terminalCreatedEmitter.event}async getProcessTelemetry(){try{return JSON.parse(await this.fs.readFile(this.callbackFile,"utf-8"))}catch{return}}resolveParams(t){if(t.type==="node-terminal"&&t.request==="launch")return t;if(t.type==="pwa-chrome"&&t.server&&"command"in t.server)return t.server}async launchProgram(t){let r;try{r=await this.resolveNodePath(t.params)}catch(a){if(a instanceof I&&a.cause.id===9230)throw a;r=new Zt("node",void 0)}let o=await this.resolveEnvironment(t,r,{fileCallback:this.callbackFile}),n=await this.createTerminal({name:t.params.name,cwd:t.params.cwd,iconPath:new Qp.ThemeIcon("debug"),env:Hd(r,o).defined(),isTransient:!0});this.terminalCreatedEmitter.fire(n),n.show();let s=this.program=new Th(n);t.params.command&&(await Promise.race([n.processId,k(1e3)]),n.sendText(t.params.command,!0)),s.stopped.then(a=>{s===this.program&&this.onProgramTerminated(a)})}createTerminal(t){return Promise.resolve(Qp.window.createTerminal(t))}dispose(){super.dispose(),this.fs.unlink(this.callbackFile).catch(()=>{})}};Va=h([(0,Vi.injectable)(),d(0,(0,Vi.inject)(no)),d(1,(0,Vi.inject)(T)),d(2,(0,Vi.inject)(z)),d(3,(0,Vi.inject)(Xt)),d(4,(0,Vi.inject)(ht))],Va)});var Hn,Yp,Wa,YP=m(()=>{"use strict";Hn=require("inversify"),Yp=require("vscode-tas-client");H();G();au();As();Wa=class{constructor(e,t){t&&e instanceof lr&&(this.service=(0,Yp.getExperimentationService)("ms-vscode.js-debug",on,ru?Yp.TargetPopulation.Insiders:Yp.TargetPopulation.Public,{setSharedProperty(r,o){e.setGlobalMetric(r,o)},postEvent(r,o){e.pushOutput({category:"telemetry",output:r,data:o})}},t.globalState))}async getTreatment(e,t){if(!this.service)return t;try{return await this.service.getTreatmentVariableAsync("vscode",e,!0)}catch{return t}}};Wa=h([(0,Hn.injectable)(),d(0,(0,Hn.inject)(nt)),d(1,(0,Hn.optional)()),d(1,(0,Hn.inject)(De))],Wa)});var XP,at,Ie,Lo=m(()=>{"use strict";XP=require("inversify"),at=w(require("vscode"));F();Ie=class{constructor(){this._onSessionAddedEmitter=new at.EventEmitter;this._onSessionEndedEmitter=new at.EventEmitter;this._disposables=[];this.sessions=new Map;this.onSessionAdded=this._onSessionAddedEmitter.event;this.onSessionEnded=this._onSessionEndedEmitter.event}static isConcreteSession(e){return!!e.configuration.__pendingTargetId}static pickSession(e,t){if(e.length<2)return e[0];let r=at.window.createQuickPick();return r.title=t,r.items=e.map(o=>({label:o.name,id:o.id})),r.ignoreFocusOut=!0,new Promise(o=>{r.onDidAccept(()=>o(e.find(n=>{var s;return n.id===((s=r.selectedItems[0])==null?void 0:s.id)}))),r.onDidHide(()=>o(void 0)),r.show()}).finally(()=>r.dispose())}get isDebugging(){return this.sessions.size>0}getById(e){return this.sessions.get(e)}isRunning(e){return[...this.sessions.values()].includes(e)}getByName(e){return[...this.sessions.values()].filter(t=>t.name===e)}getConcreteSessions(){return[...this.sessions.values()].filter(Ie.isConcreteSession)}getChildren(e){return[...this.sessions.values()].filter(t=>t.configuration.__parentId===e.id)}attach(){at.debug.onDidStartDebugSession(e=>{ti(e.type)&&(this.sessions.set(e.id,e),this._onSessionAddedEmitter.fire(e))},void 0,this._disposables),at.debug.onDidTerminateDebugSession(e=>{ti(e.type)&&(this.sessions.delete(e.id),this._onSessionEndedEmitter.fire(e))},void 0,this._disposables),at.debug.onDidReceiveDebugSessionCustomEvent(e=>{if(ti(e.session.type)){if(e.event==="revealLocationRequested"){let t=e.body,r=at.debug.asDebugSourceUri(e.body.source),o={};if(t.line){let n=new at.Position((t.line||1)-1,(t.column||1)-1);o.selection=new at.Range(n,n)}at.window.showTextDocument(r,o);return}if(e.event==="copyRequested"){let t=e.body;at.env.clipboard.writeText(t.text);return}}},void 0,this._disposables)}dispose(){for(let e of this._disposables)e.dispose();this._disposables=[]}};Ie=h([(0,XP.injectable)()],Ie)});var sm,ZP,$a,eC=m(()=>{"use strict";sm=require("inversify"),ZP=w(require("vscode"));Lo();$a=class{constructor(e){this.tracker=e}register(e){e.subscriptions.push(this.tracker.onSessionEnded(t=>{let r=t.configuration.cascadeTerminateToConfigurations;if(!(!r||!(r instanceof Array)))for(let o of r)for(let n of this.tracker.getByName(o))ZP.debug.stopDebugging(n)}))}};$a=h([(0,sm.injectable)(),d(0,(0,sm.inject)(Ie))],$a)});var tC,rC,oC=m(()=>{"use strict";tC=Symbol("IDebugConfigurationResolver"),rC=Symbol("IDebugConfigurationProvider")});var iC,nC,Ao,Rh=m(()=>{"use strict";iC=require("inversify"),nC=w(require("vscode"));F();Ao=class{get type(){return this.getType()}get triggerKind(){return this.getTriggerKind()}async provideDebugConfigurations(e,t){try{let r=await this.provide(e,t);if(!r)return[];let o=r instanceof Array?r:[r],n=yg.get(this.type);if(n)for(let s of o)s.type===this.type&&(s.type=n);return o}catch(r){return nC.window.showErrorMessage(r.message,{modal:!0}),[]}}};Ao=h([(0,iC.injectable)()],Ao)});var sC,qa,Dh=m(()=>{"use strict";sC=w(require("vscode")),qa=class{constructor(e){this.key=e}set value(e){e!==this._value&&(this._value=e,sC.commands.executeCommand("setContext",this.key,e))}get value(){return this._value}}});var aC,am,cC=m(()=>{"use strict";aC=Symbol("Uninitialized"),am=class{constructor(e,t){this.key=e;this.defaultValue=t;this._value=aC}write(e,t){t!==this.read(e)&&(this._value=t,e.update(this.key,t))}read(e){return this._value===aC&&(this._value=e.get(this.key)??this.defaultValue),this._value}}});var Xp,_h,cm,Ha,Ah=m(()=>{"use strict";Xp=require("inversify"),_h=w(require("vscode"));F();G();Lo();Dh();cC();cm=new am("sourceSteppingEnabled",!0),Ha=class{constructor(e,t){this.context=e;this.tracker=t}register(e){let t=new qa("jsDebugIsMapSteppingDisabled");cm.read(this.context.workspaceState)===!1&&(t.value=!0);let r=o=>{t.value=!o,cm.write(this.context.workspaceState,o);for(let n of this.tracker.getConcreteSessions())n.customRequest("setSourceMapStepping",{enabled:o})};e.subscriptions.push(Ke(_h.commands,"extension.js-debug.enableSourceMapStepping",async()=>{r(!0)}),Ke(_h.commands,"extension.js-debug.disableSourceMapStepping",async()=>{r(!1)}))}};Ha=h([(0,Xp.injectable)(),d(0,(0,Xp.inject)(De)),d(1,(0,Xp.inject)(Ie))],Ha)});var pm,pC,Eo,Sr,el=m(()=>{"use strict";pm=require("inversify"),pC=require("path"),Eo=w(require("vscode"));F();L();M();H();G();Ah();Sr=class{constructor(e){this.extensionContext=e}get type(){return this.getType()}async resolveDebugConfiguration(e,t,r){if(t.type&&(t.type=this.getType()),"__pendingTargetId"in t)return t;let o=t;o.sourceMaps??=cm.read(this.extensionContext.workspaceState);try{let n=await this.resolveDebugConfigurationAsync(e,o,r);return n&&this.commonResolution(n,e)}catch(n){Eo.window.showErrorMessage(n.message,{modal:!0})}}applyDefaultRuntimeExecutable(e){if(e.runtimeExecutable)return;let t=ar(Eo.workspace,"debug.javascript.defaultRuntimeExecutable"),r=t?t[e.type]:void 0;r&&(e.runtimeExecutable=r)}commonResolution(e,t){var r,o;return e.trace=Jm(e.trace,this.extensionContext.logPath),e.__workspaceCachePath=this.extensionContext.storagePath,e.__breakOnConditionalError=ar(Eo.workspace,"debug.javascript.breakOnConditionalError",t)??!1,t?e.__workspaceFolder=t.uri.fsPath:(e.__workspaceFolder||=this.getSuggestedWorkspaceFolders(e).filter(Fe).filter(n=>!n.includes("${workspaceFolder}")).map(n=>{var s;return(0,pC.isAbsolute)(n)?(s=Eo.workspace.getWorkspaceFolder(Eo.Uri.file(n)))==null?void 0:s.uri.fsPath:n}).find(Fe)||((o=(r=Eo.workspace.workspaceFolders)==null?void 0:r[0])==null?void 0:o.uri.fsPath)||"",e.__workspaceFolder?e=Tg(e):e=kg(e)),e}getSuggestedWorkspaceFolders(e){return[]}};Sr=h([(0,pm.injectable)(),d(0,(0,pm.inject)(De))],Sr)});function lm(i){lC.debug.activeDebugConsole.appendLine(i)}var lC,uC=m(()=>{"use strict";lC=w(require("vscode"))});async function za(i,e,t=!1){var n;let r=(n=e.processId)==null?void 0:n.trim(),o=r&&WD(r);if(!o||isNaN(o.pid))throw new Error(Eh.t("Attach to process: '{0}' doesn't look like a process id.",r||"<unknown>"));if(o.port||$D(o.pid),e.port=o.port||UD,delete e.processId,t){let s=await VD(i,o.pid);s&&(e.cwd=s)}}async function VD(i,e){var n;let t=e&&await Un.getWorkingDirectory(e);if(!t)return(n=zn.workspace.workspaceFolders)==null?void 0:n[0].uri.fsPath;let r=await Is(i,t,"package.json");if(!r)return t;let o=zn.workspace.getWorkspaceFolder(zn.Uri.file(t));return!o||El(o.uri.fsPath,r)?r:o.uri.fsPath}function $D(i){try{if(process.platform==="win32"){let e=`node -e process._debugProcess(${i})`;(0,dC.execSync)(e)}else process.kill(i,"SIGUSR1")}catch(e){throw new Error(Eh.t("Attach to process: cannot enable debug mode for process '{0}' ({1}).",i,e))}}var Eh,dC,OD,ND,zn,UD,WD,Fh=m(()=>{"use strict";Eh=w(require("@vscode/l10n")),dC=require("child_process"),OD=require("fs"),ND=require("path"),zn=w(require("vscode"));F();ae();Z();B();H();Yd();UD=9229;WD=i=>{let[e,t]=i.split(":");return{pid:Number(e),port:t?Number(t):void 0}}});function Mh(i,e){if(e)return e.uri.fsPath;if(tr.workspace.workspaceFolders&&tr.workspace.workspaceFolders.length>0)return tr.workspace.workspaceFolders[0].uri.fsPath;if(i){if(i==="${file}")return"${fileDirname}";if(xe.isAbsolute(i))return xe.dirname(i)}return"${workspaceFolder}"}function mC(i,e){var t;if(i&&(e=zr(e,"workspaceFolder",i.uri.fsPath)),(t=tr.workspace.workspaceFolders)!=null&&t.length&&(e=zr(e,"workspaceRoot",tr.workspace.workspaceFolders[0].uri.fsPath)),xe.isAbsolute(e))return e;if(i)return xe.join(i.uri.fsPath,e)}async function qD(i,e,t){if(t.outFiles||!e)return;let r;if(t.program?(r=mC(e,t.program),r&&(r=xe.dirname(r))):t.cwd&&(r=mC(e,t.cwd)),!r||Fl(e.uri.fsPath,r))return;let o=await bg(r,async n=>!n.includes("node_modules")&&await i.exists(xe.join(n,"package.json")));if(o){let n=E(xe.relative(e.uri.fsPath,o));n.length&&(t.outFiles=[...Xl.outFiles,`\${workspaceFolder}/${n}/**/*.js`,`!\${workspaceFolder}/${n}/**/node_modules/**`])}}async function Bh(i,e,t){var a;let r={type:"pwa-node",request:"launch",name:Wi.t("Launch Program"),skipFiles:["<node_internals>/**"]};t&&t.noDebug&&(r.noDebug=!0);let o=await gC(i,"package.json"),n,s=!1;if(o&&o.name==="mern-starter")return e&&lm(Wi.t("Launch configuration for '{0}' project created.","Mern Starter")),GD(r),r;if(o&&(n=await KD(i,o,e),n&&e&&lm(Wi.t("Launch configuration created based on 'package.json'."))),!n){let c=tr.window.activeTextEditor;c&&eu.includes(c.document.languageId)&&(s=c.document.languageId!=="javascript",n=i?xe.relative(i.uri.fsPath,c.document.uri.fsPath):c.document.uri.fsPath,xe.isAbsolute(n)||(n="${workspaceFolder}"+xe.sep+n))}if(!n&&i){let c=i.uri.fsPath;n=await Wr(HD.map(async p=>await Wt(Ja.promises,xe.join(c,p))&&"${workspaceFolder}"+xe.sep+p))}if(n||(n="${file}"),n&&(r.program=n,i||(r.__workspaceFolder=xe.dirname(n))),s||tr.workspace.textDocuments.some(c=>JD(c.languageId))){e&&lm(Wi.t("Adjust glob pattern(s) in the 'outFiles' attribute so that they cover the generated JavaScript."));let c="",p=await gC(i,"tsconfig.json");if((a=p==null?void 0:p.compilerOptions)!=null&&a.outDir&&zD()){let l=p.compilerOptions.outDir;xe.isAbsolute(l)||(c=l,c.indexOf("./")===0&&(c=c.substr(2)),c[c.length-1]!=="/"&&(c+="/")),r.preLaunchTask="tsc: build - tsconfig.json"}r.outFiles=["${workspaceFolder}/"+c+"**/*.js"]}return r}function zD(){let i=tr.workspace.getConfiguration().get("typescript.tsc.autoDetect");return i!=="off"&&i!=="watch"}function GD(i){i.request==="launch"&&(i.runtimeExecutable="nodemon",i.program="${workspaceFolder}/index.js",i.restart=!0,i.env={BABEL_DISABLE_CACHE:"1",NODE_ENV:"development"},i.console="integratedTerminal",i.internalConsoleOptions="neverOpen")}function JD(i){return i==="typescript"||i==="coffeescript"}async function gC(i,e){if(i)try{let t=await Ja.promises.readFile(xe.join(i.uri.fsPath,e),"utf8");return JSON.parse(t)}catch{}}async function KD(i,e,t){let r;try{if(e.main?r=e.main:e.scripts&&typeof e.scripts.start=="string"&&(r=e.scripts.start.split(" ").pop()),r){let o;if(xe.isAbsolute(r)?o=r:(o=i?xe.join(i.uri.fsPath,r):void 0,r=xe.join("${workspaceFolder}",r)),t&&o&&!await Wt(Ja.promises,o)&&!await Wt(Ja.promises,o+".js"))return}}catch{}return r}var Wi,Ja,Ga,xe,tr,co,HD,Ka=m(()=>{"use strict";Wi=w(require("@vscode/l10n")),Ja=require("fs"),Ga=require("inversify"),xe=w(require("path")),tr=w(require("vscode"));uC();F();to();ui();ae();Z();U();B();H();G();om();Ch();Fh();el();co=class extends Sr{constructor(t,r,o){super(t);this.nvmResolver=r;this.fsUtils=o}async resolveDebugConfigurationWithSubstitutedVariables(t,r){let o=r;if(o.type==="pwa-node"&&o.request==="attach"&&typeof o.processId=="string"&&await za(this.fsUtils,o),o.cwd){let n=await Wt(Ja.promises,o.cwd);if(!n){tr.window.showErrorMessage(Wi.t("The configured `cwd` {0} does not exist.",o.cwd),{modal:!0});return}if(!n.isDirectory()){tr.window.showErrorMessage(Wi.t("The configured `cwd` {0} is not a folder.",o.cwd),{modal:!0});return}}return o}async resolveDebugConfigurationAsync(t,r,o){if(!r.name&&!r.type&&!r.request&&(r=await Bh(t,!0,r),r.request==="launch"&&!r.program)){tr.window.showErrorMessage(Wi.t("Cannot find a program to debug"),{modal:!0});return}if(r.cwd||(r.cwd=r.localRoot||Mh(r.request==="launch"?r.program:void 0,t)),r.remoteRoot&&!r.localRoot&&(r.localRoot="${workspaceFolder}"),r.request==="launch"){if(this.applyDefaultRuntimeExecutable(r),r.runtimeExecutable&&Ql(r.runtimeExecutable)==="deno"&&!r.attachSimplePort){let s=await je();r.attachSimplePort=s,r.continueOnAttach??=!0;let a=[`--inspect-brk=127.0.0.1:${s}`,"--allow-all"];r.runtimeArgs?r.runtimeArgs.includes("run")?r.runtimeArgs=[...r.runtimeArgs,...a]:r.runtimeArgs=["run",...a,...r.runtimeArgs]:r.runtimeArgs=["run",...a]}let n=r.runtimeVersion;if(typeof n=="string"&&n!=="default"){let{directory:s,binary:a}=await this.nvmResolver.resolveNvmVersionPath(n);r.env=new oe(r.env).addToPath(s,"prepend",!0).value,r.runtimeExecutable=!r.runtimeExecutable||r.runtimeExecutable==="node"?a:r.runtimeExecutable}if(r.console==="integratedTerminal"&&!r.internalConsoleOptions&&(r.internalConsoleOptions="neverOpen"),r.attachSimplePort===null||r.attachSimplePort===void 0)Zd(r);else{if(r.attachSimplePort===0){r.attachSimplePort=await je(void 0,o);let s=`--inspect-brk=${r.attachSimplePort}`;r.runtimeArgs=r.runtimeArgs?[...r.runtimeArgs,s]:[s]}r.continueOnAttach=!r.stopOnEntry,r.stopOnEntry=!1}await qD(this.fsUtils,t,r)}return Cg(r)}getType(){return"pwa-node"}getSuggestedWorkspaceFolders(t){return[t.rootPath,t.cwd]}};co=h([(0,Ga.injectable)(),d(0,(0,Ga.inject)(De)),d(1,(0,Ga.inject)(rm)),d(2,(0,Ga.inject)(mt))],co);HD=["index.js","main.js"]});var fC,Qa,jh=m(()=>{"use strict";fC=w(require("vscode"));F();H();el();Ka();Qa=class extends Sr{async resolveDebugConfigurationAsync(e,t){if(t.cwd||(t.cwd=Mh(void 0,e)),t.request==="launch"&&!t.command){await _t(fC.commands,"extension.js-debug.createDebuggerTerminal",void 0,e);return}return t.remoteRoot&&!t.localRoot&&(t.localRoot="${workspaceFolder}"),xg(t)}getType(){return"node-terminal"}}});var Ya,Fo,hC,Xa,tl,QD,YD,$i,qi,Oh=m(()=>{"use strict";Ya=w(require("@vscode/l10n")),Fo=require("inversify"),hC=require("os"),Xa=require("path"),tl=w(require("vscode"));F();ui();ae();U();G();Rh();el();Ka();jh();QD=i=>i.request==="launch",YD=i=>i.request==="attach",$i=class extends Sr{constructor(t,r,o,n,s){super(t);this.nodeProvider=r;this.terminalProvider=o;this.location=n;this.fs=s}async resolveBrowserCommon(t,r){if(r.request,r.server&&"program"in r.server){let n={...r.server,type:"pwa-node",request:"launch",name:`${r.name}: Server`};r.server=await this.nodeProvider.resolveDebugConfiguration(t,n)}else r.server&&"command"in r.server&&(r.server=await this.terminalProvider.resolveDebugConfiguration(t,{...r.server,type:"node-terminal",request:"launch",name:`${r.name}: Server`}));let o=this.location==="remote"?"ui":"workspace";if(QD(r)&&!r.browserLaunchLocation&&(r.browserLaunchLocation=o),YD(r)&&!r.browserAttachLocation&&(r.browserAttachLocation=o),r.request==="launch"){let n=r;this.applyDefaultRuntimeExecutable(n)}}getSuggestedWorkspaceFolders(t){return[t.rootPath,t.webRoot]}async resolveDebugConfigurationWithSubstitutedVariables(t,r){if("__pendingTargetId"in r)return r;let o=r;if(o.request==="launch"){let n=await this.ensureNoLockfile(o);if(n===void 0)return;o=n}return o}async ensureNoLockfile(t){var a;if(t.request!=="launch")return t;let r=t;if(r.userDataDir===!1||r.port&&!await rv(r.port))return t;let o=typeof r.userDataDir=="string"?r.userDataDir:(0,Xa.join)(this.extensionContext.storagePath??(0,hC.tmpdir)(),(a=r.runtimeArgs)!=null&&a.includes("--headless")?".headless-profile":".profile"),n=(0,Xa.join)(o,process.platform==="win32"?"lockfile":"SingletonLock");if(await Wr([nw(this.fs,n),this.isVsCodeLocked((0,Xa.join)(o,"code.lock"))])){let c=Ya.t("Debug Anyway");if(await tl.window.showErrorMessage(Ya.t("It looks like a browser is already running from {0}. Please close it before trying to debug, otherwise VS Code may not be able to connect to it.",r.userDataDir===!0?Ya.t("an old debug session"):Ya.t("the configured userDataDir")),{modal:!0},c)!==c)return}return{...t,userDataDir:o}}async isVsCodeLocked(t){try{let r=Number(await this.fs.readFile(t,"utf-8"));return process.kill(r,0),!0}catch{return!1}}};$i=h([(0,Fo.injectable)(),d(0,(0,Fo.inject)(De)),d(1,(0,Fo.inject)(co)),d(2,(0,Fo.inject)(Qa)),d(3,(0,Fo.inject)(Io)),d(4,(0,Fo.inject)(z))],$i);qi=class extends Ao{provide(){return this.createLaunchConfigFromContext()||this.getDefaultLaunch()}getTriggerKind(){return tl.DebugConfigurationProviderTriggerKind.Initial}createLaunchConfigFromContext(){let e=tl.window.activeTextEditor;if(e&&e.document.languageId==="html")return{type:this.getType(),request:"launch",name:`Open ${(0,Xa.basename)(e.document.uri.fsPath)}`,file:e.document.uri.fsPath}}getDefaultLaunch(){return{type:this.getType(),request:"launch",name:Ya.t("Launch Chrome against localhost"),url:"http://localhost:8080",webRoot:"${workspaceFolder}"}}};qi=h([(0,Fo.injectable)()],qi)});var Nh,Za,Gn,bC=m(()=>{"use strict";H();F();Oh();Nh=require("inversify"),Za=class extends $i{async resolveDebugConfigurationAsync(e,t){if(!t.name&&!t.type&&!t.request){let r=new Gn().createLaunchConfigFromContext();if(!r)return null;t=r}return await this.resolveBrowserCommon(e,t),t.request==="attach"?{...Zc,...t}:{...Ts,...t}}getType(){return"pwa-chrome"}};Za=h([(0,Nh.injectable)()],Za);Gn=class extends qi{getType(){return"pwa-chrome"}};Gn=h([(0,Nh.injectable)()],Gn)});var wC,Uh,ec,Jn,yC=m(()=>{"use strict";wC=w(require("@vscode/l10n")),Uh=require("inversify");F();H();Oh();ec=class extends $i{async resolveDebugConfigurationAsync(e,t){if(!t.name&&!t.type&&!t.request){let r=new Jn().createLaunchConfigFromContext();if(!r)return;t=r}return await this.resolveBrowserCommon(e,t),t.useWebView&&(t.timeout=t.timeout??0),t.request==="attach"?{...Ig,...t}:{...Pg,...t}}getType(){return"pwa-msedge"}};ec=h([(0,Uh.injectable)()],ec);Jn=class extends qi{getType(){return"pwa-msedge"}getDefaultLaunch(){return{...super.getDefaultLaunch(),name:wC.t("Launch Edge against localhost")}}};Jn=h([(0,Uh.injectable)()],Jn)});var SC,IC,PC,Hi,vC,XD,Vh=m(()=>{"use strict";SC=require("fs"),IC=require("inversify"),PC=require("path");F();H();el();Hi=class extends Sr{async resolveDebugConfigurationAsync(e,t){if(t.debugWebWorkerHost===void 0){let r=await XD(e,t);t={...t,debugWebWorkerHost:r.length===1&&r[0]==="web"}}return t.debugWebWorkerHost&&(t.outFiles=[]),Zl(t),Promise.resolve({...Sg,...t})}getType(){return"pwa-extensionHost"}};Hi=h([(0,IC.injectable)()],Hi);vC="--extensionDevelopmentPath=",XD=async(i,e)=>{var n;let t=(n=e.args)==null?void 0:n.find(s=>s.startsWith(vC));if(!t)return["workspace"];let r=zr(t.slice(vC.length),"workspaceFolder",(i==null?void 0:i.uri.fsPath)??e.__workspaceFolder??""),o;try{let s=await SC.promises.readFile((0,PC.join)(r,"package.json"),"utf-8");o=JSON.parse(s).extensionKind??"workspace"}catch{return["workspace"]}return o instanceof Array?o:[o]}});var CC,xC,Wh=m(()=>{"use strict";CC=require("vscode"),xC=async i=>{try{return await CC.commands.executeCommand("npm.packageManager",i==null?void 0:i.uri)}catch{return"npm"}}});async function RC(i,e=!1){let t=i??Ae.workspace.workspaceFolders??[];if(!t||t.length===0){e||Ae.window.showErrorMessage(tc.t("You need to open a workspace folder to debug npm scripts."));return}let r=(await Promise.all(t.map(s=>Ae.workspace.findFiles(new Ae.RelativePattern(s,"**/package.json"),"**/{node_modules,.vscode-test}/**")))).flat();if(r.length===0){e||Ae.window.showErrorMessage(tc.t("No package.json files found in your workspace."));return}let o=[],n={path:r[0].fsPath,score:0};for(let{fsPath:s}of new Set(r)){n=$h(n,{path:s,score:1});let a;try{a=JSON.parse(await nr(s))}catch(c){e||kC("showWarningMessage",tc.t("Could not read {0}: {1}",s,c.message),s),n=$h(n,{path:void 0,score:3});continue}if(n=$h(n,{path:void 0,score:2}),!!a.scripts)for(let c of Object.keys(a.scripts))o.push({directory:qh.dirname(s),name:c,command:a.scripts[c]})}if(o.length===0){n.path&&!e&&kC("showErrorMessage",tc.t("No npm scripts found in your package.json"),n.path);return}return o.sort((s,a)=>(s.name==="start"?-1:0)+(a.name==="start"?1:0)),o}async function kC(i,e,t){let r=tc.t("Edit package.json");if(await Ae.window[i](e,r)!==r)return;if(TC.existsSync(t)){let a=await Ae.workspace.openTextDocument(t);await Ae.window.showTextDocument(a);return}let o=await Ae.workspace.openTextDocument(Ae.Uri.file(t).with({scheme:"untitled"})),n=await Ae.window.showTextDocument(o);await n.edit(a=>a.insert(new Ae.Position(0,0),ZD));let s=new Ae.Position(2,5);n.selection=new Ae.Selection(s,s)}var tc,TC,qh,Ae,$h,ZD,DC=m(()=>{"use strict";tc=w(require("@vscode/l10n")),TC=w(require("fs")),qh=w(require("path")),Ae=w(require("vscode"));F();ae();Wh();$h=(i,e)=>i.score>e.score?i:e;ZD=`{
  "scripts": {
    
  }
}
`});var um,Hh,ic,rl,rc,e_,oc,_C=m(()=>{"use strict";um=w(require("@vscode/l10n")),Hh=require("inversify"),ic=w(require("path")),rl=w(require("vscode"));F();M();H();DC();Wh();Rh();Ka();rc=class extends Ao{provide(e){return Bh(e,!0)}getType(){return"pwa-node"}getTriggerKind(){return rl.DebugConfigurationProviderTriggerKind.Initial}};rc=h([(0,Hh.injectable)()],rc);e_=["cwd","program"],oc=class extends Ao{async provide(e){let t=Yi(await Promise.all([this.getFromNpmScripts(e),this.getFromActiveFile()]));if(e)for(let r of t){let o=r;for(let n of e_){let s=o[n];s&&ic.isAbsolute(s)&&(o[n]=ic.join("${workspaceFolder}",ic.relative(e.uri.fsPath,s)))}}return t}getType(){return"pwa-node"}getTriggerKind(){return rl.DebugConfigurationProviderTriggerKind.Dynamic}async getFromNpmScripts(e){let t={type:ks("node-terminal"),name:um.t("JavaScript Debug Terminal"),request:"launch",cwd:e==null?void 0:e.uri.fsPath};if(!e)return[t];let r=await RC([e],!0);if(!r)return[t];let o=await xC(e);return r.map(n=>({type:ks("node-terminal"),name:um.t("Run Script: {0}",n.name),request:"launch",command:`${o} run ${n.name}`,cwd:n.directory})).concat(t)}getFromActiveFile(){let e=rl.window.activeTextEditor;return!e||!eu.includes(e.document.languageId)||e.document.uri.scheme!=="file"?[]:[{type:ks("pwa-node"),name:um.t("Run Current File"),request:"launch",program:e.document.uri.fsPath}]}};oc=h([(0,Hh.injectable)()],oc)});var LC,AC,EC=m(()=>{"use strict";oC();bC();yC();Vh();_C();Ka();jh();LC=[Za,ec,Hi,co,Qa],AC=[Gn,Jn,rc,oc]});function zh(i,e){if(i){try{if(new Gh.URL(i).hostname)return i}catch{}try{let t=`http://${i}`,r=new Gh.URL(t);if(!e||r.port)return t}catch{}}}var nc,ol,Gh,Nt,sc,MC=m(()=>{"use strict";nc=w(require("@vscode/l10n")),ol=require("inversify"),Gh=require("url"),Nt=w(require("vscode"));F();_p();G();sc=class{constructor(e,t){this.defaultBrowser=e;this.context=t}register(e){e.subscriptions.push(Nt.commands.registerCommand("extension.js-debug.debugLink",t=>this.handle(t)))}async handle(e){var n;if(e=e??await this.getLinkFromTextEditor()??await this.getLinkFromQuickInput(),!e)return;let t="pwa-chrome";try{await this.defaultBrowser.lookup()===3&&(t="pwa-msedge")}catch{}let r=ar(Nt.workspace,"debug.javascript.debugByLinkOptions")??{},o={...typeof r=="string"?{}:r,type:ks(t),name:e,request:"launch",url:e};Nt.debug.startDebugging((n=Nt.workspace.workspaceFolders)==null?void 0:n[0],o),this.persistConfig(o)}getLinkFromTextEditor(){let e=Nt.window.activeTextEditor;if(e)return zh(e.document.getText(e.selection),!0)}async getLinkFromQuickInput(){let e=await Nt.env.clipboard.readText(),t=await Nt.window.showInputBox({value:zh(e,!1)||this.mostRecentLink,placeHolder:"https://localhost:8080",validateInput:r=>{if(r&&!zh(r,!1))return nc.t("The URL provided is invalid")}});if(t)return this.mostRecentLink=t,t}async persistConfig(e){if(this.context.globalState.get("saveDebugLinks")===!1)return;let t=Nt.workspace.getConfiguration("launch"),r=t.get("configurations")??[];if(r.some(a=>a.url===e.url))return;let o=nc.t("Yes"),n=nc.t("Never"),s=await Nt.window.showInformationMessage(nc.t("Would you like to save a configuration in your launch.json for easy access later?"),o,nc.t("No"),n);s===n&&this.context.globalState.update("saveDebugLinks",!1),s===o&&await t.update("configurations",[...r,e])}};sc=h([(0,ol.injectable)(),d(0,(0,ol.inject)(ua)),d(1,(0,ol.inject)(De))],sc)});var ac,pc,rr,BC,cc,jC=m(()=>{"use strict";ac=w(require("@vscode/l10n")),pc=require("inversify"),rr=w(require("vscode"));F();G();Lo();BC="neverRemind",cc=class{constructor(e,t,r){this.fs=e;this.context=t;this.tracker=r;this.dismissedForSession=!1;this.isPrompting=!1}register(e){e.subscriptions.push(Ke(rr.commands,"extension.js-debug.getDiagnosticLogs",async()=>{let t=await this.getTargetSession();if(!t)return;let r=await rr.window.showSaveDialog({filters:{JSON:["json"]}});r&&t.customRequest("saveDiagnosticLogs",{toFile:r.fsPath})}),Ke(rr.commands,"extension.js-debug.createDiagnostics",async()=>this.getDiagnosticInfo(await this.getTargetSession())),rr.debug.onDidReceiveDebugSessionCustomEvent(async t=>{if(t.event==="openDiagnosticTool")return this.openDiagnosticTool(t.body.file);if(t.event!=="suggestDiagnosticTool"||this.dismissedForSession||this.context.workspaceState.get(BC)||this.isPrompting)return;this.isPrompting=!0;let r=ac.t("Yes"),o=ac.t("Not Now"),n=ac.t("Never"),s=await rr.window.showInformationMessage("It looks like you might be having trouble with breakpoints. Would you like to open our diagnostic tool?",r,o,n);switch(this.isPrompting=!1,s){case r:this.getDiagnosticInfo(await this.getTargetSession(),!0);break;case n:e.workspaceState.update(BC,!0);break;case o:this.dismissedForSession=!0;break}}))}getTargetSession(){let e=rr.debug.activeDebugSession;if(!e||!ti(e==null?void 0:e.type))return this.pickSession();if(Ie.isConcreteSession(e))return e;let t=this.tracker.getChildren(e);return t.length===1?t[0]:this.pickSession()}pickSession(){return Ie.pickSession(this.tracker.getConcreteSessions(),ac.t("Select the session you want to inspect:"))}async getDiagnosticInfo(e,t=!1){if(!e||!this.tracker.isRunning(e)){rr.window.showErrorMessage(ac.t('It looks like your debug session has already ended. Try debugging again, then run the "Debug: Diagnose Breakpoint Problems" command.'));return}let{file:r}=await e.customRequest("createDiagnostics",{fromSuggestion:t});await this.openDiagnosticTool(r)}async openDiagnosticTool(e){let t=rr.window.createWebviewPanel("jsDebugDiagnostics","Debug Diagnostics",rr.ViewColumn.Active,{enableScripts:!0});t.webview.html=await this.fs.readFile(e,"utf-8")}};cc=h([(0,pc.injectable)(),d(0,(0,pc.inject)(z)),d(1,(0,pc.inject)(De)),d(2,(0,pc.inject)(Ie))],cc)});var lc,OC,Ir,Kn,NC=m(()=>{"use strict";lc=w(require("@vscode/l10n")),OC=require("inversify"),Ir=w(require("vscode"));F();Kn=class{register(e){e.subscriptions.push(Ir.debug.onDidReceiveDebugSessionCustomEvent(t=>{if(t.event!=="suggestDisableSourcemap"||!ti(t.session.type))return;let r=t.body;this.unmap(t.session,r.source).catch(o=>Ir.window.showErrorMessage(o.message))}))}async unmap(e,t){(ar(Ir.workspace,"debug.javascript.unmapMissingSources")||await this.prompt())&&await e.customRequest("disableSourcemap",{source:t})}async prompt(){let e=lc.t("Always"),t=lc.t("Always in this Workspace"),r=lc.t("Yes");switch(await Ir.window.showInformationMessage(lc.t("This is a missing file path referenced by a sourcemap. Would you like to debug the compiled version instead?"),e,t,lc.t("No"),r)){case e:return vg(Ir.workspace,"debug.javascript.unmapMissingSources",!0,Ir.ConfigurationTarget.Global),!0;case t:return vg(Ir.workspace,"debug.javascript.unmapMissingSources",!0,Ir.ConfigurationTarget.Workspace),!0;case r:return!0;default:return!1}}};Kn=h([(0,OC.injectable)()],Kn)});function o_(i){let e=i;for(;e.parentSession;)e=e.parentSession;return e}var VC,dm,zi,UC,t_,r_,uc,WC=m(()=>{"use strict";VC=w(require("@vscode/l10n")),dm=require("inversify"),zi=w(require("vscode"));F();Ko();Lo();UC=i=>{if((i==null?void 0:i.type)!=="pwa-msedge")return!1;let e=i.configuration.__browserTargetType;return e==="iframe"||e==="page"},t_="ms-edgedevtools.vscode-edge-devtools",r_="vscode-edge-devtools.attachToCurrentDebugTarget";uc=class{constructor(e){this.tracker=e}register(e){e.subscriptions.push(Ke(zi.commands,"extension.js-debug.openEdgeDevTools",async()=>{let t=zi.debug.activeDebugSession&&UC(zi.debug.activeDebugSession)?zi.debug.activeDebugSession:await Ie.pickSession(this.tracker.getConcreteSessions().filter(UC),VC.t("Select the page where you want to open the devtools"));if(!t)return;let r=o_(t);try{return await zi.commands.executeCommand(r_,t.id,r.configuration)}catch(o){if(o instanceof Error&&/command .+ not found/.test(o.message))return zi.commands.executeCommand("workbench.extensions.action.showExtensionsWithIds",[t_]);throw o}}))}};uc=h([(0,dm.injectable)(),d(0,(0,dm.inject)(Ie))],uc)});var zC,mm,GC,we,$C,qC,HC,Jh,dc,JC=m(()=>{"use strict";zC=require("crypto"),mm=require("inversify"),GC=require("path"),we=w(require("vscode"));F();Lo();$C=({name:i,line:e,column:t,source:r})=>`${i} (${(0,GC.basename)(String(r.path))}:${e}:${t})`,qC=({name:i,line:e,column:t,source:r})=>`${i} (${r.path}:${e}:${t})`,HC=async({line:i,column:e,source:t})=>{if(t.sourceReference!==0||!t.path)return;let r=we.Uri.file(t.path),o=await we.workspace.openTextDocument(r),n=await we.window.showTextDocument(o),s=new we.Position(i-1,e-1);n.revealRange(new we.Range(s,s)),n.selection=new we.Selection(s,s)},Jh=class{constructor(e,t){this.caller=e;this.target=t;this.treeItem=new we.TreeItem(`${$C(e)} \u2192 ${$C(t)}`,we.TreeItemCollapsibleState.None),this.treeItem.tooltip=`Breaks at ${qC(t)} containing ${qC(e)} will be skipped`,this.id=this.treeItem.id=(0,zC.createHash)("sha1").update(JSON.stringify([e,t])).digest("base64")}toDap(){return{caller:this.caller,target:this.target}}},dc=class{constructor(e){this.sessionTracker=e;this._onDidChangeTreeData=new we.EventEmitter;this.allCallers=new Map;this.lastHadCallers=!1;this.onDidChangeTreeData=this._onDidChangeTreeData.event}register(e){e.subscriptions.push(we.window.createTreeView("jsExcludedCallers",{treeDataProvider:this}),Ke(we.commands,"extension.js-debug.callers.add",async(t,r)=>{var a;let o=await((a=this.sessionTracker.getById(r.sessionId))==null?void 0:a.customRequest("stackTrace",{threadId:0,startFrame:0,levels:1}));if(!(o!=null&&o.stackFrames.length))return;let n=o.stackFrames[0],s=new Jh({name:r.frameName,column:r.frameLocation.range.startColumn,line:r.frameLocation.range.startLineNumber,source:r.frameLocation.source},{name:n.name,column:n.column,line:n.line,source:n.source});this.allCallers.set(s.id,s),this.triggerUpdate()}),Ke(we.commands,"extension.js-debug.callers.goToCaller",t=>HC(t.caller)),Ke(we.commands,"extension.js-debug.callers.gotToTarget",t=>HC(t.target)),Ke(we.commands,"extension.js-debug.callers.remove",async t=>{this.allCallers.delete(t.id),this.triggerUpdate()}),Ke(we.commands,"extension.js-debug.callers.removeAll",async()=>{this.allCallers.clear(),this.triggerUpdate()}),this.sessionTracker.onSessionAdded(t=>{this.allCallers.size>0&&this.sendCallersToSession(t)}))}getTreeItem(e){return e.treeItem}getChildren(e){return e?[]:[...this.allCallers.values()]}sendCallersToSession(e){e.customRequest("setExcludedCallers",{callers:[...this.allCallers.values()].map(t=>t.toDap())})}triggerUpdate(){this._onDidChangeTreeData.fire(void 0);for(let t of this.sessionTracker.getConcreteSessions())this.sendCallersToSession(t);let e=this.allCallers.size>0;e!==this.lastHadCallers&&(Qc(we.commands,"jsDebugHasExcludedCallers",e),this.lastHadCallers=e)}};dc=h([(0,mm.injectable)(),d(0,(0,mm.inject)(Ie))],dc)});var Kh,il,KC,i_,mc,QC=m(()=>{"use strict";Kh=w(require("@vscode/l10n")),il=require("inversify");G();KC="linkBpWarnIgnored",i_="https://code.visualstudio.com/docs/nodejs/nodejs-debugging#_can-i-debug-if-im-using-symlinks",mc=class{constructor(e,t){this.vscode=e;this.context=t;this.didWarn=this.context.workspaceState.get(KC,!1)}async warn(){if(this.didWarn)return;this.didWarn=!0;let e=Kh.t("Read More"),t=Kh.t("Ignore"),r=await this.vscode.window.showWarningMessage("It looks like you have symlinked files. You might need to update your configuration to make this work as expected.",t,e);r===t?this.context.workspaceState.update(KC,!0):r===e&&this.vscode.env.openExternal(this.vscode.Uri.parse(i_))}};mc=h([(0,il.injectable)(),d(0,(0,il.inject)(cr)),d(1,(0,il.inject)(De))],mc)});var nl,gm,XC,Mo,YC,gc,ZC=m(()=>{"use strict";nl=w(require("@vscode/l10n")),gm=require("inversify"),XC=require("path"),Mo=w(require("vscode"));G();YC="omitLongPredictions",gc=class{constructor(e){this.context=e}register(e){e.subscriptions.push(Mo.debug.onDidReceiveDebugSessionCustomEvent(t=>{t.event==="longPrediction"&&this.promptLongBreakpoint(t.session.workspaceFolder)}))}async promptLongBreakpoint(e){if(this.context.workspaceState.get(YC))return;let t=nl.t("It's taking a while to configure your breakpoints. You can speed this up by updating the 'outFiles' in your launch.json."),r=nl.t("Open launch.json"),o=nl.t("Don't show again"),n=await Mo.window.showWarningMessage(t,o,r);if(n===o){this.context.workspaceState.update(YC,!0);return}if(n!==r)return;if(e||(e=await Mo.window.showWorkspaceFolderPick()),!e){await Mo.window.showWarningMessage(nl.t("No workspace folder open."));return}let s=await Mo.workspace.openTextDocument((0,XC.join)(e.uri.fsPath,".vscode","launch.json"));await Mo.window.showTextDocument(s)}};gc=h([(0,gm.injectable)(),d(0,(0,gm.inject)(De))],gc)});var fm,hc,fc,ex=m(()=>{"use strict";fm=require("inversify"),hc=require("vscode");xo();ui();fc=class{constructor(e){this.leaseTracker=e;this.cachedResolutions=new Array(16).fill("");this.cachedResolutionIndex=0}register(e){typeof hc.workspace.registerPortAttributesProvider=="function"&&e.subscriptions.push(hc.workspace.registerPortAttributesProvider({portRange:[53e3,54e3]},this))}async providePortAttributes(e,t){if(t&&this.cachedResolutions.includes(`${e}:${t}`))return{port:e,autoForwardAction:hc.PortAutoForwardAction.Ignore};if(await this.leaseTracker.isRegistered(e)){if(t){let r=this.cachedResolutionIndex++%this.cachedResolutions.length;this.cachedResolutions[r]=`${e}:${t}`}return{port:e,autoForwardAction:hc.PortAutoForwardAction.Ignore}}}};fc=h([(0,fm.injectable)(),d(0,(0,fm.inject)(ht))],fc)});var hm,rx,Qn,bc,tx,n_,ox=m(()=>{"use strict";hm=require("inversify"),rx=w(require("querystring")),Qn=w(require("vscode"));F();Lo();Dh();bc=class{constructor(e){this.tracker=e;this.canPrettyPrintKey=new qa("jsDebugCanPrettyPrint")}register(e){e.subscriptions.push(Ke(Qn.commands,"extension.js-debug.prettyPrint",()=>this.prettifyActive()),Qn.window.onDidChangeActiveTextEditor(t=>this.updateEditorState(t)),this.tracker.onSessionAdded(()=>this.updateEditorState(Qn.window.activeTextEditor)),this.tracker.onSessionEnded(()=>this.updateEditorState(Qn.window.activeTextEditor)))}async prettifyActive(){let e=Qn.window.activeTextEditor;if(!e||!this.canPrettyPrint(e))return;let{sessionId:t,source:r}=n_(e.document.uri),o=t&&this.tracker.getById(t);if(o)tx(o,r,e.selection.start);else for(let n of this.tracker.getConcreteSessions())tx(n,r,e.selection.start)}canPrettyPrint(e){return this.tracker.isDebugging&&e.document.languageId==="javascript"&&!e.document.fileName.endsWith("-pretty.js")}updateEditorState(e){var t;if(!this.tracker.isDebugging){this.canPrettyPrintKey.value=void 0;return}e&&this.canPrettyPrint(e)&&e.document.uri.toString()!==((t=this.canPrettyPrintKey.value)==null?void 0:t[0])&&(this.canPrettyPrintKey.value=[e.document.uri.toString()])}};bc=h([(0,hm.injectable)(),d(0,(0,hm.inject)(Ie))],bc);tx=(i,e,t)=>i.customRequest("prettyPrintSource",{source:e,line:t.line,column:t.character}),n_=i=>{let e=rx.parse(i.query),t=e.session,r={path:i.fsPath,sourceReference:Number(e.ref)||0};return{sessionId:t,source:r}}});var sl,al,nx,Br,ix,wc,bm,sx=m(()=>{"use strict";sl=w(require("@vscode/l10n")),al=require("inversify"),nx=w(require("path")),Br=w(require("vscode"));M();G();ix="breakpointTerminationWarnedSlow",wc=class{constructor(e,t){this.fs=e;this.context=t;this.sortOrder=2;this.id="breakpoint";this.label=sl.t("Pick Breakpoint");this.description=sl.t("Run until a specific breakpoint is hit")}async onPick(e,t){if(t)return new bm(t);let r=Br.window.createQuickPick();r.canSelectMany=!0,r.matchOnDescription=!0,r.busy=!0;let o=await new Promise(n=>{r.onDidAccept(()=>n(r.selectedItems)),r.onDidHide(()=>n(void 0)),r.onDidChangeActive(async s=>{if(!s.length)return;let a=s[0].location,c=await Br.workspace.openTextDocument(a.uri);Br.window.showTextDocument(c,{selection:a.range,preview:!0,preserveFocus:!0})}),r.show(),(async()=>{let s=Br.debug.breakpoints.filter(p=>p.enabled&&p instanceof Br.SourceBreakpoint),a=await Promise.all(s.map(p=>e.getDebugProtocolBreakpoint(p))),c=await this.getCandidates(a,s);r.items=c,r.selectedItems=c,r.busy=!1})()});if(r.dispose(),!!o)return await this.warnSlowCode(),new bm(o.map(n=>Number(n.id)))}async warnSlowCode(){this.context.workspaceState.get(ix)||(Br.window.showWarningMessage(sl.t('Profiling with breakpoints enabled can change the performance of your code. It can be useful to validate your findings with the "duration" or "manual" termination conditions.'),sl.t("Got it!")),await this.context.workspaceState.update(ix,!0))}async getCandidates(e,t){if(e.length!==t.length)throw new Error("Mismatched breakpoint array lengths");let r=bo(n=>this.getFileLines(n));return(await Promise.all(t.map(async(n,s)=>{var f;let a=e[s];if(!a||!a.id)return;let c=n.location,p=Br.workspace.getWorkspaceFolder(c.uri),l=p?nx.relative(p.uri.fsPath,c.uri.fsPath):c.uri.fsPath,u=await r(c.uri.fsPath);return{id:a.id,label:`${l}:${c.range.start.line}:${c.range.start.character}`,location:c,description:(f=u==null?void 0:u[c.range.start.line])==null?void 0:f.trim()}}))).filter(Fe)}async getFileLines(e){try{return(await this.fs.readFile(e,"utf-8")).split(`
`)}catch{return}}};wc=h([(0,al.injectable)(),d(0,(0,al.inject)(z)),d(1,(0,al.inject)(De))],wc);bm=class{constructor(e){this.breakpointIds=e}get customData(){return{stopAtBreakpoint:this.breakpointIds.slice()}}dispose(){}}});var wm,po,cl,Qh=m(()=>{"use strict";wm=w(require("@vscode/l10n")),po=w(require("vscode"));$e();j();cl=class{constructor(e,t,r){this.session=e;this.impl=t;this.termination=r;this.statusChangeEmitter=new S;this.stopEmitter=new S;this._innerStatus=[];this.disposables=new O;this.state=0;this.onStatusChange=this.statusChangeEmitter.event;this.onStop=this.stopEmitter.event;var o;this.disposables.push(po.debug.onDidReceiveDebugSessionCustomEvent(n=>{n.session===e&&n.event==="profilerStateUpdate"&&this.onStateUpdate(n.body)}),po.debug.onDidTerminateDebugSession(n=>{n===e&&this.stopEmitter.fire(void 0)})),r&&(this.disposables.push(r),(o=r.attachTo)==null||o.call(r,this))}get status(){return this._innerStatus.filter(e=>!!e).join(", ")||void 0}async start(){try{await po.window.withProgress({location:po.ProgressLocation.Window,title:wm.t("Starting profile...")},()=>{var e;return this.session.customRequest("startProfile",{type:this.impl.type,...(e=this.termination)==null?void 0:e.customData})})}catch(e){po.window.showErrorMessage(e.message),this.stopEmitter.fire(void 0)}}dispose(){this.state=2,this.disposables.dispose()}setFile(e){this.file=e}async stop(){this.state===0&&(this.setStatus(-1,wm.t("Saving")),this.state=1,await po.window.withProgress({location:po.ProgressLocation.Window,title:wm.t("Stopping profile...")},()=>this.session.customRequest("stopProfile",{})))}onStateUpdate(e){if(e.running){this.setStatus(0,e.label);return}this.state=2,this.stopEmitter.fire(this.file),this.dispose()}setStatus(e,t){this.state===0&&(e===-1?this._innerStatus=[t]:this._innerStatus[e]=t,this.statusChangeEmitter.fire(this.status))}}});var Yn,ax,cx,yc,ym,px=m(()=>{"use strict";Yn=w(require("@vscode/l10n")),ax=require("inversify"),cx=w(require("vscode"));$e();Qh();yc=class{constructor(){this.sortOrder=1;this.id="duration";this.label=Yn.t("Duration");this.description=Yn.t("Run for a specific amount of time")}async onPick(e,t){if(t)return new ym(t*1e3);let r=cx.window.createInputBox();r.title=Yn.t("Duration of Profile"),r.placeholder=Yn.t('Profile duration in seconds, e.g "5"'),this.lastDuration&&(r.value=String(this.lastDuration)),r.onDidChangeValue(n=>{/^[0-9]+$/.test(n)?Number(n)<1?r.validationMessage=Yn.t("Please enter a number greater than 1"):r.validationMessage=void 0:r.validationMessage=Yn.t("Please enter a number")});let o=await new Promise(n=>{r.onDidAccept(()=>{if(r.validationMessage)return n(void 0);this.lastDuration=Number(r.value),n(new ym(this.lastDuration*1e3))}),r.onDidHide(()=>n(void 0)),r.show()});return r.dispose(),o}};yc=h([(0,ax.injectable)()],yc);ym=class{constructor(e){this.duration=e;this.disposable=new O}attachTo(e){let t=Date.now()+this.duration,r=()=>e.setStatus(1,`${Math.round((t-Date.now())/1e3)}s`),o=setTimeout(()=>e.stop(),this.duration),n=setInterval(r,1e3);r(),this.disposable.callback(()=>{clearTimeout(o),clearInterval(n)})}dispose(){this.disposable.dispose()}}});var Yh,lx,vc,pl,Xh=m(()=>{"use strict";Yh=w(require("@vscode/l10n")),lx=require("inversify"),vc=class{constructor(){this.sortOrder=0;this.id="manual";this.label=Yh.t("Manual");this.description=Yh.t("Run until manually stopped")}async onPick(){return new pl}};vc=h([(0,lx.injectable)()],vc);pl=class{dispose(){}}});var Sc,Zh=m(()=>{"use strict";Sc=Symbol("ITerminationConditionFactory")});var lo,Gi,ux,vm,et,s_,Ic,dx=m(()=>{"use strict";lo=w(require("@vscode/l10n")),Gi=require("inversify"),ux=require("os"),vm=require("path"),et=w(require("vscode"));nd();F();$e();ae();G();Lo();Xh();Zh();Qh();s_=i=>"__pendingTargetId"in i.configuration,Ic=class{constructor(e,t,r,o){this.tracker=e;this.fs=t;this.sessionStates=r;this.terminationConditions=o;this.activeSessions=new Map;this.disposables=new O;this.disposables.push(et.debug.onDidReceiveDebugSessionCustomEvent(n=>{if(n.event!=="profileStarted")return;let s=n.body,a=this.activeSessions.get(n.session.id);a||(a=new cl(n.session,Mt.ctors.find(c=>c.type===s.type)||Mt.ctors[0],new pl),this.registerSession(a)),a.setFile(s.file)}))}async start(e){let t,r=[...this.tracker.getConcreteSessions()].filter(s_);if(e.sessionId?t=r.find(p=>p.id===e.sessionId):t=await this.pickSession(r),!t)return;let o=t,n=this.activeSessions.get(o.id);if(n&&!await this.alreadyRunningSession(n))return;let s=await this.pickType(o,e.type);if(!s)return;let a;if(!s.instant&&(a=await this.pickTermination(o,e.termination),!a))return;let c=new cl(o,s,a);c&&(this.registerSession(c,e.onCompleteCommand),await c.start(),s.instant&&await c.stop())}async stop(e){let t;if(e)t=this.activeSessions.get(e);else{let r=await this.pickSession([...this.activeSessions.values()].map(o=>o.session));t=r&&this.activeSessions.get(r.id)}t&&(this.sessionStates.remove(t.session.id),await t.stop())}dispose(){for(let e of this.activeSessions.values())e.dispose();this.activeSessions.clear(),this.disposables.dispose()}registerSession(e,t){this.activeSessions.set(e.session.id,e),this.sessionStates.add(e.session.id,lo.t("Profiling")),e.onStatusChange(()=>this.updateStatusBar()),e.onStop(r=>{r&&this.openProfileFile(e,t,e.session,r),this.activeSessions.delete(e.session.id),e.dispose(),this.updateStatusBar()}),this.updateStatusBar()}async openProfileFile(e,t,r,o){var c,p;if(t)return Promise.all([et.commands.executeCommand(t,{contents:await this.fs.readFile(o,"utf-8"),basename:(0,vm.basename)(o)+e.impl.extension}),this.fs.unlink(o)]);let n=((c=r.workspaceFolder)==null?void 0:c.uri.fsPath)??((p=et.workspace.workspaceFolders)==null?void 0:p[0].uri.fsPath)??(0,ux.homedir)(),s=id()+e.impl.extension,a=et.Uri.file((0,vm.join)(n,s));await sw(this.fs,o,a.fsPath),await et.commands.executeCommand(e.impl.editable?"vscode.open":"revealInExplorer",a)}updateStatusBar(){var e;if(this.activeSessions.size===0){(e=this.statusBarItem)==null||e.hide(),Qc(et.commands,"jsDebugIsProfiling",!1);return}if(this.statusBarItem||(this.statusBarItem=et.window.createStatusBarItem(et.StatusBarAlignment.Right,500),this.statusBarItem.command="extension.js-debug.stopProfile"),Qc(et.commands,"jsDebugIsProfiling",!0),this.activeSessions.size===1){let t=this.activeSessions.values().next().value;this.statusBarItem.text=t.status?lo.t("{0} Click to Stop Profiling ({1})","$(loading~spin)",t.status):lo.t("{0} Click to Stop Profiling","$(loading~spin)")}else this.statusBarItem.text=lo.t("{0} Click to Stop Profiling ({1} sessions)","$(loading~spin)",this.activeSessions.size);this.statusBarItem.show()}async alreadyRunningSession(e){let t=lo.t("Yes"),r=lo.t("No");return await et.window.showErrorMessage(lo.t("A profiling session is already running, would you like to stop it and start a new session?"),t,r)!==t?!1:(await this.stop(e.session.id),!0)}async pickSession(e){if(e.length===0)return;if(e.length===1)return e[0];let t=await et.window.showQuickPick(e.map(r=>({label:r.name,id:r.id})));return t&&e.find(r=>r.id===t.id)}async pickType(e,t){let r=e.configuration;if(t)return Mt.ctors.find(n=>n.type===t&&n.canApplyTo(r));let o=await this.pickWithLastDefault(lo.t("Type of profile:"),Mt.ctors.filter(n=>n.canApplyTo(r)),this.lastChosenType);return o&&(this.lastChosenType=o.label),o}async pickTermination(e,t){var o;if(t){let n=typeof t=="string"?{type:t}:t;return(o=this.terminationConditions.find(s=>s.id===n.type))==null?void 0:o.onPick(e,...n.args??[])}let r=await this.pickWithLastDefault(lo.t("How long to run the profile:"),this.terminationConditions,this.lastChosenTermination);return r&&(this.lastChosenTermination=r.label),r==null?void 0:r.onPick(e)}async pickWithLastDefault(e,t,r){if(t.length<=1)return t[0];let o=et.window.createQuickPick();o.title=e,o.items=t.slice().sort((s,a)=>s.label===r||a.label===r?s.label===r?-1:1:(s.sortOrder??0)-(a.sortOrder??0)).map(s=>({label:s.label,description:s.description,alwaysShow:!0}));let n=await new Promise(s=>{o.onDidAccept(()=>{var a;return s((a=o.selectedItems[0])==null?void 0:a.label)}),o.onDidHide(()=>s(void 0)),o.show()});if(o.dispose(),!!n)return t.find(s=>s.label===n)}};Ic=h([(0,Gi.injectable)(),d(0,(0,Gi.inject)(Ie)),d(1,(0,Gi.inject)(z)),d(2,(0,Gi.inject)(ou)),d(3,(0,Gi.multiInject)(Sc))],Ic)});var mx,gx,Pc,fx=m(()=>{"use strict";mx=require("inversify"),gx=require("vscode");Uf();F();M();Pc=class{constructor(){this.read=N(()=>ar(gx.workspace,"debug.javascript.resourceRequestOptions"))}provideOptions(e){LS(e,this.read()||{})}};Pc=h([(0,mx.injectable)()],Pc)});var hx,eb,Cc,bx=m(()=>{"use strict";hx=require("inversify"),eb=require("vscode");F();Cc=class{register(e){e.subscriptions.push(Ke(eb.commands,"extension.node-debug.startWithStopOnEntry",()=>eb.commands.executeCommand("workbench.action.debug.start",{config:{stopOnEntry:!0}})))}};Cc=h([(0,hx.injectable)()],Cc)});var tb,Sm,wx,yx,tt,xc,vx=m(()=>{"use strict";tb=w(require("@vscode/l10n")),Sm=require("inversify"),wx=require("linkifyjs"),yx=require("url"),tt=w(require("vscode"));F();_p();$e();M();B();xc=class{constructor(e){this.defaultBrowser=e;this.enabledTerminals=new WeakSet;this.disposable=new O;this.notifiedCantOpenOnWeb=!1;this.baseConfiguration=this.readConfig();this.disposable.push(tt.workspace.onDidChangeConfiguration(t=>{t.affectsConfiguration("debug.javascript.debugByLinkOptions")&&(this.baseConfiguration=this.readConfig())}))}enableHandlingInTerminal(e){this.enabledTerminals.add(e)}dispose(){this.disposable.dispose()}provideTerminalLinks(e){var o;switch(this.baseConfiguration.enabled){case"off":return[];case"always":break;case"on":default:if(!this.enabledTerminals.has(e.terminal))return[]}let t=[],r=N(()=>{var n;if("cwd"in e.terminal.creationOptions&&e.terminal.creationOptions.cwd){let s=tt.workspace.getWorkspaceFolder(typeof e.terminal.creationOptions.cwd=="string"?tt.Uri.file(e.terminal.creationOptions.cwd):e.terminal.creationOptions.cwd);if(s)return s}return(n=tt.workspace.workspaceFolders)==null?void 0:n[0]});for(let n of(0,wx.find)(e.line,"url")){let s=-1;for(;(s=e.line.indexOf(n.value,s+1))!==-1;){let a;try{a=new yx.URL(n.href)}catch{continue}a.protocol==="http:"&&!n.value.startsWith("http:")&&!Hl(a.hostname)&&(a.protocol="https:"),!(a.protocol!=="http:"&&a.protocol!=="https:")&&t.push({startIndex:s,length:n.value.length,tooltip:tb.t("Debug URL"),target:a,workspaceFolder:(o=r())==null?void 0:o.index})}}return t}async handleTerminalLink(e){await this.handleTerminalLinkInner(e)||tt.env.openExternal(tt.Uri.parse(e.target.toString()))}async handleTerminalLinkInner(e){var n;if(!e.target)return!1;let t=e.target;if(tt.env.uiKind===tt.UIKind.Web)return this.notifiedCantOpenOnWeb||(tt.window.showInformationMessage(tb.t("We can't launch a browser in debug mode from here. If you want to debug this webpage, open this workspace from VS Code on your desktop.")),this.notifiedCantOpenOnWeb=!0),!1;ny(t.hostname)&&(t.hostname="localhost");let r="pwa-chrome";try{await this.defaultBrowser.lookup()===3&&(r="pwa-msedge")}catch{}let o=e.workspaceFolder!==void 0?(n=tt.workspace.workspaceFolders)==null?void 0:n[e.workspaceFolder]:void 0;return tt.debug.startDebugging(o,{...this.baseConfiguration,type:r,name:t.toString(),request:"launch",url:t.toString()}),!0}readConfig(){let e=ar(tt.workspace,"debug.javascript.debugByLinkOptions");return typeof e=="boolean"&&(e=e?"on":"off"),typeof e=="string"?{enabled:e}:{enabled:"on",...e}}};xc=h([(0,Sm.injectable)(),d(0,(0,Sm.inject)(ua))],xc)});var Sx,Ix,Px=m(()=>{"use strict";ld();G();QP();vn();Iu();YP();eC();EC();MC();Lo();jC();NC();WC();JC();rh();QC();ZC();ex();ox();sx();px();Xh();Zh();dx();fx();Ah();bx();vx();Sx=i=>{i.bind(cr).toConstantValue(require("vscode")),LC.forEach(e=>{i.bind(e).toSelf().inSingletonScope(),i.bind(tC).to(e)}),AC.forEach(e=>i.bind(rC).to(e).inSingletonScope()),i.bind(pr).to(gc).inSingletonScope(),i.bind(pr).to(sc).inSingletonScope(),i.bind(pr).to($a).inSingletonScope(),i.bind(pr).to(Kn).inSingletonScope(),i.bind(pr).to(cc).inSingletonScope(),i.bind(pr).to(Cc).inSingletonScope(),i.bind(pr).to(fc).inSingletonScope(),i.bind(pr).to(uc).inSingletonScope(),i.bind(pr).to(dc).inSingletonScope(),i.bind(pr).to(bc).inSingletonScope(),i.bind(pr).to(Ha).inSingletonScope(),i.bind(Mp).to(mc).inSingletonScope(),i.bind(Ie).toSelf().inSingletonScope().onActivation(Ce),i.bind(Ic).toSelf().inSingletonScope().onActivation(Ce),i.bind(xc).toSelf().inSingletonScope(),i.bind(Kn).toSelf().inSingletonScope(),i.bind(Sc).to(yc).inSingletonScope(),i.bind(Sc).to(vc).inSingletonScope(),i.bind(Sc).to(wc).inSingletonScope()},Ix=i=>{i.bind(st).to(Va).onActivation(Ce),i.bind(pa).to(Pc).inSingletonScope(),i.bind(Hs).to(Wa).inSingletonScope()}});var Pm,Cx,Im,Cm,aJ,xx,kx,Tx,Rx,rb=m(()=>{"use strict";Pm=require("@vscode/js-debug-browsers"),Cx=w(require("execa")),Im=require("fs"),Cm=require("inversify"),aJ=require("reflect-metadata");du();li();Vg();Ug();zg();ku();Vu();DS();Cf();dp();dn();xf();kf();xo();Bf();nd();Pp();Af();Ff();Nc();Vf();MS();VS();rp();Wu();Ht();Rp();He();Dp();_p();Fs();ae();L();_r();Of();np();Kc();cp();Jf();Rt();H();qr();G();Ep();SI();kI();RI();Ld();DI();LI();ph();ZI();hP();wP();AP();Bn();jP();om();qd();Kp();Xd();WP();kh();En();Vd();vn();au();Iu();qP();zP();As();sp();Px();xx=(i,e,t,r)=>{let o=new Cm.Container;return o.parent=i,o.bind(ie).toConstantValue(e.launchConfig),o.bind(Ds).toConstantValue(o),o.bind(sr).toConstantValue(t),o.bind(_e).toConstantValue(r),o.bind(yi).toConstantValue(e),o.bind(QI).toConstantValue(e.targetOrigin()),o.bind(Zi).to(kn).inSingletonScope(),o.bind(hu).to(Vs).inSingletonScope(),o.bind(pi).toSelf().inSingletonScope(),e.sourcePathResolver&&o.bind(fe).toConstantValue(e.sourcePathResolver),o.bind(In).toSelf(),o.bind(Zu).toDynamicValue(n=>n.container.get(In).create()).inSingletonScope(),e.parent()&&(o.bind(ln).to(pn).inSingletonScope(),o.bind(Kr).to(js).inSingletonScope()),o.bind(nt).to(process.env.DA_TEST_DISABLE_TELEMETRY?qn:lr).inSingletonScope().onActivation(Ce),o.bind(mr).toSelf().inSingletonScope(),o.bind(Qe).toSelf().inSingletonScope(),o.bind(vi).toSelf().inSingletonScope(),o.bind(oi).to(Zr).inSingletonScope(),o.bind(bi).toSelf().inSingletonScope(),o.bind(na).to(ia).inSingletonScope(),o.bind(Tu).to(Ys).inSingletonScope(),o.bind(ur).to(Os).inSingletonScope(),o.bind(Ku).to(ca).inSingletonScope(),o.bind(ai).to(Es).inSingletonScope(),o.bind(Xe).toSelf(),o.bind(Kt).toSelf(),o.bind(Qt).toSelf(),o.bind(od).to(Mt).inSingletonScope(),o.bind(sd).to(aa).inSingletonScope(),o.bind(xu).to(Ks).inSingletonScope().onActivation(Ce),o},kx=i=>{let e=new Cm.Container;e.parent=i,e.bind(Ds).toConstantValue(e),e.bind(T).to(A).inSingletonScope().onActivation(Ce),e.bind(Pi).toSelf().inSingletonScope(),e.bind(Zi).to(kn).inSingletonScope(),e.bind(nt).to(process.env.DA_TEST_DISABLE_TELEMETRY?qn:lr).inSingletonScope().onActivation(Ce),e.bind(Jr).to(Jr).inSingletonScope(),e.bind(Po).to(Po).inSingletonScope(),e.bind(la).to(ki).inSingletonScope(),e.bind(Ms).to(Di).inSingletonScope(),e.bind(no).to(Ta),e.bind(oo).toSelf().inSingletonScope().onActivation(Ce),e.bind(ao).toSelf(),e.bind(st).to(Fr).onActivation(Ce),e.bind(st).to(Ra).onActivation(Ce),e.bind(st).to(Da).onActivation(Ce),e.bind(st).to(Ma).onActivation(Ce),e.bind(Jp).to(Oa),e.bind(Jp).to(Ui),e.bind(Mn).to(ka).inSingletonScope(),Ix(e),e.bind(st).to(Ea).onActivation(Ce),e.bind(Ln).toSelf().inSingletonScope().onActivation(Ce),e.bind(st).toService(Ln),e.bind(st).to(fa).inSingletonScope().onActivation(Ce),e.bind(st).to(ba).inSingletonScope().onActivation(Ce),e.bind(st).to(ha).inSingletonScope().onActivation(Ce),e.bind(st).to(wa).inSingletonScope().onActivation(Ce),e.bind(st).to(hr).onActivation(Ce),e.bind(st).toDynamicValue(()=>i.get(Fn).createLauncher(e.get(T))).inSingletonScope();let t=r=>o=>new r(o.container.get(Dg),o.container.get(z),o.container.get(ep));return e.bind(nn).toDynamicValue(t(Pm.ChromeBrowserFinder)).inSingletonScope().whenTargetTagged("browser","chrome"),e.bind(nn).toDynamicValue(t(Pm.EdgeBrowserFinder)).inSingletonScope().whenTargetTagged("browser","edge"),e},Tx=i=>{let e=new Cm.Container;return e.bind(Ds).toConstantValue(e),e.bind(Fn).toSelf().inSingletonScope(),e.bind(Ia).toSelf().inSingletonScope(),e.bind(Hs).to(Ua).inSingletonScope(),e.bind(ou).toConstantValue(new eo),e.bind(ua).to(Ti).inSingletonScope(),e.bind(Gr).toConstantValue(i.storagePath),e.bind(_s).toConstantValue(i.isVsCode),e.bind(rm).to(Ot),e.bind(ht).to(Js).inSingletonScope(),e.bind(Dg).toConstantValue(process.env),e.bind(ep).toConstantValue(Cx.default),e.bind(z).toConstantValue(Im.promises),e.bind(mt).toConstantValue(new se(Im.promises)),e.bind(Io).toConstantValue(i.isRemote?"remote":"local"),i.context&&e.bind(De).toConstantValue(i.context),Sx(e),e},Rx=(i,e,t)=>{i.bind(Cp).toConstantValue(PS(e)),i.bind(ie).toService(Cp),i.bind(Xt).to(Pa).inSingletonScope(),i.bind(fs).toConstantValue(t),i.bind(fe).toDynamicValue(r=>r.container.get(Xt).create(e,r.container.get(T))).inSingletonScope(),i.bind(mt).toConstantValue(Al.create(e.__remoteFilePrefix,Im.promises,t)),i.bind(vo).to(ei).inSingletonScope().onActivation(Ce),i.bind(si).to(Ls).inSingletonScope(),i.bind(Pe).toSelf().inSingletonScope().onActivation(Ce),i.bind(cn).toSelf().inSingletonScope(),i.bind(ln).to(pn).inSingletonScope(),i.bind(Kr).to(Bs).inSingletonScope()}});function _x(i,e,t){let r=Dx(i,e,"uncaughtException",t),o=Dx(i,e,"unhandledRejection",t);return process.addListener("uncaughtException",r),process.addListener("unhandledRejection",o),{dispose:()=>{process.removeListener("uncaughtException",r),process.removeListener("unhandledRejection",o)}}}function p_(i){var e;return!Lx||a_(i)&&!!((e=i.stack)!=null&&e.includes(c_))}function Ax(){Lx=!0}var xm,Dx,a_,c_,Lx,Ex=m(()=>{"use strict";xm=w(require("path"));L();Dx=(i,e,t,r=!0)=>o=>{p_(o)&&(e.report("error",{"!error":o,error:r?void 0:o,exceptionType:t}),i.error("runtime.exception","Unhandled error in debug adapter",o))},a_=i=>typeof i=="object"&&!!i&&"stack"in i,c_=xm.dirname(xm.dirname(xm.dirname(__dirname)));Lx=!1});function l_(i){ru&&i.output({category:"console",output:`Note: Using the "preview" debug extension
`})}var Fx,Tm,km,Mx,ob,Ji,Bx=m(()=>{"use strict";Fx=w(require("@vscode/l10n")),Tm=w(require("os"));yS();jf();dp();IS();Ve();$e();j();L();Of();M();U();B();H();rb();G();vn();As();Ex();km=class{constructor(e,t,r,o){this._delegate=e;this._rootServices=r;this._disposables=new O;this._serviceTree=new WeakMap;this._root=new Ji(void 0);this.getLaunchers=N(()=>{let e=new Set(this._rootServices.getAll(st));for(let t of e)this._disposables.push(t.onTargetListChanged(()=>{let r=this.targetList();this._attachToNewTargets(r,t),this._terminateOrphanThreads(r)}));return e});this._dap=t.dap(),this._targetOrigin=o,this._disposables.callback(()=>iu(r)),this._disposables.push(_x(r.get(T),r.get(nt),r.get(_s))),t.attachTelemetry(r.get(nt));let n=this._dap,s=0,a;n.on("initialize",async c=>{this._rootServices.bind(Lt).toConstantValue(c);let p=ko.capabilities();return c.clientID==="vscode"&&Ax(),setTimeout(()=>n.initialized({}),0),p}),n.on("setExceptionBreakpoints",async()=>({})),n.on("setBreakpoints",async c=>{var p,l;return(p=c.breakpoints)!=null&&p.length&&r.get(Pe).notifyHadBreakpoint(),{breakpoints:((l=c.breakpoints)==null?void 0:l.map(()=>({id:++s,verified:!1,message:Fx.t("Unbound breakpoint")})))??[]}}),n.on("configurationDone",async()=>({})),n.on("threads",async()=>({threads:[]})),n.on("loadedSources",async()=>({sources:[]})),n.on("breakpointLocations",()=>Promise.resolve({breakpoints:[]})),n.on("attach",async c=>(await this.boot(c,n),{})),n.on("launch",async c=>(await this.boot(c,n),{})),n.on("pause",async()=>({})),n.on("terminate",()=>this._terminateRoot()),n.on("disconnect",()=>this._disconnectRoot()),n.on("restart",async({arguments:c})=>(await this._restart(c),{})),n.on("startSelfProfile",async({file:c})=>(a==null||a.dispose(),a=new ad(c),await a.start(),{})),n.on("stopSelfProfile",async()=>(a&&(await a.stop(),a.dispose(),a=void 0),{}))}async _terminateRoot(){return this._root.state=1,await Promise.all([...this.getLaunchers()].map(e=>e.terminate())),await this._root.waitUntilChildrenAre(2),this._root.state=2,{}}async _disconnectRoot(){return this._root.state<1&&await this._terminateRoot(),this._rootServices.get(nt).flush(),await this._root.waitUntilChildrenAre(3),this._root.state=3,{}}async boot(e,t){return this._boot(Rs(e,this._rootServices.get(Io)),t)}async _boot(e,t){l_(t),this.reportBootTelemetry(e),Rx(this._rootServices,e,t),this._rootServices.get(T).setup(Qb(t,e.trace));let r=e.timeout>0?pe.withTimeout(e.timeout):new pe;e.rootPath&&(e.rootPath=vt(e.rootPath)),this._launchParams=e;let o=await Promise.all([...this.getLaunchers()].map(n=>this._launch(n,e,r.token)));return Promise.all(o.map(n=>n.terminated)).then(n=>{let s=n.find(Fe);this._markTargetAsTerminated(this._root,{restart:!!(s!=null&&s.restart)})}),{}}reportBootTelemetry(e){let t=Rs({type:e.type,request:e.request,name:"<string>",__workspaceFolder:"<workspace>"}),r=(o,n)=>typeof o=="string"?n&&t[n]===o?o:"<string>":o instanceof Array?o.map(s=>r(s)):o&&typeof o=="object"?ho(o,s=>r(s)):o;this._rootServices.get(nt).report("launch",{type:e.type,request:e.request,os:`${Tm.platform()} ${Tm.arch()}`,nodeVersion:process.version,adapterVersion:on,parameters:ho(e,r)})}async _restart(e){let t;if(e){let r=this._rootServices.get(Cp);t=Rs({__workspaceFolder:r.__workspaceFolder,...e},this._rootServices.get(Io)),r.update(t)}await Promise.all([...this.getLaunchers()].map(r=>r.restart(t)))}async _launch(e,t,r){return(await this.captureLaunch(e,t,r)).blockSessionTermination?{terminated:new Promise(n=>{let s=this._disposables.push(e.onTerminated(a=>{s.dispose(),n(a)}))})}:{terminated:Promise.resolve(void 0)}}async captureLaunch(e,t,r){let o=e.constructor.name,n;try{n=await e.launch(t,{telemetryReporter:this._rootServices.get(nt),cancellationToken:r,targetOrigin:this._targetOrigin,dap:this._dap})}catch(s){throw this._rootServices.get(T).warn("runtime.launch","Launch returned error",{error:s,wasCancelled:r.isCancellationRequested,name:o}),s}return n.blockSessionTermination&&this._rootServices.get(T).info("runtime.launch","Launched successfully",{name:o}),n}dispose(){this._disposables.dispose(),this._terminateOrphanThreads([])}targetList(){let e=[];for(let t of this.getLaunchers())e.push(...t.targetList());return e}async attach(e,t){if(!this._launchParams)throw new Error("Cannot launch before params have been set");let r=e.value;if(!r.canAttach())return;let o=await r.attach();if(!o)return;let n=await this._delegate.acquireDap(r),s=n.dap(),a=this._launchParams;this._asyncStackPolicy||(this._asyncStackPolicy=wS(a.showAsyncStacks));let c=r.parent(),p=c&&this._serviceTree.get(c)||this._rootServices,l=xx(p,r,s,o);n.attachTelemetry(l.get(nt)),this._serviceTree.set(r,p);let u=new ko(s,this._asyncStackPolicy,a,l),f=u.createThread(o,r),y=async()=>(await u.launchBlocker(),r.runIfWaitingForDebugger(),e.threadData.resolve({thread:f,debugAdapter:u}),{});s.on("disconnect",v=>this._disconnectTarget(e,v)),s.on("terminate",()=>this._terminateTarget(e)),s.on("restart",async()=>(r.canRestart()?r.restart():await this._restart(),Promise.resolve({}))),await this._delegate.initAdapter(u,r,t)?y():(s.on("attach",y),s.on("launch",y)),await r.afterBind()}_attachToNewTargets(e,t){for(let r of e.values()){if(!r.waitingForDebugger()||Ji.targetNodes.has(r))continue;let o=r.parent(),n=o?Ji.targetNodes.get(o):this._root;if(!n)throw new Error(`Got target with unknown parent: ${r.name()}`);let s=new Ji(r);n.add(s),this.attach(s,t)}}async _terminateOrphanThreads(e,t){let r=[...this._root.all()].filter(o=>!e.includes(o.value));return Promise.all(r.map(o=>this._markTargetAsTerminated(o,t)))}async _markTargetAsTerminated(e,t={}){if(e.state>=1)return await e.waitUntil(2),{};if(e.state=1,Mx(e)){let r=await e.threadData.promise;await r.thread.dispose(),r.debugAdapter.dap.terminated(t),r.debugAdapter.dispose()}else this._dap.terminated(t);return await e.waitUntilChildrenAre(2),e.state=2,{}}async _terminateTarget(e){return e.state>=3?{}:(e.value.canStop()?e.value.stop():this._terminateRoot(),await e.waitUntil(2),{})}async _disconnectTarget(e,t){if(e.state>=3)return{};e.state<1&&(t.terminateDebuggee===!1&&e.value.canDetach()?await e.value.detach():e.value.canStop()?e.value.stop():this._terminateRoot()),await e.waitUntil(2),await e.waitUntilChildrenAre(3),e.state=3,queueMicrotask(()=>this._delegate.releaseDap(e.value));let r=e.value.parent(),o=r?Ji.targetNodes.get(r):this._root;return o==null||o.remove(e),{}}};Mx=i=>!!i.value,ob=class{constructor(e){this.value=e;this.threadData=le();this._state=0;this._children=new Set;this._stateChangeEmitter=new S;e&&ob.targetNodes.set(e,this)}get state(){return this._state}set state(e){e>this._state&&(this._state=e,this._stateChangeEmitter.fire(e))}add(e){this._children.add(e)}remove(e){this._children.delete(e)}async waitUntil(e){return this._state>=e?Promise.resolve():new Promise(t=>{let r=this._stateChangeEmitter.event(o=>{o>=e&&(r.dispose(),t())})})}async waitUntilChildrenAre(e){await Promise.all([...this._children].map(t=>t.waitUntil(e)))}*all(){Mx(this)&&(yield this);for(let e of this._children)yield*e.all()}},Ji=ob;Ji.targetNodes=new WeakMap});var jx,u_,ll,Ox=m(()=>{"use strict";j();ta();L();jx=`\r
\r
`,u_=0,ll=class{constructor(e,t,r){this.inputStream=e;this.outputStream=t;this._contentLength=-1;this._connectionId=u_++;this.msgEmitter=new S;this.messageReceived=this.msgEmitter.event;this.endedEmitter=new S;this.closed=this.endedEmitter.event;this._handleData=e=>{var r;let t=new It;for(this._rawData=Buffer.concat([this._rawData,e]);;){if(this._contentLength>=0){if(this._rawData.length>=this._contentLength){let o=this._rawData.toString("utf8",0,this._contentLength);if(this._rawData=this._rawData.slice(this._contentLength),this._contentLength=-1,o.length>0)try{let n=JSON.parse(o);(r=this.logger)==null||r.verbose("dap.receive",void 0,{connectionId:this._connectionId,message:n}),this.msgEmitter.fire({message:n,receivedTime:t})}catch(n){console.error("Error handling data: "+(n&&n.message))}continue}}else{let o=this._rawData.indexOf(jx);if(o!==-1){let s=this._rawData.toString("utf8",0,o).split(`\r
`);for(let a=0;a<s.length;a++){let c=s[a].split(/: +/);c[0]==="Content-Length"&&(this._contentLength=+c[1])}this._rawData=this._rawData.slice(o+jx.length);continue}}break}};this.logger=r,this._rawData=Buffer.alloc(0),e.on("end",()=>this.endedEmitter.fire()),e.on("data",this._handleData)}send(e,t=!0,r){var s,a;let o=JSON.stringify(e);if(t){let c=e;e.type==="response"&&e.command==="source"&&(c={...e,body:{...e.body,content:"<script source>"}}),(s=this.logger)==null||s.verbose("dap.send",void 0,{connectionId:this._connectionId,message:c})}let n=`Content-Length: ${Buffer.byteLength(o,"utf8")}\r
\r
${o}`;if(this.outputStream.destroyed){(a=this.logger)==null||a.warn("dap.send","Message not sent. Connection was closed."),r==null||r();return}this.outputStream.write(n,"utf8",c=>{var p;r==null||r(),c&&(console.log(e),(p=this.logger)==null||p.error("dap.send","Error while writing to output stream",c),this.close())})}close(){this.inputStream.destroy(),this.outputStream.destroy()}setLogger(e){return this.logger=e,this}}});var d_,Xn,ul,ib=m(()=>{"use strict";d_=["[[ArrayBufferData]]"],Xn=async(i,e,t,r=0,o)=>{if(!await t(e,r)||e.variablesReference===void 0)return;if(typeof e.namedVariables=="number"||typeof e.indexedVariables=="number"){if(e.namedVariables){let s=await i.variables({variablesReference:e.variablesReference,filter:"named",format:o});for(let a of s.variables)await Xn(i,a,t,r+1,o)}if(e.indexedVariables){let s=await i.variables({variablesReference:e.variablesReference,filter:"indexed",start:0,count:e.indexedVariables,format:o});for(let a of s.variables)await Xn(i,a,t,r+1)}}else{let s=await i.variables({variablesReference:e.variablesReference,format:o});for(let a of s.variables)await Xn(i,a,t,r+1,o)}},ul=class{constructor(e,t){this._dap=e,this._log=t}logAsConsole(e){e&&(e.endsWith(`
`)&&(e=e.substring(0,e.length-1)),this._log(e))}logVariable(e,t={},r=""){return Xn(this._dap,e,(o,n)=>{var C;if(d_.includes(o.name))return n<(t.depth??1);let s=o.name?`${o.name}: `:"",a=((C=o.presentationHint)!=null&&C.lazy?"(...)":o.value)||"";a.endsWith(`
`)&&(a=a.substring(0,a.length-1));let c=o.type?`type=${o.type}`:"",p=o.namedVariables?` named=${o.namedVariables}`:"",l=o.indexedVariables?` indexed=${o.indexedVariables}`:"",u=r+"    ".repeat(n),f=o.variablesReference?"> ":"",y=t.logInternalInfo?`${c}${p}${l}`:"";y&&(y="  // "+y);let v=`${f}${s}${a}`;return v&&(v.includes(`
`)&&(v=`
`+v),this.logAsConsole(`${u}${v}${y}`)),n<(t.depth??1)},void 0,t.format)}async logOutput(e,t){e.group&&this.logAsConsole(`# group: ${e.group}`);let r=`${e.category}> `;if(e.output&&this.logAsConsole(`${r}${e.output}`),e.variablesReference){let o=await this._dap.variables({variablesReference:e.variablesReference});for(let n of o.variables)await this.logVariable(n,t,r)}}async logEvaluateResult(e,t){let r={...e,name:"result",value:e.result};return await this.logVariable(r,t),r}async logStackTrace(e,t){let r=await this._dap.stackTrace({threadId:e}),o=r.stackFrames,n=r.totalFrames||o.length;for(;o.length<n;){let a=await this._dap.stackTrace({threadId:e,startFrame:o.length,levels:Math.min(20,n-o.length)});o.push(...a.stackFrames),a.totalFrames&&(n=Math.min(n,a.totalFrames))}let s=!!t;for(let a of o){if(s&&this._log(""),a.presentationHint==="label"){this._log(`----${a.name}----`),s=!1;continue}let c=a.source&&a.source.presentationHint==="deemphasize"?` <hidden: ${a.source.origin||""}>`:"";if(this._log(`${a.name} @ ${a.source?a.source.path:"unknown"}:${a.line}:${a.column}${c}`),!t)continue;let p=await this._dap.scopes({frameId:a.id});if(typeof p=="string")this._log(`  scope error: ${p}`);else for(let l=0;l<p.scopes.length;l++){let u=p.scopes[l];if(u.expensive){this._log(`  scope #${l}: ${u.name} [expensive]`);continue}await this.logVariable({name:"scope #"+l,value:u.name,variablesReference:u.variablesReference,namedVariables:u.namedVariables,indexedVariables:u.indexedVariables},{},"  ")}}return o}async evaluateAndLog(e,t={},r){if(typeof e=="string"){let o=await this._dap.evaluate({expression:e,context:r,...t.params,format:t.format});return typeof o=="string"?(this._log(`<error>: ${o}`),{name:"result",value:o,variablesReference:0}):await this.logEvaluateResult(o,t)}for(let o of e){this._log(`Evaluating: '${o}'`);let n=this._dap.evaluate({expression:o,context:r});await this.logOutput(await this._dap.once("output"),t),await n,this._log("")}}}});function Zn(i){return Ux.default.join(Nx.default.tmpdir(),`${i.replace(/[^a-z0-9]/gi,"-")}.json`)}var Nx,Ux,nb=m(()=>{"use strict";Nx=w(require("os")),Ux=w(require("path"))});var Vx,_m,Wx,ye,$x,qx,es,_,T7,Lm,b,Am,Rm,dl,sb,ab,Dm,ct=m(()=>{"use strict";Vx=w(require("del")),_m=w(require("gulp")),Wx=require("os"),ye=w(require("path")),$x=w(require("playwright")),qx=w(require("stream"));jf();Bx();F();j();L();M();Z();B();H();qr();Ox();rb();Ko();Vd();ib();nb();es=ye.join("D:\\a\\_work\\1\\s\\VsCodeDebugAdapter\\vscode-js-debug\\src\\test","..",".."),_=ye.join(es,"testWorkspace"),T7=ye.join(es,"src"),Lm=".dynamic-testWorkspace",b=ye.join(es,Lm),Am=i=>process.platform==="darwin"?i.replace(/^\/private/,""):i,Rm=class extends qx.Duplex{_write(e,t,r){Promise.resolve().then().then().then().then().then().then().then().then().then().then().then(()=>{this.push(e,t),r()})}_read(e){}},dl=class{constructor(e){let t=new Rm,r=new Rm;this.adapterConnection=new gs(new ll(t,r,e),e);let o=new gs(new ll(r,t,e),e);this.dap=o.createTestApi()}async _init(){let[e]=await Promise.all([this.dap.initialize({clientID:"pwa-test",adapterID:"pwa",linesStartAt1:!0,columnsStartAt1:!0,pathFormat:"path",supportsVariablePaging:!0}),this.dap.once("initialized")]);return e}},sb=class{constructor(e,t){this._evaluateCounter=0;this._root=e,this._target=t,this.log=e.log,this.assertLog=e.assertLog,this._session=new dl(e.logger),this.dap=this._session.dap,this.logger=new ul(this.dap,this.log)}get cdp(){return this._cdp}get adapter(){return this._adapter}async evaluate(e,t){return++this._evaluateCounter,this.log(`Evaluating#${this._evaluateCounter}: ${e}`),t===void 0?t=`//# sourceURL=eval${this._evaluateCounter}.js`:t&&(t=`//# sourceURL=${this.completeUrl(t)}`),this._cdp.Runtime.evaluate({expression:e+`
${t}`}).then(r=>{if(r){if(r.exceptionDetails){this.log(r.exceptionDetails,"Error evaluating");debugger;throw new Error('Error evaluating "'+e+'"')}}else{this.log(e,"Error evaluating");debugger;throw new Error('Error evaluating "'+e+'"')}return r})}async addScriptTag(e){await this._cdp.Runtime.evaluate({expression:`
      new Promise(f => {
        var script = document.createElement('script');
        script.src = '${this._root.completeUrl(e)}';
        script.onload = () => f(undefined);
        document.head.appendChild(script);
      })
    `,awaitPromise:!0})}waitForSource(e){return this.dap.once("loadedSource",t=>e===void 0||(t.source.path||"").indexOf(e)!==-1)}completeUrl(e){return this._root.completeUrl(e)}workspacePath(e){return this._root.workspacePath(e)}async _init(e,t,r){var a;e.breakpointManager.setPredictorDisabledForTest(!0),e.sourceContainer.setSourceMapTimeouts({load:0,resolveLocation:2e3,sourceMapMinPause:1e3,output:3e3,sourceMapCumulativePause:1e4}),this._adapter=e,this._root._browserLauncher=r,this._connection=(a=this._root._browserLauncher)==null?void 0:a.connectionForTest();let o=await this._connection.rootSession().Target.attachToBrowserTarget({}),n=this._connection.createSession(o.sessionId),{sessionId:s}=await n.Target.attachToTarget({targetId:this._target instanceof Jo?this._target.targetId:this._target.id(),flatten:!0});return this._cdp=this._connection.createSession(s),await this._session._init(),this._target.parent()&&(this.dap.configurationDone({}),this.dap.attach({})),!1}async load(){await this.dap.configurationDone({}),await this.dap.attach({}),this._cdp.Page.enable({}),this._cdp.Page.navigate({url:this._root._launchUrl}),await new Promise(e=>this._cdp.Page.on("loadEventFired",e)),await this._cdp.Page.disable({})}},ab=class{constructor(e,t){this._root=e,this._target=t,this.log=e.log,this.assertLog=e.assertLog,this._session=new dl(e.logger),this.dap=this._session.dap,this.logger=new ul(this.dap,this.log)}get cdp(){return this._cdp}get adapter(){return this._adapter}waitForSource(e){return this.dap.once("loadedSource",t=>e===void 0||E(t.source.path||"").includes(e))}workspacePath(e){return this._root.workspacePath(e)}async _init(e,t){return this._adapter=e,await this._session._init(),this._target.parent()&&(this.dap.configurationDone({}),this.dap.attach({})),!0}async load(){await this.dap.configurationDone({})}},Dm=class{constructor(e,t){this._testTitlePath=t;this._targetToP=new Map;this._onSessionCreatedEmitter=new S;this.onSessionCreated=this._onSessionCreatedEmitter.event;this._args=["--headless"],this.log=e.log.bind(e),this.assertLog=e.assertLog.bind(e),this._workspaceRoot=vt(_),this._webRoot=ye.join(this._workspaceRoot,"web");let r=ye.join("D:\\a\\_work\\1\\s\\VsCodeDebugAdapter\\vscode-js-debug\\src\\test","..",".."),o=new Map,n=kx(Tx({storagePath:r,isVsCode:!0,context:Wo({workspaceState:{keys:()=>[],get(a,c){return o.get(a)??c},update(a,c){return o.set(a,c),Promise.resolve()}}})}));this.logger=n.get(T),this._root=new dl(this.logger);let s=this._root.adapterConnection.dap();s.on("initialize",async()=>(s.initialized({}),ko.capabilities())),s.on("configurationDone",async()=>({})),this.binder=new km(this,this._root.adapterConnection,n,new Nd("0")),this.initialize=this._root._init(),this._launchCallback=()=>{},this._workerCallback=()=>{},this._worker=new Promise(a=>this._workerCallback=a)}async acquireDap(e){let t=e.type()==="page"?new sb(this,e):new ab(this,e);return this._targetToP.set(e,t),t._session.adapterConnection}async initAdapter(e,t,r){let o=this._targetToP.get(t);if(!o)return!0;let n=await o._init(e,t,r);return t.parent()?this._workerCallback(o):this._launchCallback(o),this._onSessionCreatedEmitter.fire(o),n}releaseDap(e){this._targetToP.delete(e)}setArgs(e){this._args=e}worker(){return this._worker}rootDap(){return this._root.dap}async waitForTopLevel(){return await new Promise(t=>this._launchCallback=t)}async _launch(e,t={}){await this.initialize,this._launchUrl=e;let r=Zn(this._testTitlePath);return this._root.dap.launch({...Ts,url:e,runtimeArgs:this._args,webRoot:this._webRoot,rootPath:this._workspaceRoot,skipNavigateForTest:!0,trace:{logFile:r},runtimeExecutable:$x.default.chromium.executablePath(),outFiles:[`${this._workspaceRoot}/**/*.js`,"!**/node_modules/**"],__workspaceFolder:this._workspaceRoot,cleanUp:"wholeBrowser",...t}),await new Promise(n=>this._launchCallback=n)}async runScript(e,t={}){await this.initialize,this._launchUrl=ye.isAbsolute(e)?e:ye.join(b,e);let r=Zn(this._testTitlePath);return this._root.dap.launch({type:"pwa-node",request:"launch",name:"Test Case",cwd:ye.dirname(b),program:this._launchUrl,rootPath:this._workspaceRoot,trace:{logFile:r},runtimeVersion:process.env.JSDBG_USE_NODE_VERSION,outFiles:[`${this._workspaceRoot}/**/*.js`,"!**/node_modules/**"],resolveSourceMapLocations:["**","!**/node_modules/**"],__workspaceFolder:this._workspaceRoot,...t}),await new Promise(n=>this._launchCallback=n)}async runScriptAsRemote(e,t={}){await this.initialize,e=ye.isAbsolute(e)?e:ye.join(b,e);let r=ye.join((0,Wx.tmpdir)(),"js-debug-test");return process.platform==="darwin"&&r.startsWith("/var/folders")&&(r=`/private/${r}`),after(()=>(0,Vx.default)(`${E(r)}/**`,{force:!0})),await new Promise((n,s)=>_m.src("**/*.*",{cwd:ye.dirname(e)}).pipe(_m.dest(r)).on("end",n).on("error",s)),this._root.dap.launch({...Xc,cwd:ye.dirname(b),program:ye.join(r,ye.basename(e)),localRoot:ye.dirname(e),remoteRoot:r,trace:{logFile:Zn(this._testTitlePath)},outFiles:[],resolveSourceMapLocations:["**","!**/node_modules/**"],env:{NODE_PATH:[process.env.NODE_PATH,ye.resolve(ye.dirname(e),"node_modules"),ye.resolve(es,"node_modules")].filter(Boolean).join(process.platform==="win32"?";":":")},__workspaceFolder:this._workspaceRoot,...t}),await new Promise(n=>this._launchCallback=n)}async attachNode(e,t={}){await this.initialize,this._launchUrl=`process${e}`,this._root.dap.launch({...ri,trace:{logFile:Zn(this._testTitlePath)},processId:`inspector${e}`,__workspaceFolder:this._workspaceRoot,...t});let r=await new Promise(o=>this._launchCallback=o);return await r.load(),r}async launch(e,t={}){let r="data:text/html;base64,"+Buffer.from(e).toString("base64");return this._launch(r,t)}async launchAndLoad(e,t={}){let r="data:text/html;base64,"+Buffer.from(e).toString("base64"),o=await this._launch(r,t);return await o.load(),o}buildUrl(e){return Cr("http://localhost:8001/",e)||e}async launchUrl(e,t={}){return await this._launch(this.buildUrl(e),t)}async launchUrlAndLoad(e,t={}){let r=await this._launch(this.buildUrl(e),t);return await r.load(),r}async disconnect(){return new Promise(e=>{this.initialize.then(()=>{var r;let t=(r=this._browserLauncher)==null?void 0:r.connectionForTest();if(t){let o=t.onDisconnected(()=>{e(),o.dispose()})}else e();this._root.dap.disconnect({}),this.binder.dispose()})})}completeUrl(e){return Cr(this._launchUrl,e)||""}workspacePath(e){return ye.join(this._workspaceRoot,e)}}});var cb,Bo,Fm,m_,g_,Hx,zx,Em,pb=m(()=>{"use strict";cb=require("chai"),Bo=w(require("fs")),Fm=w(require("path"));Z();xr();B();ct();m_=["id","threadId","sourceReference","variablesReference"],g_=new Set(["hitBreakpointIds"]),Hx=i=>i.split(`
`).map(e=>e.trimRight()).join(`
`).replace(/\\r\\n/g,"\\n"),zx=i=>i.replace(/^.*<node_internals>.*\r?\n/gm,"").replace(/^.*@ internal\/.*\r?\n/gm,""),Em=class{constructor(e,t,r){this.testFile=t;this._results=[],this._testName=e,this._hasNonAssertedLogs=!1,this._workspaceFolder=vt(r)}hasNonAssertedLogs(){return this._hasNonAssertedLogs}getOutput(){return Hx(this._results.join(`
`)+`
`)}assertLog(e={}){let t=this.getOutput();if(this._hasNonAssertedLogs=!1,e.customAssert){e.customAssert(t);return}e.process&&(t=e.process(t));let r=this.findGoldenFilePath();if(!Bo.existsSync(r))console.log("----- Missing expectations file, writing a new one"),Bo.writeFileSync(r,t,{encoding:"utf-8"});else if(process.env.RESET_RESULTS)Bo.writeFileSync(r,t,{encoding:"utf-8"});else{let o=Hx(Bo.readFileSync(r).toString("utf-8"));try{e.substring?(0,cb.expect)(t).to.contain(o):(0,cb.expect)(t).to.equal(o)}catch(n){throw Bo.writeFileSync(r+".actual",t,{encoding:"utf-8"}),n}}}findGoldenFilePath(){let e=this.testFile;if(!e)throw new Error("GoldenText failed to get filename!");let t=this._testName.trim().toLowerCase().replace(/\s/g,"-").replace(/[^-0-9a-zа-яё]/gi,""),r=Fm.resolve(Fm.dirname(e),t),o=r+`.${process.platform}.txt`;return Bo.existsSync(o)?o:r+".txt"}_sanitize(e){let t=(r,o)=>{let n=ot(E(r),"/"),s=new RegExp(n.replace(/\//g,"[\\\\/]")+"(.*)","gi");e=e.replace(s,(a,c)=>o+E(c))};return e=String(e),t(this._workspaceFolder,"${workspaceFolder}"),t(b,"${fixturesDir}"),e=e.replace(/testWorkspace/g,"${workspaceFolder}"),e=e.replace("/private${fixturesDir}","${fixturesDir}"),e=e.split(`
`).filter(r=>!r.includes("hidden: blackboxed")).join(`
`),e.replace(/VM\d+/g,"VM<xx>").replace(/\r\n/g,`
`).replace(/@\ .*vscode-pwa(\/|\\)/g,"@ ").replace(/data:text\/html;base64,[a-zA-Z0-9+/]*=?/g,"<data-url>")}log(e,t,r){return this._hasNonAssertedLogs=!0,typeof e=="object"?this._logObject(e,t,r):(this._results.push((t||"")+this._sanitize(e)),e)}_logObject(e,t,r){r=r||m_;let o=[],n=(c,p,l)=>{typeof c=="object"&&c!==null?c instanceof Array?a(c,p,l):s(c,p,l):o.push(l+this._sanitize(c).replace(/\n/g," "))};function s(c,p,l){p=p||"",l=l||p,o.push(l+"{");let u=Object.keys(c);u.sort();for(let f=0;f<u.length;++f){let y=u[f];if(!c.hasOwnProperty(y)||g_.has(y))continue;let v="    "+p+y+" : ",C=c[y];r&&r.includes(y)&&(C=`<${typeof C}>`),n(C,"    "+p,v)}o.push(p+"}")}function a(c,p,l){p=p||"",l=l||p,o.push(l+"[");for(let u=0;u<c.length;++u)n(c[u],"    "+p,"    "+p+"["+u+"] : ");o.push(p+"]")}return n(e,"",t||""),this._results.push(...o),e}}});var Jx={};Lb(Jx,{eventuallyOk:()=>J,itIntegrates:()=>g,waitForPause:()=>P});async function P(i,e){let{threadId:t}=i.log(await i.dap.once("stopped"));return await i.logger.logStackTrace(t),await(e==null?void 0:e(t)),i.dap.continue({threadId:t})}var lb,Gx,ub,Mm,ml,g,J,Ee=m(()=>{"use strict";lb=w(require("child_process")),Gx=w(require("del")),ub=w(require("path"));Z();U();pb();ct();process.env.DA_TEST_DISABLE_TELEMETRY="true";before(async()=>{Mm=[lb.fork(ub.join("D:\\a\\_work\\1\\s\\VsCodeDebugAdapter\\vscode-js-debug\\src\\test","testServer.js"),["8001"],{stdio:"pipe"}),lb.fork(ub.join("D:\\a\\_work\\1\\s\\VsCodeDebugAdapter\\vscode-js-debug\\src\\test","testServer.js"),["8002"],{stdio:"pipe"})],await Promise.all(Mm.map(i=>new Promise((e,t)=>{var o,n;let r="";(o=i.stderr)==null||o.on("data",s=>r+=s.toString()),(n=i.stdout)==null||n.on("data",s=>r+=s.toString()),i.once("error",t),i.once("close",s=>t(new Error(`Exited with ${s}, stderr=${r}`))),i.once("message",e)})))});after(async()=>{Mm.forEach(i=>i.kill()),Mm=[]});ml=(i,e,t=it)=>t(i,async function(){var n,s;if(!((n=this.test)!=null&&n.file))throw new Error("Could not find file for test");let r=new Em(this.test.titlePath().join(" "),(s=this.test)==null?void 0:s.file,_),o=new Dm(r,this.test.fullTitle());await o.initialize;try{this.test.goldenText=r,await e({golden:r,r:o,context:this})}finally{try{await o.disconnect()}catch(a){console.warn("Error disconnecting test root:",a)}}if(r.hasNonAssertedLogs())throw new Error(`Whoa, test "${i}" has some logs that it did not assert!

${r.getOutput()}`)});ml.only=(i,e)=>ml(i,e,it.only);ml.skip=(i,e)=>ml(i,e,it.skip);g=ml,J=async(i,e=1e3,t=10)=>{let r=Date.now()+e;for(;;)try{return await i()}catch(o){if(Date.now()+t>r)throw o;await k(t)}};afterEach(async()=>{await(0,Gx.default)([`${E(b)}/**`],{force:!0})})});var f_={};var or,gl,Kx,Qx=m(()=>{"use strict";or=require("chai"),gl=require("fs"),Kx=w(require("ws"));Tl();ct();Ee();describe("browser launch",()=>{g("environment variables",async({r:i})=>{if(process.platform==="win32")return;await(await i.launchUrlAndLoad("index.html",{env:{TZ:"GMT"}})).logger.evaluateAndLog("new Date().getTimezoneOffset()"),i.assertLog()}),g("runtime args",async({r:i})=>{await(await i.launchUrlAndLoad("index.html",{runtimeArgs:["--window-size=678,456"]})).logger.evaluateAndLog("[window.outerWidth, window.outerHeight]"),i.assertLog()}),g.skip("user data dir",async({r:i})=>{(0,gl.mkdirSync)(b,{recursive:!0}),(0,or.expect)((0,gl.readdirSync)(b)).to.be.empty,await i.launchUrlAndLoad("index.html",{userDataDir:b}),(0,or.expect)((0,gl.readdirSync)(b)).to.not.be.empty}),g("connects to rewritten websocket when using inspectUri parameter",async({r:i})=>{let t=new Kx.default.WebSocketServer({port:5935,path:"/_framework/debug/ws-proxy"});try{let r=new Promise(o=>{t.on("connection",n=>{n.on("message",s=>{let a=JSON.parse(s.toString());n.send(JSON.stringify({id:a.id,error:{message:"Fake websocket"}})),o(s.toString()),n.close()})})});i.launchUrl("index.html",{inspectUri:"{wsProtocol}://{url.hostname}:5935/_framework/debug/ws-proxy?browser={browserInspectUri}"}),(0,or.expect)(await r).to.be.eq('{"id":1001,"method":"Target.attachToBrowserTarget","params":{}}')}finally{await new Promise(r=>t.close(r))}})});describe("constructInspectorWSUri",()=>{let i="{wsProtocol}://{url.hostname}:{url.port}/_framework/debug/ws-proxy?browser={browserInspectUri}",e="http://localhost:5001/",t="ws://127.0.0.1:36775/devtools/browser/a292f96c-7332-4ce8-82a9-7411f3bd280a",r=encodeURIComponent(t),o="https://localhost:5001/";it("interpolates arguments to construct inspectUri",()=>{(0,or.expect)(Tt(i,e,t)).to.be.eq(`ws://localhost:5001/_framework/debug/ws-proxy?browser=${r}`),(0,or.expect)(Tt(i,o,t)).to.be.eq(`wss://localhost:5001/_framework/debug/ws-proxy?browser=${r}`)}),it("does not do anything with arguments that does not exist",()=>{(0,or.expect)(Tt(i+"&{iDoNotExist}{meEither}",e,t)).to.be.eq(`ws://localhost:5001/_framework/debug/ws-proxy?browser=${r}&{iDoNotExist}{meEither}`)}),it("fails with an useful error for invalid urls",()=>{(0,or.expect)(()=>Tt(i,".not_an_url",t)).to.throw(/Invalid URL/),(0,or.expect)(()=>Tt(i,null,t)).to.throw("A valid url wasn't supplied: <null>"),(0,or.expect)(()=>Tt(i,void 0,t)).to.throw("A valid url wasn't supplied: <undefined>"),(0,or.expect)(()=>Tt(i,"",t)).to.throw("A valid url wasn't supplied: <>")});let n="ws://localhost:1234/_framework/debug/ws-proxy?browser={browserInspectUri}";it("does not fail for an invalid url if it isnt used",()=>{(0,or.expect)(Tt(n,".not_an_url",t)).to.be.eq(`ws://localhost:1234/_framework/debug/ws-proxy?browser=${r}`),(0,or.expect)(Tt(n,void 0,t)).to.be.eq(`ws://localhost:1234/_framework/debug/ws-proxy?browser=${r}`)})})});var h_={};var db,Yx=m(()=>{"use strict";db=require("chai");Ee();describe("performance",()=>{g("gets performance information",async({r:i})=>{let t=await(await i.launchUrlAndLoad("index.html")).dap.getPerformance({});(0,db.expect)(t.error).to.be.undefined,(0,db.expect)(t.metrics).to.not.be.empty})})});var b_={};var kc,wt,Xx=m(()=>{"use strict";kc=w(require("assert")),wt=require("chai");Ve();U();describe("CancellationToken",()=>{it("None",()=>{(0,wt.expect)(Be.isCancellationRequested).to.equal(!1),(0,wt.expect)(typeof Be.onCancellationRequested).to.equal("function")}),it("cancel before token",function(i){let e=new pe;(0,wt.expect)(e.token.isCancellationRequested).to.equal(!1),e.cancel(),(0,wt.expect)(e.token.isCancellationRequested).to.equal(!0),e.token.onCancellationRequested(()=>{kc.ok(!0),i()})}),it("cancel happens only once",()=>{let i=new pe;(0,wt.expect)(i.token.isCancellationRequested).to.equal(!1);let e=0;function t(){e+=1}i.token.onCancellationRequested(t),i.cancel(),i.cancel(),(0,wt.expect)(e).to.equal(1)}),it("cancel calls all listeners",()=>{let i=0,e=new pe;e.token.onCancellationRequested(()=>{i+=1}),e.token.onCancellationRequested(()=>{i+=1}),e.token.onCancellationRequested(()=>{i+=1}),e.cancel(),(0,wt.expect)(i).to.equal(3)}),it("token stays the same",()=>{let i=new pe,e=i.token;kc.ok(e===i.token),i.cancel(),kc.ok(e===i.token),i.cancel(),kc.ok(e===i.token),i=new pe,i.cancel(),e=i.token,kc.ok(e===i.token)}),it("dispose calls no listeners",()=>{let i=0,e=new pe;e.token.onCancellationRequested(()=>{i+=1}),e.dispose(),e.cancel(),(0,wt.expect)(i).to.equal(0)}),it("dispose calls no listeners (unless told to cancel)",()=>{let i=0,e=new pe;e.token.onCancellationRequested(()=>{i+=1}),e.dispose(!0),(0,wt.expect)(i).to.equal(1)}),it("parent cancels child",()=>{let i=new pe,e=new pe(i.token),t=0;e.token.onCancellationRequested(()=>t+=1),i.cancel(),(0,wt.expect)(t).to.equal(1),(0,wt.expect)(e.token.isCancellationRequested).to.equal(!0),(0,wt.expect)(i.token.isCancellationRequested).to.equal(!0)}),describe("cancellableRace",()=>{it("returns the value when no cancellation is requested",async()=>{let i=await At(Promise.resolve(42),Be);(0,wt.expect)(i).to.equal(42)}),it("throws if cancellation is requested",async()=>{try{throw await At(Promise.resolve(42),$g),new Error("expected to throw")}catch(i){if(i instanceof Gt)(0,wt.expect)(i.message).to.equal("Task cancelled");else throw i}}),it("throws if lazy cancellation is requested",async()=>{try{throw await At(k(1e3),pe.withTimeout(3).token,"Could not do the thing"),new Error("expected to throw")}catch(i){if(i instanceof Gt)(0,wt.expect)(i.message).to.equal("Could not do the thing");else throw i}})})})});var w_={};var Bm,Zx,mb,gb,ek,tk=m(()=>{"use strict";Bm=require("chai"),Zx=require("crypto"),mb=require("sinon"),gb=require("stream"),ek=require("ws");Dn();Rn();Ve();_r();Ee();describe("cdp transport",()=>{let i=[["raw pipe",async()=>{let e=new gb.PassThrough,t=new gb.PassThrough,r=new Pt(A.null,e,t),o=new Pt(A.null,t,e);return{a:r,b:o,dispose:()=>{}}}],["websocket",async()=>{let e=new ek.Server({host:"127.0.0.1",port:0});await new Promise((n,s)=>{e.on("listening",n),e.on("error",s)});let t=e.address(),r=Ze.create(`ws://127.0.0.1:${t.port}`,Be),o=new Promise((n,s)=>{e.on("connection",a=>n(new Ze(a))),e.on("error",s)});return{a:await r,b:await o,dispose:()=>e.close()}}]];for(let[e,t]of i)describe(e,()=>{it("round-trips",async()=>{let r=(0,Zx.randomBytes)(100),{a:o,b:n,dispose:s}=await t(),a=[],c=[];n.onMessage(([p])=>a.push(p));for(let p=0;p<r.length;){let l=Math.floor(Math.random()*20),u=r.slice(p,p+l).toString("base64");c.push(u),o.send(u),p+=l}await J(()=>(0,Bm.expect)(a).to.deep.equal(c)),await o.dispose(),s()}),it("bubbles closure",async()=>{let{a:r,b:o,dispose:n}=await t(),s=(0,mb.stub)(),a=(0,mb.stub)();r.onEnd(s),o.onEnd(a),await r.dispose(),await J(()=>(0,Bm.expect)(s.called).to.be.true),await J(()=>(0,Bm.expect)(a.called).to.be.true),n()})})})});var y_={};var rk,ok,ik=m(()=>{"use strict";_p();rk=require("sinon"),ok=require("chai");describe("defaultBrowserProvider",()=>{describe("win32",()=>{let i=[{output:`\r
HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice\r
    ProgId    REG_SZ    AppXq0fevzme2pys62n3e0fbqa7peapykr8v\r
\r
`,expected:4},{output:`\r
HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice\r
    ProgId    REG_SZ    MSEdgeDHTML\r
\r
`,expected:3},{output:`\r
HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice\r
    ProgId    REG_SZ    ChromeHTML\r
\r
`,expected:0},{output:`\r
HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice\r
    ProgId    REG_SZ    IE.HTTP\r
\r
`,expected:5},{output:`\r
HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice\r
    ProgId    REG_SZ    FirefoxURL\r
\r
`,expected:2},{output:`\r
HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice\r
    ProgId    REG_SZ    Potato\r
\r
`,expected:void 0}];for(let{output:e,expected:t}of i)it(`gets browser ${t}`,async()=>{let r=(0,rk.stub)().resolves({stdout:e}),o=new Ti(r,"win32");(0,ok.expect)(await o.lookup()).to.equal(t)})})})});var v_={};var nk,jm,sk=m(()=>{"use strict";nk=require("chai"),jm=require("sinon");L();_r();describe("Logger",()=>{let i,e;beforeEach(()=>{i={write:(0,jm.stub)(),setup:(0,jm.stub)().resolves(),dispose:(0,jm.stub)()},e=new A}),it("buffers and logs messages once sinks are attached",async()=>{e.verbose("runtime","Hello world!"),await e.setup({sinks:[i],showWelcome:!1}),(0,nk.expect)(i.write.args[0][0]).to.containSubset({tag:"runtime",message:"Hello world!",level:0})})})});var S_={};var jo,ak=m(()=>{"use strict";jo=require("chai");ls();describe("mapUsingProjection",()=>{it("gets values",()=>{let i=new dt(e=>e.toLowerCase());i.set("bar",1),(0,jo.expect)(i.get("foo")).to.be.undefined,(0,jo.expect)(i.get("bar")).to.equal(1),(0,jo.expect)(i.get("bAr")).to.equal(1)}),it("sets values",()=>{let i=new dt(e=>e.toLowerCase());i.set("bar",1),(0,jo.expect)(i.get("bar")).to.equal(1),i.set("BAR",2),(0,jo.expect)(i.get("bar")).to.equal(2)}),it("deletes values",()=>{let i=new dt(e=>e.toLowerCase());i.set("bar",1),i.delete("bAr"),(0,jo.expect)(i.get("bar")).to.be.undefined}),it("gets keys",()=>{let i=new dt(e=>e.toLowerCase());i.set("FOO",1),i.set("bar",1),(0,jo.expect)([...i.keys()].sort()).to.deep.equal(["FOO","bar"])}),it("gets values",()=>{let i=new dt(e=>e.toLowerCase());i.set("FOO",1),i.set("bar",2),(0,jo.expect)([...i.values()].sort()).to.deep.equal([1,2])})})});var I_={};var pt,ck=m(()=>{"use strict";pt=require("chai");Z();describe("pathUtils",()=>{describe("forceForwardSlashes",()=>{it("works for c:/... cases",()=>{(0,pt.expect)(E("C:\\foo\\bar")).to.equal("C:/foo/bar"),(0,pt.expect)(E("C:\\")).to.equal("C:/"),(0,pt.expect)(E("C:/foo\\bar")).to.equal("C:/foo/bar")}),it("works for relative paths",()=>{(0,pt.expect)(E("foo\\bar")).to.equal("foo/bar"),(0,pt.expect)(E("foo\\bar/baz")).to.equal("foo/bar/baz")}),it("fixes escaped forward slashes",()=>{(0,pt.expect)(E("foo\\/bar")).to.equal("foo/bar")})}),describe("fixDriveLetterAndSlashes",()=>{it("works for c:/... cases",()=>{(0,pt.expect)(K("C:/path/stuff")).to.equal("c:\\path\\stuff"),(0,pt.expect)(K("c:/path\\stuff")).to.equal("c:\\path\\stuff"),(0,pt.expect)(K("C:\\path")).to.equal("c:\\path"),(0,pt.expect)(K("C:\\")).to.equal("c:\\")}),it("works for file:/// cases",()=>{(0,pt.expect)(K("file:///C:/path/stuff")).to.equal("file:///c:\\path\\stuff"),(0,pt.expect)(K("file:///c:/path\\stuff")).to.equal("file:///c:\\path\\stuff"),(0,pt.expect)(K("file:///C:\\path")).to.equal("file:///c:\\path"),(0,pt.expect)(K("file:///C:\\")).to.equal("file:///c:\\")}),it("does not impact posix cases",()=>{(0,pt.expect)(K("file:///a/b")).to.equal("file:///a/b"),(0,pt.expect)(K("/a/b")).to.equal("/a/b")})})})});var P_={};var jr,pk,lk=m(()=>{"use strict";jr=require("chai"),pk=w(require("path"));_r();Z();Ed();describe("SourceMapOverrides",()=>{describe("getComputedSourceRoot()",()=>{let i=(...s)=>be(pk.resolve(...s)),e=i("/project/webroot/code/script.js"),t="http://localhost:8080/code/script.js",r=i("/project/src"),o=i("/project/webroot"),n={"/":o};it("handles file:/// sourceRoot",async()=>{(0,jr.expect)(await Ct("file:///"+r,e,n,bt,A.null)).to.equal(r)}),it("handles /src style sourceRoot",async()=>{(0,jr.expect)(await Ct("/src",e,n,bt,A.null)).to.equal(i("/project/webroot/src"))}),it("handles /src style without matching pathMapping",async()=>{(0,jr.expect)(await Ct("/foo/bar",e,{},bt,A.null)).to.equal("/foo/bar")}),it("handles c:/src style without matching pathMapping",async()=>{(0,jr.expect)(await Ct("c:\\foo\\bar",e,{},bt,A.null)).to.equal("c:\\foo\\bar")}),it("handles ../../src style sourceRoot",async()=>{(0,jr.expect)(await Ct("../../src",e,n,bt,A.null)).to.equal(r)}),it("handles src style sourceRoot",async()=>{(0,jr.expect)(await Ct("src",e,n,bt,A.null)).to.equal(i("/project/webroot/code/src"))}),it("handles runtime script not on disk",async()=>{(0,jr.expect)(await Ct("../src",t,n,bt,A.null)).to.equal(i("/project/webroot/src"))}),it("when no sourceRoot specified and runtime script is on disk, uses the runtime script dirname",async()=>{(0,jr.expect)(await Ct("",e,n,bt,A.null)).to.equal(i("/project/webroot/code"))}),it("when no sourceRoot specified and runtime script is not on disk, uses the runtime script dirname",async()=>{(0,jr.expect)(await Ct("",t,n,bt,A.null)).to.equal(i("/project/webroot/code"))}),it("no crash on debugadapter:// urls",async()=>{(0,jr.expect)(await Ct("","eval://123",n,bt,A.null)).to.equal(i(o))})})})});function R(i,e){fl.mkdirSync(i,{recursive:!0});for(let t of Object.keys(e)){let r=e[t],o=Om.join(i,t),n;if(typeof r=="string")n=Buffer.from(r);else if(r instanceof Buffer)n=r;else if(r instanceof Array)n=Buffer.from(r.join(fb.EOL));else{R(o,r);continue}fl.mkdirSync(Om.dirname(o),{recursive:!0}),fl.writeFileSync(o,n)}}var fl,fb,Om,C_,x_,uo=m(()=>{"use strict";fl=w(require("fs")),fb=require("os"),Om=w(require("path")),C_=require("path"),x_=require("crypto")});var k_={};var Oo,We,uk=m(()=>{"use strict";Oo=require("chai"),We=require("path");Fs();_r();Z();Jf();B();uo();ct();describe("ISourceMapRepository",()=>{[{name:"TurboSearchStrategy",create:()=>new Di(A.null)}].forEach(i=>describe(i.name,()=>{let e;beforeEach(()=>{e=i.create(),R(b,{"a.js":"//# sourceMappingURL=a.js.map","a.js.map":"content1","c.js":"no.sourcemap.here",nested:{"d.js":"//# sourceMappingURL=d.js.map","d.js.map":"content2"},node_modules:{"e.js":"//# sourceMappingURL=e.js.map","e.js.map":"content3"},defaultSearchExcluded:{"f.js":"//# sourceMappingURL=f.js.map","f.js.map":"content3"}})});let t=(s,a)=>new zt({rootPath:s,patterns:[`${a}/**/*.js`,"!**/node_modules/**"]}),r=async s=>(await e.streamChildrenWithSourcemaps({files:s,processMap:async c=>{let{cacheKey:p,...l}=c;return(0,Oo.expect)(p).to.be.within(Date.now()-6e4,Date.now()+1e3),l.compiledPath=K(l.compiledPath),l},onProcessedMap:c=>c})).values.sort((c,p)=>c.compiledPath.length-p.compiledPath.length),o=async s=>(await r(s)).map(c=>K(c.compiledPath)),n=s=>e.streamAllChildren(s,a=>a).then(a=>a.sort());it("no-ops for non-existent directories",async()=>{(0,Oo.expect)(await r(t("D:\\a\\_work\\1\\s\\VsCodeDebugAdapter\\vscode-js-debug\\src\\test\\common","does-not-exist"))).to.be.empty}),it("discovers source maps and applies negated globs",async()=>{(0,Oo.expect)(await r(t(es,Lm))).to.deep.equal([{compiledPath:be((0,We.join)(b,"a.js")),sourceMapUrl:W((0,We.join)(b,"a.js.map"))},{compiledPath:be((0,We.join)(b,"nested","d.js")),sourceMapUrl:W((0,We.join)(b,"nested","d.js.map"))},{compiledPath:be((0,We.join)(b,"defaultSearchExcluded","f.js")),sourceMapUrl:W((0,We.join)(b,"defaultSearchExcluded","f.js.map"))}])}),it("applies second patterns (vscode#168635)",async()=>{R(b,{rootPath:{"d.js":"//# sourceMappingURL=d.js.map","d.js.map":"content2"},otherFolder:{"f.js":"//# sourceMappingURL=f.js.map","f.js.map":"content3"}}),(0,Oo.expect)(await o(new zt({patterns:["rootPath/*.js","otherFolder/*.js"],rootPath:b}))).to.deep.equal([be((0,We.join)(b,"rootPath","d.js")),be((0,We.join)(b,"otherFolder","f.js"))])}),it("globs for a single file",async()=>{(0,Oo.expect)(await o(new zt({patterns:["nested/d.js"],rootPath:b}))).to.deep.equal([be((0,We.join)(b,"nested","d.js"))])}),it("applies negated globs outside rootPath (#1479)",async()=>{let s={"e.js":"//# sourceMappingURL=e.js.map","e.js.map":"content3"};R(b,{rootPath:{"d.js":"//# sourceMappingURL=d.js.map","d.js.map":"content2",node_modules:s},otherFolder:{"f.js":"//# sourceMappingURL=f.js.map","f.js.map":"content3",node_modules:s}}),(0,Oo.expect)(await o(new zt({patterns:["**/*.js","../otherFolder/**/*.js","!**/node_modules/**"],rootPath:(0,We.join)(b,"rootPath")}))).to.deep.equal([be((0,We.join)(b,"rootPath","d.js")),be((0,We.join)(b,"otherFolder","f.js"))])}),it("streams all children",async()=>{(0,Oo.expect)(await n(t(es,Lm))).to.deep.equal([be((0,We.join)(b,"a.js")),be((0,We.join)(b,"c.js")),be((0,We.join)(b,"defaultSearchExcluded","f.js")),be((0,We.join)(b,"nested","d.js"))])}),it("greps inside node_modules explicitly",async()=>{(0,Oo.expect)(await r(t((0,We.join)(b,"node_modules"),"."))).to.deep.equal([{compiledPath:be((0,We.join)(b,"node_modules","e.js")),sourceMapUrl:W((0,We.join)(b,"node_modules","e.js.map"))}])})}))})});var T_={};var Tc,dk=m(()=>{"use strict";Tc=require("chai");Ee();describe("completion",()=>{let i=[["ar|",[{label:"arr",sortText:"~~arr",type:"variable",detail:"Array"}]],["arr.|",[{label:"[index]",text:"[index]",type:"property",sortText:"~~[",length:1,selectionLength:5,selectionStart:1,start:3},{label:"length",detail:"3",sortText:"~~length",type:"property"},{label:"at",detail:"fn(?)",sortText:"~~~at",type:"method"}]],["arr[|",[]],["arr[0].|",[{label:"length",detail:"0",sortText:"~~length",type:"property"},{label:"anchor",detail:"fn(?)",sortText:"~~~anchor",type:"method"},{label:"at",detail:"fn(?)",sortText:"~~~at",type:"method"}]],["arr[2].|",[]],["obj.|",[{label:"bar",detail:"42",sortText:"~~bar",type:"property"},{label:"baz",detail:"fn()",sortText:"~~baz",type:"method"},{label:"foo",detail:"string",sortText:"~~foo",type:"property"}]],["ob|",[{label:"obj",sortText:"~~obj",type:"variable",detail:"Object"}]],["arr[myStr|",[{label:"myString",sortText:"~~myString",type:"variable",detail:"string"}]],["const replVar = 42; replV|",[{label:"replVar",sortText:"replVar",type:"variable"}]],["MyCoolCl|",[{label:"MyCoolClass",sortText:"~~MyCoolClass",type:"class",detail:"fn()"}]],["Strin|",[{label:"String",sortText:"~~String",type:"class",detail:"fn(?)"}]],["myNeatFun|",[{label:"myNeatFunction",sortText:"~~myNeatFunction",type:"function",detail:"fn()"}]],["new Array(42).|",[{label:"[index]",text:"[index]",type:"property",sortText:"~~[",length:1,selectionLength:5,selectionStart:1,start:13},{label:"length",detail:"42",sortText:"~~length",type:"property"},{label:"at",detail:"fn(?)",sortText:"~~~at",type:"method"}]],["poison.|",[{label:"bar",sortText:"~~bar",type:"property",detail:"true"},{label:"foo",sortText:"~~foo",type:"property"},{label:"constructor",sortText:"~~~constructor",type:"class",detail:"fn(?)"}]],["hasPrivate.|",[{label:"c",sortText:"~~c",type:"property",detail:"3"},{label:"_a",sortText:"~~{a",type:"property",detail:"1"},{label:"__b",sortText:"~~{{b",type:"property",detail:"2"}]],["complexProp.|",[{label:"complex prop",text:'["complex prop"]',start:11,length:1,type:"property",sortText:"~~complex prop",detail:"true"},{label:"constructor",sortText:"~~~constructor",type:"class",detail:"fn(?)"},{label:"hasOwnProperty",sortText:"~~~hasOwnProperty",type:"method",detail:"fn(?)"}]],["$returnV|",[]]];g("completion",async({r:e})=>{let t=await e.launchAndLoad(`
      <script>
        var arr = ['', {}, null];
        var obj = { foo: '', bar: 42, baz() {} };
        var myString = '';
        var MyCoolClass = class MyCoolClass {} // need to be hoisted manually
        function myNeatFunction() {}
        var hasPrivate = { _a: 1, __b: 2, c: 3 };
        var poison = { get foo() { throw new Error('oh no!') }, bar: true };
        var complexProp = { 'complex prop': true };
      </script>
    `);for(let[r,o]of i){let n=r.indexOf("|"),s=await t.dap.completions({text:r.slice(0,n)+r.slice(n+1),column:n+1});(0,Tc.expect)(s.targets.slice(0,3)).to.deep.equal(o,`bad result evaluating ${r}`)}}),g("completes in scope (vscode#153651)",async({r:e})=>{let t=await e.launch(`
      <script>
        function foo() {
          const helloWorld = '';
          debugger;
        }

        foo();
      </script>
    `),r=t.dap.once("stopped");t.load();let o=(await t.dap.stackTrace({threadId:(await r).threadId})).stackFrames[0],n=await t.dap.completions({text:"helloW",column:7,frameId:o.id});(0,Tc.expect)(n.targets).to.deep.equal([{label:"helloWorld",type:"property"}])}),g("$returnValue",async({r:e})=>{let t=async()=>(await r.dap.stackTrace({threadId:o})).stackFrames[0].id,r=await e.launchAndLoad(`
      <script>
        function foo() {
          debugger;
          return { a: { b: 2 }};
        }
      </script>
    `);r.dap.evaluate({expression:"foo() "});let{threadId:o}=await r.dap.once("stopped");await r.dap.next({threadId:o}),await r.dap.once("stopped");let n=await r.dap.completions({text:"$returnValu",column:11,frameId:await t()});(0,Tc.expect)(n.targets).to.not.containSubset([{sortText:"~$returnValue"}]),await r.dap.next({threadId:o}),await r.dap.once("stopped");let s=await t(),a=await r.dap.completions({text:"$returnValu",column:11,frameId:s});(0,Tc.expect)(a.targets).to.containSubset([{label:"$returnValue",type:"variable",sortText:"~$returnValue"}]);let c=await r.dap.completions({text:"$returnValue.",column:14,frameId:s});(0,Tc.expect)(c.targets).to.containSubset([{label:"a",sortText:"~~a",type:"property"}])})})});var Rc,hb=m(()=>{"use strict";Rc=class{constructor(){this.data=new Map}keys(){return[...this.data.keys()]}get(e,t){return this.data.has(e)?this.data.get(e):t}update(e,t){return this.data.set(e,t),Promise.resolve()}}});var R_={};var Dc,mk,gk,fk=m(()=>{"use strict";Dc=require("chai"),mk=require("path"),gk=w(require("vscode"));F();to();M();Vh();uo();ct();hb();describe("ExtensionHostConfigurationProvider",()=>{let i,e=r=>({uri:gk.Uri.file((0,mk.join)(b,r)),name:"test-dir",index:0}),t={type:"pwa-extensionHost",name:"",request:"",args:["--extensionDevelopmentPath=${workspaceFolder}"]};beforeEach(()=>{i=new Hi(Wo({logPath:b,workspaceState:new Rc})),oe.platform="linux"}),describe("web worker debugging",()=>{beforeEach(()=>R(b,{"withWeb/package.json":JSON.stringify({extensionKind:["web"]}),"withoutWeb/package.json":JSON.stringify({})})),it("does not enable if no args",async()=>{let r=await i.resolveDebugConfiguration(e("withWeb"),{...t,args:[]});(0,Dc.expect)(r==null?void 0:r.debugWebWorkerHost).to.be.false}),it("does not enable if wrong type",async()=>{let r=await i.resolveDebugConfiguration(e("withoutWeb"),t);(0,Dc.expect)(r==null?void 0:r.debugWebWorkerHost).to.be.false}),it("does not enable if enoent folder",async()=>{let r=await i.resolveDebugConfiguration(e("doesNotExist"),t);(0,Dc.expect)(r==null?void 0:r.debugWebWorkerHost).to.be.false}),it("does not override existing option",async()=>{let r=await i.resolveDebugConfiguration(e("doesNotExist"),{...t,debugWebWorkerHost:!0});(0,Dc.expect)(r==null?void 0:r.debugWebWorkerHost).to.be.true}),it("enables if all good",async()=>{let r=await i.resolveDebugConfiguration(e("withWeb"),t);(0,Dc.expect)(r==null?void 0:r.debugWebWorkerHost).to.be.true})})})});var D_={};var $,hk,Or,bk,Ut,wk=m(()=>{"use strict";$=require("chai"),hk=require("fs"),Or=require("path"),bk=require("sinon"),Ut=w(require("vscode"));F();to();ae();M();Ka();uo();ct();hb();describe("NodeDebugConfigurationProvider",()=>{let i,e,t={uri:Ut.Uri.file(b),name:"test-dir",index:0};beforeEach(()=>{e={resolveNvmVersionPath:(0,bk.stub)()},i=new co(Wo({logPath:b,workspaceState:new Rc}),e,new se(hk.promises)),oe.platform="linux"}),afterEach(()=>{oe.platform=process.platform}),describe("logging resolution",()=>{let r={type:"node",name:"",request:""};beforeEach(()=>{R(b,{"hello.js":"","package.json":JSON.stringify({main:"hello.js"})})}),it("does not log by default",async()=>{let o=await i.resolveDebugConfiguration(t,r);(0,$.expect)(o.trace).to.deep.equal({stdio:!1,logFile:null})}),it("applies defaults with trace=true",async()=>{let o=await i.resolveDebugConfiguration(t,{...r,trace:!0});(0,$.expect)(o.trace).to.containSubset({stdio:!0})})}),describe("launch config from context",()=>{let r={type:"",name:"",request:""};it("loads the program from a package.json main if available",async()=>{R(b,{"hello.js":"","package.json":JSON.stringify({main:"hello.js"})});let o=await i.resolveDebugConfiguration(t,r);o.cwd=o.cwd.toLowerCase(),(0,$.expect)(o).to.containSubset({type:"pwa-node",cwd:b.toLowerCase(),name:"Launch Program",program:(0,Or.join)("${workspaceFolder}","hello.js"),request:"launch"})}),it("loads the program from a package.json start script if available",async()=>{R(b,{"hello.js":"","package.json":JSON.stringify({scripts:{start:"node hello.js"}})});let o=await i.resolveDebugConfiguration(t,r);o.cwd=o.cwd.toLowerCase(),(0,$.expect)(o).to.containSubset({type:"pwa-node",cwd:b.toLowerCase(),name:"Launch Program",program:(0,Or.join)("${workspaceFolder}","hello.js"),request:"launch"})}),it("configures mern starters",async()=>{R(b,{"hello.js":"","package.json":JSON.stringify({name:"mern-starter"})});let o=await i.resolveDebugConfiguration(t,r);(0,$.expect)(o).to.containSubset({runtimeExecutable:"nodemon",program:"${workspaceFolder}/index.js",restart:!0,env:{BABEL_DISABLE_CACHE:"1",NODE_ENV:"development"}})}),it("loads a common entrypoint if available",async()=>{R(b,{"main.js":""});let o=await i.resolveDebugConfiguration(t,r);o.cwd=o.cwd.toLowerCase(),(0,$.expect)(o).to.containSubset({type:"pwa-node",cwd:b.toLowerCase(),name:"Launch Program",program:(0,Or.join)("${workspaceFolder}","main.js"),request:"launch"})}),it("attempts to load the active text editor",async()=>{R(b,{"hello.js":""});let o=await Ut.workspace.openTextDocument((0,Or.join)(b,"hello.js"));await Ut.window.showTextDocument(o);try{let n=await i.resolveDebugConfiguration(t,r);(0,$.expect)(n).to.containSubset({program:(0,Or.join)("${workspaceFolder}","hello.js")})}finally{await Ut.commands.executeCommand("workbench.action.closeActiveEditor")}}),it("applies tsconfig settings automatically",async()=>{R(b,{out:{"hello.js":""},src:{"hello.ts":""},"package.json":JSON.stringify({main:"out/hello.js"}),"tsconfig.json":JSON.stringify({compilerOptions:{outDir:"out"}})});let o=await Ut.workspace.openTextDocument((0,Or.join)(b,"src","hello.ts"));await Ut.window.showTextDocument(o);try{let n=await i.resolveDebugConfiguration(t,r);(0,$.expect)(n).to.containSubset({program:(0,Or.join)("${workspaceFolder}","out","hello.js"),preLaunchTask:"tsc: build - tsconfig.json",outFiles:["${workspaceFolder}/out/**/*.js"]})}finally{await Ut.commands.executeCommand("workbench.action.closeActiveEditor")}})}),it("attempts to resolve nvm",async()=>{R(b,{"my.env":`A=bar
B="quoted"
"C"="more quoted"

D=overridden
`,"hello.js":""}),e.resolveNvmVersionPath.resolves({directory:"/my/node/location",binary:"node64"});let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeVersion:"3.1.4",env:{hello:"world",PATH:"/usr/bin"}});(0,$.expect)(r).to.containSubset({runtimeExecutable:"node64",env:{hello:"world",PATH:"/my/node/location:/usr/bin"}})}),describe("inspect flags",()=>{it("demaps",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeArgs:["-a","--inspect-brk","--b"]});(0,$.expect)(r.runtimeArgs).to.deep.equal(["-a","--b"]),(0,$.expect)(r.stopOnEntry).to.be.true}),it("does not overwrite existing stop on entry",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",stopOnEntry:"hello.js",runtimeArgs:["-a","--inspect-brk","--b"]});(0,$.expect)(r.runtimeArgs).to.deep.equal(["-a","--b"]),(0,$.expect)(r.stopOnEntry).to.equal("hello.js")}),it("assigns a random simple attach port",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",attachSimplePort:0});(0,$.expect)(r.continueOnAttach).to.be.true,(0,$.expect)(r.attachSimplePort).to.be.greaterThan(0),(0,$.expect)(r.runtimeArgs).to.deep.equal([`--inspect-brk=${r.attachSimplePort}`]),(0,$.expect)(r.continueOnAttach).to.equal(!0)}),it("merged picked port with existing runtime args",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",attachSimplePort:0,runtimeArgs:["--nolazy"]});(0,$.expect)(r.runtimeArgs).to.deep.equal(["--nolazy",`--inspect-brk=${r.attachSimplePort}`])}),it("keeps a static attach port",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",attachSimplePort:9229,runtimeArgs:["--inspect-brk"]});(0,$.expect)(r.continueOnAttach).to.be.true,(0,$.expect)(r.attachSimplePort).to.be.greaterThan(0),(0,$.expect)(r.runtimeArgs).to.deep.equal(["--inspect-brk"]),(0,$.expect)(r.continueOnAttach).to.equal(!0)}),it("adjusts stopOnEntry to continueOnArray",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",attachSimplePort:0,stopOnEntry:!0});(0,$.expect)(r.continueOnAttach).to.be.false,(0,$.expect)(r.stopOnEntry).to.be.false})}),describe("outFiles",()=>{it("does not modify outfiles with no package.json",async()=>{R(b,{"hello.js":""});let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js"});(0,$.expect)(r==null?void 0:r.outFiles).to.deep.equal(["${workspaceFolder}/**/*.js","!**/node_modules/**"])}),it("preserves outFiles if package.json is in the same folder",async()=>{R(b,{"hello.js":"","package.json":"{}"});let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js"});(0,$.expect)(r==null?void 0:r.outFiles).to.deep.equal(["${workspaceFolder}/**/*.js","!**/node_modules/**"])}),it("gets the nearest nested package.json",async()=>{R(b,{"a/b/c/hello.js":"","a/b/package.json":"{}","a/package.json":"{}"});let r=await i.resolveDebugConfiguration({uri:Ut.Uri.file((0,Or.join)(b,"b")),name:"test-dir",index:0},{type:"pwa-node",name:"",request:"launch",program:"../a/b/c/hello.js"});(0,$.expect)(r==null?void 0:r.outFiles).to.deep.equal(["${workspaceFolder}/**/*.js","!**/node_modules/**","${workspaceFolder}/../a/b/**/*.js","!${workspaceFolder}/../a/b/**/node_modules/**"])}),it("does not resolve in node_modules",async()=>{R(b,{"a/node_modules/c/hello.js":"","a/node_modules/c/package.json":"{}","a/package.json":"{}"});let r=await i.resolveDebugConfiguration({uri:Ut.Uri.file((0,Or.join)(b,"b")),name:"test-dir",index:0},{type:"pwa-node",name:"",request:"launch",program:"../a/node_modules/c/hello.js"});(0,$.expect)(r==null?void 0:r.outFiles).to.deep.equal(["${workspaceFolder}/**/*.js","!**/node_modules/**","${workspaceFolder}/../a/**/*.js","!${workspaceFolder}/../a/**/node_modules/**"])}),it("does not resolve outside the workspace folder",async()=>{R(b,{"a/b/c/hello.js":"","package.json":"{}"});let r=await i.resolveDebugConfiguration({uri:Ut.Uri.file((0,Or.join)(b,"a")),name:"test-dir",index:0},{type:"pwa-node",name:"",request:"launch",program:"b/c/hello.js"});(0,$.expect)(r==null?void 0:r.outFiles).to.deep.equal(["${workspaceFolder}/**/*.js","!**/node_modules/**"])})}),describe("deno",()=>{it("fills in default deno options",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeExecutable:"deno"}),o=r.attachSimplePort;(0,$.expect)(o).to.be.a("number"),(0,$.expect)(r.runtimeArgs).to.deep.equal(["run",`--inspect-brk=127.0.0.1:${o}`,"--allow-all"]),(0,$.expect)(r.continueOnAttach).to.be.true}),it("allows manual application",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeExecutable:"deno",runtimeArgs:["run","--inspect-brk=9229"],attachSimplePort:9229});(0,$.expect)(r.attachSimplePort).to.equal(9229),(0,$.expect)(r.runtimeArgs).to.deep.equal(["run","--inspect-brk=9229"])}),it("allows partial run args",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeExecutable:"deno",runtimeArgs:["--some-arg"]}),o=r.attachSimplePort;(0,$.expect)(o).to.be.a("number"),(0,$.expect)(r.runtimeArgs).to.deep.equal(["run",`--inspect-brk=127.0.0.1:${o}`,"--allow-all","--some-arg"])})})})});var __={};var ts,hl,yk,Nm,vk,_c,Sk,Ik,Nr,Pk=m(()=>{"use strict";ts=require("chai"),hl=require("child_process"),yk=w(require("del")),Nm=require("fs"),vk=require("os"),_c=w(require("path")),Sk=require("sinon"),Ik=w(require("split2")),Nr=w(require("vscode"));F();ui();ae();Z();U();H();Fh();uo();ct();Ee();describe("pick and attach",()=>{let i=_c.join((0,vk.tmpdir)(),"js-debug-pick-and-attach"),e,t,r,o=!1;beforeEach(()=>t=(0,Sk.createSandbox)()),afterEach(async()=>{t==null||t.restore(),e==null||e.kill(),await(0,yk.default)([`${E(i)}/**`],{force:!0})}),process.platform!=="win32"&&(it("infers the working directory",async()=>{R(i,{"foo.js":"setInterval(() => {}, 1000)"}),e=(0,hl.spawn)("node",["foo.js"],{cwd:i});let n={...ri,processId:`${e.pid}:1234`};await za(new se(Nm.promises),n,!0),(0,ts.expect)(Am(n.cwd)).to.equal(i)}),it("adjusts to the package root",async()=>{R(i,{"package.json":"{}","nested/foo.js":"setInterval(() => {}, 1000)"}),e=(0,hl.spawn)("node",["foo.js"],{cwd:_c.join(i,"nested")});let n={...ri,processId:`${e.pid}:1234`};await za(new se(Nm.promises),n,!0),(0,ts.expect)(Am(n.cwd)).to.equal(i)}),it("limits inference to workspace root",async()=>{R(i,{"package.json":"{}","nested/foo.js":"setInterval(() => {}, 1000)"}),t.stub(Nr.workspace,"getWorkspaceFolder").returns({name:"nested",index:1,uri:Nr.Uri.file(_c.join(i,"nested"))}),e=(0,hl.spawn)("node",["foo.js"],{cwd:_c.join(i,"nested")});let s={...ri,processId:`${e.pid}:1234`};await za(new se(Nm.promises),s,!0),(0,ts.expect)(Am(s.cwd)).to.equal(_c.join(i,"nested"))})),describe("",()=>{beforeEach(async()=>{r=await je(),e=(0,hl.spawn)("node",["--inspect-brk",`--inspect-port=${r}`],{stdio:"pipe"}),e.on("error",console.error),e.stderr.pipe((0,Ik.default)()).on("data",n=>o=o||n.includes("Debugger attached"))}),it("end to end",async function(){this.timeout(30*1e3);let n=t.spy(Nr.window,"createQuickPick");Nr.commands.executeCommand("extension.pwa-node-debug.attachNodeProcess"),await k(2e3);let s=await J(()=>((0,ts.expect)(n.called).to.be.true,n.getCall(0).returnValue),10*1e3);await k(2e3);let a=await J(()=>{let c=s.items.find(p=>p.pidAndPort===`${e.pid}:${r}`);if(!c)throw new Error("expected quickpick to have item");return c},10*1e3);s.selectedItems=[a],await k(2e3),await Nr.commands.executeCommand("workbench.action.acceptSelectedQuickOpenItem"),await k(2e3),await J(()=>(0,ts.expect)(o).to.equal(!0,"expected to have attached"),10*1e3)}),it("works without a defined workspace",async()=>{Nr.debug.startDebugging(void 0,{type:"pwa-node",request:"attach",name:"attach",processId:`${e.pid}:${r}`}),await J(()=>(0,ts.expect)(o).to.equal(!0,"expected to have attached"),10*1e3)})})})});var L_={};var V,Ck,Um,No,x,xk=m(()=>{"use strict";V=require("chai"),Ck=require("fs"),Um=require("path"),No=require("sinon"),x=w(require("vscode"));F();$e();j();U();uo();ct();Ee();describe("profiling",()=>{let i=(0,Um.join)(_,"simpleNode"),e=(0,Um.join)(i,"profilePlayground.js"),t,r,o=async s=>{let a=await Ck.promises.readFile(s,"utf-8");(0,V.expect)(()=>JSON.parse(a)).to.not.throw(void 0,"expected to be valid JSON: "+a)},n=async(s,a)=>(await a.dap.stackTrace({threadId:s})).stackFrames[0].id;beforeEach(()=>{let s=x.window.createQuickPick;t=(0,No.stub)(x.window,"createQuickPick").callsFake(()=>{let a=s();return r=new S,(0,No.stub)(a,"onDidAccept").callsFake(r.event),a})}),afterEach(()=>{t.restore()}),describe("console",()=>{g("works",async({r:s})=>{R(b,{"test.js":['console.profile("some-profile");','console.profileEnd("some-profile");']});let a=await s.runScript("test.js",{__workspaceFolder:b});a.load(),await a.dap.once("terminated"),await J(()=>o((0,Um.join)(b,"some-profile.cpuprofile")))})}),describe("cpu-profiling",()=>{g("cpu sanity test",async({r:s})=>{await s.initialize;let a=await s.runScript(e);a.load();let c=a.dap.once("profileStarted");await a.dap.startProfile({type:"cpu"}),await k(300),await a.dap.stopProfile({}),await o((await c).file)}),describe("breakpoints",()=>{g("continues if was paused on start",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load(),a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:21,column:1}]})),a.log(await a.dap.once("stopped"));let c=a.dap.once("continued"),p=a.dap.once("output");await a.dap.startProfile({type:"cpu"}),a.log(await c),a.log(await p),a.assertLog()}),g("continues if was paused on start with debugger domain",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load(),a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:21,column:1}]})),a.log(await a.dap.once("stopped"));let c=a.dap.once("continued"),p=a.dap.once("output");await a.dap.startProfile({type:"cpu",stopAtBreakpoint:[-1]}),a.log(await c),a.log(await p),a.assertLog()}),g("unverifies and reverifies",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load(),a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:6,column:1}]}),void 0,[]),await k(0);let c=(0,No.stub)().callsFake(p=>a.log(p,void 0,[]));a.dap.on("breakpoint",c),await a.dap.startProfile({type:"cpu"}),await J(()=>(0,V.expect)(c.callCount).to.gte(1),2e3),await a.dap.stopProfile({}),await J(()=>(0,V.expect)(c.callCount).to.gte(2),2e3),a.assertLog()}),g("does not unverify target breakpoint",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load();let{breakpoints:c}=a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:6,column:1},{line:17,column:1}]}),void 0,[]);await k(0);let p=(0,No.stub)().callsFake(l=>a.log(l,void 0,[]));a.dap.on("breakpoint",p),await a.dap.startProfile({type:"cpu",stopAtBreakpoint:[c[1].id]}),await J(()=>(0,V.expect)(p.callCount).to.gte(1)),await a.dap.stopProfile({}),await J(()=>(0,V.expect)(p.callCount).to.gte(2)),a.assertLog()}),g("runs until a breakpoint is hit",async({r:s})=>{await s.initialize;let a=await s.runScript(e),{breakpoints:c}=await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:20,column:1},{line:17,column:1}]});await a.load();let p=a.dap.once("profileStarted"),l=await a.dap.once("stopped");await a.dap.evaluate({expression:"setTimeout(noop, 1000)",context:"repl",frameId:await n(l.threadId,a)}),await a.dap.startProfile({type:"cpu",stopAtBreakpoint:[c[1].id]});let u=a.dap.once("stopped"),f=a.dap.once("profilerStateUpdate"),y=a.dap.once("breakpoint",v=>v.breakpoint.id===c[0].id&&v.breakpoint.verified);a.log(await u,"paused event"),a.log(await f,"finished profile"),a.log(await y,"reenabled breakpoint",[]),await o((await p).file),a.assertLog()})}),describe("ui",()=>{afterEach(async()=>{await x.debug.stopDebugging()});let s=async(a,c)=>{x.commands.executeCommand("extension.js-debug.startProfile",a.id);let p=await J(()=>{(0,V.expect)(t.callCount).to.equal(1);let u=t.getCall(0).returnValue;return(0,V.expect)(u.items).to.not.be.empty,u},2e3);p.selectedItems=p.items.filter(u=>/CPU/i.test(u.label)),r.fire();let l=await J(()=>{(0,V.expect)(t.callCount).to.equal(2);let u=t.getCall(0).returnValue;return(0,V.expect)(u.items).to.not.be.empty,u},2e3);l.selectedItems=l.items.filter(u=>c.test(u.label)),r.fire()};it.skip("allows picking breakpoints",async()=>{x.debug.addBreakpoints([new x.SourceBreakpoint(new x.Location(x.Uri.file(e),new x.Position(19,0))),new x.SourceBreakpoint(new x.Location(x.Uri.file(e),new x.Position(5,0))),new x.SourceBreakpoint(new x.Location(x.Uri.file(e+".foo"),new x.Position(0,0)))]),after(()=>{x.debug.removeBreakpoints(x.debug.breakpoints)}),x.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let a=await new Promise(p=>x.debug.onDidStartDebugSession(l=>"__pendingTargetId"in l.configuration?p(l):void 0));await s(a,/breakpoint/i);let c=await J(()=>{(0,V.expect)(t.callCount).to.equal(2);let p=t.getCall(1).returnValue;return(0,V.expect)(p.items.length).to.be.greaterThan(0,"expected to have picker items"),p},5e3);(0,V.expect)(c.items).to.containSubset([{description:"for (let i = 0; i < 10; i++) {",label:"testWorkspace/simpleNode/profilePlayground.js:6:16"},{description:"setInterval(() => {",label:"testWorkspace/simpleNode/profilePlayground.js:20:1"}]),c.dispose()}),it("sets substate correctly",async()=>{let a=new O;a.push(x.commands.registerCommand("js-debug.test.callback",()=>{})),x.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let c=await new Promise(p=>x.debug.onDidStartDebugSession(l=>"__pendingTargetId"in l.configuration?p(l):void 0));await _t(x.commands,"extension.js-debug.startProfile",{sessionId:c.id,type:"cpu",termination:{type:"manual"}}),await J(()=>(0,V.expect)(c.name).to.contain("Profiling"),2e3),await _t(x.commands,"extension.js-debug.stopProfile",c.id),await J(()=>(0,V.expect)(c.name).to.not.contain("Profiling"),2e3),a.dispose()}),it("works with pure command API",async()=>{let a=(0,No.stub)(),c=new O;c.push(x.commands.registerCommand("js-debug.test.callback",a)),x.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let p=await new Promise(u=>x.debug.onDidStartDebugSession(f=>"__pendingTargetId"in f.configuration?u(f):void 0));await _t(x.commands,"extension.js-debug.startProfile",{sessionId:p.id,type:"cpu",termination:{type:"manual"},onCompleteCommand:"js-debug.test.callback"}),await k(1e3),await _t(x.commands,"extension.js-debug.stopProfile",p.id);let l=await J(()=>((0,V.expect)(a.called).to.be.true,a.getCall(0).args[0]),2e3);(0,V.expect)(()=>JSON.parse(l.contents)).to.not.throw,(0,V.expect)(l.basename).to.match(/\.cpuprofile$/),c.dispose()}),it("profiles from launch",async function(){this.timeout(20*1e3),x.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e,profileStartup:!0});let a=await new Promise(c=>x.debug.onDidStartDebugSession(p=>"__pendingTargetId"in p.configuration?c(p):void 0));await J(()=>(0,V.expect)(a.name).to.contain("Profiling"),2e3),await _t(x.commands,"extension.js-debug.stopProfile",a.id),await J(()=>(0,V.expect)(a.name).to.not.contain("Profiling"),2e3)})})}),describe("heap-profiling",()=>{g("heap sanity test",async({r:s})=>{await s.initialize;let a=await s.runScript(e);a.load();let c=a.dap.once("profileStarted");await a.dap.startProfile({type:"heap"}),await k(300),await a.dap.stopProfile({}),await o((await c).file)}),describe("breakpoints",()=>{g("continues if was paused on start",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load(),a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:21,column:1}]})),a.log(await a.dap.once("stopped"));let c=a.dap.once("continued"),p=a.dap.once("output");await a.dap.startProfile({type:"heap"}),a.log(await c),a.log(await p),a.assertLog()}),g("continues if was paused on start with debugger domain",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load(),a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:21,column:1}]})),a.log(await a.dap.once("stopped"));let c=a.dap.once("continued"),p=a.dap.once("output");await a.dap.startProfile({type:"heap",stopAtBreakpoint:[-1]}),a.log(await c),a.log(await p),a.assertLog()}),g("unverifies and reverifies",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load(),a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:6,column:1}]}),void 0,[]),await k(0);let c=(0,No.stub)().callsFake(p=>a.log(p,void 0,[]));a.dap.on("breakpoint",c),await a.dap.startProfile({type:"heap"}),await J(()=>(0,V.expect)(c.callCount).to.gte(1),2e3),await a.dap.stopProfile({}),await J(()=>(0,V.expect)(c.callCount).to.gte(2),2e3),a.assertLog()}),g("does not unverify target breakpoint",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load();let{breakpoints:c}=a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:6,column:1},{line:17,column:1}]}),void 0,[]);await k(0);let p=(0,No.stub)().callsFake(l=>a.log(l,void 0,[]));a.dap.on("breakpoint",p),await a.dap.startProfile({type:"heap",stopAtBreakpoint:[c[1].id]}),await J(()=>(0,V.expect)(p.callCount).to.gte(1)),await a.dap.stopProfile({}),await J(()=>(0,V.expect)(p.callCount).to.gte(2)),a.assertLog()}),g("runs until a breakpoint is hit",async({r:s})=>{await s.initialize;let a=await s.runScript(e),{breakpoints:c}=await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:20,column:1},{line:17,column:1}]});await a.load();let p=a.dap.once("profileStarted"),l=await a.dap.once("stopped");await a.dap.evaluate({expression:"setTimeout(noop, 1000)",context:"repl",frameId:await n(l.threadId,a)}),await a.dap.startProfile({type:"heap",stopAtBreakpoint:[c[1].id]});let u=a.dap.once("stopped"),f=a.dap.once("profilerStateUpdate"),y=a.dap.once("breakpoint",v=>v.breakpoint.id===c[0].id&&v.breakpoint.verified);a.log(await u,"paused event"),a.log(await f,"finished profile"),a.log(await y,"reenabled breakpoint",[]),await o((await p).file),a.assertLog()})}),describe("ui",()=>{afterEach(async()=>{await x.debug.stopDebugging()});let s=async(a,c)=>{x.commands.executeCommand("extension.js-debug.startProfile",a.id);let p=await J(()=>{(0,V.expect)(t.callCount).to.equal(1);let u=t.getCall(0).returnValue;return(0,V.expect)(u.items).to.not.be.empty,u},2e3);p.selectedItems=p.items.filter(u=>/heap/i.test(u.label)),r.fire();let l=await J(()=>{(0,V.expect)(t.callCount).to.equal(2);let u=t.getCall(0).returnValue;return(0,V.expect)(u.items).to.not.be.empty,u},2e3);l.selectedItems=l.items.filter(u=>c.test(u.label)),r.fire()};it.skip("allows picking breakpoints",async()=>{x.debug.addBreakpoints([new x.SourceBreakpoint(new x.Location(x.Uri.file(e),new x.Position(19,0))),new x.SourceBreakpoint(new x.Location(x.Uri.file(e),new x.Position(5,0))),new x.SourceBreakpoint(new x.Location(x.Uri.file(e+".foo"),new x.Position(0,0)))]),after(()=>{x.debug.removeBreakpoints(x.debug.breakpoints)}),x.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let a=await new Promise(p=>x.debug.onDidStartDebugSession(l=>"__pendingTargetId"in l.configuration?p(l):void 0));await s(a,/breakpoint/i);let c=await J(()=>{(0,V.expect)(t.callCount).to.equal(2);let p=t.getCall(1).returnValue;return(0,V.expect)(p.items.length).to.be.greaterThan(0,"expected to have picker items"),p},5e3);(0,V.expect)(c.items).to.containSubset([{description:"for (let i = 0; i < 10; i++) {",label:"testWorkspace/simpleNode/profilePlayground.js:6:16"},{description:"setInterval(() => {",label:"testWorkspace/simpleNode/profilePlayground.js:20:1"}]),c.dispose()}),it("sets substate correctly",async()=>{let a=new O;a.push(x.commands.registerCommand("js-debug.test.callback",()=>{})),x.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let c=await new Promise(p=>x.debug.onDidStartDebugSession(l=>"__pendingTargetId"in l.configuration?p(l):void 0));await _t(x.commands,"extension.js-debug.startProfile",{sessionId:c.id,type:"cpu",termination:{type:"manual"}}),await J(()=>(0,V.expect)(c.name).to.contain("Profiling"),2e3),await _t(x.commands,"extension.js-debug.stopProfile",c.id),await J(()=>(0,V.expect)(c.name).to.not.contain("Profiling"),2e3),a.dispose()}),it("works with pure command API",async()=>{let a=(0,No.stub)(),c=new O;c.push(x.commands.registerCommand("js-debug.test.callback",a)),x.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let p=await new Promise(u=>x.debug.onDidStartDebugSession(f=>"__pendingTargetId"in f.configuration?u(f):void 0));await _t(x.commands,"extension.js-debug.startProfile",{sessionId:p.id,type:"heap",termination:{type:"manual"},onCompleteCommand:"js-debug.test.callback"}),await k(1e3),await _t(x.commands,"extension.js-debug.stopProfile",p.id);let l=await J(()=>((0,V.expect)(a.called).to.be.true,a.getCall(0).args[0]),2e3);(0,V.expect)(()=>JSON.parse(l.contents)).to.not.throw,(0,V.expect)(l.basename).to.match(/\.heapprofile$/),c.dispose()}),it("profiles from launch",async function(){this.timeout(20*1e3),x.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e,profileStartup:!0});let a=await new Promise(c=>x.debug.onDidStartDebugSession(p=>"__pendingTargetId"in p.configuration?c(p):void 0));await J(()=>(0,V.expect)(a.name).to.contain("Profiling"),2e3),await _t(x.commands,"extension.js-debug.stopProfile",a.id),await J(()=>(0,V.expect)(a.name).to.not.contain("Profiling"),2e3)})})})})});var A_={};var rs,kk=m(()=>{"use strict";rs=require("chai");U();bh();describe("node lease file",()=>{let i;beforeEach(()=>i=new jt),afterEach(()=>i.dispose()),it("says the lease is not valid for missing files",async()=>{(0,rs.expect)(jt.isValid("does-not-exist.txt")).to.be.false}),it("says the lease is not valid if too far in the past",async()=>{await i.touch(()=>Date.now()-5e3),(0,rs.expect)(jt.isValid(i.path)).to.be.false}),it("says the lease is valid if recent",async()=>{await i.touch(()=>Date.now()),(0,rs.expect)(jt.isValid(i.path)).to.be.true}),it("truncates and updates on touches",async()=>{await i.touch(()=>Date.now()-5e3),await i.touch(()=>Date.now()),(0,rs.expect)(jt.isValid(i.path)).to.be.true}),it("disposes the file",async()=>{await i.touch(()=>Date.now()),await i.dispose(),(0,rs.expect)(jt.isValid(i.path)).to.be.false}),it("disposes the touch loop",async()=>{await i.startTouchLoop(),await i.dispose(),await k(1200),(0,rs.expect)(jt.isValid(i.path)).to.be.false})})});var E_={};var Ur,mo,Tk,Q,Rk,Dk,_k=m(()=>{"use strict";Ur=require("chai"),mo=require("child_process"),Tk=require("fs"),Q=require("path"),Rk=require("sinon"),Dk=w(require("split2"));to();ui();M();Z();U();H();kh();uo();ct();Ee();describe("node runtime",()=>{async function i(r){let{threadId:o}=r.log(await r.dap.once("stopped"));return await r.logger.logStackTrace(o),r.dap.continue({threadId:o})}async function e(r,o){r.load();let{threadId:n}=r.log(await r.dap.once("stopped")),s=await r.dap.stackTrace({threadId:n});await r.logger.evaluateAndLog(o,{params:{frameId:s.stackFrames[0].id}}),r.assertLog()}function t(r){let o=r.trim().split(`
`);(0,Ur.expect)(o.length).to.be.greaterThan(0),(0,Ur.expect)(o[0]).to.not.contain("<hidden: Skipped by skipFiles>");for(let n=1;n<o.length;n++)(0,Ur.expect)(o[n]).to.contain("<hidden: Skipped by skipFiles>")}describe("skipFiles",()=>{console.log("described skipFiles"),g("skipFiles skip node internals",async({r})=>{await r.initialize;let o=(0,Q.join)(_,"simpleNode"),n=await r.runScript((0,Q.join)(o,"index.js"),{skipFiles:["<node_internals>/**"]});await n.dap.setBreakpoints({source:{path:(0,Q.join)(o,"index.js")},breakpoints:[{line:1,column:1}]}),n.load();let s=await n.dap.once("stopped");await k(200),await n.logger.logStackTrace(s.threadId,!1),n.assertLog({customAssert:t})});for(let[r,o]of[["with delay",!0],["without delay",!1]])describe(r,()=>{for(let n of["caughtInUserCode","uncaught","caught","rethrown"])g(n,async({r:s})=>{await s.initialize;let a=(0,Q.join)(_,"simpleNode"),c=await s.runScript((0,Q.join)(a,"skipFiles.js"),{args:[o?"1000":"0",n],skipFiles:["**/skippedScript.js"]});await c.dap.setExceptionBreakpoints({filters:["all","uncaught"]}),c.dap.on("output",p=>c.logger.logOutput(p)),c.dap.on("stopped",async p=>{await c.logger.logStackTrace(p.threadId,!1),await c.dap.continue({threadId:p.threadId})}),c.load(),await c.dap.once("terminated"),c.assertLog({substring:!0})})})}),g("simple script",async({r})=>{R(b,{"test.js":['console.log("hello world");',"debugger;"]});let o=await r.runScript("test.js");o.load(),await i(o),o.assertLog({substring:!0})}),g("chakracore string value",async({r})=>{if(process.platform!=="win32")return;R(b,{"test.js":['const message = "hello world!";',"console.log(message);","debugger;"]});let o=(0,Q.join)(_,"chakracore","ChakraCore.Debugger.Sample.exe"),n=await je(),s=await r.runScript("test.js",{runtimeExecutable:o,runtimeArgs:["--inspect-brk","--port",`${n}`],attachSimplePort:n,continueOnAttach:!0});s.load();let{threadId:a}=s.log(await s.dap.once("stopped"));s.dap.continue({threadId:a}),await s.dap.once("stopped");let c=await s.dap.stackTrace({threadId:a});await s.logger.evaluateAndLog("message",{params:{frameId:c.stackFrames[0].id}}),s.assertLog({substring:!0})}),g("exits with child process launcher",async({r})=>{R(b,{"test.js":""});let o=await r.runScript("test.js",{console:"internalConsole"});o.load(),await o.dap.once("terminated")}),process.env.ONLY_MINSPEC!=="true"&&g("debugs worker threads",async({r})=>{R(b,{"test.js":['const { Worker, isMainThread, workerData } = require("worker_threads");',"if (isMainThread) {",'  new Worker(__filename, { workerData: { greet: "world" } });',"} else {","  setInterval(() => {",'    console.log("hello " + workerData.greet);',"   }, 100);","}"]});let o=await r.runScript("test.js");o.load();let n=await r.worker();await n.dap.setBreakpoints({source:{path:(0,Q.join)(b,"test.js")},breakpoints:[{line:6,column:1}]}),n.load(),await i(n),o.assertLog({substring:!0})}),g("exits with integrated terminal launcher",async({r})=>{let o=(0,Rk.stub)(Ui.prototype,"sendLaunchRequest");after(()=>o.restore());let n;o.callsFake(a=>(n=a,(0,mo.spawn)(a.args[0],a.args.slice(1),{cwd:a.cwd,env:{...process.env,...a.env}}),Promise.resolve({}))),R(b,{"test.js":""});let s=await r.runScript("test.js",{console:"integratedTerminal",cwd:b,env:{myEnv:"foo"}});s.load(),await s.dap.once("terminated"),(0,Ur.expect)(n).to.containSubset({title:"Test Case",kind:"integrated",cwd:b,env:{myEnv:"foo"}})}),g("adjusts to compiles file if it exists",async({r})=>{await r.initialize;let o=await r.runScript((0,Q.join)(_,"web/basic.ts"));await o.dap.setBreakpoints({source:{path:o.workspacePath("web/basic.ts")},breakpoints:[{line:21,column:0}]}),o.load(),await i(o),o.assertLog({substring:!0})}),describe("inspect flag handling",()=>{g("does not break with inspect flag",async({r})=>{R(b,{"test.js":['console.log("hello world");',"debugger;"]});let o=await r.runScript("test.js",{runtimeArgs:["--inspect"]});o.load(),await i(o),o.assertLog({substring:!0})}),g("treats inspect-brk as stopOnEntry",async({r})=>{R(b,{"test.js":['console.log("hello world");']});let o=await r.runScript("test.js",{cwd:b,runtimeArgs:["--inspect-brk"]});o.load(),await i(o),o.assertLog({substring:!0})})}),describe("stopOnEntry",()=>{beforeEach(()=>R(b,{"test.js":["let i = 0;","i++;","i++;"],"bar.js":'require("./test")'})),g("stops with a breakpoint elsewhere (#515)",async({r})=>{let o=await r.runScript("test.js",{cwd:b,stopOnEntry:!0});await o.dap.setBreakpoints({source:{path:(0,Q.join)(b,"test.js")},breakpoints:[{line:3,column:1}]}),o.load(),await i(o),r.assertLog({substring:!0})}),g("stops with a program provided",async({r})=>{let o=await r.runScript("test.js",{cwd:b,stopOnEntry:!0});o.load(),await i(o),r.assertLog({substring:!0})}),g("launches and infers entry from args",async({r})=>{let o=await r.runScript("test.js",{cwd:b,args:["--max-old-space-size=1024","test.js","--not-a-file"],program:void 0,stopOnEntry:!0});o.load(),await i(o),r.assertLog({substring:!0})}),g("sets an explicit stop on entry point",async({r})=>{let o=await r.runScript("bar.js",{cwd:b,stopOnEntry:(0,Q.join)(b,"test.js")});o.load(),await i(o),r.assertLog({substring:!0})})}),describe("attaching",()=>{let r;afterEach(()=>{r&&r.kill()}),g("attaches to existing processes",async({r:o})=>{R(b,{"test.js":["setInterval(() => { debugger; }, 500)"]});let n=await je();r=(0,mo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(b,"test")]),await k(500);let s=await o.attachNode(r.pid,{port:n});await i(s),s.assertLog({substring:!0})}),g.skip("continueOnAttach",async({r:o})=>{R(b,{"test.js":['console.log("");',"debugger;"]});let n=await je();r=(0,mo.spawn)("node",[`--inspect-brk=${n}`,(0,Q.join)(b,"test")]);let s=await o.attachNode(r.pid,{continueOnAttach:!0,port:n});await i(s),s.assertLog({substring:!0})}),g("retries attachment",async({r:o})=>{R(b,{"test.js":["setInterval(() => { debugger; }, 500)"]});let n=await je(),s=o.attachNode(0,{port:n});await k(500),r=(0,mo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(b,"test")]);let a=await s;await i(a),a.assertLog({substring:!0})}),g("attaches children of child processes",async({r:o})=>{R(b,{"test.js":`
          const { spawn } = require('child_process');
          setInterval(() => spawn('node', ['child'], { cwd: __dirname }), 500);
        `,"child.js":"(function foo() { debugger; })();"});let n=await je();r=(0,mo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(b,"test")]),await k(500),(await o.attachNode(r.pid,{port:n})).load();let a=await o.worker();a.load(),await i(a),a.assertLog({substring:!0})}),g("attaches to cluster processes",async({r:o})=>{R(b,{"test.js":`
          const cluster = require('cluster');
          if (cluster.isMaster) {
            cluster.fork();
          } else {
            setInterval(() => { debugger; }, 500);
          }
        `});let n=await je();r=(0,mo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(b,"test")]),await k(500),(await o.attachNode(r.pid,{port:n})).load();let a=await o.worker();a.load(),await i(a),a.assertLog({substring:!0})}),g("restarts if requested",async({r:o})=>{R(b,{"test.js":["setInterval(() => { debugger; }, 100)"]});let n=await je();r=(0,mo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(b,"test")]);let s=await o.attachNode(0,{port:n,restart:!0});s.log(await s.dap.once("stopped")),await s.dap.evaluate({expression:"process.exit(0)"}),r=(0,mo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(b,"test")]);let a=await o.waitForTopLevel();a.load(),await i(a),s.assertLog({substring:!0})}),g("does not restart if killed",async({r:o})=>{var c;R(b,{"test.js":["setInterval(() => { debugger; }, 100)"]});let n=await je();r=(0,mo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(b,"test")],{stdio:"pipe"});let s=[];(c=r.stderr)==null||c.pipe((0,Dk.default)()).on("data",p=>s.push(p));let a=await o.attachNode(0,{port:n,restart:!0});await a.dap.once("stopped"),await a.dap.disconnect({}),await o.rootDap().disconnect({}),await k(1e3),(0,Ur.expect)(s.filter(p=>p.includes("Debugger attached"))).to.have.lengthOf(1)})}),describe("child processes",()=>{beforeEach(()=>R(b,{"test.js":`
        const cp = require('child_process');
        const path = require('path');
        cp.fork(path.join(__dirname, 'child.js'));
      `,"child.js":`
        const foo = 'It works!';
        debugger;
      `})),g("debugs",async({r})=>{(await r.runScript("test.js")).load();let n=await r.worker();n.load();let{threadId:s}=n.log(await n.dap.once("stopped")),a=await n.dap.stackTrace({threadId:s});await n.logger.evaluateAndLog("foo",{params:{frameId:a.stackFrames[0].id}}),n.assertLog()}),g("does not debug if auto attach off",async({r})=>{(await r.runScript("test.js",{autoAttachChildProcesses:!1})).load();let n=await Promise.race([r.worker(),new Promise(s=>setTimeout(()=>s("ok"),1e3))]);(0,Ur.expect)(n).to.equal("ok")})}),g("sets arguments",async({r})=>{R(b,{"test.js":"debugger"});let o=await r.runScript("test.js",{args:["--some","very fancy","--arguments"]});await e(o,"process.argv.slice(2)")}),g("sets the cwd",async({r})=>{R(b,{"test.js":"debugger"});let o=await r.runScript("test.js",{cwd:_});await e(o,"process.cwd()")}),g("sets sourceMapOverrides from the cwd",async({r})=>{let o=await r.runScript((0,Q.join)(_,"simpleNode","simpleWebpack.js"),{cwd:(0,Q.join)(_,"simpleNode")});o.load(),await i(o),o.assertLog({substring:!0})}),g("sets environment variables",async({r})=>{R(b,{"test.js":"debugger"});let o=await r.runScript("test.js",{env:{HELLO:"world"}});await e(o,"process.env.HELLO")}),g("sets environment variables",async({r})=>{R(b,{"test.js":"debugger"});let o=await r.runScript("test.js",{env:{HELLO:"world"}});await e(o,"process.env.HELLO")}),g("reads the envfile",async({r})=>{R(b,{"test.js":"debugger;",vars:["A=foo","B=bar"]}),oe.processEnv.forget();let o=process.env.C;process.env.C="inherited";let n=await r.runScript("test.js",{envFile:(0,Q.join)(b,"vars"),env:{B:"overwritten"}});await e(n,"JSON.stringify({ a: process.env.A, b: process.env.B, c: process.env.C })"),process.env.C=o,oe.processEnv.forget()}),g("writes errors if runtime executable not found",async({r})=>{await r.initialize;let o=await r.rootDap().launch({...Xc,cwd:(0,Q.dirname)(b),program:(0,Q.join)(b,"test.js"),rootPath:_,runtimeExecutable:"does-not-exist",__workspaceFolder:b});(0,Ur.expect)(o).to.include(`Can't find Node.js binary "does-not-exist"`)}),g("scripts with http urls",async({r})=>{await r.initialize;let o=(0,Q.join)(_,"web","urlSourcemap"),n=await r.runScript((0,Q.join)(o,"index.js"),{cwd:_,skipFiles:["<node_internals>/**"],sourceMapPathOverrides:{"http://localhost:8001/*":`${_}/web/*`}});n.load(),await i(n),n.assertLog({substring:!0})}),g("gets performance information",async({r})=>{R(b,{"test.js":"setInterval(() => {}, 1000)"});let o=await r.runScript("test.js");await o.load();let n=await o.dap.getPerformance({});(0,Ur.expect)(n.error).to.be.undefined,(0,Ur.expect)(n.metrics).to.not.be.empty}),describe("simplePortAttach",()=>{let r=N(async()=>{let o=await ds(Tk.promises,"npm",process.env);if(!o)throw new Error("npm not on path");return o});g("allows inspect-brk in npm scripts",async({r:o})=>{await o.initialize;let n=(0,Q.join)(_,"simpleNode"),s=await o.runScript("",{program:void 0,cwd:n,runtimeExecutable:await r(),runtimeArgs:["run","startWithBrk"],port:29204}),a=s.dap.once("output",p=>p.output.includes("NODE_OPTIONS"));s.load();let{threadId:c}=s.log(await s.dap.once("stopped"));s.dap.continue({threadId:c}),s.logger.logOutput(await a),s.assertLog({substring:!0})}),g("uses bootloader for normal npm scripts",async({r:o})=>{await o.initialize;let n=(0,Q.join)(_,"simpleNode");o.onSessionCreated(p=>p.load());let s=await o.runScript("",{program:void 0,cwd:n,runtimeExecutable:await r(),runtimeArgs:["run","startWithoutBrk"],port:29204});s.load();let c=(await o.worker()).dap.once("output",p=>p.output.includes("NODE_OPTIONS"));s.logger.logOutput(await c),s.assertLog({customAssert:p=>(0,Ur.expect)(p).to.contain("NODE_OPTIONS= --require")})}),g("allows simple port attachment",async({r:o})=>{await o.initialize;let n=(0,Q.join)(_,"simpleNode"),s=await je(),a=await o.runScript((0,Q.join)(n,"logNodeOptions"),{runtimeArgs:[`--inspect-brk=${s}`],attachSimplePort:s});a.load();let c=a.dap.once("output",l=>l.output.includes("NODE_OPTIONS")),{threadId:p}=a.log(await a.dap.once("stopped"));a.dap.continue({threadId:p}),a.logger.logOutput(await c),a.assertLog({substring:!0})}),g("terminates when inspector closed",async({r:o})=>{await o.initialize;let n=(0,Q.join)(_,"simpleNode"),s=await je(),a=await o.runScript((0,Q.join)(n,"debuggerStmt"),{runtimeArgs:[`--inspect-brk=${s}`],attachSimplePort:s});a.load();let{threadId:c}=a.log(await a.dap.once("stopped")),p=await a.dap.stackTrace({threadId:c});a.dap.evaluate({expression:'require("inspector").close()',frameId:p.stackFrames[0].id}),a.log(await a.dap.once("terminated")),a.assertLog({substring:!0})}),g("terminates when process killed",async({r:o})=>{await o.initialize;let n=(0,Q.join)(_,"simpleNode"),s=await je(),a=await o.runScript((0,Q.join)(n,"debuggerStmt"),{runtimeArgs:[`--inspect-brk=${s}`],attachSimplePort:s});a.load(),a.log(await a.dap.once("stopped")),a.dap.evaluate({expression:"process.exit(1)"}),a.log(await a.dap.once("terminated")),a.assertLog({substring:!0})})})})});var F_={};var ir,Lk,Ki,go,Ak=m(()=>{"use strict";ir=require("chai"),Lk=require("fs"),Ki=require("path");ae();_r();Z();B();ch();go=new se(Lk.promises);describe("node source path resolver",()=>{describe("url to path",()=>{let i={workspaceFolder:"file:///",resolveSourceMapLocations:null,basePath:"D:\\a\\_work\\1\\s\\VsCodeDebugAdapter\\vscode-js-debug\\src\\test\\node",remoteRoot:null,localRoot:null,sourceMapOverrides:{"webpack:///*":"D:\\a\\_work\\1\\s\\VsCodeDebugAdapter\\vscode-js-debug\\src\\test\\node/*"}};it("resolves absolute",async()=>{let e=new Le(go,void 0,i,await A.test());(0,ir.expect)(await e.urlToAbsolutePath({url:"file:///src/index.js"})).to.equal((0,Ki.resolve)("/src/index.js"))}),it("escapes regex parts segments",async()=>{if(process.platform==="win32"){let e=new Le(go,void 0,{...i,workspaceFolder:"C:\\some\\workspa*ce\\folder",basePath:"C:\\some\\workspa*ce\\folder",resolveSourceMapLocations:["C:\\some\\workspa*ce\\folder/**","C:\\some\\workspa*ce\\folder/../**","C:\\some\\workspa*ce\\folder/../foo/**"]},await A.test());(0,ir.expect)(e.resolvePatterns).to.deep.equal(["C:/some/workspa\\*ce/folder/**","C:/some/workspa\\*ce/**","C:/some/workspa\\*ce/foo/**"])}}),it("fixes regex escape issue #1554",async()=>{if(process.platform==="win32"){let e=new Le(go,void 0,{...i,workspaceFolder:"C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode",basePath:"C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode",resolveSourceMapLocations:["C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/**","C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/../../../packages/shared/dist/**","C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/../../../packages/swimmagic/dist/**","C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/../../../packages/editor/dist/**","C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/../../server/dist/**","!**/node_modules/**"]},await A.test());(0,ir.expect)(e.shouldResolveSourceMap({compiledPath:"c:\\Users\\Segev\\prj\\swimm\\ide\\server\\dist\\app.js",sourceMapUrl:"file:///c:/Users/Segev/prj/swimm/ide/server/dist/app.js.map"})).to.be.true}}),it("resolves unc paths",async()=>{if(process.platform!=="win32")return;let e=new Le(go,void 0,i,await A.test());(0,ir.expect)(await e.urlToAbsolutePath({url:"file:////mac/Home/Github/js-debug-demos/node/main.js"})).to.equal((0,Ki.resolve)("\\\\mac\\Home\\Github\\js-debug-demos\\node\\main.js"))}),it("normalizes roots (win -> posix) ",async()=>{let e=new Le(go,void 0,{...i,remoteRoot:"C:\\Source",localRoot:"/dev/src"},await A.test());(0,ir.expect)(await e.urlToAbsolutePath({url:"file:///c:/source/foo/bar.js"})).to.equal("/dev/src/foo/bar.js")}),it("normalizes roots (posix -> win) ",async()=>{let e=new Le(go,void 0,{...i,remoteRoot:"/dev/src",localRoot:"C:\\Source"},await A.test());(0,ir.expect)(await e.urlToAbsolutePath({url:"file:///dev/src/foo/bar.js"})).to.equal("c:\\Source\\foo\\bar.js")}),it("places relative paths in node_internals",async()=>{let e=new Le(go,void 0,i,await A.test());(0,ir.expect)(await e.urlToAbsolutePath({url:"internal.js"})).to.equal("<node_internals>/internal.js")}),it("applies source map overrides",async()=>{let e=new Le(go,void 0,i,await A.test());(0,ir.expect)(await e.urlToAbsolutePath({url:"webpack:///hello.js",map:{sourceRoot:"",metadata:{compiledPath:"hello.js"}}})).to.equal(be((0,Ki.join)("D:\\a\\_work\\1\\s\\VsCodeDebugAdapter\\vscode-js-debug\\src\\test\\node","hello.js")))}),it("loads local node internals (#823)",async()=>{let e=new Le(go,void 0,i,A.null);(0,ir.expect)(await e.urlToAbsolutePath({url:"node:url"})).to.equal((0,Ki.join)("D:\\a\\_work\\1\\s\\VsCodeDebugAdapter\\vscode-js-debug\\src\\test\\node","lib/url.js")),(0,ir.expect)(await e.urlToAbsolutePath({url:"node:internal/url.js"})).to.equal((0,Ki.join)("D:\\a\\_work\\1\\s\\VsCodeDebugAdapter\\vscode-js-debug\\src\\test\\node","lib/internal/url.js"))}),describe("source map filtering",()=>{let e={"matches paths":{locs:["/foo/bar/**","!**/node_modules/**"],map:"file:///foo/bar/baz/my.map.js",ok:!0},"is case sensitive on unix":{locs:["/foo/BAR/**","!**/node_modules/**"],map:"file:////bar/my.map.js",ok:!1,caseSensitive:!0},"does not match paths outside of locations":{locs:["/foo/bar/**","!**/node_modules/**"],map:"file:////bar/my.map.js",ok:!1},"applies negations":{locs:["/foo/bar/**","!**/node_modules/**"],map:"file:///foo/bar/node_modules/my.map.js",ok:!1},"matches win32 paths, case insensitive":{locs:["c:\\foo\\BAR\\**","!**\\node_modules\\**"],map:"file:///c:/foo/bar/BAZ/my.map.js",ok:!0,caseSensitive:!1},"applies win32 negations":{locs:["c:\\foo\\bar\\**","!**\\node_modules\\**"],map:"file:///c:/foo/bar/node_modules/my.map.js",ok:!1},"works for http urls, case insensitive":{locs:["https://EXAMPLE.com/**"],map:"https://example.COM/my.map.js",ok:!0}};afterEach(()=>zl());for(let t of Object.keys(e)){let r=e[t],{locs:o,map:n,ok:s}=r,a="caseSensitive"in r&&r.caseSensitive;it(t,async()=>{Gl(a);let p=await new Le(go,void 0,{...i,resolveSourceMapLocations:o},await A.test()).urlToAbsolutePath({url:"webpack:///hello.js",map:{metadata:{sourceMapUrl:n,compiledPath:n},sourceRoot:""}});s?(0,ir.expect)(p&&be(p)).to.equal(be((0,Ki.join)("D:\\a\\_work\\1\\s\\VsCodeDebugAdapter\\vscode-js-debug\\src\\test\\node","hello.js"))):(0,ir.expect)(p).to.be.undefined})}})})})});var B_={};var os,Ek,Fk,wb,yb,M_,bb,Mk=m(()=>{"use strict";os=require("chai"),Ek=require("sinon");yh();Fk=require("events");Yd();wb=require("stream-buffers");Qd();vh();ae();yb=require("fs"),M_=i=>{let e=new Fk.EventEmitter;return e.stderr=new wb.ReadableStreamBuffer,e.stderr.stop(),e.stdout=new wb.ReadableStreamBuffer({frequency:2,chunkSize:32}),e.stdout.put(i),e.stdout.stop(),e.stdout.once("end",()=>setTimeout(()=>e.emit("close",0),1)),e},bb=async(i,e,t)=>{let r=(0,Ek.stub)(i,"createProcess").returns(M_(e));try{let o=await i.lookup((n,s)=>[...s,n],[]);(0,os.expect)(o).to.deep.equal(t)}finally{r.restore()}};describe("process tree",()=>{it("gives some output for the current platform",async()=>{let i=await Un.lookup((e,t)=>[...t,e],[]);(0,os.expect)(i.length).to.be.greaterThan(0),(0,os.expect)(i[0].pid).to.be.a("number"),(0,os.expect)(i[0].ppid).to.be.a("number"),(0,os.expect)(i[0].command).to.match(/./)}),process.platform!=="win32"&&it("gets the working directory",async()=>{let i=await Un.getWorkingDirectory(process.pid);(0,os.expect)(i).to.equal(process.cwd())}),it("works for darwin",async()=>{await bb(new Ni(new se(yb.promises)),`  PID  PPID BINARY           COMMAND
  380     1 /usr/sbin/cfpref /usr/sbin/cfprefsd agent
  381     1 /usr/libexec/Use /usr/libexec/UserEventAgent (Aqua)
  383     1 /usr/sbin/distno /usr/sbin/distnoted agent
  384     1 /usr/libexec/USB /usr/libexec/USBAgent
  387     1 /System/Library/ /System/Library/Frameworks/CoreTelephony.framework/Support/CommCenter -L
  389     1 /usr/libexec/lsd /usr/libexec/lsd
  390     1 /usr/libexec/tru /usr/libexec/trustd --agent
  391     1 /usr/libexec/sec /usr/libexec/secd
  392     2 /System/Library/ /System/Library/PrivateFrameworks/CloudKitDaemon.framework/Support/cloudd`,[{pid:380,ppid:1,command:"usr/sbin/cfpref",args:"/usr/sbin/cfprefsd agent"},{pid:381,ppid:1,command:"usr/libexec/Use",args:"/usr/libexec/UserEventAgent (Aqua)"},{pid:383,ppid:1,command:"usr/sbin/distno",args:"/usr/sbin/distnoted agent"},{pid:384,ppid:1,command:"usr/libexec/USB",args:"/usr/libexec/USBAgent"},{pid:387,ppid:1,command:"System/Library/",args:"/System/Library/Frameworks/CoreTelephony.framework/Support/CommCenter -L"},{pid:389,ppid:1,command:"usr/libexec/lsd",args:"/usr/libexec/lsd"},{pid:390,ppid:1,command:"usr/libexec/tru",args:"/usr/libexec/trustd --agent"},{pid:391,ppid:1,command:"usr/libexec/sec",args:"/usr/libexec/secd"},{pid:392,ppid:2,command:"System/Library/",args:"/System/Library/PrivateFrameworks/CloudKitDaemon.framework/Support/cloudd"}])}),it("works for posix",async()=>{await bb(new La(new se(yb.promises)),`   PID   PPID BINARY          COMMAND
   351      1 systemd         /lib/systemd/systemd --user
   352    351 (sd-pam)        (sd-pam)
   540      1 sh              sh /home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/server.sh --host=127.0.0.1 --enable-remote-auto-shutdown --port=0
   548    540 node            /home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/node /home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/out/vs/server/main.js --host=127.0.0.1 --enable-remote-auto-shutdown --port=0
  6557   6434 sshd            sshd: connor@notty
  6558   6557 bash            bash
  7281   7199 sshd            sshd: connor@pts/0
  7282   7281 bash            -bash
  9880  99219 bash            /bin/bash`,[{pid:351,ppid:1,command:"/lib/systemd/systemd",args:"--user"},{pid:352,ppid:351,command:"(sd-pam)",args:""},{pid:540,ppid:1,command:"sh",args:"/home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/server.sh --host=127.0.0.1 --enable-remote-auto-shutdown --port=0"},{pid:548,ppid:540,command:"/home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/node",args:"/home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/out/vs/server/main.js --host=127.0.0.1 --enable-remote-auto-shutdown --port=0"},{pid:6557,ppid:6434,command:"sshd:",args:"connor@notty"},{pid:6558,ppid:6557,command:"bash",args:""},{pid:7281,ppid:7199,command:"sshd:",args:"connor@pts/0"},{pid:7282,ppid:7281,command:"-bash",args:""},{pid:9880,ppid:99219,command:"/bin/bash",args:""}])}),it("works for windows",async()=>{await bb(new Aa,`"C:\\Windows\\SystemApps\\Microsoft.Windows.Cortana_cw5n1h2txyewy\\SearchUI.exe" -ServerName:CortanaUI.AppXa50dqqa5gqv4a428c9y1jjw7m3btvepj.mca                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        20191205115356.768712-480  876              5620       \r
C:\\Windows\\System32\\RuntimeBroker.exe -Embedding                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   20191205115357.036237-480  876              2420       \r
C:\\Windows\\system32\\ApplicationFrameHost.exe -Embedding                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            20191205115357.561985-480  876              6400       \r
"C:\\Windows\\SystemApps\\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\\MicrosoftEdge.exe" -ServerName:MicrosoftEdge.AppXdnhjhccw3zf0j06tkg3jtqr00qdm0khc.mca                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 20191205115357.575393-480  876              6436       \r
"C:\\Program Files\\WindowsApps\\Microsoft.SkypeApp_14.54.91.0_x64__kzf8qxf38zg5c\\SkypeApp.exe" -ServerName:App.AppXffn3yxqvgawq9fpmnhy90fr3y01d1t5b.mca                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              20191205115357.658285-480  876              6524       \r
"C:\\Program Files\\WindowsApps\\Microsoft.YourPhone_1.19111.85.0_x64__8wekyb3d8bbwe\\YourPhone.exe" -ServerName:App.AppX9yct9q388jvt4h7y0gn06smzkxcsnt8m.mca                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          20191205115357.756888-480  876              6596       \r
C:\\Windows\\system32\\browser_broker.exe -Embedding                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  20191205115358.037182-480  876              6808       \r
C:\\Windows\\System32\\RuntimeBroker.exe -Embedding                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   20191205115358.290892-480  876              6972       \r
"C:\\Windows\\System32\\MicrosoftEdgeCP.exe" -ServerName:Windows.Internal.WebRuntime.ContentProcessServer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             20191205115358.344618-480  876              7036       \r
C:\\Windows\\system32\\MicrosoftEdgeSH.exe SCODEF:6436 CREDAT:9730 APH:1000000000000006 JITHOST /prefetch:2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           20191205115358.405124-480  6972             7088       \r
`,[{pid:5620,ppid:876,command:"C:\\Windows\\SystemApps\\Microsoft.Windows.Cortana_cw5n1h2txyewy\\SearchUI.exe",args:"-ServerName:CortanaUI.AppXa50dqqa5gqv4a428c9y1jjw7m3btvepj.mca",date:20191205115356},{pid:2420,ppid:876,command:"C:\\Windows\\System32\\RuntimeBroker.exe",args:"-Embedding",date:20191205115357},{pid:6400,ppid:876,command:"C:\\Windows\\system32\\ApplicationFrameHost.exe",args:"-Embedding",date:20191205115357},{pid:6436,ppid:876,command:"C:\\Windows\\SystemApps\\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\\MicrosoftEdge.exe",args:"-ServerName:MicrosoftEdge.AppXdnhjhccw3zf0j06tkg3jtqr00qdm0khc.mca",date:20191205115357},{pid:6524,ppid:876,command:"C:\\Program Files\\WindowsApps\\Microsoft.SkypeApp_14.54.91.0_x64__kzf8qxf38zg5c\\SkypeApp.exe",args:"-ServerName:App.AppXffn3yxqvgawq9fpmnhy90fr3y01d1t5b.mca",date:20191205115357},{pid:6596,ppid:876,command:"C:\\Program Files\\WindowsApps\\Microsoft.YourPhone_1.19111.85.0_x64__8wekyb3d8bbwe\\YourPhone.exe",args:"-ServerName:App.AppX9yct9q388jvt4h7y0gn06smzkxcsnt8m.mca",date:20191205115357},{pid:6808,ppid:876,command:"C:\\Windows\\system32\\browser_broker.exe",args:"-Embedding",date:20191205115358},{pid:6972,ppid:876,command:"C:\\Windows\\System32\\RuntimeBroker.exe",args:"-Embedding",date:20191205115358},{pid:7036,ppid:876,command:"C:\\Windows\\System32\\MicrosoftEdgeCP.exe",args:"-ServerName:Windows.Internal.WebRuntime.ContentProcessServer",date:20191205115358},{pid:7088,ppid:6972,command:"C:\\Windows\\system32\\MicrosoftEdgeSH.exe",args:"SCODEF:6436 CREDAT:9730 APH:1000000000000006 JITHOST /prefetch:2",date:20191205115358}])})})});var j_={};var me,Bk,lt,is,jk=m(()=>{"use strict";me=require("chai"),Bk=require("fs"),lt=w(require("path"));ae();ce();om();uo();ct();is=new se(Bk.promises);describe("runtimeVersion",()=>{let i;it("fails if no nvm/s present",async()=>{i=new Ot(is,{},"x64","linux",_),await(0,me.expect)(i.resolveNvmVersionPath("13")).to.eventually.be.rejectedWith(I,/requires Node.js version manager/)}),describe("fall throughs",()=>{beforeEach(()=>{R(b,{"nvs/node/13.12.0/x64/bin/node":"","nvs/node/13.11.0/x86/bin/node":"","nvm/versions/node/v13.11.0/bin/node":""}),i=new Ot(is,{NVS_HOME:lt.join(b,"nvs"),NVM_DIR:lt.join(b,"nvm")},"x64","linux",_)}),it("attempts multiple lookup to get the right version",async()=>{let{directory:e}=await i.resolveNvmVersionPath("13.12");(0,me.expect)(e).to.equal(lt.join(b,"nvs/node/13.12.0/x64/bin"));let{directory:t}=await i.resolveNvmVersionPath("13.11");(0,me.expect)(t).to.equal(lt.join(b,"nvm/versions/node/v13.11.0/bin")),await(0,me.expect)(i.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(I,/not installed using version manager nvs\/nvm/)}),it("requires nvs for a specific architecture",async()=>{i=new Ot(is,{NVM_DIR:lt.join(b,"nvm")},"x64","linux",_),await(0,me.expect)(i.resolveNvmVersionPath("13.11/x64")).to.eventually.be.rejectedWith(I,/architecture requires 'nvs' to be installed/)}),it("does not fall through if requesting a specific nvs architecture",async()=>{await(0,me.expect)(i.resolveNvmVersionPath("13.11/x64")).to.eventually.be.rejectedWith(I,/not installed/)})}),describe("nvs support",()=>{beforeEach(()=>{R(b,{"node/13.12.0/x64/bin/node":"","node/13.4.0/x86/bin/node":"","node/13.3.0/x64/bin/node":"","node/13.3.1/x64/bin/node64.exe":"","node/13.invalid/x64/bin/node":""}),i=new Ot(is,{NVS_HOME:b},"x64","linux",_)}),it("gets an exact match",async()=>{let{directory:e,binary:t}=await i.resolveNvmVersionPath("13.3.0");(0,me.expect)(e).to.equal(lt.join(b,"node/13.3.0/x64/bin")),(0,me.expect)(t).to.equal("node")}),it("resolves node64",async()=>{let{directory:e,binary:t}=await i.resolveNvmVersionPath("13.3.1");(0,me.expect)(e).to.equal(lt.join(b,"node/13.3.1/x64/bin")),(0,me.expect)(t).to.equal("node64")}),it("gets the best matching version",async()=>{let{directory:e}=await i.resolveNvmVersionPath("13");(0,me.expect)(e).to.equal(lt.join(b,"node/13.12.0/x64/bin"))}),it("throws if no version match",async()=>{await(0,me.expect)(i.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(I,/not installed/)}),it("throws on none for specific architecture",async()=>{await(0,me.expect)(i.resolveNvmVersionPath("13.4.0")).to.eventually.be.rejectedWith(I,/not installed/)}),it("gets a specific architecture",async()=>{let{directory:e}=await i.resolveNvmVersionPath("13/x86");(0,me.expect)(e).to.equal(lt.join(b,"node/13.4.0/x86/bin"))}),it("omits the bin directory on windows",async()=>{i=new Ot(is,{NVS_HOME:b},"x64","win32",_);let{directory:e}=await i.resolveNvmVersionPath("13.3.0");(0,me.expect)(e).to.equal(lt.join(b,"node/13.3.0/x64"))})}),describe("nvm windows",()=>{beforeEach(()=>{R(b,{"v13.12.0/node.exe":"","v13.3.0/node.exe":"","v13.3.1/node64.exe":"","v13.invalid/node.exe":""}),i=new Ot(is,{NVM_HOME:b},"x64","win32",_)}),it("gets an exact match",async()=>{let{directory:e,binary:t}=await i.resolveNvmVersionPath("13.3.0");(0,me.expect)(e).to.equal(lt.join(b,"v13.3.0")),(0,me.expect)(t).to.equal("node")}),it("resolves node64",async()=>{let{directory:e,binary:t}=await i.resolveNvmVersionPath("13.3.1");(0,me.expect)(e).to.equal(lt.join(b,"v13.3.1")),(0,me.expect)(t).to.equal("node64")}),it("gets the best matching version",async()=>{let{directory:e}=await i.resolveNvmVersionPath("13");(0,me.expect)(e).to.equal(lt.join(b,"v13.12.0"))}),it("throws if no version match",async()=>{await(0,me.expect)(i.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(I,/not installed/)})}),describe("nvm osx",()=>{beforeEach(()=>{R(b,{"versions/node/v13.12.0/bin/node":"","versions/node/v13.3.0/bin/node":"","versions/node/v13.3.1/bin/node64":"","versions/node/v13.invalid/bin/node":""}),i=new Ot(is,{NVM_DIR:b},"x64","linux",_)}),it("gets an exact match",async()=>{let{directory:e,binary:t}=await i.resolveNvmVersionPath("13.3.0");(0,me.expect)(e).to.equal(lt.join(b,"versions/node/v13.3.0/bin")),(0,me.expect)(t).to.equal("node")}),it("resolves node64",async()=>{let{directory:e,binary:t}=await i.resolveNvmVersionPath("13.3.1");(0,me.expect)(e).to.equal(lt.join(b,"versions/node/v13.3.1/bin")),(0,me.expect)(t).to.equal("node64")}),it("gets the best matching version",async()=>{let{directory:e}=await i.resolveNvmVersionPath("13");(0,me.expect)(e).to.equal(lt.join(b,"versions/node/v13.12.0/bin"))}),it("throws if no version match",async()=>{await(0,me.expect)(i.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(I,/not installed/)})})})});var O_={};var Lc,Ac,Ok=m(()=>{"use strict";Lc=require("chai"),Ac=require("fs");dd();Ee();describe("resourceProvider",()=>{async function i(e,t){let{threadId:r}=e.log(await e.dap.once("stopped"));return await e.logger.logStackTrace(r),t&&await t(r),e.dap.continue({threadId:r})}g("applies cookies",async({r:e})=>{let t=await e.launchUrl("cookies/home");t.load(),await i(t),t.assertLog()}),g("follows redirects",async({r:e})=>{let t=await e.launchUrl("redirect-test/home");t.load(),t.log(await t.waitForSource("module1.ts")),t.assertLog()}),it("decodes base64 data uris",async()=>{let e=new Bt(Ac.promises);(0,Lc.expect)(await e.fetch("data:text/plain;base64,SGVsbG8gd29ybGQh")).to.deep.equal({ok:!0,statusCode:200,body:"Hello world!",url:"data:text/plain;base64,SGVsbG8gd29ybGQh"})}),it("decodes utf8 data uris (#662)",async()=>{let e=new Bt(Ac.promises);(0,Lc.expect)(await e.fetch("data:text/plain;utf-8,Hello%20world!")).to.deep.equal({ok:!0,statusCode:200,body:"Hello world!",url:"data:text/plain;utf-8,Hello%20world!"})}),it("fetches remote url",async()=>{let e=new Bt(Ac.promises);(0,Lc.expect)(await e.fetch("http://localhost:8001/greet")).to.deep.equal({ok:!0,statusCode:200,body:"Hello world!",url:"http://localhost:8001/greet"})}),it("follows redirects (unit)",async()=>{let e=new Bt(Ac.promises);(0,Lc.expect)(await e.fetch("http://localhost:8001/redirect-to-greet")).to.deep.equal({ok:!0,statusCode:200,body:"Hello world!",url:"http://localhost:8001/redirect-to-greet"})}),it("applies request options",async()=>{let t=await new Bt(Ac.promises,{provideOptions:r=>{r.headers={cool:"true"}}}).fetch("http://localhost:8001/view-headers");(0,Lc.expect)(JSON.parse(t.body||"no content")).to.containSubset({cool:"true"})})})});var N_={};var Nk=m(()=>{"use strict";Ee();describe("pretty print sources",()=>{async function i(t){let{threadId:r}=t.log(await t.dap.once("stopped"));return await t.logger.logStackTrace(r),()=>t.dap.continue({threadId:r})}let e=async(t,r)=>{let o=t.dap.prettyPrintSource({source:r}),n=t.dap.once("loadedSource"),s=t.dap.once("continued"),a=await i(t);t.log(await s),t.log(await n),await o,a()};g("base",async function({r:t}){let r=await t.launchUrl("pretty/pretty.html"),o={path:r.workspacePath("web/pretty/ugly.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:5,column:1}]}),r.load(),await i(r),await e(r,o),r.assertLog()}),g("steps in pretty",async({r:t})=>{let r=await t.launchUrl("pretty/pretty.html"),o={path:r.workspacePath("web/pretty/ugly.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:5,column:1}]}),r.load(),await r.dap.once("stopped"),r.dap.prettyPrintSource({source:o});let{threadId:n}=r.log(await r.dap.once("stopped"));for(let s=0;s<4;s++)r.log(`
step`),r.dap.next({threadId:n}),r.log(await Promise.all([r.dap.once("continued"),r.dap.once("stopped")])),await r.logger.logStackTrace(n);r.assertLog()}),g("bps",async({r:t})=>{let r=await t.launchUrl("pretty/pretty.html"),o={path:r.workspacePath("web/pretty/ugly.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:5,column:1},{line:9,column:1}]}),r.load();let n=r.dap.once("stopped");for(let l=0;l<2;l++)r.log(await r.dap.once("breakpoint"));let{threadId:s}=r.log(await n);r.dap.prettyPrintSource({source:o});let a=r.dap.once("loadedSource"),c=r.log(await r.dap.once("breakpoint")).breakpoint,p=r.log(await r.dap.once("breakpoint")).breakpoint;r.log(await r.dap.setBreakpoints({source:(await a).source,breakpoints:[{line:17,column:1},{line:c.line,column:c.column},{line:p.line,column:p.column}]}));for(let l=0;l<2;l++)r.log(`
continue`),r.dap.continue({threadId:s}),r.log(await Promise.all([r.dap.once("continued"),r.dap.once("stopped")])),await r.logger.logStackTrace(s);r.assertLog()}),g("eval sources (#929)",async function({r:t}){let r=await t.launchUrlAndLoad("index.html");await r.load();let o=r.waitForSource(),n=r.evaluate('let n=1;for(let l=0;l<n;l++){console.log("hi");debugger}',"");await i(r),await e(r,(await o).source),await n,r.assertLog()})})});var Wk=yT((OY,Vk)=>{"use strict";var Wm=w(require("mocha"));nb();var vb=class extends Wm.reporters.Spec{constructor(e){super(e),e.on("pass",t=>{if(vb.alwaysDumpLogs)return this.dumpLogs(t)}),e.on("fail",t=>this.dumpLogs(t))}async dumpLogs(e){if(!(e instanceof Wm.Test))return;let t=Zn(e.fullTitle());console.log(`##vso[build.uploadlog]${t}`)}},Vm=vb;Vm.alwaysDumpLogs=process.env.DUMP_LOGS;Vk.exports=Vm});var V_={};async function $k(i,e,t=[]){console.log("Setting up CRA in "+e),Hk.mkdirSync(e,{recursive:!0});let r=Ib.spawn("npx",["create-react-app",...t,i],{cwd:e,stdio:"pipe",env:process.env});r.stdout.on("data",n=>console.log(n.toString().replace(/\r?\n$/,""))),r.stderr.on("data",n=>console.error(n.toString().replace(/\r?\n$/,"")));let o=le();r.once("exit",()=>{o.resolve(void 0)}),await o.promise}async function qk(i){let e=le(),t=Ib.spawn("npm",["run-script","start"],{env:{...process.env,BROWSER:"none",SKIP_PREFLIGHT_CHECK:"true"},cwd:i,stdio:"pipe"}),r=setTimeout(()=>{console.log("Did not get recognized dev server output, continuing"),e.resolve(void 0)},1e4);return t.stdout.on("data",o=>{o=o.toString(),o.includes("You can now view")?(console.log("Detected CRA dev server started"),e.resolve(void 0)):o.includes("Something is already")&&e.reject(new Error("Failed to start the dev server: "+o)),console.log(o.toString().replace(/\r?\n$/,""))}),t.stderr.on("data",o=>console.error(o.toString().replace(/\r?\n$/,""))),await e.promise,clearTimeout(r),t}var Ib,Hk,bl,zk=m(()=>{"use strict";Ib=w(require("child_process")),Hk=w(require("fs")),bl=require("path");_r();U();Ap();ct();Ee();describe("react",()=>{async function i(o,n){let{threadId:s}=o.log(await o.dap.once("stopped"));return await o.logger.logStackTrace(s),n&&await n(s),o.dap.continue({threadId:s})}let e="react-test",t,r;afterEach(()=>{r&&(console.log("Killing "+r.pid),Lr(r.pid,A.null))}),describe("TS",()=>{beforeEach(async function(){this.timeout(6e4*4),t=(0,bl.join)(b,e),await $k(e,b,["--template","cra-template-typescript"]),r=await qk(t)}),g("hit breakpoint",async({r:o})=>{let n=await o._launch("http://localhost:3000",{webRoot:t,__workspaceFolder:t,rootPath:t}),s={path:(0,bl.join)(t,"src/App.tsx")};await n.dap.setBreakpoints({source:s,breakpoints:[{line:6,column:0}]}),n.load(),await i(n),n.assertLog({substring:!0})})}),describe("JS",()=>{beforeEach(async function(){this.timeout(6e4*4),t=(0,bl.join)(b,e),await $k(e,b),r=await qk(t)}),g("hit breakpoint",async({r:o})=>{let n=await o._launch("http://localhost:3000",{webRoot:t,__workspaceFolder:t,rootPath:t}),s={path:(0,bl.join)(t,"src/App.js")};await n.dap.setBreakpoints({source:s,breakpoints:[{line:6,column:0}]}),n.load(),await i(n),n.assertLog({substring:!0})})})})});var W_={};var Gk=m(()=>{"use strict";Ee();describe("infra",()=>{g("initialize",async({r:i})=>{i.log(await i.initialize),i.assertLog()}),it("imports win32 app container tokens",async()=>{process.platform==="win32"&&await import("@vscode/win32-app-container-tokens")})})});var $_={};var Pb,Cb,D,Jk=m(()=>{"use strict";Pb=require("chai"),Cb=w(require("del")),D=require("path");ae();Z();B();uo();pb();ct();Ee();describe("breakpoints",()=>{describe("configure",()=>{g("inline",async({r:i})=>{let e=await i.launchUrl("inlinescript.html"),t={path:e.workspacePath("web/inlinescript.html")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:3,column:2}]}),e.load(),await P(e),e.assertLog()}),g("script",async({r:i})=>{let e=await i.launchUrl("script.html"),t={path:e.workspacePath("web/script.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:9,column:0}]}),e.load(),await P(e),await P(e),e.assertLog()}),g("query params",async({r:i})=>{let e=await i.launchUrl("script-with-query-param.html"),t={path:e.workspacePath("web/script.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:9,column:0}]}),e.load(),await P(e),await P(e),e.assertLog()}),g("remove",async({r:i})=>{let e=await i.launchUrl("script.html"),t={path:e.workspacePath("web/script.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:2,column:0}]}),e.load();let r;await P(e,async()=>{e.dap.once("breakpoint").then(o=>r=o),await e.dap.setBreakpoints({source:t})}),await P(e),e.cdp.Runtime.evaluate({expression:`foo();
debugger;
//# sourceURL=test.js`}),await P(e),(0,Pb.expect)(r).to.be.undefined,e.assertLog()}),g("source map",async({r:i})=>{let e=await i.launchUrl("browserify/pause.html"),t={path:e.workspacePath("web/browserify/module2.ts")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),e.load(),await P(e),await P(e),e.assertLog()}),g("absolute paths in source maps",async({r:i})=>{let e=i.workspacePath("web/tmp");after(()=>(0,Cb.default)([`${E(e)}/**`],{force:!0})),R(e,{"pause.js":await nr(i.workspacePath("web/browserify/pause.js")),"pause.html":await nr(i.workspacePath("web/browserify/pause.html")),"pause.js.map":(await nr(i.workspacePath("web/browserify/pause.js.map"))).replace(/"([a-z0-9]+.ts)"/g,`"${E(i.workspacePath("web/browserify"))}/$1"`)});let t=await i.launchUrl("tmp/pause.html"),r={path:t.workspacePath("web/browserify/module2.ts")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:3}]}),t.load(),await P(t),await P(t),t.assertLog()}),g("source map predicted",async({r:i})=>{let e=await i.launchUrl("browserify/pause.html");e.adapter.breakpointManager.setPredictorDisabledForTest(!1);let t={path:e.workspacePath("web/browserify/module2.ts")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),e.load(),await P(e),await P(e),e.assertLog()}),g("source map that's path mapped",async({r:i})=>{let e=i.workspacePath("web/tmp");after(()=>(0,Cb.default)([`${E(e)}/**`],{force:!0})),R(e,{"app.ts":await nr(i.workspacePath("web/pathMapped/app.ts")),"app.js":(await nr(i.workspacePath("web/pathMapped/app.js"))).replace("app.js.map","mappedPath/app.js.map"),"index.html":await nr(i.workspacePath("web/pathMapped/index.html")),mappedDir:{"app.js.map":await nr(i.workspacePath("web/pathMapped/app.js.map"))}});let t=await i.launchUrl("tmp/index.html",{pathMapping:{"/mappedPath/":"${workspaceFolder}/web/tmp/mappedDir/"}}),r={path:t.workspacePath("web/tmp/app.ts")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2}]}),t.load(),await P(t),t.assertLog()})}),describe("launched",()=>{g("inline",async({r:i})=>{let e=await i.launchUrl("inlinescriptpause.html");e.load(),await P(e,async()=>{let t={path:e.workspacePath("web/inlinescriptpause.html")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:6}]})}),await P(e),e.assertLog()}),g("script",async({r:i})=>{let e=await i.launchUrl("script.html");e.load(),await P(e,async()=>{let t={path:e.workspacePath("web/script.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:6}]})}),await P(e),e.assertLog()}),g("ref",async({r:i})=>{let e=await i.launchUrlAndLoad("index.html");e.cdp.Runtime.evaluate({expression:`
        function foo() {
          return 2;
        }
      `});let{source:t}=await e.waitForSource("eval");t.path=void 0,await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]});let r=e.evaluate("foo();");await P(e),await r,e.assertLog()}),g("remove",async({r:i})=>{let e=await i.launchUrlAndLoad("index.html");e.cdp.Runtime.evaluate({expression:`
        function foo() {
          return 2;
        }
      `});let{source:t}=await e.waitForSource("eval");t.path=void 0,await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),await e.dap.setBreakpoints({source:t}),e.cdp.Runtime.evaluate({expression:`foo();
debugger;
//# sourceURL=test.js`}),await P(e),e.assertLog()}),g("overwrite",async({r:i})=>{let e=await i.launchUrlAndLoad("index.html");e.cdp.Runtime.evaluate({expression:`
        function foo() {
          var x = 3;
          return 2;
        }
      `});let{source:t}=await e.waitForSource("eval");t.path=void 0,await e.dap.setBreakpoints({source:t,breakpoints:[{line:4}]}),await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),e.cdp.Runtime.evaluate({expression:`foo();
debugger;
//# sourceURL=test.js`}),await P(e),await P(e),e.assertLog()}),g("source map",async({r:i})=>{let e=await i.launchUrl("browserify/browserify.html"),t=e.waitForSource("module2.ts");await e.load(),await t;let r={path:e.workspacePath("web/browserify/module2.ts")},o=await e.dap.setBreakpoints({source:r,breakpoints:[{line:3}]});(0,Pb.expect)(o.breakpoints[0].verified).to.be.true,e.cdp.Runtime.evaluate({expression:`window.callBack(window.pause);
//# sourceURL=test.js`}),await P(e),await P(e),e.assertLog()}),g("source map remove",async({r:i})=>{let e=await i.launchUrlAndLoad("browserify/browserify.html"),t={path:e.workspacePath("web/browserify/module2.ts")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),await e.dap.setBreakpoints({source:t,breakpoints:[]}),e.cdp.Runtime.evaluate({expression:`window.callBack(window.pause);
//# sourceURL=test.js`}),await P(e),e.assertLog()}),g("source map set compiled",async({r:i})=>{let e=await i.launchUrl("browserify/browserify.html");e.load(),await e.waitForSource("bundle.js");let t=await e.dap.setBreakpoints({source:{path:e.workspacePath("web/browserify/bundle.js")},breakpoints:[{line:36}]});delete t.breakpoints[0].source.sources,e.log(t.breakpoints[0],"Breakpoint resolved: "),e.cdp.Runtime.evaluate({expression:`window.callBack(window.pause);
//# sourceURL=test.js`});let{threadId:r}=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(r),e.dap.stepIn({threadId:r}),await P(e),e.assertLog()}),g("source map set compiled 2",async({r:i})=>{let e=await i.launchUrl("browserify/browserify.html");e.load(),await e.waitForSource("bundle.js");let t=await e.dap.setBreakpoints({source:{path:e.workspacePath("web/browserify/bundle.js")},breakpoints:[{line:36}]});delete t.breakpoints[0].source.sources,e.log(t.breakpoints[0],"Breakpoint resolved: "),e.cdp.Runtime.evaluate({expression:`window.callBack(window.pause);
//# sourceURL=test.js`}),await P(e),await P(e),e.assertLog()}),g("sets breakpoints in sourcemapped node_modules",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"nodeModuleBreakpoint"),t=await i.runScript((0,D.join)(e,"index.js"),{outFiles:[`${e}/**/*.js`],env:{MODULE:"@c4312/foo"},resolveSourceMapLocations:null});await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"node_modules","@c4312","foo","src","index.ts")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("sets breakpoints in sourcemapped node_modules with absolute root",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"nodeModuleBreakpoint"),t=await i.runScript((0,D.join)(e,"index.js"),{outFiles:[`${e}/**/*.js`],env:{MODULE:"@c4312/absolute-sourceroot"},resolveSourceMapLocations:null});await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"node_modules","@c4312","absolute-sourceroot","src","index.ts")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("absolute path in nested module",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"nestedAbsRoot"),t=await i.runScript((0,D.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"test.js")},breakpoints:[{line:1,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})})}),describe("logpoints",()=>{g("basic",async({r:i})=>{let e=await i.launchUrl("logging.html"),t={path:e.workspacePath("web/logging.js")},r=[{line:6,column:0,logMessage:"123"},{line:7,column:0,logMessage:"{({foo: 'bar'})}"},{line:8,column:0,logMessage:"{foo}"},{line:9,column:0,logMessage:"foo {foo} bar"},{line:10,column:0,logMessage:"foo {bar + baz}"},{line:11,column:0,logMessage:"{const a = bar + baz; a}"},{line:12,column:0,logMessage:"{(x=>x+baz)(bar)}"},{line:13,column:0,logMessage:'{throw new Error("oof")}'},{line:14,column:0,logMessage:"{'hi'}"}];await e.dap.setBreakpoints({source:t,breakpoints:r}),e.load();let o=[];for(let n=0;n<r.length;n++)o.push(await e.dap.once("output"));for(let n of o)await e.logger.logOutput(n);e.assertLog()}),g("callstack",async({r:i})=>{let e=await i.launchUrl("logging.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/logging.js")},breakpoints:[{line:6,column:0,logMessage:"123"}]}),e.load(),e.log(await e.dap.once("output")),e.assertLog()}),g("returnValue",async({r:i})=>{let e=await i.launchUrl("logging.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/logging.js")},breakpoints:[{line:32,column:100,logMessage:"doubled: {$returnValue * 2}"}]}),e.load(),await e.logger.logOutput(await e.dap.once("output")),e.assertLog()}),g("no double log",async({r:i})=>{let e=await i.launchUrlAndLoad("logging.html"),t={path:e.workspacePath("web/logging.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:28,column:0,logMessage:"{'LOG' + (window.logValue = (window.logValue || 0) + 1)}"}]}),e.cdp.Runtime.evaluate({expression:"g(); console.log('DONE' + window.logValue)"});let r=[];for(let o=0;o<2;o++)r.push(await e.dap.once("output"));for(let o of r)await e.logger.logOutput(o);e.assertLog()})}),describe("hit condition",()=>{async function i(e){await P(e,async()=>{await e.logger.evaluateAndLog("i")})}g("exact",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,hitCondition:"==2"}]}),t.load(),await i(t),await P(t),t.assertLog()}),g("less than",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,hitCondition:"<3"}]}),t.load(),await i(t),await i(t),await P(t),t.assertLog()}),g("greater than",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,hitCondition:">3"}]}),t.load(),await i(t),await i(t),t.assertLog()}),g("invalid",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};t.dap.on("output",o=>{o.category==="stderr"&&t.logger.logOutput(o)}),await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,hitCondition:"abc"}]}),t.load(),await P(t),t.assertLog()})}),describe("condition",()=>{async function i(e){await P(e,async()=>{await e.logger.evaluateAndLog("i")})}g("basic",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,condition:"i==2"}]}),t.load(),await i(t),await P(t),t.assertLog()}),g("ignores error by default",async({r:e})=>{let t=await e.launchUrl("condition.html");await t.dap.setBreakpoints({source:{path:t.workspacePath("web/condition.js")},breakpoints:[{line:2,column:0,condition:'(() => { throw "oh no" })()'}]}),t.load(),await P(t),t.assertLog()}),g("pauses on error",async({r:e})=>{let t=await e.launchUrl("condition.html",{__breakOnConditionalError:!0});await t.dap.setBreakpoints({source:{path:t.workspacePath("web/condition.js")},breakpoints:[{line:2,column:0,condition:'(() => { throw "oh no" })()'}]}),t.load();let r=t.dap.once("output");await P(t),t.logger.logOutput(await r),t.assertLog()}),g("ignores bp with invalid condition",async({r:e})=>{let t=await e.launchUrl("condition.html"),r=t.dap.once("output"),o={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:o,breakpoints:[{line:2,column:0,condition:")(}{][.&"}]}),t.load(),await e.log(await r),await P(t),t.assertLog()})}),describe("custom",()=>{g("inner html",async({r:i})=>{let e=await i.launchAndLoad("<div>text</div>");e.log("Not pausing on innerHTML"),await e.evaluate("document.querySelector('div').innerHTML = 'foo';"),e.log("Pausing on innerHTML"),await e.dap.enableCustomBreakpoints({ids:["instrumentation:Element.setInnerHTML"]}),e.evaluate("document.querySelector('div').innerHTML = 'bar';");let t=e.log(await e.dap.once("stopped"));e.log(await e.dap.continue({threadId:t.threadId})),e.assertLog()})}),describe("first line",()=>{g("breaks if requested",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"simpleNode"),t=await i.runScript((0,D.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"index.js")},breakpoints:[{line:1,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("does not break if not requested",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"simpleNode"),t=await i.runScript((0,D.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"index.js")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})})}),describe("hot-transpiled",()=>{g("breaks on first line",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"tsNode"),t=await i.runScript((0,D.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"double.ts")},breakpoints:[{line:1,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("user defined bp on first line",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"tsNode"),t=await i.runScript((0,D.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"log.ts")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("adjusts breakpoints",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"tsNode"),t=await i.runScript((0,D.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"double.ts")},breakpoints:[{line:7,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("adjusts breakpoints after already running (#524)",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"tsNode"),t=await i.runScript((0,D.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"double.ts")},breakpoints:[{line:7,column:1}]}),t.load();let{threadId:r}=await t.dap.once("stopped");t.log(await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"double.ts")},breakpoints:[{line:17,column:1}]})),t.dap.continue({threadId:r}),await P(t),t.assertLog({substring:!0})}),g("works in remote workspaces",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"tsNode"),t=await i.runScriptAsRemote((0,D.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"double.ts")},breakpoints:[{line:7,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("avoids double pathmapping (#1617)",async({r:i})=>{R(b,{src:{"double.js":"console.log('hello world');"},"double.js":["/*'Object.<anonymous>':function(module,exports,require,__dzrname,__fzlename,jest*/console.log('hello world');","//# sourceMappingURL=data:application/json;charset=utf-8;base64,"+Buffer.from(JSON.stringify({version:3,names:["console","log"],sources:["double.js"],sourcesContent:[`console.log('hello world');
`],mappings:"AAAAA,OAAO,CAACC,GAAG,CAAC,aAAa,CAAC"})).toString("base64")]});let e=await i.runScript("double.js",{localRoot:(0,D.join)(b,"src"),remoteRoot:b});await e.dap.setBreakpoints({source:{path:(0,D.join)(b,"src","double.js")},breakpoints:[{line:1,column:1}]}),e.load(),await P(e),i.assertLog({substring:!0})}),g("does not adjust already correct",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"tsNode"),t=await i.runScript((0,D.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"matching-line.ts")},breakpoints:[{line:3,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})})}),describe("lazy async stack",()=>{g("sets stack on pause",async({r:i})=>{let e=await i.launchUrl("asyncStack.html",{showAsyncStacks:{onceBreakpointResolved:32}});e.load(),await P(e),await P(e),e.assertLog()}),g("sets eagerly on bp",async({r:i})=>{let e=await i.launchUrl("asyncStack.html",{showAsyncStacks:{onceBreakpointResolved:32}}),t={path:e.workspacePath("web/asyncStack.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:5,column:1}]}),e.load(),await P(e),await P(e),e.assertLog()})}),g("gets correct line number with babel code (#407)",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"babelLineNumbers"),t=await i.runScript((0,D.join)(e,"compiled.js"));await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"compiled.js")},breakpoints:[{line:1}]}),await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"app.tsx")},breakpoints:[{line:2}]}),t.load();let{threadId:r}=t.log(await t.dap.once("stopped"));await t.dap.continue({threadId:r}),await P(t),t.assertLog({substring:!0})}),g("vue projects",async({r:i})=>{let e=await i.launchUrl("vue/index.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/src/App.vue")},breakpoints:[{line:9,column:1}]}),e.load();let{threadId:t}=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(t),e.dap.stepIn({threadId:t}),await P(e),e.assertLog()}),describe("breakpoint placement",()=>{let i=(0,D.join)(_,"sourceMapLocations");describe("first function stmt",()=>{["tsc","babel"].forEach(e=>g(e,async({r:t})=>{await t.initialize;let r=await t.runScript((0,D.join)(i,`${e}.js`));await r.dap.setBreakpoints({source:{path:(0,D.join)(i,"test.ts")},breakpoints:[{line:4,column:1}]}),r.load(),await P(r),r.assertLog({substring:!0})}))}),describe("end function stmt",()=>{["tsc","babel"].forEach(e=>g(e,async({r:t})=>{await t.initialize;let r=await t.runScript((0,D.join)(i,`${e}.js`));await r.dap.setBreakpoints({source:{path:(0,D.join)(i,"test.ts")},breakpoints:[{line:6,column:1}]}),r.load(),await P(r),r.assertLog({substring:!0})}))})}),describe("hit count",()=>{let i=async(t,r)=>{let o=await t.launchUrlAndLoad("index.html");o.cdp.Runtime.evaluate({expression:`
        function foo() {
          for (let i = 0; i < 10; i++) {
            console.log(i);
            console.log(i);
            console.log(i);
          }
        }
      `});let{source:n}=await o.waitForSource("eval");n.path=void 0,await r(o,n),o.assertLog()},e=async t=>{let{threadId:r}=await t.dap.once("stopped"),{id:o}=(await t.dap.stackTrace({threadId:r})).stackFrames[0];return await t.logger.logEvaluateResult(await t.dap.evaluate({expression:"i",frameId:o})),t.dap.continue({threadId:r})};g("works for valid",async({r:t})=>{await i(t,async(r,o)=>{t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"=5"}]}));let n=r.evaluate("foo();");await e(r),await n})}),g("implies equal (#1698)",async({r:t})=>{await i(t,async(r,o)=>{t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"5"}]}));let n=r.evaluate("foo();");await e(r),await n})}),g("can change after set",async({r:t})=>{await i(t,async(r,o)=>{t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"=5"}]})),t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"=8"}]}));let n=r.evaluate("foo();");await e(r),await n})}),g("does not validate or hit invalid breakpoint",async({r:t})=>{await i(t,async(r,o)=>{let n=r.dap.once("output");t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"potato"}]})),await t.log(await n),await r.evaluate("foo();")})})}),g("user defined bp on first line with stop on entry on .ts file reports as breakpoint",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"tsNodeApp"),t=await i.runScript((0,D.join)(e,"app.ts"),{stopOnEntry:!0,smartStep:!1});await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"app.ts")},breakpoints:[{line:1,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("stop on entry on .ts file reports as entry",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"tsNodeApp"),t=await i.runScript((0,D.join)(e,"app.ts"),{stopOnEntry:!0,smartStep:!1});await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"app.tsx")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("resolves sourcemaps in paths containing glob patterns (vscode#166400)",async({r:i})=>{await i.initialize;let e=(0,D.join)(_,"glob(chars)"),t=await i.runScript((0,D.join)(e,"app.ts"),{stopOnEntry:!0,smartStep:!1,outFiles:[`${e}/**/*.js`],resolveSourceMapLocations:[`${e}/**/*.js`]});await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"app.ts")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("reevaluates breakpoints when new sources come in (#600)",async({r:i})=>{let e=await i.launchUrl("unique-refresh?v=1");e.load();let{source:t}=await e.waitForSource("hello.js");e.dap.setBreakpoints({source:t,breakpoints:[{line:2,column:1}]}),await P(e),e.cdp.Page.navigate({url:i.buildUrl("unique-refresh?v=2")}),await P(e),e.assertLog()}),g("can step in when first line of code is function",async({r:i})=>{R(b,{"test.js":["function double(x) {","  x *= 2;","  return x;","}","double(2)"]});let e=await i.runScript("test.js");await e.dap.setBreakpoints({source:{path:(0,D.join)(b,"test.js")},breakpoints:[{line:5,column:0}]}),e.load();let{threadId:t}=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(t),e.dap.stepIn({threadId:t}),await P(e),e.assertLog({process:zx})}),g("normalizes webpack nul byte (#1080)",async({r:i})=>{let e=(0,D.join)(_,"webpackNulByte"),t=await i.runScript((0,D.join)(e,"build/greeter.js"),{cwd:e});await t.dap.setBreakpoints({source:{path:(0,D.join)(e,"src/#hello/world.ts")},breakpoints:[{line:1,column:0}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("excludes callers",async({r:i})=>{let e=await i.launchAndLoad("blank");e.dap.evaluate({expression:`
        function foo() {
          bar();
        }

        function baz() {
          bar();
        }

        function bar() {
          debugger;
        }

        foo();
        baz();
        foo();
        baz();
      `}),await P(e,async t=>{let{stackFrames:[r,o]}=await e.dap.stackTrace({threadId:t});await e.dap.setExcludedCallers({callers:[{caller:{line:o.line,column:o.column,source:o.source},target:{line:r.line,column:r.column,source:r.source}}]})}),await P(e),await P(e),e.assertLog()}),g("ignores source url query string (#1225)",async({r:i})=>{let e=(0,D.join)(_,"sourceQueryString"),t=await i.runScript((0,D.join)(e,"output.js"),{cwd:e});t.load(),await P(t),t.assertLog({substring:!0})}),g("toggles source map stepping",async({r:i})=>{let e=await i.launchUrl("basic.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/basic.ts")},breakpoints:[{line:12}]}),e.load();{let o=e.dap.once("breakpoint"),{threadId:n}=e.log(await e.dap.once("stopped"));await i.log(await o,"Initial breakpoint resolution"),await e.logger.logStackTrace(n)}e.dap.setSourceMapStepping({enabled:!1});let t=e.dap.once("breakpoint"),{threadId:r}=e.log(await e.dap.once("stopped"));await i.log(await t,"Demapped breakpoint"),await e.logger.logStackTrace(r),await e.dap.stepIn({threadId:r}),await P(e),e.assertLog()}),g("prefers file uris to url (#1598)",async({r:i})=>{let e=(0,D.join)(_,"web/script.html"),t=await i.launchUrl("script.html",{file:e});i._launchUrl=Cs(e);let r={path:t.workspacePath("web/script.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:9,column:0}]}),t.load(),await P(t),await P(t),t.assertLog()}),g("stepInTargets",async({r:i})=>{let e=await i.launchUrl("stepInTargets.html"),t=e.waitForSource("stepInTargets.js");await e.load(),await e.dap.setBreakpoints({source:(await t).source,breakpoints:[{line:4,column:1},{line:5,column:1}]});let r=e.dap.evaluate({expression:"doTest()"});{let{threadId:o}=e.log(await e.dap.once("stopped")),{stackFrames:n}=await e.dap.stackTrace({threadId:o}),{targets:s}=e.log(await e.dap.stepInTargets({frameId:n[0].id}),"stepInTargets line 3");e.log(await e.dap.stepIn({threadId:o,targetId:s[0].id}),"step in new Foo()"),await P(e)}{let{threadId:o}=e.log(await e.dap.once("stopped")),{stackFrames:n}=await e.dap.stackTrace({threadId:o}),{targets:s}=e.log(await e.dap.stepInTargets({frameId:n[0].id}),"stepInTargets line 4");e.log(await e.dap.stepIn({threadId:o,targetId:s[2].id}),"step in new Foo().bar()"),await P(e)}await r,e.assertLog()}),g("does not interrupt stepOver with instrumentation breakpoint (#1556)",async({r:i})=>{async function e(o){let{threadId:n}=o.log(await o.dap.once("stopped"));return await o.logger.logStackTrace(n),o.dap.next({threadId:n})}let t=await i.launchAndLoad(`
        <script>
          function test() {
            debugger;
            f=eval(\`
              (function (a, b) {
                c = a + b;
                return c;
              });
              //# sourceURL=foo.js
              //# sourceMappingURL=foo.js.map
            \`);
            f(1, 2);
          }
        </script>`),r=t.evaluate("test()");await e(t),await e(t),await P(t),await r,t.assertLog()}),g("does not interrupt stepIn with instrumentation breakpoint (#1665)",async({r:i})=>{let e=await i.launchAndLoad(`
        <script>
          function test() {
            debugger;
            f=eval(\`
              (function (a, b) {
                c = a + b;
                return c;
              });
              //# sourceURL=foo.js
              //# sourceMappingURL=foo.js.map
            \`);
            f(1, 2);
          }
        </script>`),t=e.evaluate("test()"),r=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(r.threadId),await e.dap.stepIn({threadId:r.threadId});let o=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(o.threadId),await e.dap.stepIn({threadId:o.threadId}),await P(e),await t,e.assertLog()}),g("deals with removed execution contexts (#1582)",async({r:i})=>{let e=await i.launchUrlAndLoad("iframe-1582/index.html"),t={path:e.workspacePath("web/iframe-1582/inner.js")};e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),await P(e,async()=>{await e.dap.evaluate({expression:'document.getElementsByTagName("IFRAME")[0].src += ""',context:"repl"})}),await P(e,async()=>{await e.dap.setBreakpoints({source:t,breakpoints:[]})}),e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),await P(e),e.assertLog()})})});var q_={};var Kk=m(()=>{"use strict";Ee();describe("frames",()=>{g("hierarchy",async({r:i})=>{i.setArgs(["--site-per-process"]);let e=await i.launchUrl("frames.html");e.load();let t=(r,o)=>{let n=" ".repeat(o);e.log(`${n}${r.type()} "${r.name()}" [thread "${r.scriptUrlToUrl("")}"]${r.fileName()?" @ "+r.fileName():""}`);let s=r.children();s.sort((a,c)=>a.name().localeCompare(c.name())),s.forEach(a=>t(a,o+2))};await new Promise(r=>{i.onSessionCreated(()=>{i.binder.targetList().length===11&&r()})}),i.binder.targetList().filter(r=>!r.parent()).forEach(r=>t(r,0)),e.assertLog()})})});var kt,Qk,ke,Yk,wl,Xk=m(()=>{"use strict";kt=require("chai"),Qk=require("fs"),ke=w(require("path")),Yk=require("sinon");Rp();Fs();ae();_r();M();Z();B();H();jd();ct();wl={lookup:async i=>ke.join(b,"web","looked up",i),getVueHandling:i=>i.includes("lookup.vue")?1:i.includes("omit.vue")?2:0};describe("BrowserPathResolver",()=>{let i;before(()=>Gl(!1)),beforeEach(()=>{i=new se(Qk.promises),(0,Yk.stub)(i,"exists").callsFake(t=>{switch(t){case"c:\\Users\\user\\Source\\Repos\\Angular Project\\ClientApp\\src\\app\\app.component.html":return Promise.resolve(!0);case"c:\\Users\\user\\Source\\Repos\\Angular Project\\wwwroot\\src\\app\\app.component.html":return Promise.resolve(!1);default:return Promise.resolve(!1)}})}),after(()=>zl()),describe("vue",()=>{let t=new br(wl,i,{workspaceFolder:b,pathMapping:{"/":ke.join(b,"web")},clientID:"vscode",baseUrl:"http://localhost:1234/",sourceMapOverrides:So(ke.join(b,"web")),localRoot:null,remoteRoot:null,resolveSourceMapLocations:null,remoteFilePrefix:void 0},A.null),r={metadata:{compiledPath:ke.join(b,"web","bundle.js"),sourceMapUrl:ke.join(b,"web","bundle.map.js")}};it("looks up vue paths",async()=>{(0,kt.expect)(await t.urlToAbsolutePath({url:"lookup.vue",map:r})).to.equal(be(ke.join(b,"web","looked up","lookup.vue")))}),it("omits vue paths",async()=>{(0,kt.expect)(await t.urlToAbsolutePath({url:"omit.vue",map:r})).to.be.undefined}),it("uses default handling",async()=>{(0,kt.expect)(await t.urlToAbsolutePath({url:"whatever.vue",map:r})).to.equal(be(ke.join(b,"web","whatever.vue")))}),describe("VueFileMapper",()=>{let o=new ki(new zt({rootPath:b,patterns:["**/*.vue"]}),{streamChildrenWithSourcemaps(){return Promise.resolve({values:[],state:void 0})},streamAllChildren(n,s){return Promise.all([s(ke.join(b,"web","a.vue")),s(ke.join(b,"web","b.vue"))])}});it("has correct vue handling",()=>{let n=new Map([["webpack:///hello.vue?f00d",1],["webpack:///./components/hello.vue?f00d",2],["webpack:///unrelated.js",0]]);for(let[s,a]of n.entries())(0,kt.expect)(o.getVueHandling(s)).to.equal(a)}),it("maps basenames to disk",async()=>{(0,kt.expect)(await o.lookup("webpack:///a.vue?f00d")).to.equal(ke.join(b,"web","a.vue")),(0,kt.expect)(await o.lookup("webpack:///q.vue?f00d")).to.be.undefined,(0,kt.expect)(await o.lookup("webpack:///unrelated.js")).to.be.undefined})})});class e{exists(r){switch(r){case"c:\\Users\\user\\Source\\Repos\\Angular Project\\ClientApp\\src\\app\\app.component.html":return Promise.resolve(!0);case"c:\\Users\\user\\Source\\Repos\\Angular Project\\wwwroot\\src\\app\\app.component.html":return Promise.resolve(!1);default:throw Error(`Unknown path ${r}`)}}}describe("absolutePathToUrl",()=>{let t=(r={})=>new br(wl,i,{workspaceFolder:b,pathMapping:{"/":ke.join(b,"web"),"/sibling":ke.join(b,"sibling-dir"),"https://example.com/abs":ke.join(b,"abs")},clientID:"vscode",baseUrl:"http://localhost:1234/",sourceMapOverrides:So(ke.join(b,"web")),localRoot:null,remoteRoot:null,resolveSourceMapLocations:null,remoteFilePrefix:void 0,...r},A.null);it("selects webRoot correctly",()=>{let r="http://localhost:1234/foo/bar(\\.html)?";(0,kt.expect)(t().absolutePathToUrlRegexp(ke.join(b,"web","foo","bar.html"))).to.equal(Me(r,[0,r.length-9]));let o="http://localhost:1234/sibling/foo/bar(\\.html)?";(0,kt.expect)(t().absolutePathToUrlRegexp(ke.join(b,"sibling-dir","foo","bar.html"))).to.equal(Me(o,[0,o.length-9]))}),it("falls back if not in any webroot",()=>{let r="http://localhost:1234/../foo/bar(\\.html)?";(0,kt.expect)(t().absolutePathToUrlRegexp(ke.join(b,"foo","bar.html"))).to.equal(Me(r,[0,r.length-9]))}),it("matches any path if no baseUrl is present",()=>{let r=ke.join(b,"web","foo.js");(0,kt.expect)(t({baseUrl:void 0}).absolutePathToUrlRegexp(r)).to.equal(Me(W(r))+"|[hH][tT][tT][pP][sS]?:\\/\\/[^\\/]+\\/[fF][oO][oO]\\.[jJ][sS]($|\\?)")}),it("does not mangle absolute pathmapping",()=>{(0,kt.expect)(t({baseUrl:void 0}).absolutePathToUrlRegexp(ke.join(b,"abs","x.js"))).to.equal(Me("https://example.com/abs/x.js"))}),it("allows overriding resolution of workspaceFolder (for #1308)",()=>{(0,kt.expect)(t({pathMapping:{"/":ke.join(b,"web"),"/override":ke.join(b,"web")}}).absolutePathToUrlRegexp(ke.join(b,"web","x.js"))).to.equal(Me("http://localhost:1234/override/x.js"))})}),[["visualstudio","ClientApp"],["vscode","wwwroot"]].forEach(([t,r])=>{it(`returns ${r} for ${t} if the webroot path doesn't exist and the modified path does`,async()=>{let o="c:\\Users\\user\\Source\\Repos\\Angular Project\\wwwroot",n=new br(wl,new e,{workspaceFolder:b,pathMapping:{"/":o},clientID:t,baseUrl:"http://localhost:60318/",sourceMapOverrides:So(o),localRoot:null,remoteRoot:null,resolveSourceMapLocations:null,remoteFilePrefix:void 0},await A.test()),s="webpack:///src/app/app.component.html",a=await n.urlToAbsolutePath({url:s,map:Wo({metadata:{sourceMapUrl:"",compiledPath:""}})});(0,kt.expect)(a).to.equal(`c:\\Users\\user\\Source\\Repos\\Angular Project\\${r}\\src\\app\\app.component.html`)})})})});var H_={};function Zk(i){return new Sa(wl,new se(tT.promises),{workspaceFolder:b,pathMapping:{"/":yl.default.join(b,"web")},clientID:"vscode",baseUrl:"http://localhost:1234/",sourceMapOverrides:So(yl.default.join(b,"web")),localRoot:null,remoteRoot:null,resolveSourceMapLocations:null,remoteFilePrefix:i},A.null)}var $m,tT,yl,rT,eT,oT=m(()=>{"use strict";$m=require("chai"),tT=require("fs"),yl=w(require("path"));ae();_r();B();H();ah();Xk();ct();rT=process.platform==="win32",eT=rT?"C:":"/c";describe("BlazorSourcePathResolver.absolutePathToUrlRegexp",()=>{it("generates the correct regexp in local scenarios",async()=>{let i=yl.default.join(eT,"Users","digeff","source","repos","MyBlazorApp","MyBlazorApp","Pages","Counter.razor"),e=await Zk(void 0).absolutePathToUrlRegexp(i);Gc()?(0,$m.expect)(e).to.equal("file:\\/\\/\\/c\\/Users\\/digeff\\/source\\/repos\\/MyBlazorApp\\/MyBlazorApp\\/Pages\\/Counter\\.razor($|\\?)|\\/c\\/Users\\/digeff\\/source\\/repos\\/MyBlazorApp\\/MyBlazorApp\\/Pages\\/Counter\\.razor($|\\?)|http:\\/\\/localhost:1234\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/c\\/Users\\/digeff\\/source\\/repos\\/MyBlazorApp\\/MyBlazorApp\\/Pages\\/Counter\\.razor($|\\?)"):(0,$m.expect)(e).to.contain("[fF][iI][lL][eE]:\\/\\/\\/[cC]:\\/[uU][sS][eE][rR][sS]\\/[dD][iI][gG][eE][fF][fF]\\/[sS][oO][uU][rR][cC][eE]\\/[rR][eE][pP][oO][sS]\\/[mM][yY][bB][lL][aA][zZ][oO][rR][aA][pP][pP]\\/[mM][yY][bB][lL][aA][zZ][oO][rR][aA][pP][pP]\\/[pP][aA][gG][eE][sS]\\/[cC][oO][uU][nN][tT][eE][rR]\\.[rR][aA][zZ][oO][rR]($|\\?)|[cC]:\\\\[uU][sS][eE][rR][sS]\\\\[dD][iI][gG][eE][fF][fF]\\\\[sS][oO][uU][rR][cC][eE]\\\\[rR][eE][pP][oO][sS]\\\\[mM][yY][bB][lL][aA][zZ][oO][rR][aA][pP][pP]\\\\[mM][yY][bB][lL][aA][zZ][oO][rR][aA][pP][pP]\\\\[pP][aA][gG][eE][sS]\\\\[cC][oO][uU][nN][tT][eE][rR]\\.[rR][aA][zZ][oO][rR]($|\\?)")}),rT&&it("generates the correct regexp in codespace scenarios",async()=>{let i=yl.default.join(eT,"Users","digeff","AppData","Local","Temp","2689D069D40B1EFF4B570B2DB12506073980","5~~"),e=`${i}\\C$\\workspace\\NewBlazorWASM\\NewBlazorWASM\\Pages\\Counter.razor`,t=await Zk(i).absolutePathToUrlRegexp(e);(0,$m.expect)(t).to.equal("dotnet://.*\\.dll/[cC]\\/[wW][oO][rR][kK][sS][pP][aA][cC][eE]\\/[nN][eE][wW][bB][lL][aA][zZ][oO][rR][wW][aA][sS][mM]\\/[nN][eE][wW][bB][lL][aA][zZ][oO][rR][wW][aA][sS][mM]\\/[pP][aA][gG][eE][sS]\\/[cC][oO][uU][nN][tT][eE][rR]\\.[rR][aA][zZ][oO][rR]($|\\?)")})})});var z_={};var vl,iT=m(()=>{"use strict";vl=require("chai");U();Ee();describe("evaluate",()=>{g("default",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await t.logger.evaluateAndLog("42"),t.log(""),await t.logger.evaluateAndLog("'foo'"),t.log(""),await t.logger.evaluateAndLog("1234567890n"),t.log(""),await t.logger.evaluateAndLog("throw new Error('foo')"),t.log(""),await t.logger.evaluateAndLog("throw {foo: 3, bar: 'baz'};"),t.log(""),await t.logger.evaluateAndLog("throw 42;"),t.log(""),await t.logger.evaluateAndLog("{foo: 3}"),t.log(""),await t.logger.evaluateAndLog("baz();"),t.log(""),await t.logger.evaluateAndLog("new Uint8Array([1, 2, 3]);"),t.log(""),await t.logger.evaluateAndLog("new Uint8Array([1, 2, 3]).buffer;"),t.log(""),await t.logger.evaluateAndLog("new Proxy({ a: 1 }, { get: () => 2 });"),t.log(""),await t.logger.evaluateAndLog("Object.create({ set foo(x) {} })",{depth:2}),t.log(""),await t.logger.evaluateAndLog("Object.create({ get foo() { return 42 } })",{depth:2}),t.log(""),await t.logger.evaluateAndLog("Object.create({ get foo() { throw 'wat'; } })",{depth:2}),t.log(""),await t.logger.evaluateAndLog("Object.create({ get [Symbol.toStringTag]() { return 42 } })",{depth:2}),t.log(""),t.evaluate("setTimeout(() => { throw new Error('bar')}, 0)"),await t.logger.logOutput(await t.dap.once("output")),t.log(""),t.dap.evaluate({expression:"setTimeout(() => { throw new Error('baz')}, 0)"}),await t.logger.logOutput(await t.dap.once("output")),t.log(""),await t.addScriptTag("browserify/bundle.js"),await t.logger.evaluateAndLog("window.throwError('error1')"),t.log(""),await t.logger.evaluateAndLog("window.throwValue({foo: 3, bar: 'baz'})"),t.log(""),t.dap.evaluate({expression:"setTimeout(() => { window.throwError('error2')}, 0)"}),await t.logger.logOutput(await t.dap.once("output")),t.log(""),t.assertLog()}),g("repl",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await t.logger.evaluateAndLog("42",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("'foo'",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("1234567890n",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("throw new Error('foo')",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("throw {foo: 3, bar: 'baz'};",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("throw 42;",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("{foo: 3}",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("baz();",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("new Map([['hello', function() { return 'world' }]])",void 0,"repl"),t.log("");let[,r]=await Promise.all([t.logger.evaluateAndLog("setTimeout(() => { throw new Error('bar')}, 0); 42",void 0,"repl"),t.dap.once("output")]);await t.logger.logOutput(r),t.log("");let[,o]=await Promise.all([t.logger.evaluateAndLog("setTimeout(() => { throw new Error('baz')}, 0); 42",void 0,"repl"),t.dap.once("output")]);await t.logger.logOutput(o),t.log(""),await t.addScriptTag("browserify/bundle.js"),await t.logger.evaluateAndLog("window.throwError('error1')",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("window.throwValue({foo: 3, bar: 'baz'})",void 0,"repl"),t.log("");let[,n]=await Promise.all([t.logger.evaluateAndLog("setTimeout(() => { window.throwError('error2')}, 0); 42",void 0,"repl"),t.dap.once("output")]);await t.logger.logOutput(n),t.log(""),await t.logger.evaluateAndLog("new Uint8Array(100_000).fill(0)",{logInternalInfo:!0,depth:0},"repl"),t.log(""),t.assertLog()}),g("valueFormatter",async({r:e})=>{let t={hex:!0},r=await e.launchUrlAndLoad("index.html");await r.logger.evaluateAndLog("42",{format:t}),r.log(""),await r.logger.evaluateAndLog("123567891235678912356789123567891235678912356789n",{format:t}),r.log(""),await r.logger.evaluateAndLog("'hello world'",{format:t}),r.log(""),await r.logger.evaluateAndLog("({ a: 'hello', b: 42, c: true })",{format:t}),r.log(""),r.assertLog()});let i={"123n":"123n",NaN:"NaN",'{foo: "bar", baz: { a: [1, 2, 3, 4, 5, 6, 7, 8, 9], b: 123n, "complex key": true }}':`{
  foo: "bar",
  baz: {
    a: [
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
    ],
    b: 123n,
    "complex key": true,
  },
}`,[`{
  double(x) {
    return x * 2;
  },
  triple: x => {
    return x * 3
  }
}`]:`{
  double: function(x) {
    return x * 2;
  },
  triple: x => {
    return x * 3
  },
}`,'function hello() { return "world" }':'function hello() { return "world" }',"(() => { const n = { foo: true }; n.recurse = n; return n })()":`{
  foo: true,
  recurse: [Circular],
}`,"new Uint8Array([1, 2, 3])":"new Uint8Array([1, 2, 3])","new Uint8Array([1, 2, 3]).buffer":"new Uint8Array([1, 2, 3]).buffer","new Float32Array([1.5, 2.5, 3.5])":"new Float32Array([1.5, 2.5, 3.5])","1n << 100n":"1267650600228229401496703205376n","new Date(1665007127286)":'"2022-10-05T21:58:47.286Z"','(() => { const node = document.createElement("div"); node.innerText = "hi"; return node })()':"<div>hi</div>"};g("copy via function",async({r:e})=>{let t=await e.launchAndLoad("blank");t.dap.evaluate({expression:'var x = "hello"; copy(x)'}),(0,vl.expect)((await t.dap.once("copyRequested")).text).to.equal("hello");for(let[r,o]of Object.entries(i)){t.dap.evaluate({expression:`copy(${r})`});let n=await t.dap.once("copyRequested");(0,vl.expect)(n.text).to.equal(o,r)}}),g("copy via evaluate context",async({r:e})=>{let t=await e.launchAndLoad("blank");for(let[r,o]of Object.entries(i)){let n=await t.dap.evaluate({expression:r,context:"clipboard"});(0,vl.expect)(n.result).to.equal(o,r)}}),g("inspect",async({r:e})=>{let t=await e.launchAndLoad("blank");t.dap.evaluate({expression:`function foo() {}; inspect(foo)
//# sourceURL=test.js`}),t.log(await t.dap.once("revealLocationRequested")),t.assertLog()}),g("queryObjects",async({r:e})=>{let t=await e.launchAndLoad("blank");await t.dap.evaluate({expression:`
      class Foo {
        constructor(value) {
          this.value = value;
        }
      }
      var foo1 = new Foo(1);
      var foo2 = new Foo(2);
    `}),t.dap.evaluate({expression:"queryObjects(Foo)"}),await t.logger.logOutput(await t.dap.once("output")),t.assertLog()}),g("topLevelAwait",async({r:e})=>{let t=await e.launchAndLoad(`
      <script>
        function foo(x) {
          return x;
        }

        function koo() {
          return Promise.resolve(4);
        }
      </script>
    `),r=["await Promise.resolve(1)","{a:await Promise.resolve(1)}","4","$_","let {a,b} = await Promise.resolve({a: 1, b:2}), f = 5;","a","b","let c = await Promise.resolve(2)","c","let d;","d","let [i,{abc:{k}}] = [0,{abc:{k:1}}];","i","k","var l = await Promise.resolve(2);","l","foo(await koo());","$_","const m = foo(await koo());","m",`const n = foo(await
koo());`,"n","`status: ${(await Promise.resolve({status:200})).status}`","for (let i = 0; i < 2; ++i) await i","for (let i = 0; i < 2; ++i) { await i }","await 0","await 0;function foo(){}","foo","class Foo{}; await 1;","Foo","await 0;function* gen(){}","for (var i = 0; i < 10; ++i) { await i; }","i","for (let j = 0; j < 5; ++j) { await j; }","j","gen","await 5; return 42;","let o = await 1, p","p","let q = 1, s = await 2","s","await {...{foo: 42}}"];for(let o of r)t.log(`Evaluating: '${o}'`),t.logger.logEvaluateResult(await t.dap.evaluate({expression:o,context:"repl"}),{depth:0});t.assertLog()}),g("escapes strings",async({r:e})=>{let t=await e.launchAndLoad("blank");for(let r of["watch","hover","repl"])t.log(`context=${r}`),await t.logger.evaluateAndLog(JSON.stringify(`1
2\r3	\\4`),{depth:0},r);t.assertLog({customAssert:r=>(0,vl.expect)(r).to.equal(["context=watch","result: '1\\n2\\r3\\t\\\\4'","context=hover","result: '1\\n2\\r3\\t\\\\4'","context=repl",`
result: '1
2\r3	\\4'`,""].join(`
`))})}),g.skip("output slots",async({r:e})=>{let t=await e.launchAndLoad("blank"),r=await t.dap.evaluate({expression:"let i = 0; console.log(++i); ++i",context:"repl"}),o=await t.dap.once("output"),n=await t.dap.once("output");await t.logger.logEvaluateResult(r),await t.logger.logOutput(o),await t.logger.logOutput(n),t.assertLog()}),g.skip("output slots 2",async({r:e})=>{let t=await e.launchAndLoad("blank"),r=await t.dap.evaluate({expression:`
      let i = 0;
      setTimeout(() => {
        console.log(++i);
        throw {foo: ++i};
      }, 0);
      ++i
    `,context:"repl"}),o=await t.dap.once("output"),n=await t.dap.once("output"),s=await t.dap.once("output");await t.logger.logEvaluateResult(r),await t.logger.logOutput(o),await t.logger.logOutput(n),await t.logger.logOutput(s),t.assertLog()}),g("selected context",async({r:e})=>{let t=await e.launchUrlAndLoad("worker.html");t.log("--- Evaluating in page"),t.log("Pausing..."),t.dap.evaluate({expression:"window.w.postMessage('pause');",context:"repl"});let{threadId:r}=await t.dap.once("stopped");t.log("Paused");let{id:o}=(await t.dap.stackTrace({threadId:r})).stackFrames[0];await t.logger.logEvaluateResult(await t.dap.evaluate({expression:"isWorker",frameId:o}),{depth:0}),t.dap.continue({threadId:r}),await t.dap.once("continued"),t.log("Resumed"),t.log("--- Evaluating in worker"),t.dap.evaluate({expression:"window.w.postMessage('pauseWorker');",context:"repl"});let n=await e.worker(),{threadId:s}=await n.dap.once("stopped");t.log("Paused");let{id:a}=(await n.dap.stackTrace({threadId:s})).stackFrames[0];await n.logger.logEvaluateResult(await n.dap.evaluate({expression:"isWorker",frameId:a}),{depth:0}),n.dap.continue({threadId:s}),await n.dap.once("continued"),t.log("Resumed"),t.assertLog()}),g("cd",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");async function r(o){let n=await t.dap.completions(o),s=o.text.substring(0,o.column-1)+"|"+o.text.substring(o.column-1);t.log(n.targets.filter(a=>a.label.startsWith("cd")),`"${s}": `)}await k(50),await r({line:1,column:1,text:""}),await r({line:1,column:3,text:"cd"}),await r({line:1,column:4,text:"cd "}),await r({line:1,column:5,text:"cd t"}),await r({line:1,column:5,text:"cd h"}),await r({line:1,column:2,text:"cd"}),await r({line:1,column:3,text:"co"}),t.assertLog()}),g("returnValue",async({r:e})=>{let t=await e.launchAndLoad("blank"),r=async(o,n="$returnValue")=>{t.dap.evaluate({expression:`(function () {
          debugger;
          return ${o};
        })();`});let{threadId:s}=await t.dap.once("stopped");await t.dap.next({threadId:s}),await t.dap.once("stopped"),await t.dap.next({threadId:s}),await t.dap.once("stopped");let a=(await t.dap.stackTrace({threadId:s})).stackFrames[0].id;t.log(`return ${o}:
`),await t.logger.evaluateAndLog(n,{params:{frameId:a}}),await t.dap.continue({threadId:s})};await r("42"),await r("{ a: { b: true } }"),await r("undefined"),e.assertLog()}),g("supports bigint map keys (#1277)",async({r:e})=>{await(await e.launchUrlAndLoad("index.html")).logger.evaluateAndLog("new Map([[1n, 'one'], [2n, 'two']])"),e.assertLog()})})});var G_={};var qm,fo,nT=m(()=>{"use strict";qm=require("chai"),fo=require("path");uo();ct();Ee();describe("sources",()=>{async function i(e,t,r){e.log(`
Source event for `+r),e.log(t);let o=await e.dap.source({sourceReference:t.source.sourceReference,source:{path:t.source.path,sourceReference:t.source.sourceReference}});e.log(o.content),e.log("---------")}g("basic sources",async({r:e})=>{let t=await e.launchUrl("inlinescript.html");t.load(),await i(t,await t.waitForSource("inline"),"inline"),t.addScriptTag("empty.js"),await i(t,await t.waitForSource("empty.js"),"empty.js"),t.evaluate("17","doesnotexist.js"),await i(t,await t.waitForSource("doesnotexist"),"does not exist"),t.addScriptTag("dir/helloworld.js"),await i(t,await t.waitForSource("helloworld"),"dir/helloworld"),t.evaluate("42",""),await i(t,await t.waitForSource("eval"),"eval"),t.log(await t.dap.loadedSources({}),`
Loaded sources: `),t.assertLog()}),g("updated content",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:"content1//# sourceURL=test.js"}),await i(t,await t.waitForSource("test"),"test.js"),t.cdp.Runtime.evaluate({expression:"content2//# sourceURL=test.js"}),await i(t,await t.waitForSource("test"),"test.js updated"),t.log(await t.dap.loadedSources({}),`
Loaded sources: `),t.assertLog()}),g("basic source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.addScriptTag("browserify/bundle.js");let r=await Promise.all([t.waitForSource("index.ts"),t.waitForSource("module1.ts"),t.waitForSource("module2.ts")]);for(let o of r)await i(t,o,"");t.assertLog()}),g("waiting for source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await t.addScriptTag("browserify/bundle.js"),t.dap.evaluate({expression:"setTimeout(() => { window.throwError('error2')}, 0)"}),await t.logger.logOutput(await t.dap.once("output")),t.assertLog()}),g.skip("waiting for source map failure",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.adapter.sourceContainer.setSourceMapTimeouts({load:2e3,resolveLocation:0,output:0,sourceMapMinPause:0,sourceMapCumulativePause:0}),await t.addScriptTag("browserify/bundle.js"),t.dap.evaluate({expression:"setTimeout(() => { window.throwError('error2')}, 0)"}),await t.logger.logOutput(await t.dap.once("output")),t.assertLog()}),g("supports nested sourcemaps (#1390)",async({r:e})=>{await e.initialize;let t=(0,fo.join)(_,"nestedSourceMaps"),r=await e.runScript((0,fo.join)(t,"a/main.bundle.js"),{cwd:t});await r.dap.setBreakpoints({source:{path:(0,fo.join)(_,"nestedSourceMaps","b","lib.js")},breakpoints:[{line:2,column:1}]}),r.load(),await P(r),r.assertLog({substring:!0})}),g("works with relative webpack sourcemaps (#479)",async({r:e})=>{let t=await e.launchUrl("webpack/relative-paths.html");await t.dap.setBreakpoints({source:{path:t.workspacePath("greet.js")},breakpoints:[{line:2,column:1}]}),await t.dap.setBreakpoints({source:{path:t.workspacePath("web/webpack/farewell.js")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),await P(t),t.assertLog()}),g("allows overrides for relative webpack paths (#479)",async({r:e})=>{let t=await e.launchUrl("webpack/relative-paths.html",{sourceMapPathOverrides:{"webpack:///./*":"${webRoot}/*","webpack:///../*":"${webRoot}/was-nested/*"}});await t.dap.setBreakpoints({source:{path:t.workspacePath("web/was-nested/greet.js")},breakpoints:[{line:2,column:1}]}),await t.dap.setBreakpoints({source:{path:t.workspacePath("web/webpack/farewell.js")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),await P(t),t.assertLog()}),g("url and hash",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:`a
//# sourceURL=foo.js`}),await i(t,await t.waitForSource("foo.js"),"foo.js"),t.cdp.Runtime.evaluate({expression:`b
//# sourceURL=foo.js`}),await i(t,await t.waitForSource("foo.js"),"foo.js"),await t.cdp.Runtime.evaluate({expression:`a
//# sourceURL=foo.js`}),await t.cdp.Runtime.evaluate({expression:`b
//# sourceURL=foo.js`}),t.addScriptTag("empty.js"),await i(t,await t.waitForSource("empty.js"),"empty.js");let r=t.workspacePath("web/empty2.js");t.adapter.sourceContainer.setFileContentOverrideForTest(r,"123"),t.addScriptTag("empty2.js"),await i(t,await t.waitForSource("empty2.js"),"empty2.js"),t.log(await t.dap.loadedSources({}),`
Loaded sources: `),t.assertLog()}),g("allows module wrapper in node code",async({r:e})=>{let t=await e.runScript((0,fo.join)(_,"moduleWrapper","index.js"));t.load();let r=await t.waitForSource("moduleWrapper/test.js");(0,qm.expect)(r.source.sourceReference).to.equal(0)}),g("verifies content when enableContentValidation=true",async({r:e})=>{let t=await e.runScript((0,fo.join)(_,"moduleWrapper","customWrapper.js"));t.load();let r=await t.waitForSource("moduleWrapper/test.js");(0,qm.expect)(r.source.sourceReference).to.be.greaterThan(0)}),g("does not verify content when enableContentValidation=false",async({r:e})=>{let t=await e.runScript((0,fo.join)(_,"moduleWrapper","customWrapper.js"),{enableContentValidation:!1});t.load();let r=await t.waitForSource("moduleWrapper/test.js");(0,qm.expect)(r.source.sourceReference).to.equal(0)}),g("allows shebang in node code",async({r:e})=>{R(b,{index:'require("./shebang-lf"); require("./shebang-crlf"); debugger;',"shebang-lf":`#!/bin/node
console.log("hello world")`,"shebang-crlf":`#!/bin/node\r
console.log("hello world")`});let t=await e.runScript((0,fo.join)(b,"index"));t.load();let r=t.waitForSource("shebang-lf"),o=t.waitForSource("shebang-crlf");t.log(await r,void 0,[]),t.log(await o,void 0,[]),t.assertLog()}),g("removes any query from node paths (#529)",async({r:e})=>{let t=await e.runScript((0,fo.join)(_,"simpleNode","simpleWebpackWithQuery.js"),{cwd:(0,fo.join)(_,"simpleNode")});t.load(),t.log(await t.waitForSource("simpleWebpackWithQuery.ts"),void 0,[]),t.assertLog()}),describe("sourcemap error handling",()=>{g("logs initial parse errors",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html"),r=t.dap.once("output",o=>o.category==="stderr");await t.evaluate(`//# sourceMappingURL=data:application/json;charset=utf-8;base64,ZGV2cw==
`),await t.logger.logOutput(await r),t.assertLog()}),g("logs not found errors",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html"),r=t.dap.once("output",o=>o.category==="stderr");await t.evaluate(`//# sourceMappingURL=does-not-exist.js.map
`),await t.logger.logOutput(await r),t.assertLog()}),g("logs lazy parse errors",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await t.dap.setBreakpoints({source:{path:t.workspacePath("web/eval1Source.js")},breakpoints:[{line:1,column:1}]});let r=e.rootDap().once("output",s=>s.category==="stderr"),o=Buffer.from(JSON.stringify({version:3,file:"eval1.js",sourceRoot:"",sources:["eval1Source.js"],mappings:"#,####;"})).toString("base64"),n=t.evaluate(`//# sourceMappingURL=data:application/json;charset=utf-8;base64,${o}
`);await t.logger.logOutput(await r),await P(t),await n,t.assertLog()})})})});var J_={};var sT=m(()=>{"use strict";U();ct();Ee();describe("stacks",()=>{async function i(e,t){let r=await e.dap.once("stopped");await e.logger.logStackTrace(r.threadId,t),await e.dap.continue({threadId:r.threadId})}g("eval in anonymous",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`

debugger;
//# sourceURL=eval.js`}),await i(t,!1),t.assertLog()}),g("anonymous initial script",async({r:e})=>{let t=await e.launch("<script>debugger;</script>");t.load(),await i(t,!1),t.assertLog()}),g("anonymous scopes",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`
      function paused() {
        let y = 'paused';
        debugger;
      }
      function chain(n) {
        if (!n)
          return paused;
        return function chained() {
          let x = 'x' + n;
          chain(n - 1)();
        };
      }
      chain(3)();
    `}),await i(t,!0),t.assertLog()}),g("async",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`
      function foo(n) {
        if (!n) {
          debugger;
          return;
        }
        setTimeout(() => {
          bar(n - 1);
        }, 0);
      }
      async function bar(n) {
        await Promise.resolve(15);
        await foo(n);
      }
      bar(1);
    `}),await i(t,!0),t.assertLog()}),g("async disables",async({r:e})=>{let t=await e.launchAndLoad("blank",{showAsyncStacks:!1});t.cdp.Runtime.evaluate({expression:`
      function foo(n) {
        if (!n) {
          debugger;
          return;
        }
        setTimeout(() => {
          bar(n - 1);
        }, 0);
      }
      async function bar(n) {
        await Promise.resolve(15);
        await foo(n);
      }
      bar(1);
    `}),await i(t,!0),t.assertLog()}),g("cross target",async({r:e})=>{let t=await e.launchUrlAndLoad("worker.html");t.cdp.Runtime.evaluate({expression:"window.w.postMessage('pause')"}),await i(t,!0),t.assertLog()}),g("source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.addScriptTag("browserify/pause.js"),await i(t,!0),t.assertLog()}),describe("smartStep",()=>{let t="//# sourceMappingURL=data:application/json;charset=utf-8;base64,"+Buffer.from(JSON.stringify({version:3,file:"source.js",sourceRoot:"",sources:["source.ts"],mappings:""})).toString("base64");g("simple stepping",async({r})=>{let o=await r.launchUrlAndLoad("index.html");o.addScriptTag("smartStep/async.js");let{threadId:n}=await o.dap.once("stopped");await o.dap.next({threadId:n}),await o.dap.once("stopped"),await o.logger.logStackTrace(n),await o.dap.stepIn({threadId:n}),await o.dap.stepIn({threadId:n}),await i(o,!1),o.assertLog()}),g("remembers step direction out",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.addScriptTag("smartStep/directional.js"),await o.waitForSource("directional.ts"),await o.dap.setBreakpoints({source:{path:o.workspacePath("web/smartStep/directional.ts")},breakpoints:[{line:2,column:0}]});let n=o.evaluate(`doCall(() => { mapped1(); mapped2(); })
${t}`),{threadId:s}=await o.dap.once("stopped");await o.logger.logStackTrace(s),await o.dap.stepOut({threadId:s}),o.logger.logAsConsole(`
# stepping out
`),await o.dap.once("stopped"),await o.logger.logStackTrace(s),await o.dap.continue({threadId:s}),await n,o.assertLog()}),g("remembers step direction in",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.addScriptTag("smartStep/directional.js"),await o.waitForSource("directional.ts"),await o.dap.setBreakpoints({source:{path:o.workspacePath("web/smartStep/directional.ts")},breakpoints:[{line:2,column:0}]});let n=o.evaluate(`doCall(() => { mapped1(); mapped2(); })
${t}`),{threadId:s}=await o.dap.once("stopped");await o.logger.logStackTrace(s);for(let a=0;a<2;a++)await o.dap.stepIn({threadId:s}),await o.dap.once("stopped");o.logger.logAsConsole(`
# stepping in
`),await o.logger.logStackTrace(s),await o.dap.continue({threadId:s}),await n,o.assertLog()}),g("does not smart step on exception breakpoints",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.dap.setExceptionBreakpoints({filters:["uncaught","all"]}),o.addScriptTag("smartStep/exceptionBp.js"),await i(o,!1),o.assertLog()}),g("does not smart step manual breakpoints",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.dap.setBreakpoints({source:{path:o.workspacePath("web/smartStep/exceptionBp.js")},breakpoints:[{line:9,column:0}]}),o.addScriptTag("smartStep/exceptionBp.js"),await i(o,!1),o.assertLog()}),g("does not step in sources missing maps",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.addScriptTag("smartStep/missingMap.js");let n=o.evaluate(`debugger; doCallback(() => {
        console.log("hi");
      });`),s=(await o.dap.once("stopped")).threadId;await o.dap.stepIn({threadId:s}),s=(await o.dap.once("stopped")).threadId,await o.dap.stepIn({threadId:s}),await P(o),await n,o.assertLog()})}),g("return value",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`
      function foo() {
        debugger;
        return 42;
      }
      foo();
    `});let{threadId:r}=await t.dap.once("stopped");t.dap.next({threadId:r}),await t.dap.once("stopped"),t.dap.next({threadId:r}),await i(t,!0),t.assertLog()}),describe("skipFiles",()=>{async function e(t,r){let o=await t.dap.once("stopped");return await k(200),await t.logger.logStackTrace(o.threadId,r),o}g("single authored js",async({r:t})=>{let r=await t.launchUrl("script.html",{skipFiles:["**/script.js"]}),o={path:r.workspacePath("web/script.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:6,column:0}]}),r.load(),await e(r,!1),r.assertLog()}),g("single compiled js",async({r:t})=>{let r=await t.launchUrlAndLoad("basic.html",{skipFiles:["**/basic.js"]}),o={path:r.workspacePath("web/basic.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:3,column:0}]}),r.load(),await e(r,!1),r.assertLog()}),g("multiple authored ts to js",async({r:t})=>{let r=await t.launchUrlAndLoad("browserify/browserify.html",{skipFiles:["**/module*.ts"]}),o=r.dap.evaluate({expression:`window.callBack(() => { debugger });
console.log("out");`});await P(r),await o,r.assertLog()}),g("works with absolute paths (#470)",async({r:t})=>{let r=await t.launchUrl("basic.html",{skipFiles:[`${_}/web/basic.js`]}),o={path:r.workspacePath("web/basic.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:3,column:0}]}),r.load(),await e(r,!1),r.assertLog()}),g("toggle authored ts",async({r:t})=>{let r=await t.launchUrlAndLoad("basic.html"),o=r.workspacePath("web/basic.ts"),n={path:o};await r.dap.setBreakpoints({source:n,breakpoints:[{line:21,column:0}]}),r.load();let s=await r.dap.once("stopped");await k(500),await r.logger.logStackTrace(s.threadId,!1),r.log("----send toggle skipfile status request----"),await r.dap.toggleSkipFileStatus({resource:o}),await r.logger.logStackTrace(s.threadId,!1),r.log("----send (un)toggle skipfile status request----"),await r.dap.toggleSkipFileStatus({resource:o}),await r.logger.logStackTrace(s.threadId,!1),r.assertLog()})})})});var K_={};var aT=m(()=>{"use strict";Ee();describe("threads",()=>{g("paused",async({r:i})=>{let e=await i.launchUrlAndLoad("index.html");e.cdp.Runtime.evaluate({expression:"debugger;"}),await e.dap.once("stopped"),e.log(await e.dap.threads({})),e.assertLog()}),g("not paused",async({r:i})=>{let e=await i.launchUrlAndLoad("index.html");e.log(await e.dap.threads({})),e.assertLog()}),describe("stepping",()=>{g("basic",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.evaluate(`
        function bar() {
          return 2;
        }
        function foo() {
          debugger;
          bar();
          bar();
        }
        foo();
      `);let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step out`),t.dap.stepOut({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
resume`),t.dap.continue({threadId:r}),t.log(await t.dap.once("continued")),t.assertLog()}),g("cross thread",async({r:e})=>{let t=await e.launchUrlAndLoad("worker.html");t.cdp.Runtime.evaluate({expression:`debugger;
window.w.postMessage('message')
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let o=await e.worker(),{threadId:n}=t.log(await o.dap.once("stopped"));await o.logger.logStackTrace(n),t.log(`
resume`),o.dap.continue({threadId:n}),t.log(await o.dap.once("continued")),t.assertLog()}),g("cross thread constructor",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:`
        debugger;
        window.w = new Worker('worker.js');
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let o=await e.worker(),{threadId:n}=t.log(await o.dap.once("stopped"));await o.logger.logStackTrace(n),t.log(`
resume`),o.dap.continue({threadId:n}),t.log(await o.dap.once("continued")),t.assertLog()}),g("cross thread skip over tasks",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:`
        window.p = new Promise(f => window.cb = f);
        debugger;
        p.then(() => {
          var a = 1; // should stop here
        });
        window.w = new Worker('worker.js');
        window.w.postMessage('hey');
        window.w.addEventListener('message', () => window.cb());
        
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let{threadId:o}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(o),t.log(`
resume`),t.dap.continue({threadId:o}),t.log(await t.dap.once("continued")),t.assertLog()});let i=async(e,t)=>{t.cdp.Runtime.evaluate({expression:`debugger;
window.w = new Worker('workerSourceMap.js');
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let o=await e.worker(),{threadId:n}=t.log(await o.dap.once("stopped"));await o.logger.logStackTrace(n),t.log(`
resume`),o.dap.continue({threadId:n}),t.log(await o.dap.once("continued")),t.assertLog()};g("cross thread constructor source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await i(e,t)}),g("cross thread constructor source map predicted",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await t.dap.setBreakpoints({source:{path:t.workspacePath("web/does-not-exist.html")},breakpoints:[{line:1,column:1}]}),await i(e,t)}),g("cross thread source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:`
        window.w = new Worker('workerSourceMap.js');
        debugger;
        window.w.postMessage('hey');
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let o=await e.worker(),{threadId:n}=t.log(await o.dap.once("stopped"));await o.logger.logStackTrace(n),t.log(`
resume`),o.dap.continue({threadId:n}),t.log(await o.dap.once("continued")),t.assertLog()})}),describe("pause on exceptions",()=>{async function i(e){let t=e.log(await e.dap.once("stopped"));e.log(await e.dap.exceptionInfo({threadId:t.threadId})),e.log(await e.dap.continue({threadId:t.threadId}))}g("cases",async({r:e})=>{let t=await e.launchAndLoad("blank");t.log("Not pausing on exceptions"),await t.dap.setExceptionBreakpoints({filters:[]}),await t.evaluate("setTimeout(() => { throw new Error('hello'); })"),await t.evaluate("setTimeout(() => { try { throw new Error('hello'); } catch (e) {}})"),t.log("Pausing on uncaught exceptions"),await t.dap.setExceptionBreakpoints({filters:["uncaught"]}),await t.evaluate("setTimeout(() => { try { throw new Error('hello'); } catch (e) {}})"),t.evaluate("setTimeout(() => { throw new Error('hello'); })"),await i(t),t.log("Pausing on uncaught rejections"),t.evaluate("new Promise((res, rej) => rej(new Error('oh no!')))"),await i(t),t.log("Pausing on caught exceptions"),await t.dap.setExceptionBreakpoints({filters:["all"]}),t.evaluate("setTimeout(() => { throw new Error('hello'); })"),await i(t),t.evaluate("setTimeout(() => { try { throw new Error('hello'); } catch (e) {}})"),await i(t),t.log("Pausing on caught rejections"),t.evaluate("new Promise((res, rej) => rej(new Error('oh no!'))).catch(err => {})"),await i(t),t.assertLog()}),g("pauses on conditional exceptions",async({r:e})=>{let t=await e.launchAndLoad("blank");t.log("Pausing on caught exceptions"),await t.dap.setExceptionBreakpoints({filters:["all"],filterOptions:[{filterId:"all",condition:'error.message.includes("bye")'}]}),t.evaluate("setTimeout(() => { try { throw new Error('hello'); } catch (e) {} })"),t.evaluate("setTimeout(() => { try { throw new Error('goodbye'); } catch (e) {} })"),await i(t),t.log("Pausing on uncaught exceptions"),await t.dap.setExceptionBreakpoints({filters:["uncaught"],filterOptions:[{filterId:"uncaught",condition:'error.message.includes("bye")'}]}),t.evaluate("setTimeout(() => { throw new Error('hello'); })"),t.evaluate("setTimeout(() => { try { throw new Error('goodbye1'); } catch (e) {} })"),t.evaluate("setTimeout(() => { throw new Error('goodbye2'); })"),await i(t),t.assertLog()}),g("deals with syntax errors in conditional exception bps",async({r:e})=>{let t=await e.launchAndLoad("blank");t.dap.setExceptionBreakpoints({filters:["all"],filterOptions:[{filterId:"all",condition:'error.message.includes("bye'}]}),await t.logger.logOutput(await t.dap.once("output")),t.assertLog()}),g("configuration",async({r:e})=>{let t=await e.launch(`
        <script>
          try {
            throw new Error('this error is caught');
          } catch (e) {
          }
          throw new Error('this error is uncaught');
        </script>
      `);await t.dap.setExceptionBreakpoints({filters:["uncaught"]}),t.load(),await i(t),t.assertLog()})})})});var Q_={};var cT,pT=m(()=>{"use strict";cT=require("chai");ib();Ee();describe("variables",()=>{describe("basic",()=>{g("basic object",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog("({a: 1})"),e.assertLog()}),g("simple log",async({r:i})=>{let e=await i.launch(`
        <script>
          console.log('Hello world');
        </script>`);e.load(),await e.logger.logOutput(await e.dap.once("output")),e.assertLog()}),g("clear console",async({r:i})=>{let e,t=new Promise(n=>e=n),r=Promise.resolve(),o=await i.launch(`
        <script>
        console.clear();
        console.log('Hello world');
        console.clear();
        console.clear();
        console.log('Hello world');
        console.clear();
        console.error('DONE');
        </script>`);o.load(),o.dap.on("output",async n=>{r=r.then(async()=>{n.category==="stderr"?e():await o.logger.logOutput(n)})}),await t,o.assertLog()})}),describe("object",()=>{g("simple array",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog("var a = [1, 2, 3]; a.foo = 1; a",{logInternalInfo:!0}),e.assertLog()}),g.skip("large array",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog("var a = new Array(110); a.fill(1); a",{logInternalInfo:!0}),e.assertLog()}),g("get set",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(`
        const a = {};
        Object.defineProperty(a, 'getter', { get: () => {} });
        Object.defineProperty(a, 'setter', { set: () => {} });
        Object.defineProperty(a, 'accessor', { get: () => {}, set: () => {} });
        a;`),e.assertLog()}),g("private props",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(`
        class A { #foo = 'bar' }
        new A();`),e.assertLog()}),g("deep accessor",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(`
        class Foo { get getter() {} }
        class Bar extends Foo { }
        new Bar();`),e.assertLog()}),describe("customDescriptionGenerator",()=>{g("using function declaration",async({r:i})=>{let e=await i.launchAndLoad("blank",{customDescriptionGenerator:'function (def) { if (this.customDescription) return "using function: " + this.customDescription(); else return def }'});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          new Bar();`),e.assertLog()}),g("shows errors",async({r:i})=>{let e=await i.launchAndLoad("blank",{customDescriptionGenerator:'function (def) { if (this.customDescription) throw new Error("oh no!"); else return def }'});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          new Bar();`),e.assertLog()}),g("using statement syntax",async({r:i})=>{let e=await i.launchAndLoad("blank",{customDescriptionGenerator:'const hasCustomDescription = this.customDescription; "using statement: " + (hasCustomDescription ? this.customDescription() : defaultValue)'});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          new Bar();`),e.assertLog()}),g("using statement with return syntax",async({r:i})=>{let e=await i.launchAndLoad("blank",{customDescriptionGenerator:'const hasCustomDescription = this.customDescription; if (hasCustomDescription) { return "using statement return: " + this.customDescription() } else return defaultValue'});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          new Bar();`),e.assertLog()}),g("with arrays",async({r:i})=>{let e=await i.launchAndLoad("blank",{customDescriptionGenerator:`function (def) {
              return this.customDescription
                ? this.customDescription()
                : (Array.isArray(this)
                  ? "I'm an array"
                  : def); }`});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          [new Bar(), new Foo(), 5, "test"];`),e.assertLog()})}),describe("customPropertiesGenerator",()=>{g("works with customPropertiesGenerator method ",async({r:i})=>{let e=await i.launchAndLoad("blank",{customPropertiesGenerator:"function () { if (this.customPropertiesGenerator) return this.customPropertiesGenerator(); else return this; }"});await e.logger.evaluateAndLog(`
        class Foo { get getter() {} }
        class Bar extends Foo {
          constructor() {
            super();
            this.realProp = 'cc3';
          }

          customPropertiesGenerator() {
            const properties = Object.create(this.__proto__);
            return Object.assign(properties, this, { customProp1: 'aa1', customProp2: 'bb2' });
          }
        }
        new Bar();`),e.assertLog()})}),g("shows errors while generating properties",async({r:i})=>{let e=await i.launchAndLoad("blank",{customPropertiesGenerator:'function () { if (this.customPropertiesGenerator) throw new Error("Some error while generating properties"); else return this; }'});await e.logger.evaluateAndLog(`
      class Foo { get getter() {} }
      class Bar extends Foo {
        constructor() {
          super();
          this.realProp = 'cc3';
        }

        customPropertiesGenerator() {
          const properties = Object.create(this.__proto__);
          return Object.assign(properties, this, { customProp1: 'aa1', customProp2: 'bb2' });
        }
      }
      new Bar();`),e.assertLog()})}),describe("web",()=>{g("tags",async({r:i})=>{let e=await i.launchAndLoad(`<head>
        <meta name='foo' content='bar'></meta>
        <title>Title</title>
      </head>`);await e.logger.evaluateAndLog("document.head.children"),e.assertLog()})}),describe("multiple threads",()=>{g("worker",async({r:i})=>{let e=await i.launchUrlAndLoad("worker.html"),t=[];await Promise.all([(async()=>t.push({output:await e.dap.once("output"),logger:e.logger}))(),(async()=>{let r=await i.worker();t.push({output:await r.dap.once("output"),logger:r.logger}),t.push({output:await r.dap.once("output"),logger:r.logger})})()]),t.sort((r,o)=>{var a,c,p,l;let n=(c=(a=r==null?void 0:r.output)==null?void 0:a.source)==null?void 0:c.name,s=(l=(p=o==null?void 0:o.output)==null?void 0:p.source)==null?void 0:l.name;return n&&s?n.localeCompare(s):0});for(let{output:r,logger:o}of t)await o.logOutput(r);e.assertLog()})}),describe("setVariable",()=>{g("basic",async({r:i})=>{let e=await i.launchAndLoad("blank"),t=await e.logger.evaluateAndLog("window.x = ({foo: 42}); x");e.log(`
Setting "foo" to "{bar: 17}"`);let r=await e.dap.setVariable({variablesReference:t.variablesReference,name:"foo",value:"{bar: 17}"}),o={...r,variablesReference:r.variablesReference||0,name:"<result>"};await e.logger.logVariable(o),e.log(`
Original`),await e.logger.logVariable(t),e.log(await e.dap.setVariable({variablesReference:t.variablesReference,name:"foo",value:"baz"}),`
setVariable failure: `),e.assertLog()}),g("setExpression",async({r:i})=>{let e=await i.launchAndLoad("blank");e.cdp.Runtime.evaluate({expression:`
        (function foo() {
          let a = { b: 1 }
          let c = 'e';
          debugger;
          console.log(a.b, c);
        })()
      `});let t=await e.dap.once("stopped"),r=await e.dap.stackTrace({threadId:t.threadId});e.log(await e.dap.setExpression({expression:"a.b",value:"42",frameId:r.stackFrames[0].id}),`
setExpression a: `),e.log(await e.dap.setExpression({expression:"c",value:'"hello " + "world"',frameId:r.stackFrames[0].id}),`
setExpression a: `),e.dap.continue({threadId:t.threadId}),e.log(`
 Vars:`),await e.logger.logOutput(await e.dap.once("output")),e.assertLog()}),g("scope",async({r:i})=>{let e=await i.launchAndLoad("blank");e.cdp.Runtime.evaluate({expression:`
        (function foo() {
          let y = 'value of y';
          let z = 'value of z';
          debugger;
        })()
      `});let t=e.log(await e.dap.once("stopped"),"stopped: "),r=await e.dap.stackTrace({threadId:t.threadId}),n=(await e.dap.scopes({frameId:r.stackFrames[0].id})).scopes[0],s={name:"scope",value:n.name,variablesReference:n.variablesReference,namedVariables:n.namedVariables,indexedVariables:n.indexedVariables};await e.logger.logVariable(s),e.log(`
Setting "y" to "z"`);let a=await e.dap.setVariable({variablesReference:s.variablesReference,name:"y",value:"z"}),c={...a,variablesReference:a.variablesReference||0,name:"<result>"};await e.logger.logVariable(c),e.log(`
Original`),await e.logger.logVariable(s),e.assertLog()}),g("name mapping",async({r:i})=>{let e=await i.launchUrlAndLoad("minified/index.html");e.cdp.Runtime.evaluate({expression:"test()"});let t=await e.dap.once("stopped"),r=await e.logger.logStackTrace(t.threadId,!0);e.log(`
Preserves eval sourceURL (#1259):`),e.log(await e.dap.evaluate({expression:"arg1; thenSomethingInvalid()",context:"repl",frameId:r[0].id})),await e.dap.continue({threadId:t.threadId}),e.assertLog()}),g("evaluateName",async({r:i})=>{let e=await i.launchAndLoad("blank");e.cdp.Runtime.evaluate({expression:`
        (function foo() {
          let a = 'some string';
          let b = [1, 2, 3, 4];
          b.prop = '';
          let c = { $a: 1, _b: 2, c: 3, 'd d': 4, [42]: 5,
            e: { nested: [{ obj: true }]}, [Symbol('wut')]: 'wut' };
          debugger;
        })();
      `});let t=e.log(await e.dap.once("stopped"),"stopped: "),r=await e.dap.stackTrace({threadId:t.threadId}),n=(await e.dap.scopes({frameId:r.stackFrames[0].id})).scopes[0],s={name:"scope",value:n.name,variablesReference:n.variablesReference,namedVariables:n.namedVariables,indexedVariables:n.indexedVariables};await Xn(e.dap,s,(a,c)=>(e.log("  ".repeat(c)+a.evaluateName),!a.name.startsWith("__")&&!a.name.startsWith("[[")&&a.name!=="this")),e.assertLog()})}),g("readMemory/writeMemory",async({r:i})=>{let e=await i.launchAndLoad("blank");e.cdp.Runtime.evaluate({expression:`
        (function foo() {
          let $memA = new WebAssembly.Memory({ initial: 1, maximum: 1 });
          let $memB = $memA.buffer.slice(0, 12);
          let $memC = new Uint8Array($memB);
          let $memD = new DataView($memB);
          let $memE = new Uint8Array($memB, 3, 8);

          for (let i = 0; i < $memC.length; i++) {
            $memC[i] = i;
          }

          debugger;
          console.log($memA, $memB, $memC, $memD);
        })()
      `});let t=await e.dap.once("stopped"),r=await e.dap.stackTrace({threadId:t.threadId}),n=(await e.dap.scopes({frameId:r.stackFrames[0].id})).scopes[0],s={name:"scope",value:n.name,variablesReference:n.variablesReference,namedVariables:n.namedVariables,indexedVariables:n.indexedVariables},a,c;await Xn(e.dap,s,async(y,v)=>{if(!y.name.startsWith("$mem"))return v<2;y.name==="$memB"?a=y:y.name==="$memE"&&(c=y),(0,cT.expect)(y).to.have.property("memoryReference");let C=await e.dap.readMemory({count:20,memoryReference:y.memoryReference,offset:0});e.log(C,`${y.name} [0, 20]`);let Y=await e.dap.readMemory({count:10,memoryReference:y.memoryReference,offset:5});return e.log(Y,`${y.name} [5, 10]`),!1});let p=await e.dap.writeMemory({memoryReference:a.memoryReference,data:Buffer.from("hello").toString("base64"),offset:1});e.log(p,"write");let l=await e.dap.readMemory({count:10,memoryReference:a.memoryReference});e.log(l,"read outcome");let u=await e.dap.writeMemory({memoryReference:c.memoryReference,data:Buffer.from("helloworld").toString("base64"),offset:1});e.log(u,"write with offset");let f=await e.dap.readMemory({count:10,memoryReference:a.memoryReference});e.log(f,"read outcome"),e.assertLog()})})});var Y_={};var lT=m(()=>{"use strict";Ee();describe("console format",()=>{g("string",async({r:i})=>{let e=await i.launchAndLoad(`
        <script>
          var array = ["test", "test2"];array.length = 10;
          array.foo = {};
          array[4] = "test4";
        </script>`);await e.logger.evaluateAndLog(["console.log(array)",'console.log("hello world".repeat(10000))','console.log("%o", array)','console.log("%O", array)','console.log("Test for zero \\"%f\\" in formatter", 0)','console.log("%% self-escape1", "dummy")','console.log("%%s self-escape2", "dummy")','console.log("%%ss self-escape3", "dummy")','console.log("%%s%s%%s self-escape4", "dummy")','console.log("%%%%% self-escape5", "dummy")','console.log("%%%s self-escape6", "dummy");']),e.assertLog()}),g("popular types",async({r:i})=>{let e=await i.launchAndLoad(`
        <p id="p"></p>
        <script>
          // Populate Globals
          var regex1 = /^url\\(\\s*(?:(?:"(?:[^\\\\\\"]|(?:\\\\[\\da-f]{1,6}\\s?|\\.))*"|'(?:[^\\\\\\']|(?:\\\\[\\da-f]{1,6}\\s?|\\.))*')|(?:[!#$%&*-~\\w]|(?:\\\\[\\da-f]{1,6}\\s?|\\.))*)\\s*\\)/i;
          var regex2 = new RegExp("foo\\\\\\\\bar\\\\sbaz", "i");
          var str = "test";
          var str2 = "test named \\"test\\"";
          var error = new Error;
          var errorWithMessage = new Error("my error message");
          var errorWithMultilineMessage = new Error("my multiline\\nerror message");
          var node = document.getElementById("p");
          var func = function() { return 1; };
          var multilinefunc = function() {
              return 2;
          };
          var num = 1.2e-1;
          var throwingLengthGetter = {get length() { throw "Length called"; }};
          var objectWithNonEnumerables = Object.create({ foo: 1 }, {
              __underscoreNonEnumerableProp: { value: 2, enumerable: false },
              abc: { value: 3, enumerable: false },
              getFoo: { value: function() { return this.foo; } },
              bar: { get: function() { return this.bar; }, set: function(x) { this.bar = x; } }
          });
          objectWithNonEnumerables.enumerableProp = 4;
          objectWithNonEnumerables.__underscoreEnumerableProp__ = 5;
          var negZero = 1 / Number.NEGATIVE_INFINITY;
          var arrayLikeFunction = function( /**/ foo/**/, /*/**/bar,
          /**/baz) {};
          arrayLikeFunction.splice = function() {};
          var tinyTypedArray = new Uint8Array([3]);
          var smallTypedArray = new Uint8Array(new ArrayBuffer(400));
          smallTypedArray["foo"] = "bar";
          var bigTypedArray = new Uint8Array(new ArrayBuffer(400 * 1000 * 1000));
          bigTypedArray["FAIL"] = "FAIL: Object.getOwnPropertyNames() should not have been run";
          var bigArray = [];
          bigArray.length = 200;
          bigArray.fill(1);
          var boxedNumberWithProps = new Number(42);
          boxedNumberWithProps[1] = "foo";
          boxedNumberWithProps["a"] = "bar";
          var boxedStringWithProps = new String("abc");
          boxedStringWithProps["01"] = "foo";
          boxedStringWithProps[3] = "foo";
          boxedStringWithProps["a"] = "bar";
          function domException()
          {
              var result = "FAIL";
              try {
                  var a = document.createElement("div");
                  var b = document.createElement("div");
                  a.removeChild(b);
              } catch(e) {
                  e.stack = "";
                  result = e;
              }
              return result;
          }
          //# sourceURL=console-format
        </script>`),r=["regex1","regex2","str","str2","error","errorWithMessage","errorWithMultilineMessage","func","multilinefunc","num","null","undefined","NaN","Number.POSITIVE_INFINITY","Number.NEGATIVE_INFINITY","{}","[function() {}]","objectWithNonEnumerables","negZero","Object.create(null)","Object","Object.prototype","new Number(42)",'new String("abc")',"arrayLikeFunction",'new Uint16Array(["1", "2", "3"])',"tinyTypedArray","smallTypedArray","bigTypedArray","throwingLengthGetter","domException()","bigArray","boxedNumberWithProps","boxedStringWithProps","false","true","new Boolean(true)","new Set([1, 2, 3, 4])","new Set([1, 2, 3, 4, 5, 6, 7, 8])",'new class { toString() { return "custom to string" } }','new class { toString() { return "long custom to string".repeat(500) } }'].map(o=>[`console.log(${o})`,`console.log([${o}])`]);await e.logger.evaluateAndLog([].concat(...r),{depth:0}),e.assertLog()}),g("custom toString",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(`
      new class A {
        prop = new class B {
          toString() { return "hello b" }
        }
        toString() { return "hello a" }
      }
    `),e.assertLog()}),g("collections",async({r:i})=>{let e=await i.launchAndLoad(`
        <div style="display:none" class="c1 c2 c3">
          <form id="f">
              <select id="sel" name="sel">
                  <option value="1">one</option>
                  <option value="2">two</option>
              </select>
              <input type="radio" name="x" value="x1"> x1
              <input type="radio" name="x" value="x2"> x2
          </form>
        </div>
        <script>
          var formElement = document.getElementById("f");
          var selectElement = document.getElementById("sel");
          var spanElement = document.getElementById("span");

          // NodeList
          var nodelist = document.getElementsByTagName("select");
          var htmlcollection = document.head.children;
          var options = selectElement.options;
          var all = document.all;
          var formControls = formElement.elements;
          var radioNodeList = formElement.x;

          var arrayX = [1];
          var arrayY = [2, arrayX];
          arrayX.push(arrayY);

          var nonArray = new NonArrayWithLength();
          // Arguments
          function generateArguments(foo, bar)
          {
              return arguments;
          }

          var div = document.getElementsByTagName("div")[0];

          function NonArrayWithLength() {
              this.keys = [];
          }

          NonArrayWithLength.prototype.__defineGetter__("length", function() {
              console.log("FAIL: 'length' should not be called");
              return this.keys.length;
          });
        </script>`),r=["nodelist","htmlcollection","options","all","formControls","radioNodeList","arrayX","nonArray",'generateArguments(1, "2")',"div.classList"].map(o=>[`console.log(${o})`,`console.log([${o}])`]);await e.logger.evaluateAndLog([].concat(...r),{depth:0}),e.assertLog()}),g("es6",async({r:i})=>{let e=await i.launchAndLoad(`
        <script>
          var p = Promise.reject(-0);
          p.catch(function() {});

          var p2 = Promise.resolve(1);
          var p3 = new Promise(() => {});

          var smb1 = Symbol();
          var smb2 = Symbol("a");
          var obj = {
              get getter() {}
          };
          obj["a"] = smb1;
          obj[smb2] = 2;

          var map = new Map();
          var weakMap = new WeakMap();
          map.set(obj, {foo: 1});
          weakMap.set(obj, {foo: 1});

          var set = new Set();
          var weakSet = new WeakSet();
          set.add(obj);
          weakSet.add(obj);

          var mapMap0 = new Map();
          mapMap0.set(new Map(), new WeakMap());
          var mapMap = new Map();
          mapMap.set(map, weakMap);

          var setSet0 = new Set();
          setSet0.add(new WeakSet());
          var setSet = new Set();
          setSet.add(weakSet);

          var bigmap = new Map();
          bigmap.set(" from str ", " to str ");
          bigmap.set(undefined, undefined);
          bigmap.set(null, null);
          bigmap.set(42, 42);
          bigmap.set({foo:"from"}, {foo:"to"});
          bigmap.set(["from"], ["to"]);

          var genFunction = function *() {
              yield 1;
              yield 2;
          }
          var generator = genFunction();
        </script>`),r=["p","p2","p3","smb1","smb2","obj","map","weakMap","set","weakSet","mapMap0","mapMap","setSet0","setSet","bigmap","generator"].map(o=>[`console.log(${o})`,`console.log([${o}])`]);await e.logger.evaluateAndLog([].concat(...r),{depth:0}),e.assertLog()}),g("es6-2",async({r:i})=>{let e=await i.launchAndLoad(`
        <script>
          var map2 = new Map();
          map2.set(41, 42);
          map2.set({foo: 1}, {foo: 2});

          var iter1 = map2.values();
          iter1.next();

          var set2 = new Set();
          set2.add(41);
          set2.add({foo: 1});

          var iter2 = set2.keys();
          iter2.next();
        </script>`),r=["map2.keys()","map2.values()","map2.entries()","set2.keys()","set2.values()","set2.entries()","iter1","iter2"].map(o=>[`console.log(${o})`,`console.log([${o}])`]);await e.logger.evaluateAndLog([].concat(...r),{depth:0}),e.assertLog()}),g("array",async({r:i})=>{let e=await i.launchAndLoad(`
        <script>
          var a0 = [];
          var a1 = []; a1.length = 1;
          var a2 = []; a2.length = 5;
          var a3 = [,2,3];
          var a4 = []; a4.length = 15;
          var a5 = []; a5.length = 15; a5[8] = 8;
          var a6 = []; a6.length = 15; a6[0] = 0; a6[10] = 10;
          var a7 = [,,,4]; a7.length = 15;
          for (var i = 0; i < 6; ++i)
              a7["index" + i] = i;
          var a8 = [];
          for (var i = 0; i < 10; ++i)
              a8[i] = i;
          var a9 = [];
          for (var i = 1; i < 5; ++i) {
              a9[i] = i;
              a9[i + 5] = i + 5;
          }
          a9.length = 11;
          a9.foo = "bar";
          a10 = Object.create([1,2]);
        </script>`),t=new Array(11).fill(0).map((r,o)=>`console.log(a${o})`);await e.logger.evaluateAndLog(t,{depth:0}),e.assertLog()}),g("class",async({r:i})=>{let e=await i.launchAndLoad(`
        <script>
          var a0 = [];
          var a1 = []; a1.length = 1;
          var a2 = []; a2.length = 5;
          var a3 = [,2,3];
          var a4 = []; a4.length = 15;
          var a5 = []; a5.length = 15; a5[8] = 8;
          var a6 = []; a6.length = 15; a6[0] = 0; a6[10] = 10;
          var a7 = [,,,4]; a7.length = 15;
          for (var i = 0; i < 6; ++i)
              a7["index" + i] = i;
          var a8 = [];
          for (var i = 0; i < 10; ++i)
              a8[i] = i;
          var a9 = [];
          for (var i = 1; i < 5; ++i) {
              a9[i] = i;
              a9[i + 5] = i + 5;
          }
          a9.length = 11;
          a9.foo = "bar";
          a10 = Object.create([1,2]);
        </script>`),t=new Array(11).fill(0).map((r,o)=>`console.log(a${o})`);await e.logger.evaluateAndLog(t,{depth:0}),e.assertLog()}),g("groups",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(["console.log('outer')","console.group()","console.log('in anonymous')","console.groupCollapsed('named')","console.log('in named')","console.group({ complex: true })","console.log('in complex')","console.groupEnd()","console.groupEnd()","console.log('back in anonymous')","console.groupEnd()"]),e.assertLog()}),g("colors",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(["console.log('%cColors are awesome.', 'color: blue;')","console.log('%cColors are awesome.', 'background-color: red;')","console.log('%cColors are awesome.', 'background-color: red;', 'Do not apply to trailing params')","console.log('%cColors %care %cawesome.', 'color: red', 'color:green', 'color:blue')","console.log('%cBold text.', 'font-weight: bold')","console.log('%cItalic text.', 'font-style: italic')","console.log('%cUnderline text.', 'text-decoration: underline')"],{depth:0}),e.assertLog()}),g("error traces in source maps",async({r:i})=>{let e=await i.launchUrlAndLoad("browserify/browserify.html");await e.logger.evaluateAndLog(["try { throwError() } catch (e) { console.error(e) }"]),e.assertLog()}),g("adds error traces if they do not exist",async({r:i})=>{let e=await i.launchUrlAndLoad("browserify/browserify.html"),t=e.dap.once("output");await e.logger.evaluateAndLog(['setTimeout(() => { throw "asdf" }, 0) ']),e.log(await t),e.assertLog()}),g("applies skipfiles to logged stacks",async({r:i})=>{var o;let e=await i.launchAndLoad(`
        <script>
        function doLog() { console.log.apply(console, arguments); }
        //# sourceURL=ignore-me.js
        </script>
      `,{skipFiles:["**/ignore-me.js"]}),t=e.dap.evaluate({expression:`doLog("hello world");
//# sourceURL=dont-ignore-me.js`,context:"watch"}),r=await e.dap.once("output");await t,e.log(`logged ${r.output} at ${(o=r.source)==null?void 0:o.name}:${r.line}:${r.column}`),e.assertLog()})})});var X_={};var uT=m(()=>{"use strict";Ee();describe("console api",()=>{describe("format",()=>{g("format string",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(["console.log('Log')","console.info('Info')","console.warn('Warn')","console.error('Error')","console.assert(false, 'Assert')","console.assert(false)","console.trace('Trace')","console.count('Counter')","console.count('Counter')"]),e.assertLog()})}),g("format string",async({r:i})=>{let e=await i.launchAndLoad(`<script>
    var peopleObject = {
      one: ["John", "Smith"],
      two: ["Jane", "Doe"],
      three: ["Emily", "Jones"]
    };
    var peopleObject2 = {
      one: { name: "John", last: "Smith"},
      two: { name: "Jane", last: "Doe"},
      three: { name: "Emily", last: "Jones"}
    };
    var peopleLongHeader = {
      one: { "first name": "John", "last name": "Smith"},
      two: { "first name": "Jane", "last name": "Doe"},
      three: { "first name": "Emily", "last name": "Jones"}
    };
    var peopleArray= [
      ["John", "Smith"],
      ["Jane", "Doe"],
      ["Emily", "Jones"]
    ];
    var trimEmptyColumn = [
      ["John", "Smith", ""],
      ["Jane", "Doe", ""],
      ["Emily", "Jones", ""]
    ];
    var cellOverflow = {
      one: ["John", "Smith"],
      two: ["Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane ",
       "Doe Doe Doe Doe Doe Doe Doe DoeDoe DoeDoe Doe Doe DoeDoe DoeDoe DoeDoe Doe"],
      three: ["Emily", "Jones"]
    };
    var longTableOverflow = [
      new Array(1000).fill(0),
      new Array(1000).fill(1)
    ];
    </script>`);await e.logger.evaluateAndLog(["console.table(peopleObject)","console.table(peopleObject2)","console.table(peopleLongHeader)","console.table(peopleArray)","console.table(trimEmptyColumn)","console.table(cellOverflow)","console.table(longTableOverflow)"],{depth:0}),e.assertLog()})})});var tL={};Lb(tL,{run:()=>eL});module.exports=vT(tL);var U_=new Map([["browser/browser-args.test.ts",()=>Promise.resolve().then(()=>(qb(),IT))],["browser/browser-launch.test.ts",()=>Promise.resolve().then(()=>(Qx(),f_))],["browser/performance.test.ts",()=>Promise.resolve().then(()=>(Yx(),h_))],["common/cancellation.test.ts",()=>Promise.resolve().then(()=>(Xx(),b_))],["common/cdpTransport.test.ts",()=>Promise.resolve().then(()=>(tk(),w_))],["common/defaultBrowserProvider.test.ts",()=>Promise.resolve().then(()=>(ik(),y_))],["common/logging.test.ts",()=>Promise.resolve().then(()=>(sk(),v_))],["common/mapUsingProjection.test.ts",()=>Promise.resolve().then(()=>(ak(),S_))],["common/pathUtils.test.ts",()=>Promise.resolve().then(()=>(ck(),I_))],["common/sourceMapOverrides.test.ts",()=>Promise.resolve().then(()=>(lk(),P_))],["common/sourceMapRepository.test.ts",()=>Promise.resolve().then(()=>(uk(),k_))],["completion/completion.test.ts",()=>Promise.resolve().then(()=>(dk(),T_))],["extension/extensionHostConfigurationProvider.test.ts",()=>Promise.resolve().then(()=>(fk(),R_))],["extension/nodeConfigurationProvider.test.ts",()=>Promise.resolve().then(()=>(wk(),D_))],["extension/pickAttach.test.ts",()=>Promise.resolve().then(()=>(Pk(),__))],["extension/profiling.test.ts",()=>Promise.resolve().then(()=>(xk(),L_))],["node/lease-file.test.ts",()=>Promise.resolve().then(()=>(kk(),A_))],["node/node-runtime.test.ts",()=>Promise.resolve().then(()=>(_k(),E_))],["node/node-source-path-resolver.test.ts",()=>Promise.resolve().then(()=>(Ak(),F_))],["node/process-tree.test.ts",()=>Promise.resolve().then(()=>(Mk(),B_))],["node/runtimeVersion.test.ts",()=>Promise.resolve().then(()=>(jk(),j_))],["resourceProvider/resourceProvider.test.ts",()=>Promise.resolve().then(()=>(Ok(),O_))],["sources/pretty-print.test.ts",()=>Promise.resolve().then(()=>(Nk(),N_))]]),Uk=U_;var Sl=w(require("mocha")),Hm=require("path"),dT=w(Wk());var NY=require("reflect-metadata"),Sb=require("chai");(0,Sb.use)(require("chai-subset"));(0,Sb.use)(require("chai-as-promised"));function Z_(){let i=require("nyc"),e=new i({cwd:(0,Hm.join)("D:\\a\\_work\\1\\s\\VsCodeDebugAdapter\\vscode-js-debug\\src\\test","..","..",".."),exclude:["**/test/**",".vscode-test/**"],reporter:["text","html"],all:!0,instrument:!0,hookRequire:!0,hookRunInContext:!0,hookRunInThisContext:!0});return e.reset(),e.wrap(),e}async function eL(){let i=process.env.COVERAGE?Z_():null,e={timeout:10*1e3,color:!0,...JSON.parse(process.env.PWA_TEST_OPTIONS||"{}")};process.env.ONLY_MINSPEC==="true"&&(e.grep="node runtime");let t=e.grep||e.g;t&&(e.grep=new RegExp(String(t),"i")),e.reporter=dT.default,process.env.BUILD_ARTIFACTSTAGINGDIRECTORY&&(e.reporterOptions={reporterEnabled:"mocha-junit-reporter",mochaJunitReporterReporterOptions:{testsuitesTitle:`tests ${process.platform}`,mochaFile:(0,Hm.join)(process.env.BUILD_ARTIFACTSTAGINGDIRECTORY,`test-results/TEST-${process.platform}-test-results.xml`)}});let r=new Sl.default(e),o=async(s,a)=>{r.suite.emit(Sl.default.Suite.constants.EVENT_FILE_PRE_REQUIRE,globalThis,s,r);let c=await a();r.suite.emit(Sl.default.Suite.constants.EVENT_FILE_REQUIRE,c,s,r),r.suite.emit(Sl.default.Suite.constants.EVENT_FILE_POST_REQUIRE,globalThis,s,r)};process.env.RETRY_TESTS&&r.retries(Number(process.env.RETRY_TESTS));let n=s=>(0,Hm.join)("D:\\a\\_work\\1\\s\\VsCodeDebugAdapter\\vscode-js-debug\\src\\test",`${s}.ts`);if(process.env.FRAMEWORK_TESTS)await o(n("framework/reactTest"),()=>Promise.resolve().then(()=>(zk(),V_)));else{await o(n("testIntegrationUtils"),()=>Promise.resolve().then(()=>(Ee(),Jx))),await o(n("infra/infra"),()=>Promise.resolve().then(()=>(Gk(),W_))),await o(n("breakpoints/breakpointsTest"),()=>Promise.resolve().then(()=>(Jk(),$_))),await o(n("browser/framesTest"),()=>Promise.resolve().then(()=>(Kk(),q_))),await o(n("browser/blazorSourcePathResolverTest"),()=>Promise.resolve().then(()=>(oT(),H_))),await o(n("evaluate/evaluate"),()=>Promise.resolve().then(()=>(iT(),z_))),await o(n("sources/sourcesTest"),()=>Promise.resolve().then(()=>(nT(),G_))),await o(n("stacks/stacksTest"),()=>Promise.resolve().then(()=>(sT(),J_))),await o(n("threads/threadsTest"),()=>Promise.resolve().then(()=>(aT(),K_))),await o(n("variables/variablesTest"),()=>Promise.resolve().then(()=>(pT(),Q_))),await o(n("console/consoleFormatTest"),()=>Promise.resolve().then(()=>(lT(),Y_))),await o(n("console/consoleAPITest"),()=>Promise.resolve().then(()=>(uT(),X_)));for(let[s,a]of Uk)await o(n(s),a)}try{await new Promise((s,a)=>r.run(c=>c?a(new Error(`${c} tests failed`)):s(void 0)))}finally{i&&(i.writeCoverageFile(),await i.report())}}0&&(module.exports={run});
//# sourceMappingURL=testRunner.js.map

// SIG // Begin signature block
// SIG // MIIoKAYJKoZIhvcNAQcCoIIoGTCCKBUCAQExDzANBglg
// SIG // hkgBZQMEAgEFADB3BgorBgEEAYI3AgEEoGkwZzAyBgor
// SIG // BgEEAYI3AgEeMCQCAQEEEBDgyQbOONQRoqMAEEvTUJAC
// SIG // AQACAQACAQACAQACAQAwMTANBglghkgBZQMEAgEFAAQg
// SIG // L/qvm2m7AfrjaFHbQ0FK2QStS7MoTgX0M68nlH1/B9Kg
// SIG // gg12MIIF9DCCA9ygAwIBAgITMwAAA061PHrBhG/rKwAA
// SIG // AAADTjANBgkqhkiG9w0BAQsFADB+MQswCQYDVQQGEwJV
// SIG // UzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMH
// SIG // UmVkbW9uZDEeMBwGA1UEChMVTWljcm9zb2Z0IENvcnBv
// SIG // cmF0aW9uMSgwJgYDVQQDEx9NaWNyb3NvZnQgQ29kZSBT
// SIG // aWduaW5nIFBDQSAyMDExMB4XDTIzMDMxNjE4NDMyOVoX
// SIG // DTI0MDMxNDE4NDMyOVowdDELMAkGA1UEBhMCVVMxEzAR
// SIG // BgNVBAgTCldhc2hpbmd0b24xEDAOBgNVBAcTB1JlZG1v
// SIG // bmQxHjAcBgNVBAoTFU1pY3Jvc29mdCBDb3Jwb3JhdGlv
// SIG // bjEeMBwGA1UEAxMVTWljcm9zb2Z0IENvcnBvcmF0aW9u
// SIG // MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA
// SIG // 3QiojSOiARVrryVJn+lnTiamZiMGLORuwCQ+VG3C+rbA
// SIG // vhATw269+qRRqNW7FKed50chWJ53KDIPBStHfIy5cNJY
// SIG // HsQw6+4InH9szgRVqn7/50i8MyRTT+VtNwxf9daGddq0
// SIG // hahpZvjuOnEY0wxQaTEQmWRnXWZUQY4r28tHiNVYEw9U
// SIG // 7wHXwWEHvNn4ZlkJGEf5VpgCvr1v9fmzu4x2sV0zQsSy
// SIG // AVtOxfDwY1HMBcccn23tphweIdS+FNDn2vh1/2kREO0q
// SIG // mGc+fbFzNskjn72MiI56kjvNDRgWs+Q78yBvPCdPgTYT
// SIG // rto5eg33Ko2ELNR/zzEkCCuhO5Vw10qV8wIDAQABo4IB
// SIG // czCCAW8wHwYDVR0lBBgwFgYKKwYBBAGCN0wIAQYIKwYB
// SIG // BQUHAwMwHQYDVR0OBBYEFJzHO2Z/7pCgbAYlpMHTX7De
// SIG // aXcAMEUGA1UdEQQ+MDykOjA4MR4wHAYDVQQLExVNaWNy
// SIG // b3NvZnQgQ29ycG9yYXRpb24xFjAUBgNVBAUTDTIzMDAx
// SIG // Mis1MDA1MTYwHwYDVR0jBBgwFoAUSG5k5VAF04KqFzc3
// SIG // IrVtqMp1ApUwVAYDVR0fBE0wSzBJoEegRYZDaHR0cDov
// SIG // L3d3dy5taWNyb3NvZnQuY29tL3BraW9wcy9jcmwvTWlj
// SIG // Q29kU2lnUENBMjAxMV8yMDExLTA3LTA4LmNybDBhBggr
// SIG // BgEFBQcBAQRVMFMwUQYIKwYBBQUHMAKGRWh0dHA6Ly93
// SIG // d3cubWljcm9zb2Z0LmNvbS9wa2lvcHMvY2VydHMvTWlj
// SIG // Q29kU2lnUENBMjAxMV8yMDExLTA3LTA4LmNydDAMBgNV
// SIG // HRMBAf8EAjAAMA0GCSqGSIb3DQEBCwUAA4ICAQA9tb/a
// SIG // R6C3QUjZRQI5pJseF8TmQD7FccV2w8kL9fpBg3vV6YAZ
// SIG // 09ZV58eyQ6RTCgcAMiMHSJ5r4SvaRgWt9U8ni96e0drN
// SIG // C/EgATz0SRwBJODR6QV8R45uEyo3swG0qqm4LMtdGOyg
// SIG // KcvvVKymtpBprLgErJPeT1Zub3puzpk7ONr5tASVFPiT
// SIG // 0C4PGP7HY907Uny2GGQGicEwCIIu3Yc5+YWrS6Ow4c/u
// SIG // E/jKxXfui1GtlN86/e0MMw7YcfkT/f0WZ7q+Ip80kLBu
// SIG // QwlSDKQNZdjVhANygHGtLSNpeoUDWLGii9ZHn3Xxwqz8
// SIG // RK8vKJyY8hhr/WCqC7+gDjuzoSRJm0Jc/8ZLGBtjfyUj
// SIG // ifkKmKRkxLmBWFVmop+x3uo4G+NSW6Thig3RP2/ldqv4
// SIG // F1IBXtoHcE6Qg7L4fEjEaKtfwTV3K+4kwFN/FYK/N4lb
// SIG // T2JhYWTlTNFC6f5Ck1aIqyKT9igsU+DnpDnLbfIK2J4S
// SIG // dekDI5jL+aOd4YzRVzsYoJEFmM1DvusOdINBQHhWvObo
// SIG // AggepVxJNtRRQdRXSB6Y0kH/iz/1tjlfx34Qt7kz4Cm0
// SIG // bV6PN02WBLnaKMmfwFbtPLIm2dzJBjiTkSxETcCpthu6
// SIG // KnTr+EI/GdCaxoDM4+OjRSgMZC0qROaB0GD9R7T8dZT3
// SIG // w+4jUmybD+i4lB1x9TCCB3owggVioAMCAQICCmEOkNIA
// SIG // AAAAAAMwDQYJKoZIhvcNAQELBQAwgYgxCzAJBgNVBAYT
// SIG // AlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYDVQQH
// SIG // EwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQgQ29y
// SIG // cG9yYXRpb24xMjAwBgNVBAMTKU1pY3Jvc29mdCBSb290
// SIG // IENlcnRpZmljYXRlIEF1dGhvcml0eSAyMDExMB4XDTEx
// SIG // MDcwODIwNTkwOVoXDTI2MDcwODIxMDkwOVowfjELMAkG
// SIG // A1UEBhMCVVMxEzARBgNVBAgTCldhc2hpbmd0b24xEDAO
// SIG // BgNVBAcTB1JlZG1vbmQxHjAcBgNVBAoTFU1pY3Jvc29m
// SIG // dCBDb3Jwb3JhdGlvbjEoMCYGA1UEAxMfTWljcm9zb2Z0
// SIG // IENvZGUgU2lnbmluZyBQQ0EgMjAxMTCCAiIwDQYJKoZI
// SIG // hvcNAQEBBQADggIPADCCAgoCggIBAKvw+nIQHC6t2G6q
// SIG // ghBNNLrytlghn0IbKmvpWlCquAY4GgRJun/DDB7dN2vG
// SIG // EtgL8DjCmQawyDnVARQxQtOJDXlkh36UYCRsr55JnOlo
// SIG // XtLfm1OyCizDr9mpK656Ca/XllnKYBoF6WZ26DJSJhIv
// SIG // 56sIUM+zRLdd2MQuA3WraPPLbfM6XKEW9Ea64DhkrG5k
// SIG // NXimoGMPLdNAk/jj3gcN1Vx5pUkp5w2+oBN3vpQ97/vj
// SIG // K1oQH01WKKJ6cuASOrdJXtjt7UORg9l7snuGG9k+sYxd
// SIG // 6IlPhBryoS9Z5JA7La4zWMW3Pv4y07MDPbGyr5I4ftKd
// SIG // gCz1TlaRITUlwzluZH9TupwPrRkjhMv0ugOGjfdf8NBS
// SIG // v4yUh7zAIXQlXxgotswnKDglmDlKNs98sZKuHCOnqWbs
// SIG // YR9q4ShJnV+I4iVd0yFLPlLEtVc/JAPw0XpbL9Uj43Bd
// SIG // D1FGd7P4AOG8rAKCX9vAFbO9G9RVS+c5oQ/pI0m8GLhE
// SIG // fEXkwcNyeuBy5yTfv0aZxe/CHFfbg43sTUkwp6uO3+xb
// SIG // n6/83bBm4sGXgXvt1u1L50kppxMopqd9Z4DmimJ4X7Iv
// SIG // hNdXnFy/dygo8e1twyiPLI9AN0/B4YVEicQJTMXUpUMv
// SIG // dJX3bvh4IFgsE11glZo+TzOE2rCIF96eTvSWsLxGoGyY
// SIG // 0uDWiIwLAgMBAAGjggHtMIIB6TAQBgkrBgEEAYI3FQEE
// SIG // AwIBADAdBgNVHQ4EFgQUSG5k5VAF04KqFzc3IrVtqMp1
// SIG // ApUwGQYJKwYBBAGCNxQCBAweCgBTAHUAYgBDAEEwCwYD
// SIG // VR0PBAQDAgGGMA8GA1UdEwEB/wQFMAMBAf8wHwYDVR0j
// SIG // BBgwFoAUci06AjGQQ7kUBU7h6qfHMdEjiTQwWgYDVR0f
// SIG // BFMwUTBPoE2gS4ZJaHR0cDovL2NybC5taWNyb3NvZnQu
// SIG // Y29tL3BraS9jcmwvcHJvZHVjdHMvTWljUm9vQ2VyQXV0
// SIG // MjAxMV8yMDExXzAzXzIyLmNybDBeBggrBgEFBQcBAQRS
// SIG // MFAwTgYIKwYBBQUHMAKGQmh0dHA6Ly93d3cubWljcm9z
// SIG // b2Z0LmNvbS9wa2kvY2VydHMvTWljUm9vQ2VyQXV0MjAx
// SIG // MV8yMDExXzAzXzIyLmNydDCBnwYDVR0gBIGXMIGUMIGR
// SIG // BgkrBgEEAYI3LgMwgYMwPwYIKwYBBQUHAgEWM2h0dHA6
// SIG // Ly93d3cubWljcm9zb2Z0LmNvbS9wa2lvcHMvZG9jcy9w
// SIG // cmltYXJ5Y3BzLmh0bTBABggrBgEFBQcCAjA0HjIgHQBM
// SIG // AGUAZwBhAGwAXwBwAG8AbABpAGMAeQBfAHMAdABhAHQA
// SIG // ZQBtAGUAbgB0AC4gHTANBgkqhkiG9w0BAQsFAAOCAgEA
// SIG // Z/KGpZjgVHkaLtPYdGcimwuWEeFjkplCln3SeQyQwWVf
// SIG // Liw++MNy0W2D/r4/6ArKO79HqaPzadtjvyI1pZddZYSQ
// SIG // fYtGUFXYDJJ80hpLHPM8QotS0LD9a+M+By4pm+Y9G6XU
// SIG // tR13lDni6WTJRD14eiPzE32mkHSDjfTLJgJGKsKKELuk
// SIG // qQUMm+1o+mgulaAqPyprWEljHwlpblqYluSD9MCP80Yr
// SIG // 3vw70L01724lruWvJ+3Q3fMOr5kol5hNDj0L8giJ1h/D
// SIG // Mhji8MUtzluetEk5CsYKwsatruWy2dsViFFFWDgycSca
// SIG // f7H0J/jeLDogaZiyWYlobm+nt3TDQAUGpgEqKD6CPxNN
// SIG // ZgvAs0314Y9/HG8VfUWnduVAKmWjw11SYobDHWM2l4bf
// SIG // 2vP48hahmifhzaWX0O5dY0HjWwechz4GdwbRBrF1HxS+
// SIG // YWG18NzGGwS+30HHDiju3mUv7Jf2oVyW2ADWoUa9WfOX
// SIG // pQlLSBCZgB/QACnFsZulP0V3HjXG0qKin3p6IvpIlR+r
// SIG // +0cjgPWe+L9rt0uX4ut1eBrs6jeZeRhL/9azI2h15q/6
// SIG // /IvrC4DqaTuv/DDtBEyO3991bWORPdGdVk5Pv4BXIqF4
// SIG // ETIheu9BCrE/+6jMpF3BoYibV3FWTkhFwELJm3ZbCoBI
// SIG // a/15n8G9bW1qyVJzEw16UM0xghoKMIIaBgIBATCBlTB+
// SIG // MQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3Rv
// SIG // bjEQMA4GA1UEBxMHUmVkbW9uZDEeMBwGA1UEChMVTWlj
// SIG // cm9zb2Z0IENvcnBvcmF0aW9uMSgwJgYDVQQDEx9NaWNy
// SIG // b3NvZnQgQ29kZSBTaWduaW5nIFBDQSAyMDExAhMzAAAD
// SIG // TrU8esGEb+srAAAAAANOMA0GCWCGSAFlAwQCAQUAoIGu
// SIG // MBkGCSqGSIb3DQEJAzEMBgorBgEEAYI3AgEEMBwGCisG
// SIG // AQQBgjcCAQsxDjAMBgorBgEEAYI3AgEVMC8GCSqGSIb3
// SIG // DQEJBDEiBCAO7T4kQ/ABEKvOK99DD3ueFoym2+za22EP
// SIG // cSEzTPivgTBCBgorBgEEAYI3AgEMMTQwMqAUgBIATQBp
// SIG // AGMAcgBvAHMAbwBmAHShGoAYaHR0cDovL3d3dy5taWNy
// SIG // b3NvZnQuY29tMA0GCSqGSIb3DQEBAQUABIIBAAtSHpEg
// SIG // UENIk9kknN5WwnwTzR4SnTQNSKfAcqktl8AOGsMhn0h0
// SIG // KjGlL8mMstfVRL/gfdxPIgKA50Lx7QgcseqagYyqOxts
// SIG // YNBPgwy/X6SxQwMiKp7+FuX7QpjSi2BXwXV0WKur+MMY
// SIG // WoeozKZk1SsI2q71q0R6v6yBgQhU1iuTZe2vHP+XkU7C
// SIG // rlXOjTRdcCCwxW5G6fI6WkOrbCWOkBONC0dDLq9YAMe7
// SIG // xN5oZa3STKFsCKzdF2N7TbSDvfvr6syiBfxvid/URixg
// SIG // Oy7lrLEEolp0jDGLxwlOPwFX0N3YphIQxrtpkGoRzvQx
// SIG // 8tDU070oMHoFSFsS0pfDs8GxO9WhgheUMIIXkAYKKwYB
// SIG // BAGCNwMDATGCF4Awghd8BgkqhkiG9w0BBwKgghdtMIIX
// SIG // aQIBAzEPMA0GCWCGSAFlAwQCAQUAMIIBUgYLKoZIhvcN
// SIG // AQkQAQSgggFBBIIBPTCCATkCAQEGCisGAQQBhFkKAwEw
// SIG // MTANBglghkgBZQMEAgEFAAQg60dQFtoLb4XjcL1CryFt
// SIG // Qt0dM7OFEw1leFGM/KO2AuUCBmUD9ple1RgTMjAyMzA5
// SIG // MjYwOTA3NDkuMjc3WjAEgAIB9KCB0aSBzjCByzELMAkG
// SIG // A1UEBhMCVVMxEzARBgNVBAgTCldhc2hpbmd0b24xEDAO
// SIG // BgNVBAcTB1JlZG1vbmQxHjAcBgNVBAoTFU1pY3Jvc29m
// SIG // dCBDb3Jwb3JhdGlvbjElMCMGA1UECxMcTWljcm9zb2Z0
// SIG // IEFtZXJpY2EgT3BlcmF0aW9uczEnMCUGA1UECxMeblNo
// SIG // aWVsZCBUU1MgRVNOOjhEMDAtMDVFMC1EOTQ3MSUwIwYD
// SIG // VQQDExxNaWNyb3NvZnQgVGltZS1TdGFtcCBTZXJ2aWNl
// SIG // oIIR6jCCByAwggUIoAMCAQICEzMAAAHNVQcq58rBmR0A
// SIG // AQAAAc0wDQYJKoZIhvcNAQELBQAwfDELMAkGA1UEBhMC
// SIG // VVMxEzARBgNVBAgTCldhc2hpbmd0b24xEDAOBgNVBAcT
// SIG // B1JlZG1vbmQxHjAcBgNVBAoTFU1pY3Jvc29mdCBDb3Jw
// SIG // b3JhdGlvbjEmMCQGA1UEAxMdTWljcm9zb2Z0IFRpbWUt
// SIG // U3RhbXAgUENBIDIwMTAwHhcNMjMwNTI1MTkxMjA1WhcN
// SIG // MjQwMjAxMTkxMjA1WjCByzELMAkGA1UEBhMCVVMxEzAR
// SIG // BgNVBAgTCldhc2hpbmd0b24xEDAOBgNVBAcTB1JlZG1v
// SIG // bmQxHjAcBgNVBAoTFU1pY3Jvc29mdCBDb3Jwb3JhdGlv
// SIG // bjElMCMGA1UECxMcTWljcm9zb2Z0IEFtZXJpY2EgT3Bl
// SIG // cmF0aW9uczEnMCUGA1UECxMeblNoaWVsZCBUU1MgRVNO
// SIG // OjhEMDAtMDVFMC1EOTQ3MSUwIwYDVQQDExxNaWNyb3Nv
// SIG // ZnQgVGltZS1TdGFtcCBTZXJ2aWNlMIICIjANBgkqhkiG
// SIG // 9w0BAQEFAAOCAg8AMIICCgKCAgEA0zgi1Uto5hFjqsc8
// SIG // oFu7OmC5ptvaY7wPgoelS+x5Uy/MlLd2dCiM02tjvx76
// SIG // /2ic2tahFZJauzT4jq6QQCM+uey1ccBHOAcSYr+gevGv
// SIG // A0IhelgBRTWit1h4u038UZ6i6IYDc+72T8pWUF+/ea/D
// SIG // EL1+ersI4/0eIV50ezWuC5buJlrJpf8KelSagrsWZ7vY
// SIG // 1+KmlMZ4HK3xU+/s75VwpcC2odp9Hhip2tXTozoMitNI
// SIG // 2Kub7c6+TWfqlcamsPQ5hLI/b36mJH0Ga8tiTucJoF1+
// SIG // /TsezyzFH6k+PvMOSZHUjKF99m9Q+nAylkVL+ao4mIeK
// SIG // P2vXoRPygJFFpUj22w0f2hpzySwBj8tqgPe2AgXniCY0
// SIG // SlEYHT5YROTuOpDo7vJ2CZyL8W7gtkKdo8cHOqw/TOj7
// SIG // 3PLGSHENdGCmVWCrPeGD0pZIcF8LbW0WPo2Z0Ig5tmRY
// SIG // x/Ej3tSOhEXH3mF9cwmIxM3cFnJvnxWZpSQPR0Fu2SQJ
// SIG // jhAjjbXytvBERBBOcs6vk90DFT4YhHxIYHGLIdA3qFom
// SIG // BrA4ihLkvhRJTDMk+OevlNmUWtoW0UPe0HG72gHejlUC
// SIG // 6d00KjRLtHrOWatMINggA3/kCkEf2OvnxoJPaiTSVtzL
// SIG // u+9SrYbj5TXyrLNAdc4dMWtcjeKgt86BPVKuk/K+xt/z
// SIG // rUhZrOMCAwEAAaOCAUkwggFFMB0GA1UdDgQWBBShk/mm
// SIG // NmmawQCVSGYeZInKJHzVmjAfBgNVHSMEGDAWgBSfpxVd
// SIG // AF5iXYP05dJlpxtTNRnpcjBfBgNVHR8EWDBWMFSgUqBQ
// SIG // hk5odHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcGtpb3Bz
// SIG // L2NybC9NaWNyb3NvZnQlMjBUaW1lLVN0YW1wJTIwUENB
// SIG // JTIwMjAxMCgxKS5jcmwwbAYIKwYBBQUHAQEEYDBeMFwG
// SIG // CCsGAQUFBzAChlBodHRwOi8vd3d3Lm1pY3Jvc29mdC5j
// SIG // b20vcGtpb3BzL2NlcnRzL01pY3Jvc29mdCUyMFRpbWUt
// SIG // U3RhbXAlMjBQQ0ElMjAyMDEwKDEpLmNydDAMBgNVHRMB
// SIG // Af8EAjAAMBYGA1UdJQEB/wQMMAoGCCsGAQUFBwMIMA4G
// SIG // A1UdDwEB/wQEAwIHgDANBgkqhkiG9w0BAQsFAAOCAgEA
// SIG // Uqht6aSiFPovxDMMLaLaMZyn8NEl/909ehD248LACJlj
// SIG // meZywG2raKZfMxWPONYG+Xoi9Y/NYeA4hIl7fgSYByAN
// SIG // iyISoUrHHe/aDG6+t9Q4hKn/V+S2Ud1dyiGLLVNyu3+Q
// SIG // 5O7W6G7h7vun2DP4DseOLIEVO2EPmE2B77/JOJjJ7omo
// SIG // SUZVPxdr2r3B1OboV4tO/CuJ0kQD51sl+4FYuolTAQVB
// SIG // ePNt6Dxc5xHB7qe1TRkbRntcb55THdQrssXLTPHf6Ksk
// SIG // 7McJSQDORf5Q8ZxFqEswJGndZ1r5GgHjFe/t/SKV4bn/
// SIG // Rt8W33yosgZ493EHogOEsUsAnZ8dNEQZV0uq/bRg2v6P
// SIG // UUtNRTgAcypD+QgQ6ZuMKSnSFO+CrQR9rBOUGGJ+5YmF
// SIG // ma9n/1PoIU5nThDj5FxHF/NR+HUSVNvE4/4FGXcC/NcW
// SIG // ofCp/nAe7zPx7N/yfLRdd2Tz/vDbV977uDa3IRwyWIIz
// SIG // ovtSbkn/uI6Rf6RBD16fQLrIs5kppASuIlU+zcFbUZ0t
// SIG // bbPKgBhxj4Nhz2uG9rvZnrnlKKjVbTIW7piNcvnfWZE4
// SIG // TVwV89miLU9gvfQzN096mKgFJrylK8lUqTC1abHuI3uV
// SIG // jelVZQgxSlhUR9tNmMRFVrGeW2jfQmqgmwktBGu7PThS
// SIG // 2hDOXzZ/ZubOvZQ/3pHFtqkwggdxMIIFWaADAgECAhMz
// SIG // AAAAFcXna54Cm0mZAAAAAAAVMA0GCSqGSIb3DQEBCwUA
// SIG // MIGIMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGlu
// SIG // Z3RvbjEQMA4GA1UEBxMHUmVkbW9uZDEeMBwGA1UEChMV
// SIG // TWljcm9zb2Z0IENvcnBvcmF0aW9uMTIwMAYDVQQDEylN
// SIG // aWNyb3NvZnQgUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3Jp
// SIG // dHkgMjAxMDAeFw0yMTA5MzAxODIyMjVaFw0zMDA5MzAx
// SIG // ODMyMjVaMHwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpX
// SIG // YXNoaW5ndG9uMRAwDgYDVQQHEwdSZWRtb25kMR4wHAYD
// SIG // VQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xJjAkBgNV
// SIG // BAMTHU1pY3Jvc29mdCBUaW1lLVN0YW1wIFBDQSAyMDEw
// SIG // MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA
// SIG // 5OGmTOe0ciELeaLL1yR5vQ7VgtP97pwHB9KpbE51yMo1
// SIG // V/YBf2xK4OK9uT4XYDP/XE/HZveVU3Fa4n5KWv64NmeF
// SIG // RiMMtY0Tz3cywBAY6GB9alKDRLemjkZrBxTzxXb1hlDc
// SIG // wUTIcVxRMTegCjhuje3XD9gmU3w5YQJ6xKr9cmmvHaus
// SIG // 9ja+NSZk2pg7uhp7M62AW36MEBydUv626GIl3GoPz130
// SIG // /o5Tz9bshVZN7928jaTjkY+yOSxRnOlwaQ3KNi1wjjHI
// SIG // NSi947SHJMPgyY9+tVSP3PoFVZhtaDuaRr3tpK56KTes
// SIG // y+uDRedGbsoy1cCGMFxPLOJiss254o2I5JasAUq7vnGp
// SIG // F1tnYN74kpEeHT39IM9zfUGaRnXNxF803RKJ1v2lIH1+
// SIG // /NmeRd+2ci/bfV+AutuqfjbsNkz2K26oElHovwUDo9Fz
// SIG // pk03dJQcNIIP8BDyt0cY7afomXw/TNuvXsLz1dhzPUNO
// SIG // wTM5TI4CvEJoLhDqhFFG4tG9ahhaYQFzymeiXtcodgLi
// SIG // Mxhy16cg8ML6EgrXY28MyTZki1ugpoMhXV8wdJGUlNi5
// SIG // UPkLiWHzNgY1GIRH29wb0f2y1BzFa/ZcUlFdEtsluq9Q
// SIG // BXpsxREdcu+N+VLEhReTwDwV2xo3xwgVGD94q0W29R6H
// SIG // XtqPnhZyacaue7e3PmriLq0CAwEAAaOCAd0wggHZMBIG
// SIG // CSsGAQQBgjcVAQQFAgMBAAEwIwYJKwYBBAGCNxUCBBYE
// SIG // FCqnUv5kxJq+gpE8RjUpzxD/LwTuMB0GA1UdDgQWBBSf
// SIG // pxVdAF5iXYP05dJlpxtTNRnpcjBcBgNVHSAEVTBTMFEG
// SIG // DCsGAQQBgjdMg30BATBBMD8GCCsGAQUFBwIBFjNodHRw
// SIG // Oi8vd3d3Lm1pY3Jvc29mdC5jb20vcGtpb3BzL0RvY3Mv
// SIG // UmVwb3NpdG9yeS5odG0wEwYDVR0lBAwwCgYIKwYBBQUH
// SIG // AwgwGQYJKwYBBAGCNxQCBAweCgBTAHUAYgBDAEEwCwYD
// SIG // VR0PBAQDAgGGMA8GA1UdEwEB/wQFMAMBAf8wHwYDVR0j
// SIG // BBgwFoAU1fZWy4/oolxiaNE9lJBb186aGMQwVgYDVR0f
// SIG // BE8wTTBLoEmgR4ZFaHR0cDovL2NybC5taWNyb3NvZnQu
// SIG // Y29tL3BraS9jcmwvcHJvZHVjdHMvTWljUm9vQ2VyQXV0
// SIG // XzIwMTAtMDYtMjMuY3JsMFoGCCsGAQUFBwEBBE4wTDBK
// SIG // BggrBgEFBQcwAoY+aHR0cDovL3d3dy5taWNyb3NvZnQu
// SIG // Y29tL3BraS9jZXJ0cy9NaWNSb29DZXJBdXRfMjAxMC0w
// SIG // Ni0yMy5jcnQwDQYJKoZIhvcNAQELBQADggIBAJ1Vffwq
// SIG // reEsH2cBMSRb4Z5yS/ypb+pcFLY+TkdkeLEGk5c9MTO1
// SIG // OdfCcTY/2mRsfNB1OW27DzHkwo/7bNGhlBgi7ulmZzpT
// SIG // Td2YurYeeNg2LpypglYAA7AFvonoaeC6Ce5732pvvinL
// SIG // btg/SHUB2RjebYIM9W0jVOR4U3UkV7ndn/OOPcbzaN9l
// SIG // 9qRWqveVtihVJ9AkvUCgvxm2EhIRXT0n4ECWOKz3+SmJ
// SIG // w7wXsFSFQrP8DJ6LGYnn8AtqgcKBGUIZUnWKNsIdw2Fz
// SIG // Lixre24/LAl4FOmRsqlb30mjdAy87JGA0j3mSj5mO0+7
// SIG // hvoyGtmW9I/2kQH2zsZ0/fZMcm8Qq3UwxTSwethQ/gpY
// SIG // 3UA8x1RtnWN0SCyxTkctwRQEcb9k+SS+c23Kjgm9swFX
// SIG // SVRk2XPXfx5bRAGOWhmRaw2fpCjcZxkoJLo4S5pu+yFU
// SIG // a2pFEUep8beuyOiJXk+d0tBMdrVXVAmxaQFEfnyhYWxz
// SIG // /gq77EFmPWn9y8FBSX5+k77L+DvktxW/tM4+pTFRhLy/
// SIG // AsGConsXHRWJjXD+57XQKBqJC4822rpM+Zv/Cuk0+CQ1
// SIG // ZyvgDbjmjJnW4SLq8CdCPSWU5nR0W2rRnj7tfqAxM328
// SIG // y+l7vzhwRNGQ8cirOoo6CGJ/2XBjU02N7oJtpQUQwXEG
// SIG // ahC0HVUzWLOhcGbyoYIDTTCCAjUCAQEwgfmhgdGkgc4w
// SIG // gcsxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5n
// SIG // dG9uMRAwDgYDVQQHEwdSZWRtb25kMR4wHAYDVQQKExVN
// SIG // aWNyb3NvZnQgQ29ycG9yYXRpb24xJTAjBgNVBAsTHE1p
// SIG // Y3Jvc29mdCBBbWVyaWNhIE9wZXJhdGlvbnMxJzAlBgNV
// SIG // BAsTHm5TaGllbGQgVFNTIEVTTjo4RDAwLTA1RTAtRDk0
// SIG // NzElMCMGA1UEAxMcTWljcm9zb2Z0IFRpbWUtU3RhbXAg
// SIG // U2VydmljZaIjCgEBMAcGBSsOAwIaAxUAaKn3ptiis7kW
// SIG // YyEmInxqJVTncgSggYMwgYCkfjB8MQswCQYDVQQGEwJV
// SIG // UzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMH
// SIG // UmVkbW9uZDEeMBwGA1UEChMVTWljcm9zb2Z0IENvcnBv
// SIG // cmF0aW9uMSYwJAYDVQQDEx1NaWNyb3NvZnQgVGltZS1T
// SIG // dGFtcCBQQ0EgMjAxMDANBgkqhkiG9w0BAQsFAAIFAOi8
// SIG // 9M8wIhgPMjAyMzA5MjYwNjEyMzFaGA8yMDIzMDkyNzA2
// SIG // MTIzMVowdDA6BgorBgEEAYRZCgQBMSwwKjAKAgUA6Lz0
// SIG // zwIBADAHAgEAAgISxjAHAgEAAgIUADAKAgUA6L5GTwIB
// SIG // ADA2BgorBgEEAYRZCgQCMSgwJjAMBgorBgEEAYRZCgMC
// SIG // oAowCAIBAAIDB6EgoQowCAIBAAIDAYagMA0GCSqGSIb3
// SIG // DQEBCwUAA4IBAQCI6hNjrD7ggACH/pYCPCnhkwclBZX3
// SIG // M2itD2jl2xtl6Rp3/hsnMHUxDusxo0gB+cxhzy9dLGCo
// SIG // 3iIxemzBrBdu3Y4cwRCN1lAW78uLMI17k0O/FUOMisio
// SIG // IdoKw4QX9Y5z8p4ed8kv20/z1S7QK2TVKD/kAQrnKh4K
// SIG // H45PLDQZtkjKNm/hTHpAk9wgEGu157WUHf0sLzSpewrj
// SIG // T3i03bbWH6nPlIH/8no62x4fE76ZeLSmcbTtx4/6ubox
// SIG // yyHuhLnvR7P0aSdicbSyUw88k+S+HJl63VlIwEwhjvGY
// SIG // +XtiNaUvmv+690AFbN0n7+NgUF6Kn0b0dmZF8hkZFdHh
// SIG // bfjoMYIEDTCCBAkCAQEwgZMwfDELMAkGA1UEBhMCVVMx
// SIG // EzARBgNVBAgTCldhc2hpbmd0b24xEDAOBgNVBAcTB1Jl
// SIG // ZG1vbmQxHjAcBgNVBAoTFU1pY3Jvc29mdCBDb3Jwb3Jh
// SIG // dGlvbjEmMCQGA1UEAxMdTWljcm9zb2Z0IFRpbWUtU3Rh
// SIG // bXAgUENBIDIwMTACEzMAAAHNVQcq58rBmR0AAQAAAc0w
// SIG // DQYJYIZIAWUDBAIBBQCgggFKMBoGCSqGSIb3DQEJAzEN
// SIG // BgsqhkiG9w0BCRABBDAvBgkqhkiG9w0BCQQxIgQgflVG
// SIG // pys2b0KSzizrIXoA0f44Plkp/W3E58nTFiSgvlswgfoG
// SIG // CyqGSIb3DQEJEAIvMYHqMIHnMIHkMIG9BCDiZqX4rVa9
// SIG // T2RoL0xHU6UrVHOhjYeyza6EASsKVEaZCjCBmDCBgKR+
// SIG // MHwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5n
// SIG // dG9uMRAwDgYDVQQHEwdSZWRtb25kMR4wHAYDVQQKExVN
// SIG // aWNyb3NvZnQgQ29ycG9yYXRpb24xJjAkBgNVBAMTHU1p
// SIG // Y3Jvc29mdCBUaW1lLVN0YW1wIFBDQSAyMDEwAhMzAAAB
// SIG // zVUHKufKwZkdAAEAAAHNMCIEIOHujXIYs6FmD9o3gCnW
// SIG // LH92Y9Ci9JPC3JcSMDT17f1tMA0GCSqGSIb3DQEBCwUA
// SIG // BIICAJokgYBN7U66j+ZEf43L6W4tOkZzm0rdalR37a2t
// SIG // vE2qyhR61h3JC0C1NParKx+ESjqWFWdIwt271DEKiEQx
// SIG // Fv8J6l5vfEUmcNWBzKNV0yR6GPO2/vueOBad4xHCpsLO
// SIG // iem8pzDD7YUzbyHnppvFjr68bSjC0IT4Cy2MJBXNcGFL
// SIG // Y9I4ZFP51RkhWVmTxM+TD5xXzXCCS36Plwb882GcNjmk
// SIG // 7FJX+ctcMMdZKPf3u60RVX686HKViaS81WYGXZZPSk4o
// SIG // f42uRe4rZuUqQFotjXsbOp4sQdAb2CKOg+q5yL5jGF0g
// SIG // E96r1GaXiAZQufx0xUMTE2IyCwLJWWUYB/tIjNTlZEo0
// SIG // KZ0rllPXRucqqo2AHi9Jz4QZBBz1lHviFPJZAfqnLdX1
// SIG // aDQjAJ8UMnkGbUwxQM1j9EOTfGwkmo2/jdY6uTVMUVDr
// SIG // efV1pQm/VcqS4wjH3QbTkxSD7q8Fi9I46rBUZa7ueOYn
// SIG // 7p2cknGtOAXgo1gsmWAwnxAvR2PYrZpnLeDoMMATe3k3
// SIG // Wt44uiB9XVfo86+O107Mv69HfOiNV6FRz5GSoEmLumfc
// SIG // Eaa6M0Zd2S0G0SCv1C7M+gCfMvLh/KI+VXvsHHUfBU3Z
// SIG // wN6IEoT1aFGpw8Bs/EGGW4buMMjnwzS2s3nZKFd5aofs
// SIG // uR1aonJyELBx7/rVihG4RAMQzbka
// SIG // End signature block
